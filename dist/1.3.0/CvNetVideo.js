(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.CvNetVideo=e()}})(function(){var n,t,i;return function(){function l(a,s,o){function c(i,e){if(!s[i]){if(!a[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(d)return d(i,!0);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}var n=s[i]={exports:{}};a[i][0].call(n.exports,function(e){var t=a[i][1][e];return c(t||e)},n,n.exports,l,a,s,o)}return s[i].exports}for(var d="function"==typeof require&&require,e=0;e<o.length;e++)c(o[e]);return c}return l}()({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function i(e,t){n(this,i)}r(i,[{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return-1}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;return-1}},{key:"StopVideo",value:function e(){}},{key:"onMediaWaiting",value:function e(){}},{key:"SetRtvsAddr",value:function e(t){}},{key:"onHlsInfo",value:function e(t){}},{key:"onMediaError",value:function e(){}},{key:"onWebrtcSFUInfo",value:function e(t){}},{key:"onBufferAppending",value:function e(t){}},{key:"onBufferReset",value:function e(t){}}]);return i}();i.default=a},{}],2:[function(e,t,i){"use strict";var a=this&&this.__awaiter||function(e,s,i,o){function c(t){return t instanceof i?t:new i(function(e){e(t)})}return new(i||(i=Promise))(function(t,i){function r(e){try{a(o.next(e))}catch(e){i(e)}}function n(e){try{a(o["throw"](e))}catch(e){i(e)}}function a(e){e.done?t(e.value):c(e.value).then(r,n)}a((o=o.apply(e,s||[])).next())})};Object.defineProperty(i,"__esModule",{value:true});class r{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=false;this.pendingTasks=[];this.ClosedErrorClass=Error;this.StoppedErrorClass=Error;this.ClosedErrorClass=e;this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(this.closed)return;this.closed=true;for(const e of this.pendingTasks){e.stopped=true;e.reject(new this.ClosedErrorClass("AwaitQueue closed"))}this.pendingTasks.length=0}push(r,n){return a(this,void 0,void 0,function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if(typeof r!=="function")throw new TypeError("given task is not a function");if(!r.name&&n){try{Object.defineProperty(r,"name",{value:n})}catch(e){}}return new Promise((e,t)=>{const i={task:r,name:n,resolve:e,reject:t,stopped:false,enqueuedAt:new Date,executedAt:undefined};this.pendingTasks.push(i);if(this.pendingTasks.length===1)this.next()})})}stop(){if(this.closed)return;for(const e of this.pendingTasks){e.stopped=true;e.reject(new this.StoppedErrorClass("AwaitQueue stopped"))}this.pendingTasks.length=0}dump(){const t=new Date;return this.pendingTasks.map(e=>{return{task:e.task,name:e.name,enqueuedTime:e.executedAt?e.executedAt.getTime()-e.enqueuedAt.getTime():t.getTime()-e.enqueuedAt.getTime(),executingTime:e.executedAt?t.getTime()-e.executedAt.getTime():0}})}next(){return a(this,void 0,void 0,function*(){const e=this.pendingTasks[0];if(!e)return;yield this.executeTask(e);this.pendingTasks.shift();this.next()})}executeTask(t){return a(this,void 0,void 0,function*(){if(t.stopped)return;t.executedAt=new Date;try{const e=yield t.task();if(t.stopped)return;t.resolve(e)}catch(e){if(t.stopped)return;t.reject(e)}})}}i.AwaitQueue=r},{}],3:[function(e,t,i){"use strict";i.byteLength=s;i.toByteArray=o;i.fromByteArray=m;var c=[];var d=[];var l=typeof Uint8Array!=="undefined"?Uint8Array:Array;var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var n=0,a=r.length;n<a;++n){c[n]=r[n];d[r.charCodeAt(n)]=n}d["-".charCodeAt(0)]=62;d["_".charCodeAt(0)]=63;function u(e){var t=e.length;if(t%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var i=e.indexOf("=");if(i===-1)i=t;var r=i===t?0:4-i%4;return[i,r]}function s(e){var t=u(e);var i=t[0];var r=t[1];return(i+r)*3/4-r}function f(e,t,i){return(t+i)*3/4-i}function o(e){var t;var i=u(e);var r=i[0];var n=i[1];var a=new l(f(e,r,n));var s=0;var o=n>0?r-4:r;var c;for(c=0;c<o;c+=4){t=d[e.charCodeAt(c)]<<18|d[e.charCodeAt(c+1)]<<12|d[e.charCodeAt(c+2)]<<6|d[e.charCodeAt(c+3)];a[s++]=t>>16&255;a[s++]=t>>8&255;a[s++]=t&255}if(n===2){t=d[e.charCodeAt(c)]<<2|d[e.charCodeAt(c+1)]>>4;a[s++]=t&255}if(n===1){t=d[e.charCodeAt(c)]<<10|d[e.charCodeAt(c+1)]<<4|d[e.charCodeAt(c+2)]>>2;a[s++]=t>>8&255;a[s++]=t&255}return a}function h(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[e&63]}function p(e,t,i){var r;var n=[];for(var a=t;a<i;a+=3){r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(e[a+2]&255);n.push(h(r))}return n.join("")}function m(e){var t;var i=e.length;var r=i%3;var n=[];var a=16383;for(var s=0,o=i-r;s<o;s+=a){n.push(p(e,s,s+a>o?o:s+a))}if(r===1){t=e[i-1];n.push(c[t>>2]+c[t<<4&63]+"==")}else if(r===2){t=(e[i-2]<<8)+e[i-1];n.push(c[t>>10]+c[t>>4&63]+c[t<<2&63]+"=")}return n.join("")}},{}],4:[function(e,i,r){!function(e,t){"object"==typeof r&&"object"==typeof i?i.exports=t():"function"==typeof n&&n.amd?n([],t):"object"==typeof r?r.bowser=t():e.bowser=t()}(this,function(){return function(i){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=i,n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}({17:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r=i(18),n=function(){function c(){}return c.getFirstMatch=function(e,t){var i=t.match(e);return i&&i.length>0&&i[1]||""},c.getSecondMatch=function(e,t){var i=t.match(e);return i&&i.length>1&&i[2]||""},c.matchAndReturnConst=function(e,t,i){if(e.test(t))return i},c.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},c.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},c.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},c.getVersionPrecision=function(e){return e.split(".").length},c.compareVersions=function(e,t,i){void 0===i&&(i=!1);var r=c.getVersionPrecision(e),n=c.getVersionPrecision(t),a=Math.max(r,n),s=0,o=c.map([e,t],function(e){var t=a-c.getVersionPrecision(e),i=e+new Array(t+1).join(".0");return c.map(i.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});for(i&&(s=a-Math.min(r,n)),a-=1;a>=s;){if(o[0][a]>o[1][a])return 1;if(o[0][a]===o[1][a]){if(a===s)return 0;a-=1}else if(o[0][a]<o[1][a])return-1}},c.map=function(e,t){var i,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(i=0;i<e.length;i+=1)r.push(t(e[i]));return r},c.find=function(e,t){var i,r;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(i=0,r=e.length;i<r;i+=1){var n=e[i];if(t(n,i))return n}},c.assign=function(e){for(var i,t,r=e,n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(a));var o=function(){var t=a[i];"object"==typeof t&&null!==t&&Object.keys(t).forEach(function(e){r[e]=t[e]})};for(i=0,t=a.length;i<t;i+=1)o();return e},c.getBrowserAlias=function(e){return r.BROWSER_ALIASES_MAP[e]},c.getBrowserTypeByAlias=function(e){return r.BROWSER_MAP[e]||""},c}();t.default=n,e.exports=t.default},18:function(e,t,i){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0;t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"};t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"};t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"};t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"};t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(91))&&r.__esModule?r:{default:r},a=i(18);function s(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){}var t,i,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new n.default(e,t)},e.parse=function(e){return new n.default(e).getResult()},t=e,r=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}],(i=null)&&s(t.prototype,i),r&&s(t,r),e}();t.default=o,e.exports=t.default},91:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r=o(i(92)),n=o(i(93)),a=o(i(94)),s=o(i(95)),h=o(i(17));function o(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var t=this;this.parsedResult.browser={};var e=h.default.find(r.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var t=this;this.parsedResult.os={};var e=h.default.find(n.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var t=this;this.parsedResult.platform={};var e=h.default.find(a.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var t=this;this.parsedResult.engine={};var e=h.default.find(s.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return h.default.assign({},this.parsedResult)},t.satisfies=function(i){var t=this,r={},n=0,a={},s=0;if(Object.keys(i).forEach(function(e){var t=i[e];"string"==typeof t?(a[e]=t,s+=1):"object"==typeof t&&(r[e]=t,n+=1)}),n>0){var e=Object.keys(r),o=h.default.find(e,function(e){return t.isOS(e)});if(o){var c=this.satisfies(r[o]);if(void 0!==c)return c}var d=h.default.find(e,function(e){return t.isPlatform(e)});if(d){var l=this.satisfies(r[d]);if(void 0!==l)return l}}if(s>0){var u=Object.keys(a),f=h.default.find(u,function(e){return t.isBrowser(e,!0)});if(void 0!==f)return this.compareVersion(a[f])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var i=this.getBrowserName().toLowerCase(),r=e.toLowerCase(),n=h.default.getBrowserTypeByAlias(r);return t&&n&&(r=n.toLowerCase()),r===i},t.compareVersion=function(e){var t=[0],i=e,r=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===e[0]||"<"===e[0]?(i=e.substr(1),"="===e[1]?(r=!0,i=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?i=e.substr(1):"~"===e[0]&&(r=!0,i=e.substr(1)),t.indexOf(h.default.compareVersions(n,i,r))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some(function(e){return t.is(e)})},e}();t.default=c,e.exports=t.default},92:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(17))&&r.__esModule?r:{default:r};var a=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},i=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},i=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},i=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},i=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},i=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},i=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},i=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},i=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},i=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},i=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},i=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},i=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},i=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},i=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},i=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return i&&(t.version=i),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},i=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},i=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},i=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},i=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},i=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},i=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},i=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},i=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},i=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},i=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},i=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},i=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},i=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:function(e){var t=!e.test(/like android/i),i=e.test(/android/i);return t&&i},describe:function(e){var t={name:"Android Browser"},i=n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},i=n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},i=n.default.getFirstMatch(a,e);return i&&(t.version=i),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(t,e),version:n.default.getSecondMatch(t,e)}}}];t.default=s,e.exports=t.default},93:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(17))&&r.__esModule?r:{default:r},a=i(18);var s=[{test:[/Roku\/DVP/],describe:function(e){var t=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:a.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),i=n.default.getWindowsVersionName(t);return{name:a.OS_MAP.Windows,version:t,versionName:i}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:a.OS_MAP.iOS},i=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return i&&(t.version=i),t}},{test:[/macintosh/i],describe:function(e){var t=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),i=n.default.getMacOSVersionName(t),r={name:a.OS_MAP.MacOS,version:t};return i&&(r.versionName=i),r}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:a.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),i=e.test(/android/i);return t&&i},describe:function(e){var t=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),i=n.default.getAndroidVersionName(t),r={name:a.OS_MAP.Android,version:t};return i&&(r.versionName=i),r}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),i={name:a.OS_MAP.WebOS};return t&&t.length&&(i.version=t),i}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||n.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:a.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:a.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:a.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.PlayStation4,version:t}}}];t.default=s,e.exports=t.default},94:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(17))&&r.__esModule?r:{default:r},a=i(18);var s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=n.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",i={type:a.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(i.model=t),i}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),i=e.test(/like (ipod|iphone)/i);return t&&!i},describe:function(e){var t=n.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:a.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.tv}}}];t.default=s,e.exports=t.default},95:function(e,t,i){"use strict";t.__esModule=!0,t.default=void 0;var r,n=(r=i(17))&&r.__esModule?r:{default:r},a=i(18);var s=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:a.ENGINE_MAP.Blink};var t=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:a.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:a.ENGINE_MAP.Trident},i=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:a.ENGINE_MAP.Presto},i=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:function(e){var t=e.test(/gecko/i),i=e.test(/like gecko/i);return t&&!i},describe:function(e){var t={name:a.ENGINE_MAP.Gecko},i=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:a.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:a.ENGINE_MAP.WebKit},i=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return i&&(t.version=i),t}}];t.default=s,e.exports=t.default}})})},{}],5:[function(ee,e,te){(function(Q,e){(function(){"use strict";var r=ee("base64-js");var a=ee("ieee754");var o=ee("isarray");te.Buffer=f;te.SlowBuffer=t;te.INSPECT_MAX_BYTES=50;f.TYPED_ARRAY_SUPPORT=Q.TYPED_ARRAY_SUPPORT!==undefined?Q.TYPED_ARRAY_SUPPORT:e();te.kMaxLength=i();function e(){try{var e=new Uint8Array(1);e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return e.foo()===42&&typeof e.subarray==="function"&&e.subarray(1,1).byteLength===0}catch(e){return false}}function i(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(i()<t){throw new RangeError("Invalid typed array length")}if(f.TYPED_ARRAY_SUPPORT){e=new Uint8Array(t);e.__proto__=f.prototype}else{if(e===null){e=new f(t)}e.length=t}return e}function f(e,t,i){if(!f.TYPED_ARRAY_SUPPORT&&!(this instanceof f)){return new f(e,t,i)}if(typeof e==="number"){if(typeof t==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return l(this,e)}return n(this,e,t,i)}f.poolSize=8192;f._augment=function(e){e.__proto__=f.prototype;return e};function n(e,t,i,r){if(typeof t==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&t instanceof ArrayBuffer){return p(e,t,i,r)}if(typeof t==="string"){return u(e,t,i)}return m(e,t)}f.from=function(e,t,i){return n(null,e,t,i)};if(f.TYPED_ARRAY_SUPPORT){f.prototype.__proto__=Uint8Array.prototype;f.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&f[Symbol.species]===f){Object.defineProperty(f,Symbol.species,{value:null,configurable:true})}}function c(e){if(typeof e!=="number"){throw new TypeError('"size" argument must be a number')}else if(e<0){throw new RangeError('"size" argument must not be negative')}}function d(e,t,i,r){c(t);if(t<=0){return s(e,t)}if(i!==undefined){return typeof r==="string"?s(e,t).fill(i,r):s(e,t).fill(i)}return s(e,t)}f.alloc=function(e,t,i){return d(null,e,t,i)};function l(e,t){c(t);e=s(e,t<0?0:v(t)|0);if(!f.TYPED_ARRAY_SUPPORT){for(var i=0;i<t;++i){e[i]=0}}return e}f.allocUnsafe=function(e){return l(null,e)};f.allocUnsafeSlow=function(e){return l(null,e)};function u(e,t,i){if(typeof i!=="string"||i===""){i="utf8"}if(!f.isEncoding(i)){throw new TypeError('"encoding" must be a valid string encoding')}var r=y(t,i)|0;e=s(e,r);var n=e.write(t,i);if(n!==r){e=e.slice(0,n)}return e}function h(e,t){var i=t.length<0?0:v(t.length)|0;e=s(e,i);for(var r=0;r<i;r+=1){e[r]=t[r]&255}return e}function p(e,t,i,r){t.byteLength;if(i<0||t.byteLength<i){throw new RangeError("'offset' is out of bounds")}if(t.byteLength<i+(r||0)){throw new RangeError("'length' is out of bounds")}if(i===undefined&&r===undefined){t=new Uint8Array(t)}else if(r===undefined){t=new Uint8Array(t,i)}else{t=new Uint8Array(t,i,r)}if(f.TYPED_ARRAY_SUPPORT){e=t;e.__proto__=f.prototype}else{e=h(e,t)}return e}function m(e,t){if(f.isBuffer(t)){var i=v(t.length)|0;e=s(e,i);if(e.length===0){return e}t.copy(e,0,0,i);return e}if(t){if(typeof ArrayBuffer!=="undefined"&&t.buffer instanceof ArrayBuffer||"length"in t){if(typeof t.length!=="number"||Z(t.length)){return s(e,0)}return h(e,t)}if(t.type==="Buffer"&&o(t.data)){return h(e,t.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function v(e){if(e>=i()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+i().toString(16)+" bytes")}return e|0}function t(e){if(+e!=e){e=0}return f.alloc(+e)}f.isBuffer=function e(t){return!!(t!=null&&t._isBuffer)};f.compare=function e(t,i){if(!f.isBuffer(t)||!f.isBuffer(i)){throw new TypeError("Arguments must be Buffers")}if(t===i)return 0;var r=t.length;var n=i.length;for(var a=0,s=Math.min(r,n);a<s;++a){if(t[a]!==i[a]){r=t[a];n=i[a];break}}if(r<n)return-1;if(n<r)return 1;return 0};f.isEncoding=function e(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};f.concat=function e(t,i){if(!o(t)){throw new TypeError('"list" argument must be an Array of Buffers')}if(t.length===0){return f.alloc(0)}var r;if(i===undefined){i=0;for(r=0;r<t.length;++r){i+=t[r].length}}var n=f.allocUnsafe(i);var a=0;for(r=0;r<t.length;++r){var s=t[r];if(!f.isBuffer(s)){throw new TypeError('"list" argument must be an Array of Buffers')}s.copy(n,a);a+=s.length}return n};function y(e,t){if(f.isBuffer(e)){return e.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer)){return e.byteLength}if(typeof e!=="string"){e=""+e}var i=e.length;if(i===0)return 0;var r=false;for(;;){switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case undefined:return X(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return i*2;case"hex":return i>>>1;case"base64":return Y(e).length;default:if(r)return X(e).length;t=(""+t).toLowerCase();r=true}}}f.byteLength=y;function g(e,t,i){var r=false;if(t===undefined||t<0){t=0}if(t>this.length){return""}if(i===undefined||i>this.length){i=this.length}if(i<=0){return""}i>>>=0;t>>>=0;if(i<=t){return""}if(!e)e="utf8";while(true){switch(e){case"hex":return B(this,t,i);case"utf8":case"utf-8":return x(this,t,i);case"ascii":return I(this,t,i);case"latin1":case"binary":return A(this,t,i);case"base64":return E(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();r=true}}}f.prototype._isBuffer=true;function _(e,t,i){var r=e[t];e[t]=e[i];e[i]=r}f.prototype.swap16=function e(){var t=this.length;if(t%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<t;i+=2){_(this,i,i+1)}return this};f.prototype.swap32=function e(){var t=this.length;if(t%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<t;i+=4){_(this,i,i+3);_(this,i+1,i+2)}return this};f.prototype.swap64=function e(){var t=this.length;if(t%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<t;i+=8){_(this,i,i+7);_(this,i+1,i+6);_(this,i+2,i+5);_(this,i+3,i+4)}return this};f.prototype.toString=function e(){var t=this.length|0;if(t===0)return"";if(arguments.length===0)return x(this,0,t);return g.apply(this,arguments)};f.prototype.equals=function e(t){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(this===t)return true;return f.compare(this,t)===0};f.prototype.inspect=function e(){var t="";var i=te.INSPECT_MAX_BYTES;if(this.length>0){t=this.toString("hex",0,i).match(/.{2}/g).join(" ");if(this.length>i)t+=" ... "}return"<Buffer "+t+">"};f.prototype.compare=function e(t,i,r,n,a){if(!f.isBuffer(t)){throw new TypeError("Argument must be a Buffer")}if(i===undefined){i=0}if(r===undefined){r=t?t.length:0}if(n===undefined){n=0}if(a===undefined){a=this.length}if(i<0||r>t.length||n<0||a>this.length){throw new RangeError("out of range index")}if(n>=a&&i>=r){return 0}if(n>=a){return-1}if(i>=r){return 1}i>>>=0;r>>>=0;n>>>=0;a>>>=0;if(this===t)return 0;var s=a-n;var o=r-i;var c=Math.min(s,o);var d=this.slice(n,a);var l=t.slice(i,r);for(var u=0;u<c;++u){if(d[u]!==l[u]){s=d[u];o=l[u];break}}if(s<o)return-1;if(o<s)return 1;return 0};function b(e,t,i,r,n){if(e.length===0)return-1;if(typeof i==="string"){r=i;i=0}else if(i>2147483647){i=2147483647}else if(i<-2147483648){i=-2147483648}i=+i;if(isNaN(i)){i=n?0:e.length-1}if(i<0)i=e.length+i;if(i>=e.length){if(n)return-1;else i=e.length-1}else if(i<0){if(n)i=0;else return-1}if(typeof t==="string"){t=f.from(t,r)}if(f.isBuffer(t)){if(t.length===0){return-1}return w(e,t,i,r,n)}else if(typeof t==="number"){t=t&255;if(f.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(n){return Uint8Array.prototype.indexOf.call(e,t,i)}else{return Uint8Array.prototype.lastIndexOf.call(e,t,i)}}return w(e,[t],i,r,n)}throw new TypeError("val must be string, number or Buffer")}function w(e,t,i,r,n){var a=1;var s=e.length;var o=t.length;if(r!==undefined){r=String(r).toLowerCase();if(r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le"){if(e.length<2||t.length<2){return-1}a=2;s/=2;o/=2;i/=2}}function c(e,t){if(a===1){return e[t]}else{return e.readUInt16BE(t*a)}}var d;if(n){var l=-1;for(d=i;d<s;d++){if(c(e,d)===c(t,l===-1?0:d-l)){if(l===-1)l=d;if(d-l+1===o)return l*a}else{if(l!==-1)d-=d-l;l=-1}}}else{if(i+o>s)i=s-o;for(d=i;d>=0;d--){var u=true;for(var f=0;f<o;f++){if(c(e,d+f)!==c(t,f)){u=false;break}}if(u)return d}}return-1}f.prototype.includes=function e(t,i,r){return this.indexOf(t,i,r)!==-1};f.prototype.indexOf=function e(t,i,r){return b(this,t,i,r,true)};f.prototype.lastIndexOf=function e(t,i,r){return b(this,t,i,r,false)};function S(e,t,i,r){i=Number(i)||0;var n=e.length-i;if(!r){r=n}else{r=Number(r);if(r>n){r=n}}var a=t.length;if(a%2!==0)throw new TypeError("Invalid hex string");if(r>a/2){r=a/2}for(var s=0;s<r;++s){var o=parseInt(t.substr(s*2,2),16);if(isNaN(o))return s;e[i+s]=o}return s}function k(e,t,i,r){return $(X(t,e.length-i),e,i,r)}function C(e,t,i,r){return $(J(t),e,i,r)}function T(e,t,i,r){return C(e,t,i,r)}function P(e,t,i,r){return $(Y(t),e,i,r)}function R(e,t,i,r){return $(K(t,e.length-i),e,i,r)}f.prototype.write=function e(t,i,r,n){if(i===undefined){n="utf8";r=this.length;i=0}else if(r===undefined&&typeof i==="string"){n=i;r=this.length;i=0}else if(isFinite(i)){i=i|0;if(isFinite(r)){r=r|0;if(n===undefined)n="utf8"}else{n=r;r=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var a=this.length-i;if(r===undefined||r>a)r=a;if(t.length>0&&(r<0||i<0)||i>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!n)n="utf8";var s=false;for(;;){switch(n){case"hex":return S(this,t,i,r);case"utf8":case"utf-8":return k(this,t,i,r);case"ascii":return C(this,t,i,r);case"latin1":case"binary":return T(this,t,i,r);case"base64":return P(this,t,i,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,i,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase();s=true}}};f.prototype.toJSON=function e(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function E(e,t,i){if(t===0&&i===e.length){return r.fromByteArray(e)}else{return r.fromByteArray(e.slice(t,i))}}function x(e,t,i){i=Math.min(e.length,i);var r=[];var n=t;while(n<i){var a=e[n];var s=null;var o=a>239?4:a>223?3:a>191?2:1;if(n+o<=i){var c,d,l,u;switch(o){case 1:if(a<128){s=a}break;case 2:c=e[n+1];if((c&192)===128){u=(a&31)<<6|c&63;if(u>127){s=u}}break;case 3:c=e[n+1];d=e[n+2];if((c&192)===128&&(d&192)===128){u=(a&15)<<12|(c&63)<<6|d&63;if(u>2047&&(u<55296||u>57343)){s=u}}break;case 4:c=e[n+1];d=e[n+2];l=e[n+3];if((c&192)===128&&(d&192)===128&&(l&192)===128){u=(a&15)<<18|(c&63)<<12|(d&63)<<6|l&63;if(u>65535&&u<1114112){s=u}}}}if(s===null){s=65533;o=1}else if(s>65535){s-=65536;r.push(s>>>10&1023|55296);s=56320|s&1023}r.push(s);n+=o}return D(r)}var M=4096;function D(e){var t=e.length;if(t<=M){return String.fromCharCode.apply(String,e)}var i="";var r=0;while(r<t){i+=String.fromCharCode.apply(String,e.slice(r,r+=M))}return i}function I(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n){r+=String.fromCharCode(e[n]&127)}return r}function A(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n){r+=String.fromCharCode(e[n])}return r}function B(e,t,i){var r=e.length;if(!t||t<0)t=0;if(!i||i<0||i>r)i=r;var n="";for(var a=t;a<i;++a){n+=z(e[a])}return n}function L(e,t,i){var r=e.slice(t,i);var n="";for(var a=0;a<r.length;a+=2){n+=String.fromCharCode(r[a]+r[a+1]*256)}return n}f.prototype.slice=function e(t,i){var r=this.length;t=~~t;i=i===undefined?r:~~i;if(t<0){t+=r;if(t<0)t=0}else if(t>r){t=r}if(i<0){i+=r;if(i<0)i=0}else if(i>r){i=r}if(i<t)i=t;var n;if(f.TYPED_ARRAY_SUPPORT){n=this.subarray(t,i);n.__proto__=f.prototype}else{var a=i-t;n=new f(a,undefined);for(var s=0;s<a;++s){n[s]=this[s+t]}}return n};function O(e,t,i){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUIntLE=function e(t,i,r){t=t|0;i=i|0;if(!r)O(t,i,this.length);var n=this[t];var a=1;var s=0;while(++s<i&&(a*=256)){n+=this[t+s]*a}return n};f.prototype.readUIntBE=function e(t,i,r){t=t|0;i=i|0;if(!r){O(t,i,this.length)}var n=this[t+--i];var a=1;while(i>0&&(a*=256)){n+=this[t+--i]*a}return n};f.prototype.readUInt8=function e(t,i){if(!i)O(t,1,this.length);return this[t]};f.prototype.readUInt16LE=function e(t,i){if(!i)O(t,2,this.length);return this[t]|this[t+1]<<8};f.prototype.readUInt16BE=function e(t,i){if(!i)O(t,2,this.length);return this[t]<<8|this[t+1]};f.prototype.readUInt32LE=function e(t,i){if(!i)O(t,4,this.length);return(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};f.prototype.readUInt32BE=function e(t,i){if(!i)O(t,4,this.length);return this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};f.prototype.readIntLE=function e(t,i,r){t=t|0;i=i|0;if(!r)O(t,i,this.length);var n=this[t];var a=1;var s=0;while(++s<i&&(a*=256)){n+=this[t+s]*a}a*=128;if(n>=a)n-=Math.pow(2,8*i);return n};f.prototype.readIntBE=function e(t,i,r){t=t|0;i=i|0;if(!r)O(t,i,this.length);var n=i;var a=1;var s=this[t+--n];while(n>0&&(a*=256)){s+=this[t+--n]*a}a*=128;if(s>=a)s-=Math.pow(2,8*i);return s};f.prototype.readInt8=function e(t,i){if(!i)O(t,1,this.length);if(!(this[t]&128))return this[t];return(255-this[t]+1)*-1};f.prototype.readInt16LE=function e(t,i){if(!i)O(t,2,this.length);var r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r};f.prototype.readInt16BE=function e(t,i){if(!i)O(t,2,this.length);var r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r};f.prototype.readInt32LE=function e(t,i){if(!i)O(t,4,this.length);return this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};f.prototype.readInt32BE=function e(t,i){if(!i)O(t,4,this.length);return this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};f.prototype.readFloatLE=function e(t,i){if(!i)O(t,4,this.length);return a.read(this,t,true,23,4)};f.prototype.readFloatBE=function e(t,i){if(!i)O(t,4,this.length);return a.read(this,t,false,23,4)};f.prototype.readDoubleLE=function e(t,i){if(!i)O(t,8,this.length);return a.read(this,t,true,52,8)};f.prototype.readDoubleBE=function e(t,i){if(!i)O(t,8,this.length);return a.read(this,t,false,52,8)};function F(e,t,i,r,n,a){if(!f.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<a)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}f.prototype.writeUIntLE=function e(t,i,r,n){t=+t;i=i|0;r=r|0;if(!n){var a=Math.pow(2,8*r)-1;F(this,t,i,r,a,0)}var s=1;var o=0;this[i]=t&255;while(++o<r&&(s*=256)){this[i+o]=t/s&255}return i+r};f.prototype.writeUIntBE=function e(t,i,r,n){t=+t;i=i|0;r=r|0;if(!n){var a=Math.pow(2,8*r)-1;F(this,t,i,r,a,0)}var s=r-1;var o=1;this[i+s]=t&255;while(--s>=0&&(o*=256)){this[i+s]=t/o&255}return i+r};f.prototype.writeUInt8=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,1,255,0);if(!f.TYPED_ARRAY_SUPPORT)t=Math.floor(t);this[i]=t&255;return i+1};function j(e,t,i,r){if(t<0)t=65535+t+1;for(var n=0,a=Math.min(e.length-i,2);n<a;++n){e[i+n]=(t&255<<8*(r?n:1-n))>>>(r?n:1-n)*8}}f.prototype.writeUInt16LE=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,2,65535,0);if(f.TYPED_ARRAY_SUPPORT){this[i]=t&255;this[i+1]=t>>>8}else{j(this,t,i,true)}return i+2};f.prototype.writeUInt16BE=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,2,65535,0);if(f.TYPED_ARRAY_SUPPORT){this[i]=t>>>8;this[i+1]=t&255}else{j(this,t,i,false)}return i+2};function V(e,t,i,r){if(t<0)t=4294967295+t+1;for(var n=0,a=Math.min(e.length-i,4);n<a;++n){e[i+n]=t>>>(r?n:3-n)*8&255}}f.prototype.writeUInt32LE=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,4,4294967295,0);if(f.TYPED_ARRAY_SUPPORT){this[i+3]=t>>>24;this[i+2]=t>>>16;this[i+1]=t>>>8;this[i]=t&255}else{V(this,t,i,true)}return i+4};f.prototype.writeUInt32BE=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,4,4294967295,0);if(f.TYPED_ARRAY_SUPPORT){this[i]=t>>>24;this[i+1]=t>>>16;this[i+2]=t>>>8;this[i+3]=t&255}else{V(this,t,i,false)}return i+4};f.prototype.writeIntLE=function e(t,i,r,n){t=+t;i=i|0;if(!n){var a=Math.pow(2,8*r-1);F(this,t,i,r,a-1,-a)}var s=0;var o=1;var c=0;this[i]=t&255;while(++s<r&&(o*=256)){if(t<0&&c===0&&this[i+s-1]!==0){c=1}this[i+s]=(t/o>>0)-c&255}return i+r};f.prototype.writeIntBE=function e(t,i,r,n){t=+t;i=i|0;if(!n){var a=Math.pow(2,8*r-1);F(this,t,i,r,a-1,-a)}var s=r-1;var o=1;var c=0;this[i+s]=t&255;while(--s>=0&&(o*=256)){if(t<0&&c===0&&this[i+s+1]!==0){c=1}this[i+s]=(t/o>>0)-c&255}return i+r};f.prototype.writeInt8=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,1,127,-128);if(!f.TYPED_ARRAY_SUPPORT)t=Math.floor(t);if(t<0)t=255+t+1;this[i]=t&255;return i+1};f.prototype.writeInt16LE=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,2,32767,-32768);if(f.TYPED_ARRAY_SUPPORT){this[i]=t&255;this[i+1]=t>>>8}else{j(this,t,i,true)}return i+2};f.prototype.writeInt16BE=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,2,32767,-32768);if(f.TYPED_ARRAY_SUPPORT){this[i]=t>>>8;this[i+1]=t&255}else{j(this,t,i,false)}return i+2};f.prototype.writeInt32LE=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,4,2147483647,-2147483648);if(f.TYPED_ARRAY_SUPPORT){this[i]=t&255;this[i+1]=t>>>8;this[i+2]=t>>>16;this[i+3]=t>>>24}else{V(this,t,i,true)}return i+4};f.prototype.writeInt32BE=function e(t,i,r){t=+t;i=i|0;if(!r)F(this,t,i,4,2147483647,-2147483648);if(t<0)t=4294967295+t+1;if(f.TYPED_ARRAY_SUPPORT){this[i]=t>>>24;this[i+1]=t>>>16;this[i+2]=t>>>8;this[i+3]=t&255}else{V(this,t,i,false)}return i+4};function N(e,t,i,r,n,a){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function U(e,t,i,r,n){if(!n){N(e,t,i,4,34028234663852886e22,-34028234663852886e22)}a.write(e,t,i,r,23,4);return i+4}f.prototype.writeFloatLE=function e(t,i,r){return U(this,t,i,true,r)};f.prototype.writeFloatBE=function e(t,i,r){return U(this,t,i,false,r)};function W(e,t,i,r,n){if(!n){N(e,t,i,8,17976931348623157e292,-17976931348623157e292)}a.write(e,t,i,r,52,8);return i+8}f.prototype.writeDoubleLE=function e(t,i,r){return W(this,t,i,true,r)};f.prototype.writeDoubleBE=function e(t,i,r){return W(this,t,i,false,r)};f.prototype.copy=function e(t,i,r,n){if(!r)r=0;if(!n&&n!==0)n=this.length;if(i>=t.length)i=t.length;if(!i)i=0;if(n>0&&n<r)n=r;if(n===r)return 0;if(t.length===0||this.length===0)return 0;if(i<0){throw new RangeError("targetStart out of bounds")}if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");if(n>this.length)n=this.length;if(t.length-i<n-r){n=t.length-i+r}var a=n-r;var s;if(this===t&&r<i&&i<n){for(s=a-1;s>=0;--s){t[s+i]=this[s+r]}}else if(a<1e3||!f.TYPED_ARRAY_SUPPORT){for(s=0;s<a;++s){t[s+i]=this[s+r]}}else{Uint8Array.prototype.set.call(t,this.subarray(r,r+a),i)}return a};f.prototype.fill=function e(t,i,r,n){if(typeof t==="string"){if(typeof i==="string"){n=i;i=0;r=this.length}else if(typeof r==="string"){n=r;r=this.length}if(t.length===1){var a=t.charCodeAt(0);if(a<256){t=a}}if(n!==undefined&&typeof n!=="string"){throw new TypeError("encoding must be a string")}if(typeof n==="string"&&!f.isEncoding(n)){throw new TypeError("Unknown encoding: "+n)}}else if(typeof t==="number"){t=t&255}if(i<0||this.length<i||this.length<r){throw new RangeError("Out of range index")}if(r<=i){return this}i=i>>>0;r=r===undefined?this.length:r>>>0;if(!t)t=0;var s;if(typeof t==="number"){for(s=i;s<r;++s){this[s]=t}}else{var o=f.isBuffer(t)?t:X(new f(t,n).toString());var c=o.length;for(s=0;s<r-i;++s){this[s+i]=o[s%c]}}return this};var G=/[^+\/0-9A-Za-z-_]/g;function H(e){e=q(e).replace(G,"");if(e.length<2)return"";while(e.length%4!==0){e=e+"="}return e}function q(e){if(e.trim)return e.trim();return e.replace(/^\s+|\s+$/g,"")}function z(e){if(e<16)return"0"+e.toString(16);return e.toString(16)}function X(e,t){t=t||Infinity;var i;var r=e.length;var n=null;var a=[];for(var s=0;s<r;++s){i=e.charCodeAt(s);if(i>55295&&i<57344){if(!n){if(i>56319){if((t-=3)>-1)a.push(239,191,189);continue}else if(s+1===r){if((t-=3)>-1)a.push(239,191,189);continue}n=i;continue}if(i<56320){if((t-=3)>-1)a.push(239,191,189);n=i;continue}i=(n-55296<<10|i-56320)+65536}else if(n){if((t-=3)>-1)a.push(239,191,189)}n=null;if(i<128){if((t-=1)<0)break;a.push(i)}else if(i<2048){if((t-=2)<0)break;a.push(i>>6|192,i&63|128)}else if(i<65536){if((t-=3)<0)break;a.push(i>>12|224,i>>6&63|128,i&63|128)}else if(i<1114112){if((t-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else{throw new Error("Invalid code point")}}return a}function J(e){var t=[];for(var i=0;i<e.length;++i){t.push(e.charCodeAt(i)&255)}return t}function K(e,t){var i,r,n;var a=[];for(var s=0;s<e.length;++s){if((t-=2)<0)break;i=e.charCodeAt(s);r=i>>8;n=i%256;a.push(n);a.push(r)}return a}function Y(e){return r.toByteArray(H(e))}function $(e,t,i,r){for(var n=0;n<r;++n){if(n+i>=t.length||n>=e.length)break;t[n+i]=e[n]}return n}function Z(e){return e!==e}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},ee("buffer").Buffer)},{"base64-js":3,buffer:5,ieee754:15,isarray:17}],6:[function(e,t,i){var a=e("./lib/buffer-reader");var c=1;var d=3;var l=2;t.exports=function(e){var t={};var i=new a(e);t.trackNumber=i.nextUIntV();t.timecode=i.nextInt16BE();var r=i.nextUInt8();t.invisible=!!(r&8);t.keyframe=!!(r&128);t.discardable=!!(r&1);var n=(r&6)>>1;t.frames=s(i,n);return t};function s(e,t){if(!t)return[e.nextBuffer()];var i,r;var n=[];var a=e.nextUInt8()+1;if(t===l){if(e.length%a!==0)throw new Error("Fixed-Size Lacing Error");r=e.length/a;for(i=0;i<a;i++){n.push(e.nextBuffer(r))}return n}var s=[];if(t===c){for(i=0;i<a-1;i++){var o;r=0;do{o=e.nextUInt8();r+=o}while(o===255);s.push(r)}}else if(t===d){r=e.nextUIntV();s.push(r);for(i=1;i<a-1;i++){r+=e.nextIntV();s.push(r)}}for(i=0;i<a-1;i++){n.push(e.nextBuffer(s[i]))}n.push(e.nextBuffer());return n}},{"./lib/buffer-reader":7}],7:[function(e,t,i){var r=e("./vint");function n(e){this.buffer=e;this.offset=0}n.prototype.nextInt16BE=function(){var e=this.buffer.readInt16BE(this.offset);this.offset+=2;return e};n.prototype.nextUInt8=function(){var e=this.buffer.readUInt8(this.offset);this.offset+=1;return e};n.prototype.nextUIntV=function(){var e=r(this.buffer,this.offset);this.offset+=e.length;return e.value};n.prototype.nextIntV=function(){var e=r(this.buffer,this.offset,true);this.offset+=e.length;return e.value};n.prototype.nextBuffer=function(e){var t=e?this.buffer.slice(this.offset,this.offset+e):this.buffer.slice(this.offset);this.offset+=e||this.length;return t};Object.defineProperty(n.prototype,"length",{get:function(){return this.buffer.length-this.offset}});t.exports=n},{"./vint":8}],8:[function(e,t,i){t.exports=function(e,t,i){t=t||0;for(var r=1;r<=8;r++){if(e[t]>=Math.pow(2,8-r)){break}}if(r>8){throw new Error("Unrepresentable length: "+r+" "+e.toString("hex",t,t+r))}if(t+r>e.length){return null}var n;var a=e[t]&(1<<8-r)-1;for(n=1;n<r;n++){if(n===7){if(a>=Math.pow(2,53-8)&&e[t+7]>0){return{length:r,value:-1}}}a*=Math.pow(2,8);a+=e[t+n]}if(i){a-=Math.pow(2,r*7-1)-1}return{length:r,value:a}}},{}],9:[function(e,t,i){var r=function(){if(typeof self==="object"&&self)return self;if(typeof window==="object"&&window)return window;throw new Error("Unable to resolve global `this`")};t.exports=function(){if(this)return this;if(typeof globalThis==="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:true})}catch(e){return r()}try{if(!__global__)return r();return __global__}finally{delete Object.prototype.__global__}}()},{}],10:[function(e,t,i){function r(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}t.exports=r;r.EventEmitter=r;r.prototype._events=undefined;r.prototype._maxListeners=undefined;r.defaultMaxListeners=10;r.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};r.prototype.emit=function(e){var t,i,r,n,a,s;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||d(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}else{var o=new Error('Uncaught, unspecified "error" event. ('+t+")");o.context=t;throw o}}}i=this._events[e];if(l(i))return false;if(c(i)){switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1);i.apply(this,n)}}else if(d(i)){n=Array.prototype.slice.call(arguments,1);s=i.slice();r=s.length;for(a=0;a<r;a++)s[a].apply(this,n)}return true};r.prototype.addListener=function(e,t){var i;if(!c(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,c(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(d(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(d(this._events[e])&&!this._events[e].warned){if(!l(this._maxListeners)){i=this._maxListeners}else{i=r.defaultMaxListeners}if(i&&i>0&&this._events[e].length>i){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function(e,t){if(!c(t))throw TypeError("listener must be a function");var i=false;function r(){this.removeListener(e,r);if(!i){i=true;t.apply(this,arguments)}}r.listener=t;this.on(e,r);return this};r.prototype.removeListener=function(e,t){var i,r,n,a;if(!c(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;i=this._events[e];n=i.length;r=-1;if(i===t||c(i.listener)&&i.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(d(i)){for(a=n;a-- >0;){if(i[a]===t||i[a].listener&&i[a].listener===t){r=a;break}}if(r<0)return this;if(i.length===1){i.length=0;delete this._events[e]}else{i.splice(r,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};r.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}i=this._events[e];if(c(i)){this.removeListener(e,i)}else if(i){while(i.length)this.removeListener(e,i[i.length-1])}delete this._events[e];return this};r.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(c(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(c(t))return 1;else if(t)return t.length}return 0};r.listenerCount=function(e,t){return e.listenerCount(t)};function c(e){return typeof e==="function"}function n(e){return typeof e==="number"}function d(e){return typeof e==="object"&&e!==null}function l(e){return e===void 0}},{}],11:[function(e,t,d){const l=e("debug")("h264-profile-level-id");l.log=console.info.bind(console);const r=1;const n=2;const a=3;const s=4;const o=5;d.ProfileConstrainedBaseline=r;d.ProfileBaseline=n;d.ProfileMain=a;d.ProfileConstrainedHigh=s;d.ProfileHigh=o;const c=0;const u=10;const f=11;const h=12;const p=13;const m=20;const v=21;const y=22;const g=30;const _=31;const b=32;const w=40;const S=41;const k=42;const C=50;const T=51;const P=52;d.Level1_b=c;d.Level1=u;d.Level1_1=f;d.Level1_2=h;d.Level1_3=p;d.Level2=m;d.Level2_1=v;d.Level2_2=y;d.Level3=g;d.Level3_1=_;d.Level3_2=b;d.Level4=w;d.Level4_1=S;d.Level4_2=k;d.Level5=C;d.Level5_1=T;d.Level5_2=P;class R{constructor(e,t){this.profile=e;this.level=t}}d.ProfileLevelId=R;const i=new R(r,_);const E=16;class x{constructor(e){this._mask=~I("x",e);this._maskedValue=I("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class M{constructor(e,t,i){this.profile_idc=e;this.profile_iop=t;this.profile=i}}const D=[new M(66,new x("x1xx0000"),r),new M(77,new x("1xxx0000"),r),new M(88,new x("11xx0000"),r),new M(66,new x("x0xx0000"),n),new M(88,new x("10xx0000"),n),new M(77,new x("0x0x0000"),a),new M(100,new x("00000000"),o),new M(100,new x("00001100"),s)];d.parseProfileLevelId=function(e){if(typeof e!=="string"||e.length!==6)return null;const t=parseInt(e,16);if(t===0)return null;const i=t&255;const r=t>>8&255;const n=t>>16&255;let a;switch(i){case f:{a=(r&E)!==0?c:f;break}case u:case h:case p:case m:case v:case y:case g:case _:case b:case w:case S:case k:case C:case T:case P:{a=i;break}default:{l("parseProfileLevelId() | unrecognized level_idc:%s",i);return null}}for(const s of D){if(n===s.profile_idc&&s.profile_iop.isMatch(r)){return new R(s.profile,a)}}l("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination");return null};d.profileLevelIdToString=function(e){if(e.level==c){switch(e.profile){case r:{return"42f00b"}case n:{return"42100b"}case a:{return"4d100b"}default:{l("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile);return null}}}let t;switch(e.profile){case r:{t="42e0";break}case n:{t="4200";break}case a:{t="4d00";break}case s:{t="640c";break}case o:{t="6400";break}default:{l("profileLevelIdToString() | unrecognized profile:%s",e.profile);return null}}let i=e.level.toString(16);if(i.length===1)i=`0${i}`;return`${t}${i}`};d.parseSdpProfileLevelId=function(e={}){const t=e["profile-level-id"];return!t?i:d.parseProfileLevelId(t)};d.isSameProfile=function(e={},t={}){const i=d.parseSdpProfileLevelId(e);const r=d.parseSdpProfileLevelId(t);return Boolean(i&&r&&i.profile===r.profile)};d.generateProfileLevelIdForAnswer=function(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"]){l("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params");return null}const i=d.parseSdpProfileLevelId(e);const r=d.parseSdpProfileLevelId(t);if(!i)throw new TypeError("invalid local_profile_level_id");if(!r)throw new TypeError("invalid remote_profile_level_id");if(i.profile!==r.profile)throw new TypeError("H264 Profile mismatch");const n=L(e)&&L(t);const a=i.level;const s=r.level;const o=B(a,s);const c=n?a:o;l("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",i.profile,c);return d.profileLevelIdToString(new R(i.profile,c))};function I(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function A(e,t){if(e===c)return t!==u&&t!==c;if(t===c)return e!==u;return e<t}function B(e,t){return A(e,t)?e:t}function L(e={}){const t=e["level-asymmetry-allowed"];return t===1||t==="1"}},{debug:12}],12:[function(o,c,d){(function(s){(function(){d.formatArgs=t;d.save=i;d.load=r;d.useColors=e;d.storage=n();d.destroy=(()=>{let e=false;return()=>{if(!e){e=true;console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}}})();d.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){if(typeof window!=="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function t(e){e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+c.exports.humanize(this.diff);if(!this.useColors){return}const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let i=0;let r=0;e[0].replace(/%[a-zA-Z%]/g,e=>{if(e==="%%"){return}i++;if(e==="%c"){r=i}});e.splice(r,0,t)}d.log=console.debug||console.log||(()=>{});function i(e){try{if(e){d.storage.setItem("debug",e)}else{d.storage.removeItem("debug")}}catch(e){}}function r(){let e;try{e=d.storage.getItem("debug")}catch(e){}if(!e&&typeof s!=="undefined"&&"env"in s){e=s.env.DEBUG}return e}function n(){try{return localStorage}catch(e){}}c.exports=o("./common")(d);const{formatters:a}=c.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,o("_process"))},{"./common":13,_process:54}],13:[function(l,e,t){function i(t){c.debug=c;c.default=c;c.coerce=o;c.disable=r;c.enable=i;c.enabled=n;c.humanize=l("ms");c.destroy=d;Object.keys(t).forEach(e=>{c[e]=t[e]});c.names=[];c.skips=[];c.formatters={};function e(t){let i=0;for(let e=0;e<t.length;e++){i=(i<<5)-i+t.charCodeAt(e);i|=0}return c.colors[Math.abs(i)%c.colors.length]}c.selectColor=e;function c(e){let r;let t=null;let i;let n;function o(...n){if(!o.enabled){return}const a=o;const e=Number(new Date);const t=e-(r||e);a.diff=t;a.prev=r;a.curr=e;r=e;n[0]=c.coerce(n[0]);if(typeof n[0]!=="string"){n.unshift("%O")}let s=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(e,t)=>{if(e==="%%"){return"%"}s++;const i=c.formatters[t];if(typeof i==="function"){const r=n[s];e=i.call(a,r);n.splice(s,1);s--}return e});c.formatArgs.call(a,n);const i=a.log||c.log;i.apply(a,n)}o.namespace=e;o.useColors=c.useColors();o.color=c.selectColor(e);o.extend=a;o.destroy=c.destroy;Object.defineProperty(o,"enabled",{enumerable:true,configurable:false,get:()=>{if(t!==null){return t}if(i!==c.namespaces){i=c.namespaces;n=c.enabled(e)}return n},set:e=>{t=e}});if(typeof c.init==="function"){c.init(o)}return o}function a(e,t){const i=c(this.namespace+(typeof t==="undefined"?":":t)+e);i.log=this.log;return i}function i(e){c.save(e);c.namespaces=e;c.names=[];c.skips=[];let t;const i=(typeof e==="string"?e:"").split(/[\s,]+/);const r=i.length;for(t=0;t<r;t++){if(!i[t]){continue}e=i[t].replace(/\*/g,".*?");if(e[0]==="-"){c.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{c.names.push(new RegExp("^"+e+"$"))}}}function r(){const e=[...c.names.map(s),...c.skips.map(s).map(e=>"-"+e)].join(",");c.enable("");return e}function n(e){if(e[e.length-1]==="*"){return true}let t;let i;for(t=0,i=c.skips.length;t<i;t++){if(c.skips[t].test(e)){return false}}for(t=0,i=c.names.length;t<i;t++){if(c.names[t].test(e)){return true}}return false}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}function o(e){if(e instanceof Error){return e.stack||e.message}return e}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}c.enable(c.load());return c}e.exports=i},{ms:14}],14:[function(e,t,i){var n=1e3;var a=n*60;var s=a*60;var o=s*24;var c=o*7;var d=o*365.25;t.exports=function(e,t){t=t||{};var i=typeof e;if(i==="string"&&e.length>0){return r(e)}else if(i==="number"&&isFinite(e)){return t.long?u(e):l(e)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function r(e){e=String(e);if(e.length>100){return}var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t){return}var i=parseFloat(t[1]);var r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return i*d;case"weeks":case"week":case"w":return i*c;case"days":case"day":case"d":return i*o;case"hours":case"hour":case"hrs":case"hr":case"h":return i*s;case"minutes":case"minute":case"mins":case"min":case"m":return i*a;case"seconds":case"second":case"secs":case"sec":case"s":return i*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return undefined}}function l(e){var t=Math.abs(e);if(t>=o){return Math.round(e/o)+"d"}if(t>=s){return Math.round(e/s)+"h"}if(t>=a){return Math.round(e/a)+"m"}if(t>=n){return Math.round(e/n)+"s"}return e+"ms"}function u(e){var t=Math.abs(e);if(t>=o){return f(e,t,o,"day")}if(t>=s){return f(e,t,s,"hour")}if(t>=a){return f(e,t,a,"minute")}if(t>=n){return f(e,t,n,"second")}return e+" ms"}function f(e,t,i,r){var n=t>=i*1.5;return Math.round(e/i)+" "+r+(n?"s":"")}},{}],15:[function(e,t,i){i.read=function(e,t,i,r,n){var a,s;var o=n*8-r-1;var c=(1<<o)-1;var d=c>>1;var l=-7;var u=i?n-1:0;var f=i?-1:1;var h=e[t+u];u+=f;a=h&(1<<-l)-1;h>>=-l;l+=o;for(;l>0;a=a*256+e[t+u],u+=f,l-=8){}s=a&(1<<-l)-1;a>>=-l;l+=r;for(;l>0;s=s*256+e[t+u],u+=f,l-=8){}if(a===0){a=1-d}else if(a===c){return s?NaN:(h?-1:1)*Infinity}else{s=s+Math.pow(2,r);a=a-d}return(h?-1:1)*s*Math.pow(2,a-r)};i.write=function(e,t,i,r,n,a){var s,o,c;var d=a*8-n-1;var l=(1<<d)-1;var u=l>>1;var f=n===23?Math.pow(2,-24)-Math.pow(2,-77):0;var h=r?0:a-1;var p=r?1:-1;var m=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){o=isNaN(t)?1:0;s=l}else{s=Math.floor(Math.log(t)/Math.LN2);if(t*(c=Math.pow(2,-s))<1){s--;c*=2}if(s+u>=1){t+=f/c}else{t+=f*Math.pow(2,1-u)}if(t*c>=2){s++;c/=2}if(s+u>=l){o=0;s=l}else if(s+u>=1){o=(t*c-1)*Math.pow(2,n);s=s+u}else{o=t*Math.pow(2,u-1)*Math.pow(2,n);s=0}}for(;n>=8;e[i+h]=o&255,h+=p,o/=256,n-=8){}s=s<<n|o;d+=n;for(;d>0;e[i+h]=s&255,h+=p,s/=256,d-=8){}e[i+h-p]|=m*128}},{}],16:[function(e,t,r){(function(o){(function(){var i,n,a,s;!function(S){var k="undefined";var C=k!==typeof o&&o;var T=k!==typeof Uint8Array&&Uint8Array;var P=k!==typeof ArrayBuffer&&ArrayBuffer;var R=[0,0,0,0,0,0,0,0];var r=Array.isArray||t;var E=4294967296;var x=16777216;var M;i=e("Uint64BE",true,true);n=e("Int64BE",true,false);a=e("Uint64LE",false,true);s=e("Int64LE",false,false);function e(e,t,c){var l=t?0:4;var u=t?4:0;var r=t?0:3;var n=t?1:2;var a=t?2:1;var s=t?3:0;var o=t?F:V;var d=t?j:N;var i=p.prototype;var f="is"+e;var h="_"+f;i.buffer=void 0;i.offset=0;i[h]=true;i.toNumber=g;i.toString=_;i.toJSON=g;i.toArray=D;if(C)i.toBuffer=I;if(T)i.toArrayBuffer=A;p[f]=m;S[e]=p;return p;function p(e,t,i,r){if(!(this instanceof p))return new p(e,t,i,r);return v(this,e,t,i,r)}function m(e){return!!(e&&e[h])}function v(e,t,i,r,n){if(T&&P){if(t instanceof P)t=new T(t);if(r instanceof P)r=new T(r)}if(!t&&!i&&!r&&!M){e.buffer=O(R,0);return}if(!B(t,i)){var a=M||Array;n=i;r=t;i=0;t=new a(8)}e.buffer=t;e.offset=i|=0;if(k===typeof r)return;if("string"===typeof r){y(t,i,r,n||10)}else if(B(r,n)){L(t,i,r,n)}else if("number"===typeof n){b(t,i+l,r);b(t,i+u,n)}else if(r>0){o(t,i,r)}else if(r<0){d(t,i,r)}else{L(t,i,R,0)}}function y(e,t,i,r){var n=0;var a=i.length;var s=0;var o=0;if(i[0]==="-")n++;var c=n;while(n<a){var d=parseInt(i[n++],r);if(!(d>=0))break;o=o*r+d;s=s*r+Math.floor(o/E);o%=E}if(c){s=~s;if(o){o=E-o}else{s++}}b(e,t+l,s);b(e,t+u,o)}function g(){var e=this.buffer;var t=this.offset;var i=w(e,t+l);var r=w(e,t+u);if(!c)i|=0;return i?i*E+r:r}function _(e){var t=this.buffer;var i=this.offset;var r=w(t,i+l);var n=w(t,i+u);var a="";var s=!c&&r&2147483648;if(s){r=~r;n=E-n}e=e||10;while(1){var o=r%e*E+n;r=Math.floor(r/e);n=Math.floor(o/e);a=(o%e).toString(e)+a;if(!r&&!n)break}if(s){a="-"+a}return a}function b(e,t,i){e[t+s]=i&255;i=i>>8;e[t+a]=i&255;i=i>>8;e[t+n]=i&255;i=i>>8;e[t+r]=i&255}function w(e,t){return e[t+r]*x+(e[t+n]<<16)+(e[t+a]<<8)+e[t+s]}}function D(e){var t=this.buffer;var i=this.offset;M=null;if(e!==false&&i===0&&t.length===8&&r(t))return t;return O(t,i)}function I(e){var t=this.buffer;var i=this.offset;M=C;if(e!==false&&i===0&&t.length===8&&o.isBuffer(t))return t;var r=new C(8);L(r,0,t,i);return r}function A(e){var t=this.buffer;var i=this.offset;var r=t.buffer;M=T;if(e!==false&&i===0&&r instanceof P&&r.byteLength===8)return r;var n=new T(8);L(n,0,t,i);return n.buffer}function B(e,t){var i=e&&e.length;t|=0;return i&&t+8<=i&&"string"!==typeof e[t]}function L(e,t,i,r){t|=0;r|=0;for(var n=0;n<8;n++){e[t++]=i[r++]&255}}function O(e,t){return Array.prototype.slice.call(e,t,t+8)}function F(e,t,i){var r=t+8;while(r>t){e[--r]=i&255;i/=256}}function j(e,t,i){var r=t+8;i++;while(r>t){e[--r]=-i&255^255;i/=256}}function V(e,t,i){var r=t+8;while(t<r){e[t++]=i&255;i/=256}}function N(e,t,i){var r=t+8;i++;while(t<r){e[t++]=-i&255^255;i/=256}}function t(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)}}(typeof r==="object"&&typeof r.nodeName!=="string"?r:this||{})}).call(this)}).call(this,e("buffer").Buffer)},{buffer:5}],17:[function(e,t,i){var r={}.toString;t.exports=Array.isArray||function(e){return r.call(e)=="[object Array]"}},{}],18:[function(e,t,i){"use strict";var r={128:{name:"ChapterDisplay",level:4,type:"m",multiple:true,minver:1,webm:true,description:"Contains all possible strings to use for the chapter display."},131:{name:"TrackType",level:3,type:"u",mandatory:true,minver:1,range:"1-254",description:"A set of track types coded on 8 bits (1: video, 2: audio, 3: complex, 0x10: logo, 0x11: subtitle, 0x12: buttons, 0x20: control)."},133:{name:"ChapString",cppname:"ChapterString",level:5,type:"8",mandatory:true,minver:1,webm:true,description:"Contains the string to use as the chapter atom."},134:{name:"CodecID",level:3,type:"s",mandatory:true,minver:1,description:"An ID corresponding to the codec, see the codec page for more info."},136:{name:"FlagDefault",cppname:"TrackFlagDefault",level:3,type:"u",mandatory:true,minver:1,default:1,range:"0-1",description:"Set if that track (audio, video or subs) SHOULD be active if no language found matches the user preference. (1 bit)"},137:{name:"ChapterTrackNumber",level:5,type:"u",mandatory:true,multiple:true,minver:1,webm:false,range:"not 0",description:"UID of the Track to apply this chapter too. In the absense of a control track, choosing this chapter will select the listed Tracks and deselect unlisted tracks. Absense of this element indicates that the Chapter should be applied to any currently used Tracks."},145:{name:"ChapterTimeStart",level:4,type:"u",mandatory:true,minver:1,webm:true,description:"Timestamp of the start of Chapter (not scaled)."},146:{name:"ChapterTimeEnd",level:4,type:"u",minver:1,webm:false,description:"Timestamp of the end of Chapter (timestamp excluded, not scaled)."},150:{name:"CueRefTime",level:5,type:"u",mandatory:true,minver:2,webm:false,description:"Timestamp of the referenced Block."},151:{name:"CueRefCluster",level:5,type:"u",mandatory:true,webm:false,description:"The Position of the Cluster containing the referenced Block."},152:{name:"ChapterFlagHidden",level:4,type:"u",mandatory:true,minver:1,webm:false,default:0,range:"0-1",description:"If a chapter is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},16980:{name:"ContentCompAlgo",level:6,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"The compression algorithm used. Algorithms that have been specified so far are: 0 - zlib,   3 - Header Stripping"},16981:{name:"ContentCompSettings",level:6,type:"b",minver:1,webm:false,description:"Settings that might be needed by the decompressor. For Header Stripping (ContentCompAlgo=3), the bytes that were removed from the beggining of each frames of the track."},17026:{name:"DocType",level:1,type:"s",mandatory:true,default:"matroska",minver:1,description:"A string that describes the type of document that follows this EBML header. 'matroska' in our case or 'webm' for webm files."},17029:{name:"DocTypeReadVersion",level:1,type:"u",mandatory:true,default:1,minver:1,description:"The minimum DocType version an interpreter has to support to read this file."},17030:{name:"EBMLVersion",level:1,type:"u",mandatory:true,default:1,minver:1,description:"The version of EBML parser used to create the file."},17031:{name:"DocTypeVersion",level:1,type:"u",mandatory:true,default:1,minver:1,description:"The version of DocType interpreter used to create the file."},17476:{name:"SegmentFamily",level:2,type:"b",multiple:true,minver:1,webm:false,bytesize:16,description:"A randomly generated unique ID that all segments related to each other must use (128 bits)."},17505:{name:"DateUTC",level:2,type:"d",minver:1,description:"Date of the origin of timestamp (value 0), i.e. production date."},17540:{name:"TagDefault",level:4,type:"u",mandatory:true,minver:1,webm:false,default:1,range:"0-1",description:"Indication to know if this is the default/original language to use for the given tag. (1 bit)"},17541:{name:"TagBinary",level:4,type:"b",minver:1,webm:false,description:"The values of the Tag if it is binary. Note that this cannot be used in the same SimpleTag as TagString."},17543:{name:"TagString",level:4,type:"8",minver:1,webm:false,description:"The value of the Element."},17545:{name:"Duration",level:2,type:"f",minver:1,range:"> 0",description:"Duration of the segment (based on TimecodeScale)."},17816:{name:"ChapterFlagEnabled",level:4,type:"u",mandatory:true,minver:1,webm:false,default:1,range:"0-1",description:"Specify wether the chapter is enabled. It can be enabled/disabled by a Control Track. When disabled, the movie should skip all the content between the TimeStart and TimeEnd of this chapter (see flag notes). (1 bit)"},18016:{name:"FileMimeType",level:3,type:"s",mandatory:true,minver:1,webm:false,description:"MIME type of the file."},18017:{name:"FileUsedStartTime",level:3,type:"u",divx:true,description:"DivX font extension"},18018:{name:"FileUsedEndTime",level:3,type:"u",divx:true,description:"DivX font extension"},18037:{name:"FileReferral",level:3,type:"b",webm:false,description:"A binary value that a track/codec can refer to when the attachment is needed."},20529:{name:"ContentEncodingOrder",level:5,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"Tells when this modification was used during encoding/muxing starting with 0 and counting upwards. The decoder/demuxer has to start with the highest order number it finds and work its way down. This value has to be unique over all ContentEncodingOrder elements in the segment."},20530:{name:"ContentEncodingScope",level:5,type:"u",mandatory:true,minver:1,webm:false,default:1,range:"not 0",description:"A bit field that describes which elements have been modified in this way. Values (big endian) can be OR'ed. Possible values: 1 - all frame contents, 2 - the track's private data, 4 - the next ContentEncoding (next ContentEncodingOrder. Either the data inside ContentCompression and/or ContentEncryption)"},20531:{name:"ContentEncodingType",level:5,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"A value describing what kind of transformation has been done. Possible values: 0 - compression, 1 - encryption"},20532:{name:"ContentCompression",level:5,type:"m",minver:1,webm:false,description:"Settings describing the compression used. Must be present if the value of ContentEncodingType is 0 and absent otherwise. Each block must be decompressable even if no previous block is available in order not to prevent seeking."},20533:{name:"ContentEncryption",level:5,type:"m",minver:1,webm:false,description:"Settings describing the encryption used. Must be present if the value of ContentEncodingType is 1 and absent otherwise."},21368:{name:"CueBlockNumber",level:4,type:"u",minver:1,default:1,range:"not 0",description:"Number of the Block in the specified Cluster."},22100:{name:"ChapterStringUID",level:4,type:"8",mandatory:false,minver:3,webm:true,description:"A unique string ID to identify the Chapter. Use for WebVTT cue identifier storage."},22337:{name:"WritingApp",level:2,type:"8",mandatory:true,minver:1,description:'Writing application ("mkvmerge-0.3.3").'},22612:{name:"SilentTracks",cppname:"ClusterSilentTracks",level:2,type:"m",minver:1,webm:false,description:"The list of tracks that are not used in that part of the stream. It is useful when using overlay tracks on seeking. Then you should decide what track to use."},25152:{name:"ContentEncoding",level:4,type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"Settings for one content encoding like compression or encryption."},25188:{name:"BitDepth",cppname:"AudioBitDepth",level:4,type:"u",minver:1,range:"not 0",description:"Bits per sample, mostly used for PCM."},25906:{name:"SignedElement",level:3,type:"b",multiple:true,webm:false,description:"An element ID whose data will be used to compute the signature."},26148:{name:"TrackTranslate",level:3,type:"m",multiple:true,minver:1,webm:false,description:"The track identification for the given Chapter Codec."},26897:{name:"ChapProcessCommand",cppname:"ChapterProcessCommand",level:5,type:"m",multiple:true,minver:1,webm:false,description:"Contains all the commands associated to the Atom."},26914:{name:"ChapProcessTime",cppname:"ChapterProcessTime",level:6,type:"u",mandatory:true,minver:1,webm:false,description:"Defines when the process command should be handled (0: during the whole chapter, 1: before starting playback, 2: after playback of the chapter)."},26916:{name:"ChapterTranslate",level:2,type:"m",multiple:true,minver:1,webm:false,description:"A tuple of corresponding ID used by chapter codecs to represent this segment."},26931:{name:"ChapProcessData",cppname:"ChapterProcessData",level:6,type:"b",mandatory:true,minver:1,webm:false,description:"Contains the command information. The data should be interpreted depending on the ChapProcessCodecID value. For ChapProcessCodecID = 1, the data correspond to the binary DVD cell pre/post commands."},26948:{name:"ChapProcess",cppname:"ChapterProcess",level:4,type:"m",multiple:true,minver:1,webm:false,description:"Contains all the commands associated to the Atom."},26965:{name:"ChapProcessCodecID",cppname:"ChapterProcessCodecID",level:5,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"Contains the type of the codec used for the processing. A value of 0 means native Matroska processing (to be defined), a value of 1 means the DVD command set is used. More codec IDs can be added later."},29555:{name:"Tag",level:2,type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"Element containing elements specific to Tracks/Chapters."},29572:{name:"SegmentFilename",level:2,type:"8",minver:1,webm:false,description:"A filename corresponding to this segment."},29766:{name:"AttachmentLink",cppname:"TrackAttachmentLink",level:3,type:"u",minver:1,webm:false,range:"not 0",description:"The UID of an attachment that is used by this codec."},2459272:{name:"CodecName",level:3,type:"8",minver:1,description:"A human-readable string specifying the codec."},408125543:{name:"Segment",level:"0",type:"m",mandatory:true,multiple:true,minver:1,description:"This element contains all other top-level (level 1) elements. Typically a Matroska file is composed of 1 segment."},17530:{name:"TagLanguage",level:4,type:"s",mandatory:true,minver:1,webm:false,default:"und",description:"Specifies the language of the tag specified, in the Matroska languages form."},17827:{name:"TagName",level:4,type:"8",mandatory:true,minver:1,webm:false,description:"The name of the Tag that is going to be stored."},26568:{name:"SimpleTag",cppname:"TagSimple",level:3,recursive:"1",type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"Contains general information about the target."},25542:{name:"TagAttachmentUID",level:4,type:"u",multiple:true,minver:1,webm:false,default:0,description:"A unique ID to identify the Attachment(s) the tags belong to. If the value is 0 at this level, the tags apply to all the attachments in the Segment."},25540:{name:"TagChapterUID",level:4,type:"u",multiple:true,minver:1,webm:false,default:0,description:"A unique ID to identify the Chapter(s) the tags belong to. If the value is 0 at this level, the tags apply to all chapters in the Segment."},25545:{name:"TagEditionUID",level:4,type:"u",multiple:true,minver:1,webm:false,default:0,description:"A unique ID to identify the EditionEntry(s) the tags belong to. If the value is 0 at this level, the tags apply to all editions in the Segment."},25541:{name:"TagTrackUID",level:4,type:"u",multiple:true,minver:1,webm:false,default:0,description:"A unique ID to identify the Track(s) the tags belong to. If the value is 0 at this level, the tags apply to all tracks in the Segment."},25546:{name:"TargetType",cppname:"TagTargetType",level:4,type:"s",minver:1,webm:false,strong:"informational",description:'An  string that can be used to display the logical level of the target like "ALBUM", "TRACK", "MOVIE", "CHAPTER", etc (see TargetType).'},26826:{name:"TargetTypeValue",cppname:"TagTargetTypeValue",level:4,type:"u",minver:1,webm:false,default:50,description:"A number to indicate the logical level of the target (see TargetType)."},25536:{name:"Targets",cppname:"TagTargets",level:3,type:"m",mandatory:true,minver:1,webm:false,description:"Contain all UIDs where the specified meta data apply. It is empty to describe everything in the segment."},307544935:{name:"Tags",level:1,type:"m",multiple:true,minver:1,webm:false,description:"Element containing elements specific to Tracks/Chapters. A list of valid tags can be found here."},17677:{name:"ChapProcessPrivate",cppname:"ChapterProcessPrivate",level:5,type:"b",minver:1,webm:false,description:'Some optional data attached to the ChapProcessCodecID information. For ChapProcessCodecID = 1, it is the "DVD level" equivalent.'},17278:{name:"ChapCountry",cppname:"ChapterCountry",level:5,type:"s",multiple:true,minver:1,webm:false,description:"The countries corresponding to the string, same 2 octets as in Internet domains."},17276:{name:"ChapLanguage",cppname:"ChapterLanguage",level:5,type:"s",mandatory:true,multiple:true,minver:1,webm:true,default:"eng",description:"The languages corresponding to the string, in the bibliographic ISO-639-2 form."},143:{name:"ChapterTrack",level:4,type:"m",minver:1,webm:false,description:"List of tracks on which the chapter applies. If this element is not present, all tracks apply"},25539:{name:"ChapterPhysicalEquiv",level:4,type:"u",minver:1,webm:false,description:'Specify the physical equivalent of this ChapterAtom like "DVD" (60) or "SIDE" (50), see complete list of values.'},28348:{name:"ChapterSegmentEditionUID",level:4,type:"u",minver:1,webm:false,range:"not 0",description:"The EditionUID to play from the segment linked in ChapterSegmentUID."},28263:{name:"ChapterSegmentUID",level:4,type:"b",minver:1,webm:false,range:">0",bytesize:16,description:"A segment to play in place of this chapter. Edition ChapterSegmentEditionUID should be used for this segment, otherwise no edition is used."},29636:{name:"ChapterUID",level:4,type:"u",mandatory:true,minver:1,webm:true,range:"not 0",description:"A unique ID to identify the Chapter."},182:{name:"ChapterAtom",level:3,recursive:"1",type:"m",mandatory:true,multiple:true,minver:1,webm:true,description:"Contains the atom information to use as the chapter atom (apply to all tracks)."},17885:{name:"EditionFlagOrdered",level:3,type:"u",minver:1,webm:false,default:0,range:"0-1",description:"Specify if the chapters can be defined multiple times and the order to play them is enforced. (1 bit)"},17883:{name:"EditionFlagDefault",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,range:"0-1",description:"If a flag is set (1) the edition should be used as the default one. (1 bit)"},17853:{name:"EditionFlagHidden",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,range:"0-1",description:"If an edition is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},17852:{name:"EditionUID",level:3,type:"u",minver:1,webm:false,range:"not 0",description:"A unique ID to identify the edition. It's useful for tagging an edition."},17849:{name:"EditionEntry",level:2,type:"m",mandatory:true,multiple:true,minver:1,webm:true,description:"Contains all information about a segment edition."},272869232:{name:"Chapters",level:1,type:"m",minver:1,webm:true,description:"A system to define basic menus and partition data. For more detailed information, look at the Chapters Explanation."},18094:{name:"FileUID",level:3,type:"u",mandatory:true,minver:1,webm:false,range:"not 0",description:"Unique ID representing the file, as random as possible."},18012:{name:"FileData",level:3,type:"b",mandatory:true,minver:1,webm:false,description:"The data of the file."},18030:{name:"FileName",level:3,type:"8",mandatory:true,minver:1,webm:false,description:"Filename of the attached file."},18046:{name:"FileDescription",level:3,type:"8",minver:1,webm:false,description:"A human-friendly name for the attached file."},24999:{name:"AttachedFile",level:2,type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"An attached file."},423732329:{name:"Attachments",level:1,type:"m",minver:1,webm:false,description:"Contain attached files."},235:{name:"CueRefCodecState",level:5,type:"u",webm:false,default:0,description:"The position of the Codec State corresponding to this referenced element. 0 means that the data is taken from the initial Track Entry."},21343:{name:"CueRefNumber",level:5,type:"u",webm:false,default:1,range:"not 0",description:"Number of the referenced Block of Track X in the specified Cluster."},219:{name:"CueReference",level:4,type:"m",multiple:true,minver:2,webm:false,description:"The Clusters containing the required referenced Blocks."},234:{name:"CueCodecState",level:4,type:"u",minver:2,webm:false,default:0,description:"The position of the Codec State corresponding to this Cue element. 0 means that the data is taken from the initial Track Entry."},178:{name:"CueDuration",level:4,type:"u",mandatory:false,minver:4,webm:false,description:"The duration of the block according to the segment time base. If missing the track's DefaultDuration does not apply and no duration information is available in terms of the cues."},240:{name:"CueRelativePosition",level:4,type:"u",mandatory:false,minver:4,webm:false,description:"The relative position of the referenced block inside the cluster with 0 being the first possible position for an element inside that cluster.",position:"clusterRelative"},241:{name:"CueClusterPosition",level:4,type:"u",mandatory:true,minver:1,description:"The position of the Cluster containing the required Block.",position:"segment"},247:{name:"CueTrack",level:4,type:"u",mandatory:true,minver:1,range:"not 0",description:"The track for which a position is given."},183:{name:"CueTrackPositions",level:3,type:"m",mandatory:true,multiple:true,minver:1,description:"Contain positions for different tracks corresponding to the timestamp."},179:{name:"CueTime",level:3,type:"u",mandatory:true,minver:1,description:"Absolute timestamp according to the segment time base."},187:{name:"CuePoint",level:2,type:"m",mandatory:true,multiple:true,minver:1,description:"Contains all information relative to a seek point in the segment."},475249515:{name:"Cues",level:1,type:"m",minver:1,description:'A top-level element to speed seeking access. All entries are local to the segment. Should be mandatory for non "live" streams.'},18406:{name:"ContentSigHashAlgo",level:6,type:"u",minver:1,webm:false,default:0,description:"The hash algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - SHA1-160 2 - MD5"},18405:{name:"ContentSigAlgo",level:6,type:"u",minver:1,webm:false,default:0,description:"The algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - RSA"},18404:{name:"ContentSigKeyID",level:6,type:"b",minver:1,webm:false,description:"This is the ID of the private key the data was signed with."},18403:{name:"ContentSignature",level:6,type:"b",minver:1,webm:false,description:"A cryptographic signature of the contents."},18402:{name:"ContentEncKeyID",level:6,type:"b",minver:1,webm:false,description:"For public key algorithms this is the ID of the public key the the data was encrypted with."},18401:{name:"ContentEncAlgo",level:6,type:"u",minver:1,webm:false,default:0,description:"The encryption algorithm used. The value '0' means that the contents have not been encrypted but only signed. Predefined values: 1 - DES, 2 - 3DES, 3 - Twofish, 4 - Blowfish, 5 - AES"},28032:{name:"ContentEncodings",level:3,type:"m",minver:1,webm:false,description:"Settings for several content encoding mechanisms like compression or encryption."},196:{name:"TrickMasterTrackSegmentUID",level:3,type:"b",divx:true,bytesize:16,description:"DivX trick track extenstions"},199:{name:"TrickMasterTrackUID",level:3,type:"u",divx:true,description:"DivX trick track extenstions"},198:{name:"TrickTrackFlag",level:3,type:"u",divx:true,default:0,description:"DivX trick track extenstions"},193:{name:"TrickTrackSegmentUID",level:3,type:"b",divx:true,bytesize:16,description:"DivX trick track extenstions"},192:{name:"TrickTrackUID",level:3,type:"u",divx:true,description:"DivX trick track extenstions"},237:{name:"TrackJoinUID",level:5,type:"u",mandatory:true,multiple:true,minver:3,webm:false,range:"not 0",description:"The trackUID number of a track whose blocks are used to create this virtual track."},233:{name:"TrackJoinBlocks",level:4,type:"m",minver:3,webm:false,description:"Contains the list of all tracks whose Blocks need to be combined to create this virtual track"},230:{name:"TrackPlaneType",level:6,type:"u",mandatory:true,minver:3,webm:false,description:"The kind of plane this track corresponds to (0: left eye, 1: right eye, 2: background)."},229:{name:"TrackPlaneUID",level:6,type:"u",mandatory:true,minver:3,webm:false,range:"not 0",description:"The trackUID number of the track representing the plane."},228:{name:"TrackPlane",level:5,type:"m",mandatory:true,multiple:true,minver:3,webm:false,description:"Contains a video plane track that need to be combined to create this 3D track"},227:{name:"TrackCombinePlanes",level:4,type:"m",minver:3,webm:false,description:"Contains the list of all video plane tracks that need to be combined to create this 3D track"},226:{name:"TrackOperation",level:3,type:"m",minver:3,webm:false,description:"Operation that needs to be applied on tracks to create this virtual track. For more details look at the Specification Notes on the subject."},32123:{name:"ChannelPositions",cppname:"AudioPosition",level:4,type:"b",webm:false,description:"Table of horizontal angles for each successive channel, see appendix."},159:{name:"Channels",cppname:"AudioChannels",level:4,type:"u",mandatory:true,minver:1,default:1,range:"not 0",description:"Numbers of channels in the track."},30901:{name:"OutputSamplingFrequency",cppname:"AudioOutputSamplingFreq",level:4,type:"f",minver:1,default:"Sampling Frequency",range:"> 0",description:"Real output sampling frequency in Hz (used for SBR techniques)."},181:{name:"SamplingFrequency",cppname:"AudioSamplingFreq",level:4,type:"f",mandatory:true,minver:1,default:8e3,range:"> 0",description:"Sampling frequency in Hz."},225:{name:"Audio",cppname:"TrackAudio",level:3,type:"m",minver:1,description:"Audio settings."},2327523:{name:"FrameRate",cppname:"VideoFrameRate",level:4,type:"f",range:"> 0",strong:"Informational",description:"Number of frames per second.  only."},3126563:{name:"GammaValue",cppname:"VideoGamma",level:4,type:"f",webm:false,range:"> 0",description:"Gamma Value."},3061028:{name:"ColourSpace",cppname:"VideoColourSpace",level:4,type:"b",minver:1,webm:false,bytesize:4,description:"Same value as in AVI (32 bits)."},21683:{name:"AspectRatioType",cppname:"VideoAspectRatio",level:4,type:"u",minver:1,default:0,description:"Specify the possible modifications to the aspect ratio (0: free resizing, 1: keep aspect ratio, 2: fixed)."},21682:{name:"DisplayUnit",cppname:"VideoDisplayUnit",level:4,type:"u",minver:1,default:0,description:"How DisplayWidth & DisplayHeight should be interpreted (0: pixels, 1: centimeters, 2: inches, 3: Display Aspect Ratio)."},21690:{name:"DisplayHeight",cppname:"VideoDisplayHeight",level:4,type:"u",minver:1,default:"PixelHeight",range:"not 0",description:"Height of the video frames to display. The default value is only valid when DisplayUnit is 0."},21680:{name:"DisplayWidth",cppname:"VideoDisplayWidth",level:4,type:"u",minver:1,default:"PixelWidth",range:"not 0",description:"Width of the video frames to display. The default value is only valid when DisplayUnit is 0."},21725:{name:"PixelCropRight",cppname:"VideoPixelCropRight",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the right of the image."},21708:{name:"PixelCropLeft",cppname:"VideoPixelCropLeft",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the left of the image."},21691:{name:"PixelCropTop",cppname:"VideoPixelCropTop",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the top of the image."},21674:{name:"PixelCropBottom",cppname:"VideoPixelCropBottom",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the bottom of the image (for HDTV content)."},186:{name:"PixelHeight",cppname:"VideoPixelHeight",level:4,type:"u",mandatory:true,minver:1,range:"not 0",description:"Height of the encoded video frames in pixels."},176:{name:"PixelWidth",cppname:"VideoPixelWidth",level:4,type:"u",mandatory:true,minver:1,range:"not 0",description:"Width of the encoded video frames in pixels."},21433:{name:"OldStereoMode",level:4,type:"u",maxver:"0",webm:false,divx:false,description:"DEPRECATED, DO NOT USE. Bogus StereoMode value used in old versions of libmatroska. (0: mono, 1: right eye, 2: left eye, 3: both eyes)."},21440:{name:"AlphaMode",cppname:"VideoAlphaMode",level:4,type:"u",minver:3,webm:true,default:0,description:"Alpha Video Mode. Presence of this element indicates that the BlockAdditional element could contain Alpha data."},21432:{name:"StereoMode",cppname:"VideoStereoMode",level:4,type:"u",minver:3,webm:true,default:0,description:"Stereo-3D video mode (0: mono, 1: side by side (left eye is first), 2: top-bottom (right eye is first), 3: top-bottom (left eye is first), 4: checkboard (right is first), 5: checkboard (left is first), 6: row interleaved (right is first), 7: row interleaved (left is first), 8: column interleaved (right is first), 9: column interleaved (left is first), 10: anaglyph (cyan/red), 11: side by side (right eye is first), 12: anaglyph (green/magenta), 13 both eyes laced in one Block (left eye is first), 14 both eyes laced in one Block (right eye is first)) . There are some more details on 3D support in the Specification Notes."},154:{name:"FlagInterlaced",cppname:"VideoFlagInterlaced",level:4,type:"u",mandatory:true,minver:2,webm:true,default:0,range:"0-1",description:"Set if the video is interlaced. (1 bit)"},224:{name:"Video",cppname:"TrackVideo",level:3,type:"m",minver:1,description:"Video settings."},26277:{name:"TrackTranslateTrackID",level:4,type:"b",mandatory:true,minver:1,webm:false,description:"The binary value used to represent this track in the chapter codec data. The format depends on the ChapProcessCodecID used."},26303:{name:"TrackTranslateCodec",level:4,type:"u",mandatory:true,minver:1,webm:false,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},26364:{name:"TrackTranslateEditionUID",level:4,type:"u",multiple:true,minver:1,webm:false,description:"Specify an edition UID on which this translation applies. When not specified, it means for all editions found in the segment."},22203:{name:"SeekPreRoll",level:3,type:"u",mandatory:true,multiple:false,default:0,minver:4,webm:true,description:"After a discontinuity, SeekPreRoll is the duration in nanoseconds of the data the decoder must decode before the decoded data is valid."},22186:{name:"CodecDelay",level:3,type:"u",multiple:false,default:0,minver:4,webm:true,description:"CodecDelay is The codec-built-in delay in nanoseconds. This value must be subtracted from each block timestamp in order to get the actual timestamp. The value should be small so the muxing of tracks with the same actual timestamp are in the same Cluster."},28587:{name:"TrackOverlay",level:3,type:"u",multiple:true,minver:1,webm:false,description:"Specify that this track is an overlay track for the Track specified (in the u-integer). That means when this track has a gap (see SilentTracks) the overlay track should be used instead. The order of multiple TrackOverlay matters, the first one is the one that should be used. If not found it should be the second, etc."},170:{name:"CodecDecodeAll",level:3,type:"u",mandatory:true,minver:2,webm:false,default:1,range:"0-1",description:"The codec can decode potentially damaged data (1 bit)."},2536e3:{name:"CodecDownloadURL",level:3,type:"s",multiple:true,webm:false,description:"A URL to download about the codec used."},3883072:{name:"CodecInfoURL",level:3,type:"s",multiple:true,webm:false,description:"A URL to find information about the codec used."},3839639:{name:"CodecSettings",level:3,type:"8",webm:false,description:"A string describing the encoding setting used."},25506:{name:"CodecPrivate",level:3,type:"b",minver:1,description:"Private data only known to the codec."},2274716:{name:"Language",cppname:"TrackLanguage",level:3,type:"s",minver:1,default:"eng",description:"Specifies the language of the track in the Matroska languages form."},21358:{name:"Name",cppname:"TrackName",level:3,type:"8",minver:1,description:"A human-readable track name."},21998:{name:"MaxBlockAdditionID",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"The maximum value of BlockAdditions for this track."},21375:{name:"TrackOffset",level:3,type:"i",webm:false,default:0,description:"A value to add to the Block's Timestamp. This can be used to adjust the playback offset of a track."},2306383:{name:"TrackTimecodeScale",level:3,type:"f",mandatory:true,minver:1,maxver:"3",webm:false,default:1,range:"> 0",description:"DEPRECATED, DO NOT USE. The scale to apply on this track to work at normal speed in relation with other tracks (mostly used to adjust video speed when the audio length differs)."},2313850:{name:"DefaultDecodedFieldDuration",cppname:"TrackDefaultDecodedFieldDuration",level:3,type:"u",minver:4,range:"not 0",description:"The period in nanoseconds (not scaled by TimcodeScale)\nbetween two successive fields at the output of the decoding process (see the notes)"},2352003:{name:"DefaultDuration",cppname:"TrackDefaultDuration",level:3,type:"u",minver:1,range:"not 0",description:"Number of nanoseconds (not scaled via TimecodeScale) per frame ('frame' in the Matroska sense -- one element put into a (Simple)Block)."},28152:{name:"MaxCache",cppname:"TrackMaxCache",level:3,type:"u",minver:1,webm:false,description:"The maximum cache size required to store referenced frames in and the current frame. 0 means no cache is needed."},28135:{name:"MinCache",cppname:"TrackMinCache",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"The minimum number of frames a player should be able to cache during playback. If set to 0, the reference pseudo-cache system is not used."},156:{name:"FlagLacing",cppname:"TrackFlagLacing",level:3,type:"u",mandatory:true,minver:1,default:1,range:"0-1",description:"Set if the track may contain blocks using lacing. (1 bit)"},21930:{name:"FlagForced",cppname:"TrackFlagForced",level:3,type:"u",mandatory:true,minver:1,default:0,range:"0-1",description:"Set if that track MUST be active during playback. There can be many forced track for a kind (audio, video or subs), the player should select the one which language matches the user preference or the default + forced track. Overlay MAY happen between a forced and non-forced track of the same kind. (1 bit)"},185:{name:"FlagEnabled",cppname:"TrackFlagEnabled",level:3,type:"u",mandatory:true,minver:2,webm:true,default:1,range:"0-1",description:"Set if the track is usable. (1 bit)"},29637:{name:"TrackUID",level:3,type:"u",mandatory:true,minver:1,range:"not 0",description:"A unique ID to identify the Track. This should be kept the same when making a direct stream copy of the Track to another file."},215:{name:"TrackNumber",level:3,type:"u",mandatory:true,minver:1,range:"not 0",description:"The track number as used in the Block Header (using more than 127 tracks is not encouraged, though the design allows an unlimited number)."},174:{name:"TrackEntry",level:2,type:"m",mandatory:true,multiple:true,minver:1,description:"Describes a track with all elements."},374648427:{name:"Tracks",level:1,type:"m",multiple:true,minver:1,description:"A top-level block of information with many tracks described."},175:{name:"EncryptedBlock",level:2,type:"b",multiple:true,webm:false,description:"Similar to EncryptedBlock Structure)"},202:{name:"ReferenceTimeCode",level:4,type:"u",multiple:false,mandatory:true,minver:0,webm:false,divx:true,description:"DivX trick track extenstions"},201:{name:"ReferenceOffset",level:4,type:"u",multiple:false,mandatory:true,minver:0,webm:false,divx:true,description:"DivX trick track extenstions"},200:{name:"ReferenceFrame",level:3,type:"m",multiple:false,minver:0,webm:false,divx:true,description:"DivX trick track extenstions"},207:{name:"SliceDuration",level:5,type:"u",default:0,description:"The (scaled) duration to apply to the element."},206:{name:"Delay",cppname:"SliceDelay",level:5,type:"u",default:0,description:"The (scaled) delay to apply to the element."},203:{name:"BlockAdditionID",cppname:"SliceBlockAddID",level:5,type:"u",default:0,description:"The ID of the BlockAdditional element (0 is the main Block)."},205:{name:"FrameNumber",cppname:"SliceFrameNumber",level:5,type:"u",default:0,description:"The number of the frame to generate from this lace with this delay (allow you to generate many frames from the same Block/Frame)."},204:{name:"LaceNumber",cppname:"SliceLaceNumber",level:5,type:"u",minver:1,default:0,divx:false,description:"The reverse number of the frame in the lace (0 is the last frame, 1 is the next to last, etc). While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},232:{name:"TimeSlice",level:4,type:"m",multiple:true,minver:1,divx:false,description:"Contains extra time information about the data contained in the Block. While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},142:{name:"Slices",level:3,type:"m",minver:1,divx:false,description:"Contains slices description."},30114:{name:"DiscardPadding",level:3,type:"i",minver:4,webm:true,description:"Duration in nanoseconds of the silent data added to the Block (padding at the end of the Block for positive value, at the beginning of the Block for negative value). The duration of DiscardPadding is not calculated in the duration of the TrackEntry and should be discarded during playback."},164:{name:"CodecState",level:3,type:"b",minver:2,webm:false,description:"The new codec state to use. Data interpretation is private to the codec. This information should always be referenced by a seek entry."},253:{name:"ReferenceVirtual",level:3,type:"i",webm:false,description:"Relative position of the data that should be in position of the virtual block."},251:{name:"ReferenceBlock",level:3,type:"i",multiple:true,minver:1,description:"Timestamp of another frame used as a reference (ie: B or P frame). The timestamp is relative to the block it's attached to."},250:{name:"ReferencePriority",cppname:"FlagReferenced",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"This frame is referenced and has the specified cache priority. In cache only a frame of the same or higher priority can replace this frame. A value of 0 means the frame is not referenced."},155:{name:"BlockDuration",level:3,type:"u",minver:1,default:"TrackDuration",description:'The duration of the Block (based on TimecodeScale). This element is mandatory when DefaultDuration is set for the track (but can be omitted as other default values). When not written and with no DefaultDuration, the value is assumed to be the difference between the timestamp of this Block and the timestamp of the next Block in "display" order (not coding order). This element can be useful at the end of a Track (as there is not other Block available), or when there is a break in a track like for subtitle tracks. When set to 0 that means the frame is not a keyframe.'},165:{name:"BlockAdditional",level:5,type:"b",mandatory:true,minver:1,webm:false,description:"Interpreted by the codec as it wishes (using the BlockAddID)."},238:{name:"BlockAddID",level:5,type:"u",mandatory:true,minver:1,webm:false,default:1,range:"not 0",description:"An ID to identify the BlockAdditional level."},166:{name:"BlockMore",level:4,type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"Contain the BlockAdditional and some parameters."},30113:{name:"BlockAdditions",level:3,type:"m",minver:1,webm:false,description:"Contain additional blocks to complete the main one. An EBML parser that has no knowledge of the Block structure could still see and use/skip these data."},162:{name:"BlockVirtual",level:3,type:"b",webm:false,description:"A Block with no data. It must be stored in the stream at the place the real Block should be in display order. (see Block Virtual)"},161:{name:"Block",level:3,type:"b",mandatory:true,minver:1,description:"Block containing the actual data to be rendered and a timestamp relative to the Cluster Timecode. (see Block Structure)"},160:{name:"BlockGroup",level:2,type:"m",multiple:true,minver:1,description:"Basic container of information containing a single Block or BlockVirtual, and information specific to that Block/VirtualBlock."},163:{name:"SimpleBlock",level:2,type:"b",multiple:true,minver:2,webm:true,divx:true,description:"Similar to SimpleBlock Structure"},171:{name:"PrevSize",cppname:"ClusterPrevSize",level:2,type:"u",minver:1,description:"Size of the previous Cluster, in octets. Can be useful for backward playing.",position:"prevCluster"},167:{name:"Position",cppname:"ClusterPosition",level:2,type:"u",minver:1,webm:false,description:"The Position of the Cluster in the segment (0 in live broadcast streams). It might help to resynchronise offset on damaged streams.",position:"segment"},22743:{name:"SilentTrackNumber",cppname:"ClusterSilentTrackNumber",level:3,type:"u",multiple:true,minver:1,webm:false,description:"One of the track number that are not used from now on in the stream. It could change later if not specified as silent in a further Cluster."},231:{name:"Timecode",cppname:"ClusterTimecode",level:2,type:"u",mandatory:true,minver:1,description:"Absolute timestamp of the cluster (based on TimecodeScale)."},524531317:{name:"Cluster",level:1,type:"m",multiple:true,minver:1,description:"The lower level element containing the (monolithic) Block structure."},19840:{name:"MuxingApp",level:2,type:"8",mandatory:true,minver:1,description:'Muxing application or library ("libmatroska-0.4.3").'},31657:{name:"Title",level:2,type:"8",minver:1,webm:false,description:"General name of the segment."},2807730:{name:"TimecodeScaleDenominator",level:2,type:"u",mandatory:true,minver:4,default:"1000000000",description:"Timestamp scale numerator, see TimecodeScale."},2807729:{name:"TimecodeScale",level:2,type:"u",mandatory:true,minver:1,default:"1000000",description:"Timestamp scale in nanoseconds (1.000.000 means all timestamps in the segment are expressed in milliseconds)."},27045:{name:"ChapterTranslateID",level:3,type:"b",mandatory:true,minver:1,webm:false,description:"The binary value used to represent this segment in the chapter codec data. The format depends on the ChapProcessCodecID used."},27071:{name:"ChapterTranslateCodec",level:3,type:"u",mandatory:true,minver:1,webm:false,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},27132:{name:"ChapterTranslateEditionUID",level:3,type:"u",multiple:true,minver:1,webm:false,description:"Specify an edition UID on which this correspondance applies. When not specified, it means for all editions found in the segment."},4096955:{name:"NextFilename",level:2,type:"8",minver:1,webm:false,description:"An escaped filename corresponding to the next segment."},4110627:{name:"NextUID",level:2,type:"b",minver:1,webm:false,bytesize:16,description:"A unique ID to identify the next chained segment (128 bits)."},3965867:{name:"PrevFilename",level:2,type:"8",minver:1,webm:false,description:"An escaped filename corresponding to the previous segment."},3979555:{name:"PrevUID",level:2,type:"b",minver:1,webm:false,bytesize:16,description:"A unique ID to identify the previous chained segment (128 bits)."},29604:{name:"SegmentUID",level:2,type:"b",minver:1,webm:false,range:"not 0",bytesize:16,description:"A randomly generated unique ID to identify the current segment between many others (128 bits)."},357149030:{name:"Info",level:1,type:"m",mandatory:true,multiple:true,minver:1,description:"Contains miscellaneous general information and statistics on the file."},21420:{name:"SeekPosition",level:3,type:"u",mandatory:true,minver:1,description:"The position of the element in the segment in octets (0 = first level 1 element).",position:"segment"},21419:{name:"SeekID",level:3,type:"b",mandatory:true,minver:1,description:"The binary ID corresponding to the element name.",type2:"ebmlID"},19899:{name:"Seek",cppname:"SeekPoint",level:2,type:"m",mandatory:true,multiple:true,minver:1,description:"Contains a single seek entry to an EBML element."},290298740:{name:"SeekHead",cppname:"SeekHeader",level:1,type:"m",multiple:true,minver:1,description:"Contains the position of other level 1 elements."},32379:{name:"SignatureElementList",level:2,type:"m",multiple:true,webm:false,i:"Cluster|Block|BlockAdditional",description:"A list consists of a number of consecutive elements that represent one case where data is used in signature. Ex:  means that the BlockAdditional of all Blocks in all Clusters is used for encryption."},32347:{name:"SignatureElements",level:1,type:"m",webm:false,description:"Contains elements that will be used to compute the signature."},32437:{name:"Signature",level:1,type:"b",webm:false,description:"The signature of the data (until a new."},32421:{name:"SignaturePublicKey",level:1,type:"b",webm:false,description:"The public key to use with the algorithm (in the case of a PKI-based signature)."},32410:{name:"SignatureHash",level:1,type:"u",webm:false,description:"Hash algorithm used (1=SHA1-160, 2=MD5)."},32394:{name:"SignatureAlgo",level:1,type:"u",webm:false,description:"Signature algorithm used (1=RSA, 2=elliptic)."},458458727:{name:"SignatureSlot",level:-1,type:"m",multiple:true,webm:false,description:"Contain signature of some (coming) elements in the stream."},191:{name:"CRC-32",level:-1,type:"b",minver:1,webm:false,description:"The CRC is computed on all the data of the Master element it's in. The CRC element should be the first in it's parent master for easier reading. All level 1 elements should include a CRC-32. The CRC in use is the IEEE CRC32 Little Endian",crc:true},236:{name:"Void",level:-1,type:"b",minver:1,description:"Used to void damaged data, to avoid unexpected behaviors when using damaged data. The content is discarded. Also used to reserve space in a sub-element for later use."},17139:{name:"EBMLMaxSizeLength",level:1,type:"u",mandatory:true,default:8,minver:1,description:"The maximum length of the sizes you'll find in this file (8 or less in Matroska). This does not override the element size indicated at the beginning of an element. Elements that have an indicated size which is larger than what is allowed by EBMLMaxSizeLength shall be considered invalid."},17138:{name:"EBMLMaxIDLength",level:1,type:"u",mandatory:true,default:4,minver:1,description:"The maximum length of the IDs you'll find in this file (4 or less in Matroska)."},17143:{name:"EBMLReadVersion",level:1,type:"u",mandatory:true,default:1,minver:1,description:"The minimum EBML version a parser has to support to read this file."},440786851:{name:"EBML",level:"0",type:"m",mandatory:true,multiple:true,minver:1,description:"Set the EBML characteristics of the data to follow. Each EBML document has to start with this."}};var n={};var a={byEbmlID:r,byName:n};for(var s in r){var o=r[s];n[o.name.replace("-","_")]=parseInt(s,10)}t.exports=a},{}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.Consumer=void 0;const r=e("./Logger");const o=e("./EnhancedEventEmitter");const n=e("./errors");const c=new r.Logger("Consumer");class a extends o.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:i,rtpReceiver:r,track:n,rtpParameters:a,appData:s}){super();this._closed=false;this._observer=new o.EnhancedEventEmitter;c.debug("constructor()");this._id=e;this._localId=t;this._producerId=i;this._rtpReceiver=r;this._track=n;this._rtpParameters=a;this._paused=!n.enabled;this._appData=s;this._onTrackEnded=this._onTrackEnded.bind(this);this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;c.debug("close()");this._closed=true;this._destroyTrack();this.emit("@close");this._observer.safeEmit("close")}transportClosed(){if(this._closed)return;c.debug("transportClosed()");this._closed=true;this._destroyTrack();this.safeEmit("transportclose");this._observer.safeEmit("close")}async getStats(){if(this._closed)throw new n.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){c.debug("pause()");if(this._closed){c.error("pause() | Consumer closed");return}this._paused=true;this._track.enabled=false;this._observer.safeEmit("pause")}resume(){c.debug("resume()");if(this._closed){c.error("resume() | Consumer closed");return}this._paused=false;this._track.enabled=true;this._observer.safeEmit("resume")}_onTrackEnded(){c.debug('track "ended" event');this.safeEmit("trackended");this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded);this._track.stop()}catch(e){}}}i.Consumer=a},{"./EnhancedEventEmitter":23,"./Logger":24,"./errors":29}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.DataConsumer=void 0;const r=e("./Logger");const a=e("./EnhancedEventEmitter");const s=new r.Logger("DataConsumer");class n extends a.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:i,sctpStreamParameters:r,appData:n}){super();this._closed=false;this._observer=new a.EnhancedEventEmitter;s.debug("constructor()");this._id=e;this._dataProducerId=t;this._dataChannel=i;this._sctpStreamParameters=r;this._appData=n;this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;s.debug("close()");this._closed=true;this._dataChannel.close();this.emit("@close");this._observer.safeEmit("close")}transportClosed(){if(this._closed)return;s.debug("transportClosed()");this._closed=true;this._dataChannel.close();this.safeEmit("transportclose");this._observer.safeEmit("close")}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{if(this._closed)return;s.debug('DataChannel "open" event');this.safeEmit("open")});this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;if(!t)t=new Error("unknown DataChannel error");if(t.errorDetail==="sctp-failure"){s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message)}else{s.error('DataChannel "error" event: %o',t)}this.safeEmit("error",t)});this._dataChannel.addEventListener("close",()=>{if(this._closed)return;s.warn('DataChannel "close" event');this._closed=true;this.emit("@close");this.safeEmit("close")});this._dataChannel.addEventListener("message",e=>{if(this._closed)return;this.safeEmit("message",e.data)})}}i.DataConsumer=n},{"./EnhancedEventEmitter":23,"./Logger":24}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.DataProducer=void 0;const r=e("./Logger");const n=e("./EnhancedEventEmitter");const a=e("./errors");const s=new r.Logger("DataProducer");class o extends n.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:i,appData:r}){super();this._closed=false;this._observer=new n.EnhancedEventEmitter;s.debug("constructor()");this._id=e;this._dataChannel=t;this._sctpStreamParameters=i;this._appData=r;this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;s.debug("close()");this._closed=true;this._dataChannel.close();this.emit("@close");this._observer.safeEmit("close")}transportClosed(){if(this._closed)return;s.debug("transportClosed()");this._closed=true;this._dataChannel.close();this.safeEmit("transportclose");this._observer.safeEmit("close")}send(e){s.debug("send()");if(this._closed)throw new a.InvalidStateError("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",()=>{if(this._closed)return;s.debug('DataChannel "open" event');this.safeEmit("open")});this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;if(!t)t=new Error("unknown DataChannel error");if(t.errorDetail==="sctp-failure"){s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message)}else{s.error('DataChannel "error" event: %o',t)}this.safeEmit("error",t)});this._dataChannel.addEventListener("close",()=>{if(this._closed)return;s.warn('DataChannel "close" event');this._closed=true;this.emit("@close");this.safeEmit("close")});this._dataChannel.addEventListener("message",()=>{if(this._closed)return;s.warn('DataChannel "message" event in a DataProducer, message discarded')});this._dataChannel.addEventListener("bufferedamountlow",()=>{if(this._closed)return;this.safeEmit("bufferedamountlow")})}}i.DataProducer=o},{"./EnhancedEventEmitter":23,"./Logger":24,"./errors":29}],22:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:true});i.Device=i.detectDevice=void 0;const o=s(e("bowser"));const c=e("./Logger");const d=e("./EnhancedEventEmitter");const f=e("./errors");const l=a(e("./utils"));const u=a(e("./ortc"));const h=e("./Transport");const p=e("./handlers/Chrome74");const m=e("./handlers/Chrome70");const v=e("./handlers/Chrome67");const y=e("./handlers/Chrome55");const g=e("./handlers/Firefox60");const _=e("./handlers/Safari12");const b=e("./handlers/Safari11");const w=e("./handlers/Edge11");const S=e("./handlers/ReactNative");const k=new c.Logger("Device");function C(){if(typeof navigator==="object"&&navigator.product==="ReactNative"){if(typeof RTCPeerConnection==="undefined"){k.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection");return undefined}k.debug("this._detectDevice() | ReactNative handler chosen");return"ReactNative"}else if(typeof navigator==="object"&&typeof navigator.userAgent==="string"){const e=navigator.userAgent;const t=o.default.getParser(e);const i=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74"})){return"Chrome74"}else if(t.satisfies({chrome:">=70",chromium:">=70"})){return"Chrome70"}else if(t.satisfies({chrome:">=67",chromium:">=67"})){return"Chrome67"}else if(t.satisfies({chrome:">=55",chromium:">=55"})){return"Chrome55"}else if(t.satisfies({firefox:">=60"})){return"Firefox60"}else if(t.satisfies({safari:">=12.0"})&&typeof RTCRtpTransceiver!=="undefined"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")){return"Safari12"}else if(t.satisfies({safari:">=11"})){return"Safari11"}else if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"})){return"Edge11"}else if(i.name&&i.name.toLowerCase()==="blink"){const r=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(r){const n=Number(r[1]);if(n>=74){return"Chrome74"}else if(n>=70){return"Chrome70"}else if(n>=67){return"Chrome67"}else{return"Chrome55"}}else{return"Chrome74"}}else{k.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion());return undefined}}else{k.warn("this._detectDevice() | unknown device");return undefined}}i.detectDevice=C;class T{constructor({handlerName:e,handlerFactory:t,Handler:i}={}){this._loaded=false;this._observer=new d.EnhancedEventEmitter;k.debug("constructor()");if(i){k.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead");if(typeof i==="string")e=i;else throw new TypeError("non string Handler option no longer supported, use handlerFactory instead")}if(e&&t){throw new TypeError("just one of handlerName or handlerInterface can be given")}if(t){this._handlerFactory=t}else{if(e){k.debug("constructor() | handler given: %s",e)}else{e=C();if(e)k.debug("constructor() | detected handler: %s",e);else throw new f.UnsupportedError("device not supported")}switch(e){case"Chrome74":this._handlerFactory=p.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=m.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=v.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=y.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=g.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=_.Safari12.createFactory();break;case"Safari11":this._handlerFactory=b.Safari11.createFactory();break;case"Edge11":this._handlerFactory=w.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=S.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const r=this._handlerFactory();this._handlerName=r.name;r.close();this._extendedRtpCapabilities=undefined;this._recvRtpCapabilities=undefined;this._canProduceByKind={audio:false,video:false};this._sctpCapabilities=undefined}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new f.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new f.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){k.debug("load() [routerRtpCapabilities:%o]",e);e=l.clone(e,undefined);let t;try{if(this._loaded)throw new f.InvalidStateError("already loaded");u.validateRtpCapabilities(e);t=this._handlerFactory();const i=await t.getNativeRtpCapabilities();k.debug("load() | got native RTP capabilities:%o",i);u.validateRtpCapabilities(i);this._extendedRtpCapabilities=u.getExtendedRtpCapabilities(i,e);k.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities);this._canProduceByKind.audio=u.canSend("audio",this._extendedRtpCapabilities);this._canProduceByKind.video=u.canSend("video",this._extendedRtpCapabilities);this._recvRtpCapabilities=u.getRecvRtpCapabilities(this._extendedRtpCapabilities);u.validateRtpCapabilities(this._recvRtpCapabilities);k.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities);this._sctpCapabilities=await t.getNativeSctpCapabilities();k.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities);u.validateSctpCapabilities(this._sctpCapabilities);k.debug("load() succeeded");this._loaded=true;t.close()}catch(e){if(t)t.close();throw e}}canProduce(e){if(!this._loaded)throw new f.InvalidStateError("not loaded");else if(e!=="audio"&&e!=="video")throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d={}}){k.debug("createSendTransport()");return this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d={}}){k.debug("createRecvTransport()");return this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d})}_createTransport({direction:e,id:t,iceParameters:i,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:l={}}){if(!this._loaded)throw new f.InvalidStateError("not loaded");else if(typeof t!=="string")throw new TypeError("missing id");else if(typeof i!=="object")throw new TypeError("missing iceParameters");else if(!Array.isArray(r))throw new TypeError("missing iceCandidates");else if(typeof n!=="object")throw new TypeError("missing dtlsParameters");else if(a&&typeof a!=="object")throw new TypeError("wrong sctpParameters");else if(l&&typeof l!=="object")throw new TypeError("if given, appData must be an object");const u=new h.Transport({direction:e,id:t,iceParameters:i,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});this._observer.safeEmit("newtransport",u);return u}}i.Device=T},{"./EnhancedEventEmitter":23,"./Logger":24,"./Transport":28,"./errors":29,"./handlers/Chrome55":30,"./handlers/Chrome67":31,"./handlers/Chrome70":32,"./handlers/Chrome74":33,"./handlers/Edge11":34,"./handlers/Firefox60":35,"./handlers/ReactNative":37,"./handlers/Safari11":38,"./handlers/Safari12":39,"./ortc":47,"./utils":50,bowser:4}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.EnhancedEventEmitter=void 0;const r=e("events");const n=e("./Logger");const a=new n.Logger("EnhancedEventEmitter");class s extends r.EventEmitter{constructor(){super();this.setMaxListeners(Infinity)}safeEmit(t,...e){const i=this.listenerCount(t);try{return this.emit(t,...e)}catch(e){a.error("safeEmit() | event listener threw an error [event:%s]:%o",t,e);return Boolean(i)}}async safeEmitAsPromise(i,...r){return new Promise((e,t)=>{try{this.emit(i,...r,e,t)}catch(e){a.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",i,e);t(e)}})}}i.EnhancedEventEmitter=s},{"./Logger":24,events:10}],24:[function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:true});i.Logger=void 0;const n=r(e("debug"));const a="mediasoup-client";class s{constructor(e){if(e){this._debug=n.default(`${a}:${e}`);this._warn=n.default(`${a}:WARN:${e}`);this._error=n.default(`${a}:ERROR:${e}`)}else{this._debug=n.default(a);this._warn=n.default(`${a}:WARN`);this._error=n.default(`${a}:ERROR`)}this._debug.log=console.info.bind(console);this._warn.log=console.warn.bind(console);this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}i.Logger=s},{debug:51}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.Producer=void 0;const r=e("./Logger");const d=e("./EnhancedEventEmitter");const n=e("./errors");const l=new r.Logger("Producer");class a extends d.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:i,track:r,rtpParameters:n,stopTracks:a,disableTrackOnPause:s,zeroRtpOnPause:o,appData:c}){super();this._closed=false;this._observer=new d.EnhancedEventEmitter;l.debug("constructor()");this._id=e;this._localId=t;this._rtpSender=i;this._track=r;this._kind=r.kind;this._rtpParameters=n;this._paused=s?!r.enabled:false;this._maxSpatialLayer=undefined;this._stopTracks=a;this._disableTrackOnPause=s;this._zeroRtpOnPause=o;this._appData=c;this._onTrackEnded=this._onTrackEnded.bind(this);this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;l.debug("close()");this._closed=true;this._destroyTrack();this.emit("@close");this._observer.safeEmit("close")}transportClosed(){if(this._closed)return;l.debug("transportClosed()");this._closed=true;this._destroyTrack();this.safeEmit("transportclose");this._observer.safeEmit("close")}async getStats(){if(this._closed)throw new n.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){l.debug("pause()");if(this._closed){l.error("pause() | Producer closed");return}this._paused=true;if(this._track&&this._disableTrackOnPause){this._track.enabled=false}if(this._zeroRtpOnPause){this.safeEmitAsPromise("@replacetrack",null).catch(()=>{})}this._observer.safeEmit("pause")}resume(){l.debug("resume()");if(this._closed){l.error("resume() | Producer closed");return}this._paused=false;if(this._track&&this._disableTrackOnPause){this._track.enabled=true}if(this._zeroRtpOnPause){this.safeEmitAsPromise("@replacetrack",this._track).catch(()=>{})}this._observer.safeEmit("resume")}async replaceTrack({track:e}){l.debug("replaceTrack() [track:%o]",e);if(this._closed){if(e&&this._stopTracks){try{e.stop()}catch(e){}}throw new n.InvalidStateError("closed")}else if(e&&e.readyState==="ended"){throw new n.InvalidStateError("track ended")}if(e===this._track){l.debug("replaceTrack() | same track, ignored");return}if(!this._zeroRtpOnPause||!this._paused){await this.safeEmitAsPromise("@replacetrack",e)}this._destroyTrack();this._track=e;if(this._track&&this._disableTrackOnPause){if(!this._paused)this._track.enabled=true;else if(this._paused)this._track.enabled=false}this._handleTrack()}async setMaxSpatialLayer(e){if(this._closed)throw new n.InvalidStateError("closed");else if(this._kind!=="video")throw new n.UnsupportedError("not a video Producer");else if(typeof e!=="number")throw new TypeError("invalid spatialLayer");if(e===this._maxSpatialLayer)return;await this.safeEmitAsPromise("@setmaxspatiallayer",e);this._maxSpatialLayer=e}async setRtpEncodingParameters(e){if(this._closed)throw new n.InvalidStateError("closed");else if(typeof e!=="object")throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){l.debug('track "ended" event');this.safeEmit("trackended");this._observer.safeEmit("trackended")}_handleTrack(){if(!this._track)return;this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(!this._track)return;try{this._track.removeEventListener("ended",this._onTrackEnded);if(this._stopTracks)this._track.stop()}catch(e){}}}i.Producer=a},{"./EnhancedEventEmitter":23,"./Logger":24,"./errors":29}],26:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true})},{}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true})},{}],28:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Transport=void 0;const p=e("awaitqueue");const s=e("./Logger");const m=e("./EnhancedEventEmitter");const v=e("./errors");const y=a(e("./utils"));const g=a(e("./ortc"));const _=e("./Producer");const u=e("./Consumer");const f=e("./DataProducer");const c=e("./DataConsumer");const b=new s.Logger("Transport");class o extends m.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:i,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:u,extendedRtpCapabilities:f,canProduceByKind:h}){super();this._closed=false;this._connectionState="new";this._producers=new Map;this._consumers=new Map;this._dataProducers=new Map;this._dataConsumers=new Map;this._probatorConsumerCreated=false;this._awaitQueue=new p.AwaitQueue({ClosedErrorClass:v.InvalidStateError});this._observer=new m.EnhancedEventEmitter;b.debug("constructor() [id:%s, direction:%s]",t,e);this._id=t;this._direction=e;this._extendedRtpCapabilities=f;this._canProduceByKind=h;this._maxSctpMessageSize=a?a.maxMessageSize:null;c=y.clone(c,{});delete c.iceServers;delete c.iceTransportPolicy;delete c.bundlePolicy;delete c.rtcpMuxPolicy;delete c.sdpSemantics;this._handler=u();this._handler.run({direction:e,iceParameters:i,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:f});this._appData=l;this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(this._closed)return;b.debug("close()");this._closed=true;this._awaitQueue.close();this._handler.close();for(const e of this._producers.values()){e.transportClosed()}this._producers.clear();for(const t of this._consumers.values()){t.transportClosed()}this._consumers.clear();for(const i of this._dataProducers.values()){i.transportClosed()}this._dataProducers.clear();for(const r of this._dataConsumers.values()){r.transportClosed()}this._dataConsumers.clear();this._observer.safeEmit("close")}async getStats(){if(this._closed)throw new v.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){b.debug("restartIce()");if(this._closed)throw new v.InvalidStateError("closed");else if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){b.debug("updateIceServers()");if(this._closed)throw new v.InvalidStateError("closed");else if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:s,encodings:o,codecOptions:c,codec:d,stopTracks:l=true,disableTrackOnPause:u=true,zeroRtpOnPause:f=false,appData:h={}}={}){b.debug("produce() [track:%o]",s);if(!s)throw new TypeError("missing track");else if(this._direction!=="send")throw new v.UnsupportedError("not a sending Transport");else if(!this._canProduceByKind[s.kind])throw new v.UnsupportedError(`cannot produce ${s.kind}`);else if(s.readyState==="ended")throw new v.InvalidStateError("track ended");else if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');else if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');else if(h&&typeof h!=="object")throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let e;if(o&&!Array.isArray(o)){throw TypeError("encodings must be an array")}else if(o&&o.length===0){e=undefined}else if(o){e=o.map(e=>{const t={active:true};if(e.active===false)t.active=false;if(typeof e.dtx==="boolean")t.dtx=e.dtx;if(typeof e.scalabilityMode==="string")t.scalabilityMode=e.scalabilityMode;if(typeof e.scaleResolutionDownBy==="number")t.scaleResolutionDownBy=e.scaleResolutionDownBy;if(typeof e.maxBitrate==="number")t.maxBitrate=e.maxBitrate;if(typeof e.maxFramerate==="number")t.maxFramerate=e.maxFramerate;if(typeof e.adaptivePtime==="boolean")t.adaptivePtime=e.adaptivePtime;if(typeof e.priority==="string")t.priority=e.priority;if(typeof e.networkPriority==="string")t.networkPriority=e.networkPriority;return t})}const{localId:t,rtpParameters:i,rtpSender:r}=await this._handler.send({track:s,encodings:e,codecOptions:c,codec:d});try{g.validateRtpParameters(i);const{id:n}=await this.safeEmitAsPromise("produce",{kind:s.kind,rtpParameters:i,appData:h});const a=new _.Producer({id:n,localId:t,rtpSender:r,track:s,rtpParameters:i,stopTracks:l,disableTrackOnPause:u,zeroRtpOnPause:f,appData:h});this._producers.set(a.id,a);this._handleProducer(a);this._observer.safeEmit("newproducer",a);return a}catch(e){this._handler.stopSending(t).catch(()=>{});throw e}},"transport.produce()").catch(e=>{if(l){try{s.stop()}catch(e){}}throw e})}async consume({id:s,producerId:o,kind:c,rtpParameters:d,appData:l={}}){b.debug("consume()");d=y.clone(d,undefined);if(this._closed)throw new v.InvalidStateError("closed");else if(this._direction!=="recv")throw new v.UnsupportedError("not a receiving Transport");else if(typeof s!=="string")throw new TypeError("missing id");else if(typeof o!=="string")throw new TypeError("missing producerId");else if(c!=="audio"&&c!=="video")throw new TypeError(`invalid kind '${c}'`);else if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');else if(l&&typeof l!=="object")throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{const e=g.canReceive(d,this._extendedRtpCapabilities);if(!e)throw new v.UnsupportedError("cannot consume this Producer");const{localId:t,rtpReceiver:i,track:r}=await this._handler.receive({trackId:s,kind:c,rtpParameters:d});const n=new u.Consumer({id:s,localId:t,producerId:o,rtpReceiver:i,track:r,rtpParameters:d,appData:l});this._consumers.set(n.id,n);this._handleConsumer(n);if(!this._probatorConsumerCreated&&c==="video"){try{const a=g.generateProbatorRtpParameters(n.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:a});b.debug("consume() | Consumer for RTP probation created");this._probatorConsumerCreated=true}catch(e){b.error("consume() | failed to create Consumer for RTP probation:%o",e)}}this._observer.safeEmit("newconsumer",n);return n},"transport.consume()")}async produceData({ordered:n=true,maxPacketLifeTime:a,maxRetransmits:s,priority:o="low",label:c="",protocol:d="",appData:l={}}={}){b.debug("produceData()");if(this._direction!=="send")throw new v.UnsupportedError("not a sending Transport");else if(!this._maxSctpMessageSize)throw new v.UnsupportedError("SCTP not enabled by remote Transport");else if(!["very-low","low","medium","high"].includes(o))throw new TypeError("wrong priority");else if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');else if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');else if(l&&typeof l!=="object")throw new TypeError("if given, appData must be an object");if(a||s)n=false;return this._awaitQueue.push(async()=>{const{dataChannel:e,sctpStreamParameters:t}=await this._handler.sendDataChannel({ordered:n,maxPacketLifeTime:a,maxRetransmits:s,priority:o,label:c,protocol:d});g.validateSctpStreamParameters(t);const{id:i}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:t,label:c,protocol:d,appData:l});const r=new f.DataProducer({id:i,dataChannel:e,sctpStreamParameters:t,appData:l});this._dataProducers.set(r.id,r);this._handleDataProducer(r);this._observer.safeEmit("newdataproducer",r);return r},"transport.produceData()")}async consumeData({id:i,dataProducerId:r,sctpStreamParameters:n,label:a="",protocol:s="",appData:o={}}){b.debug("consumeData()");n=y.clone(n,undefined);if(this._closed)throw new v.InvalidStateError("closed");else if(this._direction!=="recv")throw new v.UnsupportedError("not a receiving Transport");else if(!this._maxSctpMessageSize)throw new v.UnsupportedError("SCTP not enabled by remote Transport");else if(typeof i!=="string")throw new TypeError("missing id");else if(typeof r!=="string")throw new TypeError("missing dataProducerId");else if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');else if(o&&typeof o!=="object")throw new TypeError("if given, appData must be an object");g.validateSctpStreamParameters(n);return this._awaitQueue.push(async()=>{const{dataChannel:e}=await this._handler.receiveDataChannel({sctpStreamParameters:n,label:a,protocol:s});const t=new c.DataConsumer({id:i,dataProducerId:r,dataChannel:e,sctpStreamParameters:n,appData:o});this._dataConsumers.set(t.id,t);this._handleDataConsumer(t);this._observer.safeEmit("newdataconsumer",t);return t},"transport.consumeData()")}_handleHandler(){const e=this._handler;e.on("@connect",({dtlsParameters:e},t,i)=>{if(this._closed){i(new v.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:e},t,i)});e.on("@connectionstatechange",e=>{if(e===this._connectionState)return;b.debug("connection state changed to %s",e);this._connectionState=e;if(!this._closed)this.safeEmit("connectionstatechange",e)})}_handleProducer(r){r.on("@close",()=>{this._producers.delete(r.id);if(this._closed)return;this._awaitQueue.push(async()=>this._handler.stopSending(r.localId),"producer @close event").catch(e=>b.warn("producer.close() failed:%o",e))});r.on("@replacetrack",(e,t,i)=>{this._awaitQueue.push(async()=>this._handler.replaceTrack(r.localId,e),"producer @replacetrack event").then(t).catch(i)});r.on("@setmaxspatiallayer",(e,t,i)=>{this._awaitQueue.push(async()=>this._handler.setMaxSpatialLayer(r.localId,e),"producer @setmaxspatiallayer event").then(t).catch(i)});r.on("@setrtpencodingparameters",(e,t,i)=>{this._awaitQueue.push(async()=>this._handler.setRtpEncodingParameters(r.localId,e),"producer @setrtpencodingparameters event").then(t).catch(i)});r.on("@getstats",(e,t)=>{if(this._closed)return t(new v.InvalidStateError("closed"));this._handler.getSenderStats(r.localId).then(e).catch(t)})}_handleConsumer(i){i.on("@close",()=>{this._consumers.delete(i.id);if(this._closed)return;this._awaitQueue.push(async()=>this._handler.stopReceiving(i.localId),"consumer @close event").catch(()=>{})});i.on("@getstats",(e,t)=>{if(this._closed)return t(new v.InvalidStateError("closed"));this._handler.getReceiverStats(i.localId).then(e).catch(t)})}_handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}_handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}i.Transport=o},{"./Consumer":19,"./DataConsumer":20,"./DataProducer":21,"./EnhancedEventEmitter":23,"./Logger":24,"./Producer":25,"./errors":29,"./ortc":47,"./utils":50,awaitqueue:2}],29:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.InvalidStateError=i.UnsupportedError=void 0;class r extends Error{constructor(e){super(e);this.name="UnsupportedError";if(Error.hasOwnProperty("captureStackTrace")){Error.captureStackTrace(this,r)}else{this.stack=new Error(e).stack}}}i.UnsupportedError=r;class n extends Error{constructor(e){super(e);this.name="InvalidStateError";if(Error.hasOwnProperty("captureStackTrace")){Error.captureStackTrace(this,n)}else{this.stack=new Error(e).stack}}}i.InvalidStateError=n},{}],30:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Chrome55=void 0;const h=a(e("sdp-transform"));const s=e("../Logger");const o=e("../errors");const f=a(e("../utils"));const p=a(e("../ortc"));const m=a(e("./sdp/commonUtils"));const v=a(e("./sdp/planBUtils"));const c=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const y=new s.Logger("Chrome55");const g={OS:1024,MIS:1024};class d extends c.HandlerInterface{constructor(){super();this._sendStream=new MediaStream;this._mapSendLocalIdTrack=new Map;this._nextSendLocalId=0;this._mapRecvLocalIdInfo=new Map;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new d}get name(){return"Chrome55"}close(){y.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){y.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const e=await t.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true});try{t.close()}catch(e){}const i=h.parse(e.sdp);const r=m.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){y.debug("getNativeSctpCapabilities()");return{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){y.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,planB:true});this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:a||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){y.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){y.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:i,codecOptions:e,codec:r}){this._assertSendDirection();y.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);if(r){y.warn("send() | codec selection is not available in %s handler",this.name)}this._sendStream.addTrack(t);this._pc.addStream(this._sendStream);let n=await this._pc.createOffer();let a=h.parse(n.sdp);let s;const o=f.clone(this._sendingRtpParametersByKind[t.kind],{});o.codecs=p.reduceCodecs(o.codecs);const c=f.clone(this._sendingRemoteRtpParametersByKind[t.kind],{});c.codecs=p.reduceCodecs(c.codecs);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:a});if(t.kind==="video"&&i&&i.length>1){y.debug("send() | enabling simulcast");a=h.parse(n.sdp);s=a.media.find(e=>e.type==="video");v.addLegacySimulcast({offerMediaObject:s,track:t,numStreams:i.length});n={type:"offer",sdp:h.write(a)}}y.debug("send() | calling pc.setLocalDescription() [offer:%o]",n);await this._pc.setLocalDescription(n);a=h.parse(this._pc.localDescription.sdp);s=a.media.find(e=>e.type===t.kind);o.rtcp.cname=m.getCname({offerMediaObject:s});o.encodings=v.getRtpEncodings({offerMediaObject:s,track:t});if(i){for(let e=0;e<o.encodings.length;++e){if(i[e])Object.assign(o.encodings[e],i[e])}}if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8"){for(const u of o.encodings){u.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:c,codecOptions:e});const d={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d);await this._pc.setRemoteDescription(d);const l=String(this._nextSendLocalId);this._nextSendLocalId++;this._mapSendLocalIdTrack.set(l,t);return{localId:l,rtpParameters:o}}async stopSending(e){this._assertSendDirection();y.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e);this._sendStream.removeTrack(t);this._pc.addStream(this._sendStream);const i=await this._pc.createOffer();y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(e){if(this._sendStream.getTracks().length===0){y.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());return}throw e}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){throw new o.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new o.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new o.UnsupportedError("not supported")}async getSenderStats(e){throw new o.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:a}){this._assertSendDirection();const s={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:i,protocol:n,priority:a};y.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(r,s);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=h.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const f={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f);await this._pc.setRemoteDescription(f);this._hasDataChannelMediaSection=true}const c={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();y.debug("receive() [trackId:%s, kind:%s]",e,t);const r=e;const n=t;const a=i.rtcp.cname;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:i,streamId:a,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s);await this._pc.setRemoteDescription(s);let o=await this._pc.createAnswer();const c=h.parse(o.sdp);const d=c.media.find(e=>String(e.mid)===n);m.applyCodecParameters({offerRtpParameters:i,answerMediaObject:d});o={type:"answer",sdp:h.write(c)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:c});y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o);await this._pc.setLocalDescription(o);const l=this._pc.getRemoteStreams().find(e=>e.id===a);const u=l.getTrackById(r);if(!u)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(r,{mid:n,rtpParameters:i});return{localId:r,track:u}}async stopReceiving(e){this._assertRecvDirection();y.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e);this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i});const r={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r);await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n);await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new o.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:s,protocol:i};y.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:true});const d={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=h.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=h.parse(this._pc.localDescription.sdp);const i=m.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Chrome55=d},{"../Logger":24,"../errors":29,"../ortc":47,"../utils":50,"./HandlerInterface":36,"./sdp/RemoteSdp":42,"./sdp/commonUtils":43,"./sdp/planBUtils":44,"sdp-transform":73}],31:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Chrome67=void 0;const h=a(e("sdp-transform"));const s=e("../Logger");const p=a(e("../utils"));const m=a(e("../ortc"));const v=a(e("./sdp/commonUtils"));const y=a(e("./sdp/planBUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const g=new s.Logger("Chrome67");const _={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._sendStream=new MediaStream;this._mapSendLocalIdRtpSender=new Map;this._nextSendLocalId=0;this._mapRecvLocalIdInfo=new Map;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Chrome67"}close(){g.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const e=await t.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true});try{t.close()}catch(e){}const i=h.parse(e.sdp);const r=v.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){g.debug("getNativeSctpCapabilities()");return{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){g.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,planB:true});this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",d),video:m.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",d),video:m.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:a||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){g.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){g.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:i,codecOptions:e,codec:r}){this._assertSendDirection();g.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);if(r){g.warn("send() | codec selection is not available in %s handler",this.name)}this._sendStream.addTrack(t);this._pc.addTrack(t,this._sendStream);let n=await this._pc.createOffer();let a=h.parse(n.sdp);let s;const o=p.clone(this._sendingRtpParametersByKind[t.kind],{});o.codecs=m.reduceCodecs(o.codecs);const c=p.clone(this._sendingRemoteRtpParametersByKind[t.kind],{});c.codecs=m.reduceCodecs(c.codecs);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:a});if(t.kind==="video"&&i&&i.length>1){g.debug("send() | enabling simulcast");a=h.parse(n.sdp);s=a.media.find(e=>e.type==="video");y.addLegacySimulcast({offerMediaObject:s,track:t,numStreams:i.length});n={type:"offer",sdp:h.write(a)}}g.debug("send() | calling pc.setLocalDescription() [offer:%o]",n);await this._pc.setLocalDescription(n);a=h.parse(this._pc.localDescription.sdp);s=a.media.find(e=>e.type===t.kind);o.rtcp.cname=v.getCname({offerMediaObject:s});o.encodings=y.getRtpEncodings({offerMediaObject:s,track:t});if(i){for(let e=0;e<o.encodings.length;++e){if(i[e])Object.assign(o.encodings[e],i[e])}}if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8"){for(const f of o.encodings){f.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:c,codecOptions:e});const d={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d);await this._pc.setRemoteDescription(d);const l=String(this._nextSendLocalId);this._nextSendLocalId++;const u=this._pc.getSenders().find(e=>e.track===t);this._mapSendLocalIdRtpSender.set(l,u);return{localId:l,rtpParameters:o,rtpSender:u}}async stopSending(e){this._assertSendDirection();g.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t);if(t.track)this._sendStream.removeTrack(t.track);this._mapSendLocalIdRtpSender.delete(e);const i=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(e){if(this._sendStream.getTracks().length===0){g.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());return}throw e}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){g.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{g.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapSendLocalIdRtpSender.get(e);if(!i)throw new Error("associated RTCRtpSender not found");const r=i.track;await i.replaceTrack(t);if(r)this._sendStream.removeTrack(r);if(t)this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:a}){this._assertSendDirection();const s={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:i,protocol:n,priority:a};g.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(r,s);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=h.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const f={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f);await this._pc.setRemoteDescription(f);this._hasDataChannelMediaSection=true}const c={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();g.debug("receive() [trackId:%s, kind:%s]",e,t);const r=e;const n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const a={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a);await this._pc.setRemoteDescription(a);let s=await this._pc.createAnswer();const o=h.parse(s.sdp);const c=o.media.find(e=>String(e.mid)===n);v.applyCodecParameters({offerRtpParameters:i,answerMediaObject:c});s={type:"answer",sdp:h.write(o)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:o});g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s);await this._pc.setLocalDescription(s);const d=this._pc.getReceivers().find(e=>e.track&&e.track.id===r);if(!d)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(r,{mid:n,rtpParameters:i,rtpReceiver:d});return{localId:r,track:d.track,rtpReceiver:d}}async stopReceiving(e){this._assertRecvDirection();g.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e);this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i});const r={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r);await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n);await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:s,protocol:i};g.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:true});const d={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=h.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=h.parse(this._pc.localDescription.sdp);const i=v.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Chrome67=c},{"../Logger":24,"../ortc":47,"../utils":50,"./HandlerInterface":36,"./sdp/RemoteSdp":42,"./sdp/commonUtils":43,"./sdp/planBUtils":44,"sdp-transform":73}],32:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Chrome70=void 0;const g=a(e("sdp-transform"));const s=e("../Logger");const _=a(e("../utils"));const b=a(e("../ortc"));const w=a(e("./sdp/commonUtils"));const S=a(e("./sdp/unifiedPlanUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const k=e("../scalabilityModes");const C=new s.Logger("Chrome70");const h={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map;this._sendStream=new MediaStream;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Chrome70"}close(){C.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio");t.addTransceiver("video");const e=await t.createOffer();try{t.close()}catch(e){}const i=g.parse(e.sdp);const r=w.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){C.debug("getNativeSctpCapabilities()");return{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){C.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n});this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",d),video:b.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",d),video:b.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:a||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){C.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){C.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){this._assertSendDirection();C.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const n=_.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=b.reduceCodecs(n.codecs,r);const a=_.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});a.codecs=b.reduceCodecs(a.codecs,r);const s=this._remoteSdp.getNextMediaSectionIdx();const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let c=await this._pc.createOffer();let d=g.parse(c.sdp);let l;if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:d});if(t&&t.length>1){C.debug("send() | enabling legacy simulcast");d=g.parse(c.sdp);l=d.media[s.idx];S.addLegacySimulcast({offerMediaObject:l,numStreams:t.length});c={type:"offer",sdp:g.write(d)}}let u=false;const f=k.parse((t||[{}])[0].scalabilityMode);if(t&&t.length===1&&f.spatialLayers>1&&n.codecs[0].mimeType.toLowerCase()==="video/vp9"){C.debug("send() | enabling legacy simulcast for VP9 SVC");u=true;d=g.parse(c.sdp);l=d.media[s.idx];S.addLegacySimulcast({offerMediaObject:l,numStreams:f.spatialLayers});c={type:"offer",sdp:g.write(d)}}C.debug("send() | calling pc.setLocalDescription() [offer:%o]",c);await this._pc.setLocalDescription(c);if(t){C.debug("send() | applying given encodings");const m=o.sender.getParameters();for(let e=0;e<(m.encodings||[]).length;++e){const v=m.encodings[e];const y=t[e];if(!y)break;m.encodings[e]=Object.assign(v,y)}await o.sender.setParameters(m)}const h=o.mid;n.mid=h;d=g.parse(this._pc.localDescription.sdp);l=d.media[s.idx];n.rtcp.cname=w.getCname({offerMediaObject:l});n.encodings=S.getRtpEncodings({offerMediaObject:l});if(t){for(let e=0;e<n.encodings.length;++e){if(t[e])Object.assign(n.encodings[e],t[e])}}if(u){n.encodings=[n.encodings[0]]}if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const v of n.encodings){v.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:l,reuseMid:s.reuseMid,offerRtpParameters:n,answerRtpParameters:a,codecOptions:i});const p={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p);await this._pc.setRemoteDescription(p);this._mapMidTransceiver.set(h,o);return{localId:h,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){this._assertSendDirection();C.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null);this._pc.removeTrack(t.sender);this._remoteSdp.closeMediaSection(t.mid);const i=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){C.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{C.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.sender.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:a}){this._assertSendDirection();const s={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:i,protocol:n,priority:a};C.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(r,s);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=g.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const f={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f);await this._pc.setRemoteDescription(f);this._hasDataChannelMediaSection=true}const c={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();C.debug("receive() [trackId:%s, kind:%s]",e,t);const r=i.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n);await this._pc.setRemoteDescription(n);let a=await this._pc.createAnswer();const s=g.parse(a.sdp);const o=s.media.find(e=>String(e.mid)===r);w.applyCodecParameters({offerRtpParameters:i,answerMediaObject:o});a={type:"answer",sdp:g.write(s)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:s});C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a);await this._pc.setLocalDescription(a);const c=this._pc.getTransceivers().find(e=>e.mid===r);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(r,c);return{localId:r,track:c.receiver.track,rtpReceiver:c.receiver}}async stopReceiving(e){this._assertRecvDirection();C.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const i={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i);await this._pc.setRemoteDescription(i);const r=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r);await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:s,protocol:i};C.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=g.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=g.parse(this._pc.localDescription.sdp);const i=w.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Chrome70=c},{"../Logger":24,"../ortc":47,"../scalabilityModes":48,"../utils":50,"./HandlerInterface":36,"./sdp/RemoteSdp":42,"./sdp/commonUtils":43,"./sdp/unifiedPlanUtils":45,"sdp-transform":73}],33:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Chrome74=void 0;const v=a(e("sdp-transform"));const s=e("../Logger");const y=a(e("../utils"));const g=a(e("../ortc"));const _=a(e("./sdp/commonUtils"));const b=a(e("./sdp/unifiedPlanUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const w=e("../scalabilityModes");const S=new s.Logger("Chrome74");const h={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map;this._sendStream=new MediaStream;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Chrome74"}close(){S.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){S.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio");t.addTransceiver("video");const e=await t.createOffer();try{t.close()}catch(e){}const i=v.parse(e.sdp);const r=_.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){S.debug("getNativeSctpCapabilities()");return{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){S.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n});this._sendingRtpParametersByKind={audio:g.getSendingRtpParameters("audio",d),video:g.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:g.getSendingRemoteRtpParameters("audio",d),video:g.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:a||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){S.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){S.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){this._assertSendDirection();S.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);if(t&&t.length>1){t.forEach((e,t)=>{e.rid=`r${t}`})}const n=y.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=g.reduceCodecs(n.codecs,r);const a=y.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});a.codecs=g.reduceCodecs(a.codecs,r);const s=this._remoteSdp.getNextMediaSectionIdx();const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let c=await this._pc.createOffer();let d=v.parse(c.sdp);let l;if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:d});let u=false;const f=w.parse((t||[{}])[0].scalabilityMode);if(t&&t.length===1&&f.spatialLayers>1&&n.codecs[0].mimeType.toLowerCase()==="video/vp9"){S.debug("send() | enabling legacy simulcast for VP9 SVC");u=true;d=v.parse(c.sdp);l=d.media[s.idx];b.addLegacySimulcast({offerMediaObject:l,numStreams:f.spatialLayers});c={type:"offer",sdp:v.write(d)}}S.debug("send() | calling pc.setLocalDescription() [offer:%o]",c);await this._pc.setLocalDescription(c);const h=o.mid;n.mid=h;d=v.parse(this._pc.localDescription.sdp);l=d.media[s.idx];n.rtcp.cname=_.getCname({offerMediaObject:l});if(!t){n.encodings=b.getRtpEncodings({offerMediaObject:l})}else if(t.length===1){let e=b.getRtpEncodings({offerMediaObject:l});Object.assign(e[0],t[0]);if(u)e=[e[0]];n.encodings=e}else{n.encodings=t}if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const m of n.encodings){m.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:l,reuseMid:s.reuseMid,offerRtpParameters:n,answerRtpParameters:a,codecOptions:i,extmapAllowMixed:true});const p={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("send() | calling pc.setRemoteDescription() [answer:%o]",p);await this._pc.setRemoteDescription(p);this._mapMidTransceiver.set(h,o);return{localId:h,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){this._assertSendDirection();S.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null);this._pc.removeTrack(t.sender);this._remoteSdp.closeMediaSection(t.mid);const i=await this._pc.createOffer();S.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){S.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{S.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();S.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.sender.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();S.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:a}){this._assertSendDirection();const s={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n,priority:a};S.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(r,s);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=v.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});S.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const f={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f);await this._pc.setRemoteDescription(f);this._hasDataChannelMediaSection=true}const c={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();S.debug("receive() [trackId:%s, kind:%s]",e,t);const r=i.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n);await this._pc.setRemoteDescription(n);let a=await this._pc.createAnswer();const s=v.parse(a.sdp);const o=s.media.find(e=>String(e.mid)===r);_.applyCodecParameters({offerRtpParameters:i,answerMediaObject:o});a={type:"answer",sdp:v.write(s)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:s});S.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a);await this._pc.setLocalDescription(a);const c=this._pc.getTransceivers().find(e=>e.mid===r);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(r,c);return{localId:r,track:c.receiver.track,rtpReceiver:c.receiver}}async stopReceiving(e){this._assertRecvDirection();S.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const i={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i);await this._pc.setRemoteDescription(i);const r=await this._pc.createAnswer();S.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r);await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s,protocol:i};S.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=v.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=v.parse(this._pc.localDescription.sdp);const i=_.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Chrome74=c},{"../Logger":24,"../ortc":47,"../scalabilityModes":48,"../utils":50,"./HandlerInterface":36,"./sdp/RemoteSdp":42,"./sdp/commonUtils":43,"./sdp/unifiedPlanUtils":45,"sdp-transform":73}],34:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Edge11=void 0;const s=e("../Logger");const o=e("../errors");const l=a(e("../utils"));const u=a(e("../ortc"));const f=a(e("./ortc/edgeUtils"));const c=e("./HandlerInterface");const h=new s.Logger("Edge11");class d extends c.HandlerInterface{constructor(){super();this._rtpSenders=new Map;this._rtpReceivers=new Map;this._nextSendLocalId=0;this._transportReady=false}static createFactory(){return()=>new d}get name(){return"Edge11"}close(){h.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values()){try{e.stop()}catch(e){}}for(const t of this._rtpReceivers.values()){try{t.stop()}catch(e){}}}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");return f.getCapabilities()}async getNativeSctpCapabilities(){h.debug("getNativeSctpCapabilities()");return{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){h.debug("run()");this._sendingRtpParametersByKind={audio:u.getSendingRtpParameters("audio",d),video:u.getSendingRtpParameters("video",d)};this._remoteIceParameters=t;this._remoteIceCandidates=i;this._remoteDtlsParameters=r;this._cname=`CNAME-${l.generateRandomNumber()}`;this._setIceGatherer({iceServers:a,iceTransportPolicy:s});this._setIceTransport();this._setDtlsTransport()}async updateIceServers(e){throw new o.UnsupportedError("not supported")}async restartIce(e){h.debug("restartIce()");this._remoteIceParameters=e;if(!this._transportReady)return;h.debug("restartIce() | calling iceTransport.start()");this._iceTransport.start(this._iceGatherer,e,"controlling");for(const t of this._remoteIceCandidates){this._iceTransport.addRemoteCandidate(t)}this._iceTransport.addRemoteCandidate({})}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){h.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server"});h.debug("send() | calling new RTCRtpSender()");const n=new RTCRtpSender(e,this._dtlsTransport);const a=l.clone(this._sendingRtpParametersByKind[e.kind],{});a.codecs=u.reduceCodecs(a.codecs,r);const s=a.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType));if(!t)t=[{}];for(const d of t){d.ssrc=l.generateRandomNumber();if(s)d.rtx={ssrc:l.generateRandomNumber()}}a.encodings=t;a.rtcp={cname:this._cname,reducedSize:true,mux:true};const o=f.mangleRtpParameters(a);h.debug("send() | calling rtpSender.send() [params:%o]",o);await n.send(o);const c=String(this._nextSendLocalId);this._nextSendLocalId++;this._rtpSenders.set(c,n);return{localId:c,rtpParameters:a,rtpSender:n}}async stopSending(e){h.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{h.debug("stopSending() | calling rtpSender.stop()");t.stop()}catch(e){h.warn("stopSending() | rtpSender.stop() failed:%o",e);throw e}}async replaceTrack(e,t){if(t){h.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{h.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._rtpSenders.get(e);if(!i)throw new Error("RTCRtpSender not found");i.setTrack(t)}async setMaxSpatialLayer(e,i){h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.setParameters(r)}async setRtpEncodingParameters(e,i){h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.setParameters(r)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new o.UnsupportedError("not implemented")}async receive({trackId:e,kind:t,rtpParameters:i}){h.debug("receive() [trackId:%s, kind:%s]",e,t);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server"});h.debug("receive() | calling new RTCRtpReceiver()");const r=new RTCRtpReceiver(this._dtlsTransport,t);r.addEventListener("error",e=>{h.error('rtpReceiver "error" event [event:%o]',e)});const n=f.mangleRtpParameters(i);h.debug("receive() | calling rtpReceiver.receive() [params:%o]",n);await r.receive(n);const a=e;this._rtpReceivers.set(a,r);return{localId:a,track:r.track,rtpReceiver:r}}async stopReceiving(e){h.debug("stopReceiving() [localId:%s]",e);const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{h.debug("stopReceiving() | calling rtpReceiver.stop()");t.stop()}catch(e){h.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new o.UnsupportedError("not implemented")}_setIceGatherer({iceServers:e,iceTransportPolicy:t}){const i=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});i.addEventListener("error",e=>{h.error('iceGatherer "error" event [event:%o]',e)});try{i.gather()}catch(e){h.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=i}_setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}});e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}});e.addEventListener("candidatepairchange",e=>{h.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)});this._iceTransport=e}_setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{h.debug('dtlsTransport "statechange" event [state:%s]',e.state)});e.addEventListener("dtlsstatechange",()=>{h.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state);if(e.state==="closed")this.emit("@connectionstatechange","closed")});e.addEventListener("error",e=>{h.error('dtlsTransport "error" event [event:%o]',e)});this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){h.debug("_setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e;await this.safeEmitAsPromise("@connect",{dtlsParameters:t});this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const i of this._remoteIceCandidates){this._iceTransport.addRemoteCandidate(i)}this._iceTransport.addRemoteCandidate({});this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(e=>{return e.algorithm==="sha-256"||e.algorithm==="sha-384"||e.algorithm==="sha-512"});this._dtlsTransport.start(this._remoteDtlsParameters);this._transportReady=true}}i.Edge11=d},{"../Logger":24,"../errors":29,"../ortc":47,"../utils":50,"./HandlerInterface":36,"./ortc/edgeUtils":40}],35:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Firefox60=void 0;const m=a(e("sdp-transform"));const s=e("../Logger");const o=e("../errors");const v=a(e("../utils"));const y=a(e("../ortc"));const g=a(e("./sdp/commonUtils"));const _=a(e("./sdp/unifiedPlanUtils"));const c=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const b=new s.Logger("Firefox60");const h={OS:16,MIS:2048};class d extends c.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map;this._sendStream=new MediaStream;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new d}get name(){return"Firefox60"}close(){b.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});const i=document.createElement("canvas");i.getContext("2d");const e=i.captureStream();const r=e.getVideoTracks()[0];try{t.addTransceiver("audio",{direction:"sendrecv"});const n=t.addTransceiver(r,{direction:"sendrecv"});const a=n.sender.getParameters();const s=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];a.encodings=s;await n.sender.setParameters(a);const o=await t.createOffer();try{i.remove()}catch(e){}try{r.stop()}catch(e){}try{t.close()}catch(e){}const c=m.parse(o.sdp);const d=g.extractRtpCapabilities({sdpObject:c});return d}catch(e){try{i.remove()}catch(e){}try{r.stop()}catch(e){}try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){b.debug("getNativeSctpCapabilities()");return{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){b.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n});this._sendingRtpParametersByKind={audio:y.getSendingRtpParameters("audio",d),video:y.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:y.getSendingRemoteRtpParameters("audio",d),video:y.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:a||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){throw new o.UnsupportedError("not supported")}async restartIce(e){b.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){this._assertSendDirection();b.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);if(t){t=v.clone(t,[]);if(t.length>1){t.forEach((e,t)=>{e.rid=`r${t}`});t.reverse()}}const n=v.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=y.reduceCodecs(n.codecs,r);const a=v.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});a.codecs=y.reduceCodecs(a.codecs,r);const s=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const f=s.sender.getParameters();f.encodings=t;await s.sender.setParameters(f)}const o=await this._pc.createOffer();let c=m.parse(o.sdp);if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:c});b.debug("send() | calling pc.setLocalDescription() [offer:%o]",o);await this._pc.setLocalDescription(o);const d=s.mid;n.mid=d;c=m.parse(this._pc.localDescription.sdp);const l=c.media[c.media.length-1];n.rtcp.cname=g.getCname({offerMediaObject:l});if(!t){n.encodings=_.getRtpEncodings({offerMediaObject:l})}else if(t.length===1){const h=_.getRtpEncodings({offerMediaObject:l});Object.assign(h[0],t[0]);n.encodings=h}else{n.encodings=t.reverse()}if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const p of n.encodings){p.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:l,offerRtpParameters:n,answerRtpParameters:a,codecOptions:i,extmapAllowMixed:true});const u={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",u);await this._pc.setRemoteDescription(u);this._mapMidTransceiver.set(d,s);return{localId:d,rtpParameters:n,rtpSender:s.sender}}async stopSending(e){b.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null);this._pc.removeTrack(t.sender);this._remoteSdp.disableMediaSection(t.mid);const i=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){b.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{b.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");const r=t.sender.getParameters();i=r.encodings.length-1-i;r.encodings.forEach((e,t)=>{if(t>=i)e.active=true;else e.active=false});await t.sender.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:a}){this._assertSendDirection();const s={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n,priority:a};b.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(r,s);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=m.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const f={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f);await this._pc.setRemoteDescription(f);this._hasDataChannelMediaSection=true}const c={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();b.debug("receive() [trackId:%s, kind:%s]",e,t);const r=i.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n);await this._pc.setRemoteDescription(n);let a=await this._pc.createAnswer();const s=m.parse(a.sdp);const o=s.media.find(e=>String(e.mid)===r);g.applyCodecParameters({offerRtpParameters:i,answerMediaObject:o});a={type:"answer",sdp:m.write(s)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:s});b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a);await this._pc.setLocalDescription(a);const c=this._pc.getTransceivers().find(e=>e.mid===r);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(r,c);return{localId:r,track:c.receiver.track,rtpReceiver:c.receiver}}async stopReceiving(e){this._assertRecvDirection();b.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const i={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i);await this._pc.setRemoteDescription(i);const r=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r);await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s,protocol:i};b.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=m.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=m.parse(this._pc.localDescription.sdp);const i=g.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Firefox60=d},{"../Logger":24,"../errors":29,"../ortc":47,"../utils":50,"./HandlerInterface":36,"./sdp/RemoteSdp":42,"./sdp/commonUtils":43,"./sdp/unifiedPlanUtils":45,"sdp-transform":73}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.HandlerInterface=void 0;const r=e("../EnhancedEventEmitter");class n extends r.EnhancedEventEmitter{constructor(){super()}}i.HandlerInterface=n},{"../EnhancedEventEmitter":23}],37:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.ReactNative=void 0;const h=a(e("sdp-transform"));const s=e("../Logger");const o=e("../errors");const f=a(e("../utils"));const p=a(e("../ortc"));const m=a(e("./sdp/commonUtils"));const v=a(e("./sdp/planBUtils"));const c=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const y=new s.Logger("ReactNative");const g={OS:1024,MIS:1024};class d extends c.HandlerInterface{constructor(){super();this._sendStream=new MediaStream;this._mapSendLocalIdTrack=new Map;this._nextSendLocalId=0;this._mapRecvLocalIdInfo=new Map;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new d}get name(){return"ReactNative"}close(){y.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){y.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const e=await t.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true});try{t.close()}catch(e){}const i=h.parse(e.sdp);const r=m.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){y.debug("getNativeSctpCapabilities()");return{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){y.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,planB:true});this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:a||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){y.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){y.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:i,codecOptions:e,codec:r}){this._assertSendDirection();y.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);if(r){y.warn("send() | codec selection is not available in %s handler",this.name)}this._sendStream.addTrack(t);this._pc.addStream(this._sendStream);let n=await this._pc.createOffer();let a=h.parse(n.sdp);let s;const o=f.clone(this._sendingRtpParametersByKind[t.kind],{});o.codecs=p.reduceCodecs(o.codecs);const c=f.clone(this._sendingRemoteRtpParametersByKind[t.kind],{});c.codecs=p.reduceCodecs(c.codecs);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:a});if(t.kind==="video"&&i&&i.length>1){y.debug("send() | enabling simulcast");a=h.parse(n.sdp);s=a.media.find(e=>e.type==="video");v.addLegacySimulcast({offerMediaObject:s,track:t,numStreams:i.length});n={type:"offer",sdp:h.write(a)}}y.debug("send() | calling pc.setLocalDescription() [offer:%o]",n);await this._pc.setLocalDescription(n);a=h.parse(this._pc.localDescription.sdp);s=a.media.find(e=>e.type===t.kind);o.rtcp.cname=m.getCname({offerMediaObject:s});o.encodings=v.getRtpEncodings({offerMediaObject:s,track:t});if(i){for(let e=0;e<o.encodings.length;++e){if(i[e])Object.assign(o.encodings[e],i[e])}}if(o.encodings.length>1&&(o.codecs[0].mimeType.toLowerCase()==="video/vp8"||o.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const u of o.encodings){u.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:c,codecOptions:e});const d={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d);await this._pc.setRemoteDescription(d);const l=String(this._nextSendLocalId);this._nextSendLocalId++;this._mapSendLocalIdTrack.set(l,t);return{localId:l,rtpParameters:o}}async stopSending(e){this._assertSendDirection();y.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e);this._sendStream.removeTrack(t);this._pc.addStream(this._sendStream);const i=await this._pc.createOffer();y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(e){if(this._sendStream.getTracks().length===0){y.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());return}throw e}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){throw new o.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new o.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new o.UnsupportedError("not implemented")}async getSenderStats(e){throw new o.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:a}){this._assertSendDirection();const s={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:i,protocol:n,priority:a};y.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(r,s);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=h.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const f={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f);await this._pc.setRemoteDescription(f);this._hasDataChannelMediaSection=true}const c={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();y.debug("receive() [trackId:%s, kind:%s]",e,t);const r=e;const n=t;let a=i.rtcp.cname;y.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc");a+=`-hack-${f.generateRandomNumber()}`;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:i,streamId:a,trackId:e});const s={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s);await this._pc.setRemoteDescription(s);let o=await this._pc.createAnswer();const c=h.parse(o.sdp);const d=c.media.find(e=>String(e.mid)===n);m.applyCodecParameters({offerRtpParameters:i,answerMediaObject:d});o={type:"answer",sdp:h.write(c)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:c});y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o);await this._pc.setLocalDescription(o);const l=this._pc.getRemoteStreams().find(e=>e.id===a);const u=l.getTrackById(r);if(!u)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(r,{mid:n,rtpParameters:i});return{localId:r,track:u}}async stopReceiving(e){this._assertRecvDirection();y.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e);this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i});const r={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r);await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n);await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new o.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:s,protocol:i};y.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:true});const d={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=h.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=h.parse(this._pc.localDescription.sdp);const i=m.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.ReactNative=d},{"../Logger":24,"../errors":29,"../ortc":47,"../utils":50,"./HandlerInterface":36,"./sdp/RemoteSdp":42,"./sdp/commonUtils":43,"./sdp/planBUtils":44,"sdp-transform":73}],38:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Safari11=void 0;const h=a(e("sdp-transform"));const s=e("../Logger");const p=a(e("../utils"));const m=a(e("../ortc"));const v=a(e("./sdp/commonUtils"));const y=a(e("./sdp/planBUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const g=new s.Logger("Safari11");const _={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._sendStream=new MediaStream;this._mapSendLocalIdRtpSender=new Map;this._nextSendLocalId=0;this._mapRecvLocalIdInfo=new Map;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Safari11"}close(){g.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){g.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const e=await t.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true});try{t.close()}catch(e){}const i=h.parse(e.sdp);const r=v.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){g.debug("getNativeSctpCapabilities()");return{numStreams:_}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){g.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,planB:true});this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",d),video:m.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",d),video:m.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:a||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){g.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){g.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});g.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();g.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:i,codecOptions:e,codec:r}){this._assertSendDirection();g.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);if(r){g.warn("send() | codec selection is not available in %s handler",this.name)}this._sendStream.addTrack(t);this._pc.addTrack(t,this._sendStream);let n=await this._pc.createOffer();let a=h.parse(n.sdp);let s;const o=p.clone(this._sendingRtpParametersByKind[t.kind],{});o.codecs=m.reduceCodecs(o.codecs);const c=p.clone(this._sendingRemoteRtpParametersByKind[t.kind],{});c.codecs=m.reduceCodecs(c.codecs);if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:a});if(t.kind==="video"&&i&&i.length>1){g.debug("send() | enabling simulcast");a=h.parse(n.sdp);s=a.media.find(e=>e.type==="video");y.addLegacySimulcast({offerMediaObject:s,track:t,numStreams:i.length});n={type:"offer",sdp:h.write(a)}}g.debug("send() | calling pc.setLocalDescription() [offer:%o]",n);await this._pc.setLocalDescription(n);a=h.parse(this._pc.localDescription.sdp);s=a.media.find(e=>e.type===t.kind);o.rtcp.cname=v.getCname({offerMediaObject:s});o.encodings=y.getRtpEncodings({offerMediaObject:s,track:t});if(i){for(let e=0;e<o.encodings.length;++e){if(i[e])Object.assign(o.encodings[e],i[e])}}if(o.encodings.length>1&&o.codecs[0].mimeType.toLowerCase()==="video/vp8"){for(const f of o.encodings){f.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:c,codecOptions:e});const d={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d);await this._pc.setRemoteDescription(d);const l=String(this._nextSendLocalId);this._nextSendLocalId++;const u=this._pc.getSenders().find(e=>e.track===t);this._mapSendLocalIdRtpSender.set(l,u);return{localId:l,rtpParameters:o,rtpSender:u}}async stopSending(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");if(t.track)this._sendStream.removeTrack(t.track);this._mapSendLocalIdRtpSender.delete(e);const i=await this._pc.createOffer();g.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(e){if(this._sendStream.getTracks().length===0){g.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());return}throw e}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){g.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{g.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapSendLocalIdRtpSender.get(e);if(!i)throw new Error("associated RTCRtpSender not found");const r=i.track;await i.replaceTrack(t);if(r)this._sendStream.removeTrack(r);if(t)this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();g.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();g.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");const r=t.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:a}){this._assertSendDirection();const s={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n,priority:a};g.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(r,s);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=h.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});g.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const f={type:"answer",sdp:this._remoteSdp.getSdp()};g.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f);await this._pc.setRemoteDescription(f);this._hasDataChannelMediaSection=true}const c={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();g.debug("receive() [trackId:%s, kind:%s]",e,t);const r=e;const n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const a={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a);await this._pc.setRemoteDescription(a);let s=await this._pc.createAnswer();const o=h.parse(s.sdp);const c=o.media.find(e=>String(e.mid)===n);v.applyCodecParameters({offerRtpParameters:i,answerMediaObject:c});s={type:"answer",sdp:h.write(o)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:o});g.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s);await this._pc.setLocalDescription(s);const d=this._pc.getReceivers().find(e=>e.track&&e.track.id===r);if(!d)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(r,{mid:n,rtpParameters:i,rtpReceiver:d});return{localId:r,track:d.track,rtpReceiver:d}}async stopReceiving(e){this._assertRecvDirection();g.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:i}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e);this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:i});const r={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r);await this._pc.setRemoteDescription(r);const n=await this._pc.createAnswer();g.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n);await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s,protocol:i};g.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:true});const d={type:"offer",sdp:this._remoteSdp.getSdp()};g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=h.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}g.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=h.parse(this._pc.localDescription.sdp);const i=v.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Safari11=c},{"../Logger":24,"../ortc":47,"../utils":50,"./HandlerInterface":36,"./sdp/RemoteSdp":42,"./sdp/commonUtils":43,"./sdp/planBUtils":44,"sdp-transform":73}],39:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.Safari12=void 0;const p=a(e("sdp-transform"));const s=e("../Logger");const m=a(e("../utils"));const v=a(e("../ortc"));const y=a(e("./sdp/commonUtils"));const g=a(e("./sdp/unifiedPlanUtils"));const o=e("./HandlerInterface");const l=e("./sdp/RemoteSdp");const _=new s.Logger("Safari12");const h={OS:1024,MIS:1024};class c extends o.HandlerInterface{constructor(){super();this._mapMidTransceiver=new Map;this._sendStream=new MediaStream;this._hasDataChannelMediaSection=false;this._nextSendSctpStreamId=0;this._transportReady=false}static createFactory(){return()=>new c}get name(){return"Safari12"}close(){_.debug("close()");if(this._pc){try{this._pc.close()}catch(e){}}}async getNativeRtpCapabilities(){_.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{t.addTransceiver("audio");t.addTransceiver("video");const e=await t.createOffer();try{t.close()}catch(e){}const i=p.parse(e.sdp);const r=y.extractRtpCapabilities({sdpObject:i});return r}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){_.debug("getNativeSctpCapabilities()");return{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n,iceServers:a,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){_.debug("run()");this._direction=e;this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:i,dtlsParameters:r,sctpParameters:n});this._sendingRtpParametersByKind={audio:v.getSendingRtpParameters("audio",d),video:v.getSendingRtpParameters("video",d)};this._sendingRemoteRtpParametersByKind={audio:v.getSendingRemoteRtpParameters("audio",d),video:v.getSendingRemoteRtpParameters("video",d)};this._pc=new RTCPeerConnection(Object.assign({iceServers:a||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),c);this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}async updateIceServers(e){_.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e;this._pc.setConfiguration(t)}async restartIce(e){_.debug("restartIce()");this._remoteSdp.updateIceParameters(e);if(!this._transportReady)return;if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:true});_.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t);await this._pc.setLocalDescription(t);const i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i);await this._pc.setRemoteDescription(i)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t);await this._pc.setRemoteDescription(t);const i=await this._pc.createAnswer();_.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i);await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:i,codec:r}){this._assertSendDirection();_.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const n=m.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=v.reduceCodecs(n.codecs,r);const a=m.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});a.codecs=v.reduceCodecs(a.codecs,r);const s=this._remoteSdp.getNextMediaSectionIdx();const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let c=await this._pc.createOffer();let d=p.parse(c.sdp);let l;if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:d});if(t&&t.length>1){_.debug("send() | enabling legacy simulcast");d=p.parse(c.sdp);l=d.media[s.idx];g.addLegacySimulcast({offerMediaObject:l,numStreams:t.length});c={type:"offer",sdp:p.write(d)}}_.debug("send() | calling pc.setLocalDescription() [offer:%o]",c);await this._pc.setLocalDescription(c);const u=o.mid;n.mid=u;d=p.parse(this._pc.localDescription.sdp);l=d.media[s.idx];n.rtcp.cname=y.getCname({offerMediaObject:l});n.encodings=g.getRtpEncodings({offerMediaObject:l});if(t){for(let e=0;e<n.encodings.length;++e){if(t[e])Object.assign(n.encodings[e],t[e])}}if(n.encodings.length>1&&(n.codecs[0].mimeType.toLowerCase()==="video/vp8"||n.codecs[0].mimeType.toLowerCase()==="video/h264")){for(const h of n.encodings){h.scalabilityMode="S1T3"}}this._remoteSdp.send({offerMediaObject:l,reuseMid:s.reuseMid,offerRtpParameters:n,answerRtpParameters:a,codecOptions:i});const f={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f);await this._pc.setRemoteDescription(f);this._mapMidTransceiver.set(u,o);return{localId:u,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){this._assertSendDirection();_.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null);this._pc.removeTrack(t.sender);this._remoteSdp.closeMediaSection(t.mid);const i=await this._pc.createOffer();_.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);await this._pc.setLocalDescription(i);const r={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r);await this._pc.setRemoteDescription(r)}async replaceTrack(e,t){this._assertSendDirection();if(t){_.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id)}else{_.debug("replaceTrack() [localId:%s, no track]",e)}const i=this._mapMidTransceiver.get(e);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(t)}async setMaxSpatialLayer(e,i){this._assertSendDirection();_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{if(t<=i)e.active=true;else e.active=false});await t.sender.setParameters(r)}async setRtpEncodingParameters(e,i){this._assertSendDirection();_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,i);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((e,t)=>{r.encodings[t]=Object.assign(Object.assign({},e),i)});await t.sender.setParameters(r)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:i,label:r,protocol:n,priority:a}){this._assertSendDirection();const s={negotiated:true,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:i,protocol:n,priority:a};_.debug("sendDataChannel() [options:%o]",s);const o=this._pc.createDataChannel(r,s);this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS;if(!this._hasDataChannelMediaSection){const d=await this._pc.createOffer();const l=p.parse(d.sdp);const u=l.media.find(e=>e.type==="application");if(!this._transportReady)await this._setupTransport({localDtlsRole:"server",localSdpObject:l});_.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d);await this._pc.setLocalDescription(d);this._remoteSdp.sendSctpAssociation({offerMediaObject:u});const f={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f);await this._pc.setRemoteDescription(f);this._hasDataChannelMediaSection=true}const c={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:o,sctpStreamParameters:c}}async receive({trackId:e,kind:t,rtpParameters:i}){this._assertRecvDirection();_.debug("receive() [trackId:%s, kind:%s]",e,t);const r=i.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:r,kind:t,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n);await this._pc.setRemoteDescription(n);let a=await this._pc.createAnswer();const s=p.parse(a.sdp);const o=s.media.find(e=>String(e.mid)===r);y.applyCodecParameters({offerRtpParameters:i,answerMediaObject:o});a={type:"answer",sdp:p.write(s)};if(!this._transportReady)await this._setupTransport({localDtlsRole:"client",localSdpObject:s});_.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a);await this._pc.setLocalDescription(a);const c=this._pc.getTransceivers().find(e=>e.mid===r);if(!c)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(r,c);return{localId:r,track:c.receiver.track,rtpReceiver:c.receiver}}async stopReceiving(e){this._assertRecvDirection();_.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i);await this._pc.setRemoteDescription(i);const r=await this._pc.createAnswer();_.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r);await this._pc.setLocalDescription(r)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:i}){this._assertRecvDirection();const{streamId:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s}=e;const o={negotiated:true,id:r,ordered:n,maxPacketLifeTime:a,maxRetransmits:s,protocol:i};_.debug("receiveDataChannel() [options:%o]",o);const c=this._pc.createDataChannel(t,o);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d);await this._pc.setRemoteDescription(d);const l=await this._pc.createAnswer();if(!this._transportReady){const u=p.parse(l.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:u})}_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l);await this._pc.setLocalDescription(l);this._hasDataChannelMediaSection=true}return{dataChannel:c}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){if(!t)t=p.parse(this._pc.localDescription.sdp);const i=y.extractDtlsParameters({sdpObject:t});i.role=e;this._remoteSdp.updateDtlsRole(e==="client"?"server":"client");await this.safeEmitAsPromise("@connect",{dtlsParameters:i});this._transportReady=true}_assertSendDirection(){if(this._direction!=="send"){throw new Error('method can just be called for handlers with "send" direction')}}_assertRecvDirection(){if(this._direction!=="recv"){throw new Error('method can just be called for handlers with "recv" direction')}}}i.Safari12=c},{"../Logger":24,"../ortc":47,"../utils":50,"./HandlerInterface":36,"./sdp/RemoteSdp":42,"./sdp/commonUtils":43,"./sdp/unifiedPlanUtils":45,"sdp-transform":73}],40:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.mangleRtpParameters=i.getCapabilities=void 0;const s=a(e("../../utils"));function o(){const e=RTCRtpReceiver.getCapabilities();const t=s.clone(e,{});for(const i of t.codecs){i.channels=i.numChannels;delete i.numChannels;i.mimeType=i.mimeType||`${i.kind}/${i.name}`;if(i.parameters){const r=i.parameters;if(r.apt)r.apt=Number(r.apt);if(r["packetization-mode"])r["packetization-mode"]=Number(r["packetization-mode"])}for(const n of i.rtcpFeedback||[]){if(!n.parameter)n.parameter=""}}return t}i.getCapabilities=o;function c(e){const t=s.clone(e,{});if(t.mid){t.muxId=t.mid;delete t.mid}for(const i of t.codecs){if(i.channels){i.numChannels=i.channels;delete i.channels}if(i.mimeType&&!i.name)i.name=i.mimeType.split("/")[1];delete i.mimeType}return t}i.mangleRtpParameters=c},{"../../utils":50}],41:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.OfferMediaSection=i.AnswerMediaSection=i.MediaSection=void 0;const M=a(e("../../utils"));class s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,planB:r=false}){this._mediaObject={};this._planB=r;if(e){this.setIceParameters(e)}if(t){this._mediaObject.candidates=[];for(const n of t){const a={};a.component=1;a.foundation=n.foundation;a.ip=n.ip;a.port=n.port;a.priority=n.priority;a.transport=n.protocol;a.type=n.type;if(n.tcpType)a.tcptype=n.tcpType;this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates";this._mediaObject.iceOptions="renomination"}if(i){this.setDtlsRole(i.role)}}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment;this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive";delete this._mediaObject.ext;delete this._mediaObject.ssrcs;delete this._mediaObject.ssrcGroups;delete this._mediaObject.simulcast;delete this._mediaObject.simulcast_03;delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive";this._mediaObject.port=0;delete this._mediaObject.ext;delete this._mediaObject.ssrcs;delete this._mediaObject.ssrcGroups;delete this._mediaObject.simulcast;delete this._mediaObject.simulcast_03;delete this._mediaObject.rids;delete this._mediaObject.extmapAllowMixed}}i.MediaSection=s;class o extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,plainRtpParameters:n,planB:a=false,offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:c,codecOptions:d,extmapAllowMixed:l=false}){super({iceParameters:e,iceCandidates:t,dtlsParameters:i,planB:a});this._mediaObject.mid=String(s.mid);this._mediaObject.type=s.type;this._mediaObject.protocol=s.protocol;if(!n){this._mediaObject.connection={ip:"127.0.0.1",version:4};this._mediaObject.port=7}else{this._mediaObject.connection={ip:n.ip,version:n.ipVersion};this._mediaObject.port=n.port}switch(s.type){case"audio":case"video":{this._mediaObject.direction="recvonly";this._mediaObject.rtp=[];this._mediaObject.rtcpFb=[];this._mediaObject.fmtp=[];for(const u of c.codecs){const f={payload:u.payloadType,codec:D(u),rate:u.clockRate};if(u.channels>1)f.encoding=u.channels;this._mediaObject.rtp.push(f);const h=M.clone(u.parameters,{});if(d){const{opusStereo:m,opusFec:v,opusDtx:y,opusMaxPlaybackRate:g,opusMaxAverageBitrate:_,opusPtime:b,videoGoogleStartBitrate:w,videoGoogleMaxBitrate:S,videoGoogleMinBitrate:k}=d;const C=o.codecs.find(e=>e.payloadType===u.payloadType);switch(u.mimeType.toLowerCase()){case"audio/opus":{if(m!==undefined){C.parameters["sprop-stereo"]=m?1:0;h.stereo=m?1:0}if(v!==undefined){C.parameters.useinbandfec=v?1:0;h.useinbandfec=v?1:0}if(y!==undefined){C.parameters.usedtx=y?1:0;h.usedtx=y?1:0}if(g!==undefined){h.maxplaybackrate=g}if(_!==undefined){h.maxaveragebitrate=_}if(b!==undefined){C.parameters.ptime=b;h.ptime=b}break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{if(w!==undefined)h["x-google-start-bitrate"]=w;if(S!==undefined)h["x-google-max-bitrate"]=S;if(k!==undefined)h["x-google-min-bitrate"]=k;break}}}const p={payload:u.payloadType,config:""};for(const T of Object.keys(h)){if(p.config)p.config+=";";p.config+=`${T}=${h[T]}`}if(p.config)this._mediaObject.fmtp.push(p);for(const P of u.rtcpFeedback){this._mediaObject.rtcpFb.push({payload:u.payloadType,type:P.type,subtype:P.parameter})}}this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" ");this._mediaObject.ext=[];for(const R of c.headerExtensions){const E=(s.ext||[]).some(e=>e.uri===R.uri);if(!E)continue;this._mediaObject.ext.push({uri:R.uri,value:R.id})}if(l&&s.extmapAllowMixed==="extmap-allow-mixed"){this._mediaObject.extmapAllowMixed="extmap-allow-mixed"}if(s.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:s.simulcast.list1};this._mediaObject.rids=[];for(const x of s.rids||[]){if(x.direction!=="send")continue;this._mediaObject.rids.push({id:x.id,direction:"recv"})}}else if(s.simulcast_03){this._mediaObject.simulcast_03={value:s.simulcast_03.value.replace(/send/g,"recv")};this._mediaObject.rids=[];for(const x of s.rids||[]){if(x.direction!=="send")continue;this._mediaObject.rids.push({id:x.id,direction:"recv"})}}this._mediaObject.rtcpMux="rtcp-mux";this._mediaObject.rtcpRsize="rtcp-rsize";if(this._planB&&this._mediaObject.type==="video")this._mediaObject.xGoogleFlag="conference";break}case"application":{if(typeof s.sctpPort==="number"){this._mediaObject.payloads="webrtc-datachannel";this._mediaObject.sctpPort=r.port;this._mediaObject.maxMessageSize=r.maxMessageSize}else if(s.sctpmap){this._mediaObject.payloads=r.port;this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:r.port,maxMessageSize:r.maxMessageSize}}break}}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass";break}}}i.AnswerMediaSection=o;class c extends s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,plainRtpParameters:n,planB:a=false,mid:s,kind:o,offerRtpParameters:c,streamId:d,trackId:l,oldDataChannelSpec:u=false}){super({iceParameters:e,iceCandidates:t,dtlsParameters:i,planB:a});this._mediaObject.mid=String(s);this._mediaObject.type=o;if(!n){this._mediaObject.connection={ip:"127.0.0.1",version:4};if(!r)this._mediaObject.protocol="UDP/TLS/RTP/SAVPF";else this._mediaObject.protocol="UDP/DTLS/SCTP";this._mediaObject.port=7}else{this._mediaObject.connection={ip:n.ip,version:n.ipVersion};this._mediaObject.protocol="RTP/AVP";this._mediaObject.port=n.port}switch(o){case"audio":case"video":{this._mediaObject.direction="sendonly";this._mediaObject.rtp=[];this._mediaObject.rtcpFb=[];this._mediaObject.fmtp=[];if(!this._planB)this._mediaObject.msid=`${d||"-"} ${l}`;for(const m of c.codecs){const v={payload:m.payloadType,codec:D(m),rate:m.clockRate};if(m.channels>1)v.encoding=m.channels;this._mediaObject.rtp.push(v);const y={payload:m.payloadType,config:""};for(const g of Object.keys(m.parameters)){if(y.config)y.config+=";";y.config+=`${g}=${m.parameters[g]}`}if(y.config)this._mediaObject.fmtp.push(y);for(const _ of m.rtcpFeedback){this._mediaObject.rtcpFb.push({payload:m.payloadType,type:_.type,subtype:_.parameter})}}this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" ");this._mediaObject.ext=[];for(const b of c.headerExtensions){this._mediaObject.ext.push({uri:b.uri,value:b.id})}this._mediaObject.rtcpMux="rtcp-mux";this._mediaObject.rtcpRsize="rtcp-rsize";const f=c.encodings[0];const h=f.ssrc;const p=f.rtx&&f.rtx.ssrc?f.rtx.ssrc:undefined;this._mediaObject.ssrcs=[];this._mediaObject.ssrcGroups=[];if(c.rtcp.cname){this._mediaObject.ssrcs.push({id:h,attribute:"cname",value:c.rtcp.cname})}if(this._planB){this._mediaObject.ssrcs.push({id:h,attribute:"msid",value:`${d||"-"} ${l}`})}if(p){if(c.rtcp.cname){this._mediaObject.ssrcs.push({id:p,attribute:"cname",value:c.rtcp.cname})}if(this._planB){this._mediaObject.ssrcs.push({id:p,attribute:"msid",value:`${d||"-"} ${l}`})}this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${h} ${p}`})}break}case"application":{if(!u){this._mediaObject.payloads="webrtc-datachannel";this._mediaObject.sctpPort=r.port;this._mediaObject.maxMessageSize=r.maxMessageSize}else{this._mediaObject.payloads=r.port;this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:r.port,maxMessageSize:r.maxMessageSize}}break}}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:t,trackId:i}){const r=e.encodings[0];const n=r.ssrc;const a=r.rtx&&r.rtx.ssrc?r.rtx.ssrc:undefined;if(e.rtcp.cname){this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname})}this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} ${i}`});if(a){if(e.rtcp.cname){this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:e.rtcp.cname})}this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${t||"-"} ${i}`});this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${a}`})}}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0];const i=t.ssrc;const r=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:undefined;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(e=>e.id!==i&&e.id!==r);if(r){this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(e=>e.ssrcs!==`${i} ${r}`)}}}i.OfferMediaSection=c;function D(e){const t=new RegExp("^(audio|video)/(.+)","i");const i=t.exec(e.mimeType);if(!i)throw new TypeError("invalid codec.mimeType");return i[2]}},{"../../utils":50}],42:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.RemoteSdp=void 0;const s=a(e("sdp-transform"));const o=e("../../Logger");const c=e("./MediaSection");const d=new o.Logger("RemoteSdp");class l{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:i,sctpParameters:r,plainRtpParameters:n,planB:a=false}){this._mediaSections=[];this._midToIndex=new Map;this._iceParameters=e;this._iceCandidates=t;this._dtlsParameters=i;this._sctpParameters=r;this._plainRtpParameters=n;this._planB=a;this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]};if(e&&e.iceLite){this._sdpObject.icelite="ice-lite"}if(i){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const s=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:i.fingerprints[s-1].algorithm,hash:i.fingerprints[s-1].value};this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}if(n){this._sdpObject.origin.address=n.ip;this._sdpObject.origin.ipVer=n.ipVersion}}updateIceParameters(e){d.debug("updateIceParameters() [iceParameters:%o]",e);this._iceParameters=e;this._sdpObject.icelite=e.iceLite?"ice-lite":undefined;for(const t of this._mediaSections){t.setIceParameters(e)}}updateDtlsRole(e){d.debug("updateDtlsRole() [role:%s]",e);this._dtlsParameters.role=e;for(const t of this._mediaSections){t.setDtlsRole(e)}}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:i,answerRtpParameters:r,codecOptions:n,extmapAllowMixed:a=false}){const s=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:i,answerRtpParameters:r,codecOptions:n,extmapAllowMixed:a});if(t){this._replaceMediaSection(s,t)}else if(!this._midToIndex.has(s.mid)){this._addMediaSection(s)}else{this._replaceMediaSection(s)}}receive({mid:e,kind:t,offerRtpParameters:i,streamId:r,trackId:n}){const a=this._midToIndex.get(e);let s;if(a!==undefined)s=this._mediaSections[a];if(!s){s=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:i,streamId:r,trackId:n});const o=this._mediaSections.find(e=>e.closed);if(o){this._replaceMediaSection(s,o.mid)}else{this._addMediaSection(s)}}else{s.planBReceive({offerRtpParameters:i,streamId:r,trackId:n});this._replaceMediaSection(s)}}disableMediaSection(e){const t=this._midToIndex.get(e);if(t===undefined){throw new Error(`no media section found with mid '${e}'`)}const i=this._mediaSections[t];i.disable()}closeMediaSection(e){const t=this._midToIndex.get(e);if(t===undefined){throw new Error(`no media section found with mid '${e}'`)}const i=this._mediaSections[t];if(e===this._firstMid){d.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e);this.disableMediaSection(e);return}i.close();this._regenerateBundleMids()}planBStopReceiving({mid:e,offerRtpParameters:t}){const i=this._midToIndex.get(e);if(i===undefined){throw new Error(`no media section found with mid '${e}'`)}const r=this._mediaSections[i];r.planBStopReceiving({offerRtpParameters:t});this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:e}){const t=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=false}={}){const t=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){this._sdpObject.origin.sessionVersion++;return s.write(this._sdpObject)}_addMediaSection(e){if(!this._firstMid)this._firstMid=e.mid;this._mediaSections.push(e);this._midToIndex.set(e.mid,this._mediaSections.length-1);this._sdpObject.media.push(e.getObject());this._regenerateBundleMids()}_replaceMediaSection(e,t){if(typeof t==="string"){const i=this._midToIndex.get(t);if(i===undefined){throw new Error(`no media section found for reuseMid '${t}'`)}const r=this._mediaSections[i];this._mediaSections[i]=e;this._midToIndex.delete(r.mid);this._midToIndex.set(e.mid,i);this._sdpObject.media[i]=e.getObject();this._regenerateBundleMids()}else{const i=this._midToIndex.get(e.mid);if(i===undefined){throw new Error(`no media section found with mid '${e.mid}'`)}this._mediaSections[i]=e;this._sdpObject.media[i]=e.getObject()}}_regenerateBundleMids(){if(!this._dtlsParameters)return;this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" ")}}i.RemoteSdp=l},{"../../Logger":24,"./MediaSection":41,"sdp-transform":73}],43:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.applyCodecParameters=i.getCname=i.extractDtlsParameters=i.extractRtpCapabilities=void 0;const v=a(e("sdp-transform"));function s({sdpObject:e}){const t=new Map;const i=[];let r=false;let n=false;for(const s of e.media){const o=s.type;switch(o){case"audio":{if(r)continue;r=true;break}case"video":{if(n)continue;n=true;break}default:{continue}}for(const c of s.rtp){const d={kind:o,mimeType:`${o}/${c.codec}`,preferredPayloadType:c.payload,clockRate:c.rate,channels:c.encoding,parameters:{},rtcpFeedback:[]};t.set(d.preferredPayloadType,d)}for(const l of s.fmtp||[]){const u=v.parseParams(l.config);const d=t.get(l.payload);if(!d)continue;if(u&&u.hasOwnProperty("profile-level-id"))u["profile-level-id"]=String(u["profile-level-id"]);d.parameters=u}for(const f of s.rtcpFb||[]){const d=t.get(f.payload);if(!d)continue;const h={type:f.type,parameter:f.subtype};if(!h.parameter)delete h.parameter;d.rtcpFeedback.push(h)}for(const p of s.ext||[]){if(p["encrypt-uri"])continue;const m={kind:o,uri:p.uri,preferredId:p.value};i.push(m)}}const a={codecs:Array.from(t.values()),headerExtensions:i};return a}i.extractRtpCapabilities=s;function o({sdpObject:e}){const t=(e.media||[]).find(e=>e.iceUfrag&&e.port!==0);if(!t)throw new Error("no active media section found");const i=t.fingerprint||e.fingerprint;let r;switch(t.setup){case"active":r="client";break;case"passive":r="server";break;case"actpass":r="auto";break}const n={role:r,fingerprints:[{algorithm:i.type,value:i.hash}]};return n}i.extractDtlsParameters=o;function c({offerMediaObject:e}){const t=(e.ssrcs||[]).find(e=>e.attribute==="cname");if(!t)return"";return t.value}i.getCname=c;function d({offerRtpParameters:e,answerMediaObject:t}){for(const i of e.codecs){const r=i.mimeType.toLowerCase();if(r!=="audio/opus")continue;const n=(t.rtp||[]).find(e=>e.payload===i.payloadType);if(!n)continue;t.fmtp=t.fmtp||[];let e=t.fmtp.find(e=>e.payload===i.payloadType);if(!e){e={payload:i.payloadType,config:""};t.fmtp.push(e)}const a=v.parseParams(e.config);switch(r){case"audio/opus":{const s=i.parameters["sprop-stereo"];if(s!==undefined)a.stereo=s?1:0;break}}e.config="";for(const o of Object.keys(a)){if(e.config)e.config+=";";e.config+=`${o}=${a[o]}`}}}i.applyCodecParameters=d},{"sdp-transform":73}],44:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.addLegacySimulcast=i.getRtpEncodings=void 0;function r({offerMediaObject:e,track:t}){let i;const r=new Set;for(const s of e.ssrcs||[]){if(s.attribute!=="msid")continue;const o=s.value.split(" ")[1];if(o===t.id){const c=s.id;r.add(c);if(!i)i=c}}if(r.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const n=new Map;for(const s of e.ssrcGroups||[]){if(s.semantics!=="FID")continue;let[e,t]=s.ssrcs.split(/\s+/);e=Number(e);t=Number(t);if(r.has(e)){r.delete(e);r.delete(t);n.set(e,t)}}for(const c of r){n.set(c,null)}const a=[];for(const[c,d]of n){const l={ssrc:c};if(d)l.rtx={ssrc:d};a.push(l)}return a}i.getRtpEncodings=r;function n({offerMediaObject:t,track:i,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");let n;let a;let s;const e=(t.ssrcs||[]).find(e=>{if(e.attribute!=="msid")return false;const t=e.value.split(" ")[1];if(t===i.id){n=e.id;s=e.value.split(" ")[0];return true}else{return false}});if(!e)throw new Error(`a=ssrc line with msid information not found [track.id:${i.id}]`);(t.ssrcGroups||[]).some(e=>{if(e.semantics!=="FID")return false;const t=e.ssrcs.split(/\s+/);if(Number(t[0])===n){a=Number(t[1]);return true}else{return false}});const o=t.ssrcs.find(e=>e.attribute==="cname"&&e.id===n);if(!o)throw new Error(`a=ssrc line with cname information not found [track.id:${i.id}]`);const c=o.value;const d=[];const l=[];for(let e=0;e<r;++e){d.push(n+e);if(a)l.push(a+e)}t.ssrcGroups=t.ssrcGroups||[];t.ssrcs=t.ssrcs||[];t.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let e=0;e<d.length;++e){const u=d[e];t.ssrcs.push({id:u,attribute:"cname",value:c});t.ssrcs.push({id:u,attribute:"msid",value:`${s} ${i.id}`})}for(let e=0;e<l.length;++e){const u=d[e];const f=l[e];t.ssrcs.push({id:f,attribute:"cname",value:c});t.ssrcs.push({id:f,attribute:"msid",value:`${s} ${i.id}`});t.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${f}`})}}i.addLegacySimulcast=n},{}],45:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.addLegacySimulcast=i.getRtpEncodings=void 0;function r({offerMediaObject:e}){const i=new Set;for(const n of e.ssrcs||[]){const a=n.id;i.add(a)}if(i.size===0)throw new Error("no a=ssrc lines found");const r=new Map;for(const n of e.ssrcGroups||[]){if(n.semantics!=="FID")continue;let[e,t]=n.ssrcs.split(/\s+/);e=Number(e);t=Number(t);if(i.has(e)){i.delete(e);i.delete(t);r.set(e,t)}}for(const a of i){r.set(a,null)}const t=[];for(const[a,s]of r){const o={ssrc:a};if(s)o.rtx={ssrc:s};t.push(o)}return t}i.getRtpEncodings=r;function n({offerMediaObject:t,numStreams:i}){if(i<=1)throw new TypeError("numStreams must be greater than 1");const e=(t.ssrcs||[]).find(e=>e.attribute==="msid");if(!e)throw new Error("a=ssrc line with msid information not found");const[r,n]=e.value.split(" ");const a=e.id;let s;(t.ssrcGroups||[]).some(e=>{if(e.semantics!=="FID")return false;const t=e.ssrcs.split(/\s+/);if(Number(t[0])===a){s=Number(t[1]);return true}else{return false}});const o=t.ssrcs.find(e=>e.attribute==="cname");if(!o)throw new Error("a=ssrc line with cname information not found");const c=o.value;const d=[];const l=[];for(let e=0;e<i;++e){d.push(a+e);if(s)l.push(s+e)}t.ssrcGroups=[];t.ssrcs=[];t.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let e=0;e<d.length;++e){const u=d[e];t.ssrcs.push({id:u,attribute:"cname",value:c});t.ssrcs.push({id:u,attribute:"msid",value:`${r} ${n}`})}for(let e=0;e<l.length;++e){const u=d[e];const f=l[e];t.ssrcs.push({id:f,attribute:"cname",value:c});t.ssrcs.push({id:f,attribute:"msid",value:`${r} ${n}`});t.ssrcGroups.push({semantics:"FID",ssrcs:`${u} ${f}`})}}i.addLegacySimulcast=n},{}],46:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.detectDevice=i.Device=i.version=i.types=void 0;const s=e("./Device");Object.defineProperty(i,"Device",{enumerable:true,get:function(){return s.Device}});Object.defineProperty(i,"detectDevice",{enumerable:true,get:function(){return s.detectDevice}});const o=a(e("./types"));i.types=o;i.version="3.6.30";var c=e("./scalabilityModes");Object.defineProperty(i,"parseScalabilityMode",{enumerable:true,get:function(){return c.parse}})},{"./Device":22,"./scalabilityModes":48,"./types":49}],47:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)if(i!=="default"&&Object.hasOwnProperty.call(e,i))r(t,e,i);n(t,e);return t};Object.defineProperty(i,"__esModule",{value:true});i.canReceive=i.canSend=i.generateProbatorRtpParameters=i.reduceCodecs=i.getSendingRemoteRtpParameters=i.getSendingRtpParameters=i.getRecvRtpCapabilities=i.getExtendedRtpCapabilities=i.validateSctpStreamParameters=i.validateSctpParameters=i.validateNumSctpStreams=i.validateSctpCapabilities=i.validateRtcpParameters=i.validateRtpEncodingParameters=i.validateRtpHeaderExtensionParameters=i.validateRtpCodecParameters=i.validateRtpParameters=i.validateRtpHeaderExtension=i.validateRtcpFeedback=i.validateRtpCodecCapability=i.validateRtpCapabilities=void 0;const l=a(e("h264-profile-level-id"));const s=a(e("./utils"));const o="probator";const c=1234;const d=127;function u(e){if(typeof e!=="object")throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");else if(!e.codecs)e.codecs=[];for(const t of e.codecs){f(t)}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");else if(!e.headerExtensions)e.headerExtensions=[];for(const i of e.headerExtensions){p(i)}}i.validateRtpCapabilities=u;function f(t){const e=new RegExp("^(audio|video)/(.+)","i");if(typeof t!=="object")throw new TypeError("codec is not an object");if(!t.mimeType||typeof t.mimeType!=="string")throw new TypeError("missing codec.mimeType");const i=e.exec(t.mimeType);if(!i)throw new TypeError("invalid codec.mimeType");t.kind=i[1].toLowerCase();if(t.preferredPayloadType&&typeof t.preferredPayloadType!=="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof t.clockRate!=="number")throw new TypeError("missing codec.clockRate");if(t.kind==="audio"){if(typeof t.channels!=="number")t.channels=1}else{delete t.channels}if(!t.parameters||typeof t.parameters!=="object")t.parameters={};for(const r of Object.keys(t.parameters)){let e=t.parameters[r];if(e===undefined){t.parameters[r]="";e=""}if(typeof e!=="string"&&typeof e!=="number"){throw new TypeError(`invalid codec parameter [key:${r}s, value:${e}]`)}if(r==="apt"){if(typeof e!=="number")throw new TypeError("invalid codec apt parameter")}}if(!t.rtcpFeedback||!Array.isArray(t.rtcpFeedback))t.rtcpFeedback=[];for(const n of t.rtcpFeedback){h(n)}}i.validateRtpCodecCapability=f;function h(e){if(typeof e!=="object")throw new TypeError("fb is not an object");if(!e.type||typeof e.type!=="string")throw new TypeError("missing fb.type");if(!e.parameter||typeof e.parameter!=="string")e.parameter=""}i.validateRtcpFeedback=h;function p(e){if(typeof e!=="object")throw new TypeError("ext is not an object");if(!e.kind||typeof e.kind!=="string")e.kind="";if(e.kind!==""&&e.kind!=="audio"&&e.kind!=="video")throw new TypeError("invalid ext.kind");if(!e.uri||typeof e.uri!=="string")throw new TypeError("missing ext.uri");if(typeof e.preferredId!=="number")throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&typeof e.preferredEncrypt!=="boolean")throw new TypeError("invalid ext.preferredEncrypt");else if(!e.preferredEncrypt)e.preferredEncrypt=false;if(e.direction&&typeof e.direction!=="string")throw new TypeError("invalid ext.direction");else if(!e.direction)e.direction="sendrecv"}i.validateRtpHeaderExtension=p;function m(e){if(typeof e!=="object")throw new TypeError("params is not an object");if(e.mid&&typeof e.mid!=="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs){v(t)}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");else if(!e.headerExtensions)e.headerExtensions=[];for(const i of e.headerExtensions){y(i)}if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");else if(!e.encodings)e.encodings=[];for(const r of e.encodings){g(r)}if(e.rtcp&&typeof e.rtcp!=="object")throw new TypeError("params.rtcp is not an object");else if(!e.rtcp)e.rtcp={};_(e.rtcp)}i.validateRtpParameters=m;function v(t){const e=new RegExp("^(audio|video)/(.+)","i");if(typeof t!=="object")throw new TypeError("codec is not an object");if(!t.mimeType||typeof t.mimeType!=="string")throw new TypeError("missing codec.mimeType");const i=e.exec(t.mimeType);if(!i)throw new TypeError("invalid codec.mimeType");if(typeof t.payloadType!=="number")throw new TypeError("missing codec.payloadType");if(typeof t.clockRate!=="number")throw new TypeError("missing codec.clockRate");const r=i[1].toLowerCase();if(r==="audio"){if(typeof t.channels!=="number")t.channels=1}else{delete t.channels}if(!t.parameters||typeof t.parameters!=="object")t.parameters={};for(const n of Object.keys(t.parameters)){let e=t.parameters[n];if(e===undefined){t.parameters[n]="";e=""}if(typeof e!=="string"&&typeof e!=="number"){throw new TypeError(`invalid codec parameter [key:${n}s, value:${e}]`)}if(n==="apt"){if(typeof e!=="number")throw new TypeError("invalid codec apt parameter")}}if(!t.rtcpFeedback||!Array.isArray(t.rtcpFeedback))t.rtcpFeedback=[];for(const a of t.rtcpFeedback){h(a)}}i.validateRtpCodecParameters=v;function y(t){if(typeof t!=="object")throw new TypeError("ext is not an object");if(!t.uri||typeof t.uri!=="string")throw new TypeError("missing ext.uri");if(typeof t.id!=="number")throw new TypeError("missing ext.id");if(t.encrypt&&typeof t.encrypt!=="boolean")throw new TypeError("invalid ext.encrypt");else if(!t.encrypt)t.encrypt=false;if(!t.parameters||typeof t.parameters!=="object")t.parameters={};for(const i of Object.keys(t.parameters)){let e=t.parameters[i];if(e===undefined){t.parameters[i]="";e=""}if(typeof e!=="string"&&typeof e!=="number")throw new TypeError("invalid header extension parameter")}}i.validateRtpHeaderExtensionParameters=y;function g(e){if(typeof e!=="object")throw new TypeError("encoding is not an object");if(e.ssrc&&typeof e.ssrc!=="number")throw new TypeError("invalid encoding.ssrc");if(e.rid&&typeof e.rid!=="string")throw new TypeError("invalid encoding.rid");if(e.rtx&&typeof e.rtx!=="object"){throw new TypeError("invalid encoding.rtx")}else if(e.rtx){if(typeof e.rtx.ssrc!=="number")throw new TypeError("missing encoding.rtx.ssrc")}if(!e.dtx||typeof e.dtx!=="boolean")e.dtx=false;if(e.scalabilityMode&&typeof e.scalabilityMode!=="string")throw new TypeError("invalid encoding.scalabilityMode")}i.validateRtpEncodingParameters=g;function _(e){if(typeof e!=="object")throw new TypeError("rtcp is not an object");if(e.cname&&typeof e.cname!=="string")throw new TypeError("invalid rtcp.cname");if(!e.reducedSize||typeof e.reducedSize!=="boolean")e.reducedSize=true}i.validateRtcpParameters=_;function b(e){if(typeof e!=="object")throw new TypeError("caps is not an object");if(!e.numStreams||typeof e.numStreams!=="object")throw new TypeError("missing caps.numStreams");w(e.numStreams)}i.validateSctpCapabilities=b;function w(e){if(typeof e!=="object")throw new TypeError("numStreams is not an object");if(typeof e.OS!=="number")throw new TypeError("missing numStreams.OS");if(typeof e.MIS!=="number")throw new TypeError("missing numStreams.MIS")}i.validateNumSctpStreams=w;function S(e){if(typeof e!=="object")throw new TypeError("params is not an object");if(typeof e.port!=="number")throw new TypeError("missing params.port");if(typeof e.OS!=="number")throw new TypeError("missing params.OS");if(typeof e.MIS!=="number")throw new TypeError("missing params.MIS");if(typeof e.maxMessageSize!=="number")throw new TypeError("missing params.maxMessageSize")}i.validateSctpParameters=S;function k(e){if(typeof e!=="object")throw new TypeError("params is not an object");if(typeof e.streamId!=="number")throw new TypeError("missing params.streamId");let t=false;if(typeof e.ordered==="boolean")t=true;else e.ordered=true;if(e.maxPacketLifeTime&&typeof e.maxPacketLifeTime!=="number")throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&typeof e.maxRetransmits!=="number")throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits)){throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits")}else if(!t&&(e.maxPacketLifeTime||e.maxRetransmits)){e.ordered=false}if(e.priority&&typeof e.priority!=="string")throw new TypeError("invalid params.priority");if(e.label&&typeof e.label!=="string")throw new TypeError("invalid params.label");if(e.protocol&&typeof e.protocol!=="string")throw new TypeError("invalid params.protocol")}i.validateSctpStreamParameters=k;function C(e,t){const i={codecs:[],headerExtensions:[]};for(const r of t.codecs||[]){if(I(r))continue;const n=(e.codecs||[]).find(e=>A(e,r,{strict:true,modify:true}));if(!n)continue;const a={mimeType:n.mimeType,kind:n.kind,clockRate:n.clockRate,channels:n.channels,localPayloadType:n.preferredPayloadType,localRtxPayloadType:undefined,remotePayloadType:r.preferredPayloadType,remoteRtxPayloadType:undefined,localParameters:n.parameters,remoteParameters:r.parameters,rtcpFeedback:L(n,r)};i.codecs.push(a)}for(const a of i.codecs){const s=e.codecs.find(e=>I(e)&&e.parameters.apt===a.localPayloadType);const o=t.codecs.find(e=>I(e)&&e.parameters.apt===a.remotePayloadType);if(s&&o){a.localRtxPayloadType=s.preferredPayloadType;a.remoteRtxPayloadType=o.preferredPayloadType}}for(const c of t.headerExtensions){const d=e.headerExtensions.find(e=>B(e,c));if(!d)continue;const l={kind:c.kind,uri:c.uri,sendId:d.preferredId,recvId:c.preferredId,encrypt:d.preferredEncrypt,direction:"sendrecv"};switch(c.direction){case"sendrecv":l.direction="sendrecv";break;case"recvonly":l.direction="sendonly";break;case"sendonly":l.direction="recvonly";break;case"inactive":l.direction="inactive";break}i.headerExtensions.push(l)}return i}i.getExtendedRtpCapabilities=C;function T(e){const t={codecs:[],headerExtensions:[]};for(const i of e.codecs){const r={mimeType:i.mimeType,kind:i.kind,preferredPayloadType:i.remotePayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.localParameters,rtcpFeedback:i.rtcpFeedback};t.codecs.push(r);if(!i.remoteRtxPayloadType)continue;const n={mimeType:`${i.kind}/rtx`,kind:i.kind,preferredPayloadType:i.remoteRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.remotePayloadType},rtcpFeedback:[]};t.codecs.push(n)}for(const a of e.headerExtensions){if(a.direction!=="sendrecv"&&a.direction!=="recvonly"){continue}const s={kind:a.kind,uri:a.uri,preferredId:a.recvId,preferredEncrypt:a.encrypt,direction:a.direction};t.headerExtensions.push(s)}return t}i.getRecvRtpCapabilities=T;function P(e,t){const i={mid:undefined,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const n={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};i.codecs.push(n);if(r.localRtxPayloadType){const a={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};i.codecs.push(a)}}for(const s of t.headerExtensions){if(s.kind&&s.kind!==e||s.direction!=="sendrecv"&&s.direction!=="sendonly"){continue}const o={uri:s.uri,id:s.sendId,encrypt:s.encrypt,parameters:{}};i.headerExtensions.push(o)}return i}i.getSendingRtpParameters=P;function R(e,t){const i={mid:undefined,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of t.codecs){if(r.kind!==e)continue;const n={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.remoteParameters,rtcpFeedback:r.rtcpFeedback};i.codecs.push(n);if(r.localRtxPayloadType){const a={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};i.codecs.push(a)}}for(const s of t.headerExtensions){if(s.kind&&s.kind!==e||s.direction!=="sendrecv"&&s.direction!=="sendonly"){continue}const o={uri:s.uri,id:s.sendId,encrypt:s.encrypt,parameters:{}};i.headerExtensions.push(o)}if(i.headerExtensions.some(e=>e.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")){for(const n of i.codecs){n.rtcpFeedback=(n.rtcpFeedback||[]).filter(e=>e.type!=="goog-remb")}}else if(i.headerExtensions.some(e=>e.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")){for(const n of i.codecs){n.rtcpFeedback=(n.rtcpFeedback||[]).filter(e=>e.type!=="transport-cc")}}else{for(const n of i.codecs){n.rtcpFeedback=(n.rtcpFeedback||[]).filter(e=>e.type!=="transport-cc"&&e.type!=="goog-remb")}}return i}i.getSendingRemoteRtpParameters=R;function E(t,i){const r=[];if(!i){r.push(t[0]);if(I(t[1]))r.push(t[1])}else{for(let e=0;e<t.length;++e){if(A(t[e],i)){r.push(t[e]);if(I(t[e+1]))r.push(t[e+1]);break}}if(r.length===0)throw new TypeError("no matching codec found")}return r}i.reduceCodecs=E;function x(e){e=s.clone(e,{});m(e);const t={mid:o,codecs:[],headerExtensions:[],encodings:[{ssrc:c}],rtcp:{cname:"probator"}};t.codecs.push(e.codecs[0]);t.codecs[0].payloadType=d;t.headerExtensions=e.headerExtensions;return t}i.generateProbatorRtpParameters=x;function M(t,e){return e.codecs.some(e=>e.kind===t)}i.canSend=M;function D(e,t){m(e);if(e.codecs.length===0)return false;const i=e.codecs[0];return t.codecs.some(e=>e.remotePayloadType===i.payloadType)}i.canReceive=D;function I(e){if(!e)return false;return/.+\/rtx$/i.test(e.mimeType)}function A(t,i,{strict:e=false,modify:r=false}={}){const n=t.mimeType.toLowerCase();const a=i.mimeType.toLowerCase();if(n!==a)return false;if(t.clockRate!==i.clockRate)return false;if(t.channels!==i.channels)return false;switch(n){case"video/h264":{const s=t.parameters["packetization-mode"]||0;const o=i.parameters["packetization-mode"]||0;if(s!==o)return false;if(e){if(!l.isSameProfile(t.parameters,i.parameters))return false;let e;try{e=l.generateProfileLevelIdForAnswer(t.parameters,i.parameters)}catch(e){return false}if(r){if(e){t.parameters["profile-level-id"]=e;i.parameters["profile-level-id"]=e}else{delete t.parameters["profile-level-id"];delete i.parameters["profile-level-id"]}}}break}case"video/vp9":{if(e){const c=t.parameters["profile-id"]||0;const d=i.parameters["profile-id"]||0;if(c!==d)return false}break}}return true}function B(e,t){if(e.kind&&t.kind&&e.kind!==t.kind)return false;if(e.uri!==t.uri)return false;return true}function L(e,t){const i=[];for(const r of e.rtcpFeedback||[]){const n=(t.rtcpFeedback||[]).find(e=>e.type===r.type&&(e.parameter===r.parameter||!e.parameter&&!r.parameter));if(n)i.push(n)}return i}},{"./utils":50,"h264-profile-level-id":11}],48:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.parse=void 0;const r=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function n(e){const t=r.exec(e||"");if(t){return{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}}else{return{spatialLayers:1,temporalLayers:1}}}i.parse=n},{}],49:[function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){if(r===undefined)r=i;Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){if(r===undefined)r=i;e[r]=t[i]});var n=this&&this.__exportStar||function(e,t){for(var i in e)if(i!=="default"&&!t.hasOwnProperty(i))r(t,e,i)};Object.defineProperty(i,"__esModule",{value:true});n(e("./Device"),i);n(e("./Transport"),i);n(e("./Producer"),i);n(e("./Consumer"),i);n(e("./DataProducer"),i);n(e("./DataConsumer"),i);n(e("./RtpParameters"),i);n(e("./SctpParameters"),i);n(e("./handlers/HandlerInterface"),i);n(e("./errors"),i)},{"./Consumer":19,"./DataConsumer":20,"./DataProducer":21,"./Device":22,"./Producer":25,"./RtpParameters":26,"./SctpParameters":27,"./Transport":28,"./errors":29,"./handlers/HandlerInterface":36}],50:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.generateRandomNumber=i.clone=void 0;function r(e,t){if(typeof e==="undefined")return t;return JSON.parse(JSON.stringify(e))}i.clone=r;function n(){return Math.round(Math.random()*1e7)}i.generateRandomNumber=n},{}],51:[function(o,c,d){(function(s){(function(){d.formatArgs=t;d.save=i;d.load=r;d.useColors=e;d.storage=n();d.destroy=(()=>{let e=false;return()=>{if(!e){e=true;console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}}})();d.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){if(typeof window!=="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function t(e){e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+c.exports.humanize(this.diff);if(!this.useColors){return}const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let i=0;let r=0;e[0].replace(/%[a-zA-Z%]/g,e=>{if(e==="%%"){return}i++;if(e==="%c"){r=i}});e.splice(r,0,t)}d.log=console.debug||console.log||(()=>{});function i(e){try{if(e){d.storage.setItem("debug",e)}else{d.storage.removeItem("debug")}}catch(e){}}function r(){let e;try{e=d.storage.getItem("debug")}catch(e){}if(!e&&typeof s!=="undefined"&&"env"in s){e=s.env.DEBUG}return e}function n(){try{return localStorage}catch(e){}}c.exports=o("./common")(d);const{formatters:a}=c.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,o("_process"))},{"./common":52,_process:54}],52:[function(e,t,i){arguments[4][13][0].apply(i,arguments)},{dup:13,ms:53}],53:[function(e,t,i){arguments[4][14][0].apply(i,arguments)},{dup:14}],54:[function(e,t,i){var r=t.exports={};var n;var a;function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){n=setTimeout}else{n=s}}catch(e){n=s}try{if(typeof clearTimeout==="function"){a=clearTimeout}else{a=o}}catch(e){a=o}})();function c(t){if(n===setTimeout){return setTimeout(t,0)}if((n===s||!n)&&setTimeout){n=setTimeout;return setTimeout(t,0)}try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}function d(t){if(a===clearTimeout){return clearTimeout(t)}if((a===o||!a)&&clearTimeout){a=clearTimeout;return clearTimeout(t)}try{return a(t)}catch(e){try{return a.call(null,t)}catch(e){return a.call(this,t)}}}var l=[];var u=false;var f;var h=-1;function p(){if(!u||!f){return}u=false;if(f.length){l=f.concat(l)}else{h=-1}if(l.length){m()}}function m(){if(u){return}var e=c(p);u=true;var t=l.length;while(t){f=l;l=[];while(++h<t){if(f){f[h].run()}}h=-1;t=l.length}f=null;u=false;d(e)}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}l.push(new v(e,t));if(l.length===1&&!u){c(m)}};function v(e,t){this.fun=e;this.array=t}v.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=true;r.env={};r.argv=[];r.version="";r.versions={};function y(){}r.on=y;r.addListener=y;r.once=y;r.off=y;r.removeListener=y;r.removeAllListeners=y;r.emit=y;r.prependListener=y;r.prependOnceListener=y;r.listeners=function(e){return[]};r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0}},{}],55:[function(e,t,i){const{EventEmitter:r}=e("events");const n=e("./Logger");class a extends r{constructor(e){super();this.setMaxListeners(Infinity);this._logger=e||new n("EnhancedEventEmitter")}safeEmit(t,...e){try{this.emit(t,...e)}catch(e){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",t,e)}}async safeEmitAsPromise(i,...r){return new Promise((e,t)=>{this.safeEmit(i,...r,e,t)})}}t.exports=a},{"./Logger":56,events:10}],56:[function(e,t,i){const r=e("debug");const n="protoo-client";class a{constructor(e){if(e){this._debug=r(`${n}:${e}`);this._warn=r(`${n}:WARN:${e}`);this._error=r(`${n}:ERROR:${e}`)}else{this._debug=r(n);this._warn=r(`${n}:WARN`);this._error=r(`${n}:ERROR`)}this._debug.log=console.info.bind(console);this._warn.log=console.warn.bind(console);this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}t.exports=a},{debug:62}],57:[function(e,t,i){const r=e("./Logger");const{generateRandomNumber:n}=e("./utils");const a=new r("Message");class s{static parse(e){let t;const i={};try{t=JSON.parse(e)}catch(e){a.error("parse() | invalid JSON: %s",e);return}if(typeof t!=="object"||Array.isArray(t)){a.error("parse() | not an object");return}if(t.request){i.request=true;if(typeof t.method!=="string"){a.error("parse() | missing/invalid method field");return}if(typeof t.id!=="number"){a.error("parse() | missing/invalid id field");return}i.id=t.id;i.method=t.method;i.data=t.data||{}}else if(t.response){i.response=true;if(typeof t.id!=="number"){a.error("parse() | missing/invalid id field");return}i.id=t.id;if(t.ok){i.ok=true;i.data=t.data||{}}else{i.ok=false;i.errorCode=t.errorCode;i.errorReason=t.errorReason}}else if(t.notification){i.notification=true;if(typeof t.method!=="string"){a.error("parse() | missing/invalid method field");return}i.method=t.method;i.data=t.data||{}}else{a.error("parse() | missing request/response field");return}return i}static createRequest(e,t){const i={request:true,id:n(),method:e,data:t||{}};return i}static createSuccessResponse(e,t){const i={response:true,id:e.id,ok:true,data:t||{}};return i}static createErrorResponse(e,t,i){const r={response:true,id:e.id,ok:false,errorCode:t,errorReason:i};return r}static createNotification(e,t){const i={notification:true,method:e,data:t||{}};return i}}t.exports=s},{"./Logger":56,"./utils":61}],58:[function(e,t,i){const r=e("./Logger");const n=e("./EnhancedEventEmitter");const a=e("./Message");const s=new r("Peer");class o extends n{constructor(e){super(s);s.debug("constructor()");this._closed=false;this._transport=e;this._connected=false;this._data={};this._sents=new Map;this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(this._closed)return;s.debug("close()");this._closed=true;this._connected=false;this._transport.close();for(const e of this._sents.values()){e.close()}this.safeEmit("close")}async request(e,t=undefined){const n=a.createRequest(e,t);this._logger.debug("request() [method:%s, id:%s]",e,n.id);await this._transport.send(n);return new Promise((t,i)=>{const e=1500*(15+.1*this._sents.size);const r={id:n.id,method:n.method,resolve:e=>{if(!this._sents.delete(n.id))return;clearTimeout(r.timer);t(e)},reject:e=>{if(!this._sents.delete(n.id))return;clearTimeout(r.timer);i(e)},timer:setTimeout(()=>{if(!this._sents.delete(n.id))return;i(new Error("request timeout"))},e),close:()=>{clearTimeout(r.timer);i(new Error("peer closed"))}};this._sents.set(n.id,r)})}async notify(e,t=undefined){const i=a.createNotification(e,t);this._logger.debug("notify() [method:%s]",e);await this._transport.send(i)}_handleTransport(){if(this._transport.closed){this._closed=true;setTimeout(()=>{if(this._closed)return;this._connected=false;this.safeEmit("close")});return}this._transport.on("open",()=>{if(this._closed)return;s.debug('emit "open"');this._connected=true;this.safeEmit("open")});this._transport.on("disconnected",()=>{if(this._closed)return;s.debug('emit "disconnected"');this._connected=false;this.safeEmit("disconnected")});this._transport.on("failed",e=>{if(this._closed)return;s.debug('emit "failed" [currentAttempt:%s]',e);this._connected=false;this.safeEmit("failed",e)});this._transport.on("close",()=>{if(this._closed)return;this._closed=true;s.debug('emit "close"');this._connected=false;this.safeEmit("close")});this._transport.on("message",e=>{if(e.request)this._handleRequest(e);else if(e.response)this._handleResponse(e);else if(e.notification)this._handleNotification(e)})}_handleRequest(r){try{this.emit("request",r,e=>{const t=a.createSuccessResponse(r,e);this._transport.send(t).catch(()=>{})},(e,t)=>{if(e instanceof Error){t=e.message;e=500}else if(typeof e==="number"&&t instanceof Error){t=t.message}const i=a.createErrorResponse(r,e,t);this._transport.send(i).catch(()=>{})})}catch(e){const t=a.createErrorResponse(r,500,String(e));this._transport.send(t).catch(()=>{})}}_handleResponse(e){const t=this._sents.get(e.id);if(!t){s.error("received response does not match any sent request [id:%s]",e.id);return}if(e.ok){t.resolve(e.data)}else{const i=new Error(e.errorReason);i.code=e.errorCode;t.reject(i)}}_handleNotification(e){this.safeEmit("notification",e)}}t.exports=o},{"./EnhancedEventEmitter":55,"./Logger":56,"./Message":57}],59:[function(e,t,i){const{version:r}=e("../package.json");const n=e("./Peer");const a=e("./transports/WebSocketTransport");i.version=r;i.Peer=n;i.WebSocketTransport=a},{"../package.json":65,"./Peer":58,"./transports/WebSocketTransport":60}],60:[function(e,t,i){const n=e("websocket").w3cwebsocket;const a=e("retry");const r=e("../Logger");const s=e("../EnhancedEventEmitter");const o=e("../Message");const c="protoo";const d={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:8*1e3};const l=new r("WebSocketTransport");class u extends s{constructor(e,t){super(l);l.debug("constructor() [url:%s, options:%o]",e,t);this._closed=false;this._url=e;this._options=t||{};this._ws=null;this._runWebSocket()}get closed(){return this._closed}close(){if(this._closed)return;l.debug("close()");this._closed=true;this.safeEmit("close");try{this._ws.onopen=null;this._ws.onclose=null;this._ws.onerror=null;this._ws.onmessage=null;this._ws.close()}catch(e){l.error("close() | error closing the WebSocket: %o",e)}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){l.warn("send() failed:%o",e);throw e}}_runWebSocket(){const i=a.operation(this._options.retry||d);let r=false;i.attempt(t=>{if(this._closed){i.stop();return}l.debug("_runWebSocket() [currentAttempt:%s]",t);this._ws=new n(this._url,c,this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig);this._ws.onopen=()=>{if(this._closed)return;r=true;this.safeEmit("open")};this._ws.onclose=e=>{if(this._closed)return;l.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',e.wasClean,e.code,e.reason);if(e.code!==4e3){if(!r){this.safeEmit("failed",t);if(this._closed)return;if(i.retry(true))return}else{i.stop();this.safeEmit("disconnected");if(this._closed)return;this._runWebSocket();return}}this._closed=true;this.safeEmit("close")};this._ws.onerror=()=>{if(this._closed)return;l.error('WebSocket "error" event')};this._ws.onmessage=e=>{if(this._closed)return;const t=o.parse(e.data);if(!t)return;if(this.listenerCount("message")===0){l.error('no listeners for WebSocket "message" event, ignoring received message');return}this.safeEmit("message",t)}})}}t.exports=u},{"../EnhancedEventEmitter":55,"../Logger":56,"../Message":57,retry:69,websocket:85}],61:[function(e,t,i){i.generateRandomNumber=function(){return Math.round(Math.random()*1e7)}},{}],62:[function(o,c,d){(function(s){(function(){d.formatArgs=t;d.save=i;d.load=r;d.useColors=e;d.storage=n();d.destroy=(()=>{let e=false;return()=>{if(!e){e=true;console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}}})();d.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){if(typeof window!=="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function t(e){e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+c.exports.humanize(this.diff);if(!this.useColors){return}const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let i=0;let r=0;e[0].replace(/%[a-zA-Z%]/g,e=>{if(e==="%%"){return}i++;if(e==="%c"){r=i}});e.splice(r,0,t)}d.log=console.debug||console.log||(()=>{});function i(e){try{if(e){d.storage.setItem("debug",e)}else{d.storage.removeItem("debug")}}catch(e){}}function r(){let e;try{e=d.storage.getItem("debug")}catch(e){}if(!e&&typeof s!=="undefined"&&"env"in s){e=s.env.DEBUG}return e}function n(){try{return localStorage}catch(e){}}c.exports=o("./common")(d);const{formatters:a}=c.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this)}).call(this,o("_process"))},{"./common":63,_process:54}],63:[function(e,t,i){arguments[4][13][0].apply(i,arguments)},{dup:13,ms:64}],64:[function(e,t,i){arguments[4][14][0].apply(i,arguments)},{dup:14}],65:[function(e,t,i){t.exports={_from:"protoo-client@^4.0.5",_id:"protoo-client@4.0.6",_inBundle:false,_integrity:"sha512-ZqImkKHpeJhSlgvyI6QAfZNc/aXcCgmmocMx4S1w2lAaxXtckxxeDtcVNtkOISUWm/mbC+BrmYPXoGMkfhkKOQ==",_location:"/protoo-client",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"protoo-client@^4.0.5",name:"protoo-client",escapedName:"protoo-client",rawSpec:"^4.0.5",saveSpec:null,fetchSpec:"^4.0.5"},_requiredBy:["#DEV:/"],_resolved:"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.6.tgz",_shasum:"02a89f997ee5a4f385dab7be938dda1a2c5158e4",_spec:"protoo-client@^4.0.5",_where:"C:\\Works\\Git\\Video\\Wasm\\tstWeb",author:{name:"Iaki Baz Castillo",email:"ibc@aliax.net"},bugs:{url:"https://github.com/ibc/protoo/issues"},bundleDependencies:false,dependencies:{debug:"^4.3.1",events:"^3.2.0",retry:"^0.12.0",websocket:"^1.0.33"},deprecated:false,description:"protoo JavaScript client module",devDependencies:{eslint:"^5.16.0"},engines:{node:">=8.0.0"},homepage:"https://protoo.versatica.com",keywords:["nodejs","browser","websocket"],license:"MIT",main:"lib/index.js",name:"protoo-client",optionalDependencies:{websocket:"^1.0.33"},repository:{type:"git",url:"git+https://github.com/ibc/protoo.git"},scripts:{lint:"eslint -c .eslintrc.js lib"},version:"4.0.6"}},{}],66:[function(e,t,i){"use strict";var a=Object.prototype.hasOwnProperty,s;function o(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function c(e){try{return encodeURIComponent(e)}catch(e){return null}}function r(e){var t=/([^=?#&]+)=?([^&]*)/g,i={},r;while(r=t.exec(e)){var n=o(r[1]),a=o(r[2]);if(n===null||a===null||n in i)continue;i[n]=a}return i}function n(e,t){t=t||"";var i=[],r,n;if("string"!==typeof t)t="?";for(n in e){if(a.call(e,n)){r=e[n];if(!r&&(r===null||r===s||isNaN(r))){r=""}n=c(n);r=c(r);if(n===null||r===null)continue;i.push(n+"="+r)}}return i.length?t+i.join("&"):""}i.stringify=n;i.parse=r},{}],67:[function(e,t,i){"use strict";var r="0123456789",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",a="!$%^&*()_+|~-=`{}[]:;<>?,./";function c(e){e||(e={});return{length:e.length||8,numeric:typeof e.numeric==="boolean"?e.numeric:true,letters:typeof e.letters==="boolean"?e.letters:true,special:typeof e.special==="boolean"?e.special:false,exclude:Array.isArray(e.exclude)?e.exclude:[]}}function d(e){var t="";if(e.numeric){t+=r}if(e.letters){t+=n}if(e.special){t+=a}for(var i=0;i<=e.exclude.length;i++){t=t.replace(e.exclude[i],"")}return t}t.exports=function e(t){t=c(t);var i,r,n="",a=t.length,s=t.exclude,o=d(t);for(i=1;i<=a;i++){n+=o.substring(r=Math.floor(Math.random()*o.length),r+1)}return n}},{}],68:[function(e,t,i){"use strict";t.exports=function e(t,i){i=i.split(":")[0];t=+t;if(!t)return false;switch(i){case"http":case"ws":return t!==80;case"https":case"wss":return t!==443;case"ftp":return t!==21;case"gopher":return t!==70;case"file":return false}return t!==0}},{}],69:[function(e,t,i){t.exports=e("./lib/retry")},{"./lib/retry":70}],70:[function(e,t,o){var i=e("./retry_operation");o.operation=function(e){var t=o.timeouts(e);return new i(t,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})};o.timeouts=function(e){if(e instanceof Array){return[].concat(e)}var t={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:Infinity,randomize:false};for(var i in e){t[i]=e[i]}if(t.minTimeout>t.maxTimeout){throw new Error("minTimeout is greater than maxTimeout")}var r=[];for(var n=0;n<t.retries;n++){r.push(this.createTimeout(n,t))}if(e&&e.forever&&!r.length){r.push(this.createTimeout(n,t))}r.sort(function(e,t){return e-t});return r};o.createTimeout=function(e,t){var i=t.randomize?Math.random()+1:1;var r=Math.round(i*t.minTimeout*Math.pow(t.factor,e));r=Math.min(r,t.maxTimeout);return r};o.wrap=function(a,s,e){if(s instanceof Array){e=s;s=null}if(!e){e=[];for(var t in a){if(typeof a[t]==="function"){e.push(t)}}}for(var i=0;i<e.length;i++){var r=e[i];var n=a[r];a[r]=function e(t){var i=o.operation(s);var r=Array.prototype.slice.call(arguments,1);var n=r.pop();r.push(function(e){if(i.retry(e)){return}if(e){arguments[0]=i.mainError()}n.apply(this,arguments)});i.attempt(function(){t.apply(a,r)})}.bind(a,n);a[r].options=s}}},{"./retry_operation":71}],71:[function(e,t,i){function r(e,t){if(typeof t==="boolean"){t={forever:t}}this._originalTimeouts=JSON.parse(JSON.stringify(e));this._timeouts=e;this._options=t||{};this._maxRetryTime=t&&t.maxRetryTime||Infinity;this._fn=null;this._errors=[];this._attempts=1;this._operationTimeout=null;this._operationTimeoutCb=null;this._timeout=null;this._operationStart=null;if(this._options.forever){this._cachedTimeouts=this._timeouts.slice(0)}}t.exports=r;r.prototype.reset=function(){this._attempts=1;this._timeouts=this._originalTimeouts};r.prototype.stop=function(){if(this._timeout){clearTimeout(this._timeout)}this._timeouts=[];this._cachedTimeouts=null};r.prototype.retry=function(e){if(this._timeout){clearTimeout(this._timeout)}if(!e){return false}var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime){this._errors.unshift(new Error("RetryOperation timeout occurred"));return false}this._errors.push(e);var i=this._timeouts.shift();if(i===undefined){if(this._cachedTimeouts){this._errors.splice(this._errors.length-1,this._errors.length);this._timeouts=this._cachedTimeouts.slice(0);i=this._timeouts.shift()}else{return false}}var r=this;var n=setTimeout(function(){r._attempts++;if(r._operationTimeoutCb){r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout);if(r._options.unref){r._timeout.unref()}}r._fn(r._attempts)},i);if(this._options.unref){n.unref()}return true};r.prototype.attempt=function(e,t){this._fn=e;if(t){if(t.timeout){this._operationTimeout=t.timeout}if(t.cb){this._operationTimeoutCb=t.cb}}var i=this;if(this._operationTimeoutCb){this._timeout=setTimeout(function(){i._operationTimeoutCb()},i._operationTimeout)}this._operationStart=(new Date).getTime();this._fn(this._attempts)};r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated");this.attempt(e)};r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated");this.attempt(e)};r.prototype.start=r.prototype.try;r.prototype.errors=function(){return this._errors};r.prototype.attempts=function(){return this._attempts};r.prototype.mainError=function(){if(this._errors.length===0){return null}var e={};var t=null;var i=0;for(var r=0;r<this._errors.length;r++){var n=this._errors[r];var a=n.message;var s=(e[a]||0)+1;e[a]=s;if(s>=i){t=n;i=s}}return t}},{}],72:[function(e,t,i){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";t+=e.raddr!=null?" raddr %s rport %d":"%v%v";t+=e.tcptype!=null?" tcptype %s":"%v";if(e.generation!=null){t+=" generation %d"}t+=e["network-id"]!=null?" network-id %d":"%v";t+=e["network-cost"]!=null?" network-cost %d":"%v";return t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";if(e.attribute!=null){t+=" %s";if(e.value!=null){t+=":%s"}}return t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)"+"[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)"+"(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:"+"(send|recv) ([a-zA-Z0-9\\-_~;,]+)"+"(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?"+"$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";t+=e.id!=null?"id=%s %s":"%v%s";t+=e.mediaClockValue!=null?"=%s":"";t+=e.rateNumerator!=null?" rate=%s":"";t+=e.rateDenominator!=null?"/%s":"";return t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){var t=r[e];t.forEach(function(e){if(!e.reg){e.reg=/(.*)/}if(!e.format){e.format="%s"}})})},{}],73:[function(e,t,i){var r=e("./parser");var n=e("./writer");i.write=n;i.parse=r.parse;i.parseParams=r.parseParams;i.parseFmtpConfig=r.parseFmtpConfig;i.parsePayloads=r.parsePayloads;i.parseRemoteCandidates=r.parseRemoteCandidates;i.parseImageAttributes=r.parseImageAttributes;i.parseSimulcastStreamList=r.parseSimulcastStreamList},{"./parser":74,"./writer":75}],74:[function(e,t,i){var a=function(e){return String(Number(e))===e?Number(e):e};var s=function(e,t,i,r){if(r&&!i){t[r]=a(e[1])}else{for(var n=0;n<i.length;n+=1){if(e[n+1]!=null){t[i[n]]=a(e[n+1])}}}};var o=function(e,t,i){var r=e.name&&e.names;if(e.push&&!t[e.push]){t[e.push]=[]}else if(r&&!t[e.name]){t[e.name]={}}var n=e.push?{}:r?t[e.name]:t;s(i.match(e.reg),n,e.names,e.name);if(e.push){t[e.push].push(n)}};var c=e("./grammar");var r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);i.parse=function(e){var t={},a=[],s=t;e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0];var i=e.slice(2);if(t==="m"){a.push({rtp:[],fmtp:[]});s=a[a.length-1]}for(var r=0;r<(c[t]||[]).length;r+=1){var n=c[t][r];if(n.reg.test(i)){return o(n,s,i)}}});t.media=a;return t};var n=function(e,t){var i=t.split(/=(.+)/,2);if(i.length===2){e[i[0]]=a(i[1])}else if(i.length===1&&t.length>1){e[i[0]]=undefined}return e};i.parseParams=function(e){return e.split(/;\s?/).reduce(n,{})};i.parseFmtpConfig=i.parseParams;i.parsePayloads=function(e){return e.toString().split(" ").map(Number)};i.parseRemoteCandidates=function(e){var t=[];var i=e.split(" ").map(a);for(var r=0;r<i.length;r+=3){t.push({component:i[r],ip:i[r+1],port:i[r+2]})}return t};i.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(n,{})})};i.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,i=false;if(e[0]!=="~"){t=a(e)}else{t=a(e.substring(1,e.length));i=true}return{scid:t,paused:i}})})}},{"./grammar":72}],75:[function(e,t,i){var a=e("./grammar");var s=/%[sdv%]/g;var o=function(e){var i=1;var r=arguments;var n=r.length;return e.replace(s,function(e){if(i>=n){return e}var t=r[i];i+=1;switch(e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})};var c=function(e,t,i){var r=t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format;var n=[e+"="+r];if(t.names){for(var a=0;a<t.names.length;a+=1){var s=t.names[a];if(t.name){n.push(i[t.name][s])}else{n.push(i[t.names[a]])}}}else{n.push(i[t.name])}return o.apply(null,n)};var d=["v","o","s","i","u","e","p","c","b","t","r","z","a"];var l=["i","c","b","a"];t.exports=function(e,t){t=t||{};if(e.version==null){e.version=0}if(e.name==null){e.name=" "}e.media.forEach(function(e){if(e.payloads==null){e.payloads=""}});var i=t.outerOrder||d;var r=t.innerOrder||l;var n=[];i.forEach(function(i){a[i].forEach(function(t){if(t.name in e&&e[t.name]!=null){n.push(c(i,t,e))}else if(t.push in e&&e[t.push]!=null){e[t.push].forEach(function(e){n.push(c(i,t,e))})}})});e.media.forEach(function(e){n.push(c("m",a.m[0],e));r.forEach(function(i){a[i].forEach(function(t){if(t.name in e&&e[t.name]!=null){n.push(c(i,t,e))}else if(t.push in e&&e[t.push]!=null){e[t.push].forEach(function(e){n.push(c(i,t,e))})}})})});return n.join("\r\n")+"\r\n"}},{"./grammar":72}],76:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var a=e("./tools");var n=e("int64-buffer");var r=e("./tools");var s=e("matroska/lib/schema");var o=s.byEbmlID;var c;(function(e){e[e["STATE_TAG"]=1]="STATE_TAG";e[e["STATE_SIZE"]=2]="STATE_SIZE";e[e["STATE_CONTENT"]=3]="STATE_CONTENT"})(c||(c={}));var d=function(){function e(){this._buffer=new a.Buffer(0);this._tag_stack=[];this._state=c.STATE_TAG;this._cursor=0;this._total=0;this._schema=o;this._result=[]}e.prototype.decode=function(e){this.readChunk(e);var t=this._result;this._result=[];return t};e.prototype.readChunk=function(e){this._buffer=r.concat([this._buffer,new a.Buffer(e)]);while(this._cursor<this._buffer.length){if(this._state===c.STATE_TAG&&!this.readTag()){break}if(this._state===c.STATE_SIZE&&!this.readSize()){break}if(this._state===c.STATE_CONTENT&&!this.readContent()){break}}};e.prototype.getSchemaInfo=function(e){return this._schema[e]||{name:"unknown",level:-1,type:"unknown",description:"unknown"}};e.prototype.readTag=function(){if(this._cursor>=this._buffer.length){return false}var e=a.readVint(this._buffer,this._cursor);if(e==null){return false}var t=this._buffer.slice(this._cursor,this._cursor+e.length);var i=t.reduce(function(e,t,i,r){return e+t*Math.pow(16,2*(r.length-1-i))},0);var r=this.getSchemaInfo(i);var n={EBML_ID:i.toString(16),schema:r,type:r.type,name:r.name,level:r.level,tagStart:this._total,tagEnd:this._total+e.length,sizeStart:this._total+e.length,sizeEnd:null,dataStart:null,dataEnd:null,dataSize:null,data:null};this._tag_stack.push(n);this._cursor+=e.length;this._total+=e.length;this._state=c.STATE_SIZE;return true};e.prototype.readSize=function(){if(this._cursor>=this._buffer.length){return false}var e=a.readVint(this._buffer,this._cursor);if(e==null){return false}var t=this._tag_stack[this._tag_stack.length-1];t.sizeEnd=t.sizeStart+e.length;t.dataStart=t.sizeEnd;t.dataSize=e.value;if(e.value===-1){t.dataEnd=-1;if(t.type==="m"){t.unknownSize=true}}else{t.dataEnd=t.sizeEnd+e.value}this._cursor+=e.length;this._total+=e.length;this._state=c.STATE_CONTENT;return true};e.prototype.readContent=function(){var e=this._tag_stack[this._tag_stack.length-1];if(e.type==="m"){e.isEnd=false;this._result.push(e);this._state=c.STATE_TAG;if(e.dataSize===0){var t=Object.assign({},e,{isEnd:true});this._result.push(t);this._tag_stack.pop()}return true}if(this._buffer.length<this._cursor+e.dataSize){return false}var i=this._buffer.slice(this._cursor,this._cursor+e.dataSize);this._buffer=this._buffer.slice(this._cursor+e.dataSize);e.data=i;switch(e.type){case"u":e.value=i.readUIntBE(0,i.length);break;case"i":e.value=i.readIntBE(0,i.length);break;case"f":e.value=e.dataSize===4?i.readFloatBE(0):e.dataSize===8?i.readDoubleBE(0):(console.warn("cannot read "+e.dataSize+" octets float. failback to 0"),0);break;case"s":e.value=i.toString("ascii");break;case"8":e.value=i.toString("utf8");break;case"b":e.value=i;break;case"d":e.value=a.convertEBMLDateToJSDate(new n.Int64BE(i).toNumber());break}if(e.value===null){throw new Error("unknown tag type:"+e.type)}this._result.push(e);this._total+=e.dataSize;this._state=c.STATE_TAG;this._cursor=0;this._tag_stack.pop();while(this._tag_stack.length>0){var r=this._tag_stack[this._tag_stack.length-1];if(r.dataEnd<0){this._tag_stack.pop();return true}if(this._total<r.dataEnd){break}if(r.type!=="m"){throw new Error("parent element is not master element")}var t=Object.assign({},r,{isEnd:true});this._result.push(t);this._tag_stack.pop()}return true};return e}();i.default=d},{"./tools":80,"int64-buffer":16,"matroska/lib/schema":18}],77:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var s=e("./tools");var a=e("./tools");var r=e("matroska/lib/schema");var n=r.byEbmlID;var o=function(){function e(){this._schema=n;this._buffers=[];this._stack=[]}e.prototype.encode=function(e){var i=this;return s.concat(e.reduce(function(e,t){return e.concat(i.encodeChunk(t))},[])).buffer};e.prototype.encodeChunk=function(e){if(e.type==="m"){if(!e.isEnd){this.startTag(e)}else{this.endTag(e)}}else{this.writeTag(e)}return this.flush()};e.prototype.flush=function(){var e=this._buffers;this._buffers=[];return e};e.prototype.getSchemaInfo=function(e){var t=Object.keys(this._schema).map(Number);for(var i=0;i<t.length;i++){var r=t[i];if(this._schema[r].name===e){return new a.Buffer(r.toString(16),"hex")}}return null};e.prototype.writeTag=function(e){var t=e.name;var i=this.getSchemaInfo(t);var r=e.data;if(i==null){throw new Error("No schema entry found for "+t)}var n=s.encodeTag(i,r);if(this._stack.length>0){var a=this._stack[this._stack.length-1];a.children.push({tagId:i,elm:e,children:[],data:n});return}this._buffers=this._buffers.concat(n);return};e.prototype.startTag=function(e){var t=e.name;var i=this.getSchemaInfo(t);if(i==null){throw new Error("No schema entry found for "+t)}if(e.unknownSize){var r=s.encodeTag(i,new a.Buffer(0),e.unknownSize);this._buffers=this._buffers.concat(r);return}var n={tagId:i,elm:e,children:[],data:null};if(this._stack.length>0){this._stack[this._stack.length-1].children.push(n)}this._stack.push(n)};e.prototype.endTag=function(e){var t=e.name;var i=this._stack.pop();if(i==null){throw new Error("EBML structure is broken")}if(i.elm.name!==e.name){throw new Error("EBML structure is broken")}var r=i.children.reduce(function(e,t){if(t.data===null){throw new Error("EBML structure is broken")}return e.concat(t.data)},[]);var n=s.concat(r);if(i.elm.type==="m"){i.data=s.encodeTag(i.tagId,n,i.elm.unknownSize)}else{i.data=s.encodeTag(i.tagId,n)}if(this._stack.length<1){this._buffers=this._buffers.concat(i.data)}};return e}();i.default=o},{"./tools":80,"matroska/lib/schema":18}],78:[function(e,t,i){"use strict";var r=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i]};return function(e,t){r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}();Object.defineProperty(i,"__esModule",{value:true});var n=e("events");var l=e("./tools");var a=function(i){r(e,i);function e(){var e=i.call(this)||this;e.logGroup="";e.hasLoggingStarted=false;e.metadataloaded=false;e.chunks=[];e.stack=[];e.segmentOffset=0;e.last2SimpleBlockVideoTrackTimecode=[0,0];e.last2SimpleBlockAudioTrackTimecode=[0,0];e.lastClusterTimecode=0;e.lastClusterPosition=0;e.timecodeScale=1e6;e.metadataSize=0;e.metadatas=[];e.cues=[];e.firstVideoBlockRead=false;e.firstAudioBlockRead=false;e.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null};e.trackTypes=[];e.trackDefaultDuration=[];e.trackCodecDelay=[];e.trackInfo={type:"nothing"};e.ended=false;e.logging=false;e.use_duration_every_simpleblock=false;e.use_webp=false;e.use_segment_info=true;e.drop_default_duration=true;return e}e.prototype.stop=function(){this.ended=true;this.emit_segment_info();while(this.stack.length){this.stack.pop();if(this.logging){console.groupEnd()}}if(this.logging&&this.hasLoggingStarted&&this.logGroup){console.groupEnd()}};e.prototype.emit_segment_info=function(){var e=this.chunks;this.chunks=[];if(!this.metadataloaded){this.metadataloaded=true;this.metadatas=e;var t=this.trackTypes.indexOf(1);var i=this.trackTypes.indexOf(2);this.trackInfo=t>=0&&i>=0?{type:"both",trackNumber:t}:t>=0?{type:"video",trackNumber:t}:i>=0?{type:"audio",trackNumber:i}:{type:"nothing"};if(!this.use_segment_info){return}this.emit("metadata",{data:e,metadataSize:this.metadataSize})}else{if(!this.use_segment_info){return}var r=this.lastClusterTimecode;var n=this.duration;var a=this.timecodeScale;this.emit("cluster",{timecode:r,data:e});this.emit("duration",{timecodeScale:a,duration:n})}};e.prototype.read=function(e){var a=this;var t=false;if(this.ended){return}if(e.type==="m"){if(e.isEnd){this.stack.pop()}else{var i=this.stack[this.stack.length-1];if(i!=null&&i.level>=e.level){this.stack.pop();if(this.logging){console.groupEnd()}i.dataEnd=e.dataEnd;i.dataSize=e.dataEnd-i.dataStart;i.unknownSize=false;var r=Object.assign({},i,{name:i.name,type:i.type,isEnd:true});this.chunks.push(r)}this.stack.push(e)}}if(e.type==="m"&&e.name=="Segment"){if(this.segmentOffset!=0){console.warn("Multiple segments detected!")}this.segmentOffset=e.dataStart;this.emit("segment_offset",this.segmentOffset)}else if(e.type==="b"&&e.name==="SimpleBlock"){var n=l.ebmlBlock(e.data),s=n.timecode,o=n.trackNumber,c=n.frames;if(this.trackTypes[o]===1){if(!this.firstVideoBlockRead){this.firstVideoBlockRead=true;if(this.trackInfo.type==="both"||this.trackInfo.type==="video"){var d=this.lastClusterTimecode+s;this.cues.push({CueTrack:o,CueClusterPosition:this.lastClusterPosition,CueTime:d});this.emit("cue_info",{CueTrack:o,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode});this.emit("cue",{CueTrack:o,CueClusterPosition:this.lastClusterPosition,CueTime:d})}}this.last2SimpleBlockVideoTrackTimecode=[this.last2SimpleBlockVideoTrackTimecode[1],s]}else if(this.trackTypes[o]===2){if(!this.firstAudioBlockRead){this.firstAudioBlockRead=true;if(this.trackInfo.type==="audio"){var d=this.lastClusterTimecode+s;this.cues.push({CueTrack:o,CueClusterPosition:this.lastClusterPosition,CueTime:d});this.emit("cue_info",{CueTrack:o,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode});this.emit("cue",{CueTrack:o,CueClusterPosition:this.lastClusterPosition,CueTime:d})}}this.last2SimpleBlockAudioTrackTimecode=[this.last2SimpleBlockAudioTrackTimecode[1],s]}if(this.use_duration_every_simpleblock){this.emit("duration",{timecodeScale:this.timecodeScale,duration:this.duration})}if(this.use_webp){c.forEach(function(e){var t=e.slice(3,6).toString("hex");if(t!=="9d012a"){return}var i=l.VP8BitStreamToRiffWebPBuffer(e);var r=new Blob([i],{type:"image/webp"});var n=a.duration;a.emit("webp",{currentTime:n,webp:r})})}}else if(e.type==="m"&&e.name==="Cluster"&&e.isEnd===false){this.firstVideoBlockRead=false;this.firstAudioBlockRead=false;this.emit_segment_info();this.emit("cluster_ptr",e.tagStart);this.lastClusterPosition=e.tagStart}else if(e.type==="u"&&e.name==="Timecode"){this.lastClusterTimecode=e.value}else if(e.type==="u"&&e.name==="TimecodeScale"){this.timecodeScale=e.value}else if(e.type==="m"&&e.name==="TrackEntry"){if(e.isEnd){this.trackTypes[this.currentTrack.TrackNumber]=this.currentTrack.TrackType;this.trackDefaultDuration[this.currentTrack.TrackNumber]=this.currentTrack.DefaultDuration;this.trackCodecDelay[this.currentTrack.TrackNumber]=this.currentTrack.CodecDelay}else{this.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null}}}else if(e.type==="u"&&e.name==="TrackType"){this.currentTrack.TrackType=e.value}else if(e.type==="u"&&e.name==="TrackNumber"){this.currentTrack.TrackNumber=e.value}else if(e.type==="u"&&e.name==="CodecDelay"){this.currentTrack.CodecDelay=e.value}else if(e.type==="u"&&e.name==="DefaultDuration"){if(this.drop_default_duration){console.warn("DefaultDuration detected!, remove it");t=true}else{this.currentTrack.DefaultDuration=e.value}}else if(e.name==="unknown"){console.warn(e)}if(!this.metadataloaded&&e.dataEnd>0){this.metadataSize=e.dataEnd}if(!t){this.chunks.push(e)}if(this.logging){this.put(e)}};Object.defineProperty(e.prototype,"duration",{get:function(){if(this.trackInfo.type==="nothing"){console.warn("no video, no audio track");return 0}var e=0;var t=0;var i=0;var r=this.trackDefaultDuration[this.trackInfo.trackNumber];if(typeof r==="number"){e=r}else{if(this.trackInfo.type==="both"){if(this.last2SimpleBlockAudioTrackTimecode[1]>this.last2SimpleBlockVideoTrackTimecode[1]){e=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale;var n=this.trackCodecDelay[this.trackTypes.indexOf(2)];if(typeof n==="number"){t=n}i=this.last2SimpleBlockAudioTrackTimecode[1]}else{e=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale;var n=this.trackCodecDelay[this.trackTypes.indexOf(1)];if(typeof n==="number"){t=n}i=this.last2SimpleBlockVideoTrackTimecode[1]}}else if(this.trackInfo.type==="video"){e=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale;var n=this.trackCodecDelay[this.trackInfo.trackNumber];if(typeof n==="number"){t=n}i=this.last2SimpleBlockVideoTrackTimecode[1]}else if(this.trackInfo.type==="audio"){e=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale;var n=this.trackCodecDelay[this.trackInfo.trackNumber];if(typeof n==="number"){t=n}i=this.last2SimpleBlockAudioTrackTimecode[1]}}var a=(this.lastClusterTimecode+i)*this.timecodeScale+e-t;var s=a/this.timecodeScale;return Math.floor(s)},enumerable:true,configurable:true});e.prototype.addListener=function(e,t){return i.prototype.addListener.call(this,e,t)};e.prototype.put=function(e){if(!this.hasLoggingStarted){this.hasLoggingStarted=true;if(this.logging&&this.logGroup){console.groupCollapsed(this.logGroup)}}if(e.type==="m"){if(e.isEnd){console.groupEnd()}else{console.group(e.name+":"+e.tagStart)}}else if(e.type==="b"){console.log(e.name,e.type)}else{console.log(e.name,e.tagStart,e.type,e.value)}};return e}(n.EventEmitter);i.default=a},{"./tools":80,events:10}],79:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=e("./EBMLDecoder");i.Decoder=r.default;var n=e("./EBMLEncoder");i.Encoder=n.default;var a=e("./EBMLReader");i.Reader=a.default;var s=e("./tools");i.tools=s;var o=e("../package.json").version;i.version=o},{"../package.json":83,"./EBMLDecoder":76,"./EBMLEncoder":77,"./EBMLReader":78,"./tools":80}],80:[function(e,t,k){"use strict";Object.defineProperty(k,"__esModule",{value:true});var r=e("int64-buffer");var C=e("./EBMLEncoder");var i=e("buffer/");var n=e("ebml/lib/ebml/tools");var a=e("ebml-block");k.Buffer=i.Buffer;k.readVint=n.readVint;k.writeVint=n.writeVint;k.ebmlBlock=a;function s(e){return k.ebmlBlock(new k.Buffer(e))}k.readBlock=s;function o(e,t,i){if(i===void 0){i=false}return g([e,i?new k.Buffer("01ffffffffffffff","hex"):k.writeVint(t.length),t])}k.encodeTag=o;function c(e){return d(e).reduce(function(e,t){var i=k.ebmlBlock(t.data);return i.frames.reduce(function(e,t){var i=l(t);var r=new Blob([i],{type:"image/webp"});return e.concat(r)},e)},[])}k.WebPFrameFilter=c;function d(e){return e.reduce(function(e,t){if(t.type!=="b"){return e}if(t.name!=="SimpleBlock"){return e}var i=k.ebmlBlock(t.data);var r=i.frames.some(function(e){var t=e.slice(3,6).toString("hex");return t==="9d012a"});if(!r){return e}return e.concat(t)},[])}k.WebPBlockFilter=d;function l(e){var t=u("VP8 ",e);var i=g([new k.Buffer("WEBP","ascii"),t]);return u("RIFF",i)}k.VP8BitStreamToRiffWebPBuffer=l;function u(e,t){var i=new k.Buffer(4);i.writeUInt32LE(t.byteLength,0);return g([new k.Buffer(e.substr(0,4),"ascii"),i,t,new k.Buffer(t.byteLength%2===0?0:1)])}k.createRIFFChunk=u;function f(e,t,s){var i=T("EBML",e);var r=P(i);var o=r+12;var c=e[e.length-1].dataEnd-o;var n=T("Info",e);S("Duration",n);n.splice(1,0,{name:"Duration",type:"f",data:x(t,8)});var d=P(n);var a=T("Tracks",e);var l=P(a);var u=47;var f=[];var h=5+s.length*15;var p=[];var m=-1;var v=10;var y=function(e){var t=u;var i=t+d;var r=i+l;var n=r+h;var a=n-c;f=[];f.push({name:"SeekHead",type:"m",isEnd:false});f.push({name:"Seek",type:"m",isEnd:false});f.push({name:"SeekID",type:"b",data:new k.Buffer([21,73,169,102])});f.push({name:"SeekPosition",type:"u",data:E(t)});f.push({name:"Seek",type:"m",isEnd:true});f.push({name:"Seek",type:"m",isEnd:false});f.push({name:"SeekID",type:"b",data:new k.Buffer([22,84,174,107])});f.push({name:"SeekPosition",type:"u",data:E(i)});f.push({name:"Seek",type:"m",isEnd:true});f.push({name:"Seek",type:"m",isEnd:false});f.push({name:"SeekID",type:"b",data:new k.Buffer([28,83,187,107])});f.push({name:"SeekPosition",type:"u",data:E(r)});f.push({name:"Seek",type:"m",isEnd:true});f.push({name:"SeekHead",type:"m",isEnd:true});u=P(f);p=[];p.push({name:"Cues",type:"m",isEnd:false});s.forEach(function(e){var t=e.CueTrack,i=e.CueClusterPosition,r=e.CueTime;p.push({name:"CuePoint",type:"m",isEnd:false});p.push({name:"CueTime",type:"u",data:E(r)});p.push({name:"CueTrackPositions",type:"m",isEnd:false});p.push({name:"CueTrack",type:"u",data:E(t)});i-=o;i+=a;p.push({name:"CueClusterPosition",type:"u",data:E(i)});p.push({name:"CueTrackPositions",type:"m",isEnd:true});p.push({name:"CuePoint",type:"m",isEnd:true})});p.push({name:"Cues",type:"m",isEnd:true});h=P(p);if(m!==a){m=a;if(e===v-1){throw new Error("Failed to converge to a stable metadata size")}}else{return"break"}};for(var g=0;g<v;g++){var _=y(g);if(_==="break")break}var b=[].concat.apply([],[i,{name:"Segment",type:"m",isEnd:false,unknownSize:true},f,n,a,p]);var w=(new C.default).encode(b);return w}k.makeMetadataSeekable=f;function S(e,t){var i=[];var r=-1;for(var n=0;n<t.length;n++){var a=t[n];if(a.name===e){if(a.type==="m"){if(!a.isEnd){r=n}else{if(r==-1)throw new Error("Detected "+e+" closing element before finding the start");t.splice(r,n-r+1);return}}else{t.splice(n,1);return}}}}k.removeElement=S;function T(e,t){var i=[];var r=-1;for(var n=0;n<t.length;n++){var a=t[n];if(a.name===e){if(a.type==="m"){if(!a.isEnd){r=n}else{if(r==-1)throw new Error("Detected "+e+" closing element before finding the start");i=t.slice(r,n+1);break}}else{i.push(t[n]);break}}}return i}k.extractElement=T;function h(e,t){if(Array.isArray(t.cueInfos)&&!Array.isArray(t.cues)){console.warn("putRefinedMetaData: info.cueInfos property is deprecated. please use info.cues");t.cues=t.cueInfos}var i=[];var r=[];for(var n=0;n<e.length;n++){var a=e[n];if(a.type==="m"&&a.name==="Segment"){i=e.slice(0,n);r=e.slice(n);if(a.unknownSize){r.shift();break}throw new Error("this metadata is not streaming webm file")}}if(!(r[r.length-1].dataEnd>0)){throw new Error("metadata dataEnd has wrong number")}var s=r[r.length-1].dataEnd;var o=i[i.length-1].dataEnd;var c=(new C.default).encode(i).byteLength;var d=c-o;var l=s-r[0].tagStart;var u=r[0].tagStart-o;var f=r[0].tagStart;var h=new k.Buffer([24,83,128,103]);var p=new k.Buffer("01ffffffffffffff","hex");var m=h.byteLength+p.byteLength;var v=l;var y;for(y=1;y<20;y++){var g=o+m+v;var _=g-s;var b=d+_;var w=R(r,b,t);var S=(new C.default).encode(w).byteLength;if(S===v){return(new C.default).encode([].concat(i,[{type:"m",name:"Segment",isEnd:false,unknownSize:true}],w))}v=S}throw new Error("unable to refine metadata, stable size could not be found in "+y+" iterations!")}k.putRefinedMetaData=h;function P(e){var i=new C.default;return e.reduce(function(e,t){return e.concat(i.encode([t]))},[]).reduce(function(e,t){return e+t.byteLength},0)}function R(e,t,i){var r=i.duration,n=i.clusterPtrs,a=i.cues;var s=e.slice(0);if(typeof r==="number"){var o=false;s.forEach(function(e){if(e.type==="f"&&e.name==="Duration"){o=true;e.data=x(r,8)}});if(!o){y(s,"Info",[{name:"Duration",type:"f",data:x(r,8)}])}}if(Array.isArray(a)){y(s,"Cues",v(a,t))}var c=[];if(Array.isArray(n)){console.warn("append cluster pointers to seekhead is deprecated. please use cues");c=m(n,t)}y(s,"SeekHead",c,true);return s}function p(r,n){var a=[];["Info","Tracks","Cues"].forEach(function(t){var e=r.filter(function(e){return e.type==="m"&&e.name===t&&e.isEnd===false}).map(function(e){return e["tagStart"]});var i=e[0];if(typeof i!=="number"){return}a.push({name:"Seek",type:"m",isEnd:false});switch(t){case"Info":a.push({name:"SeekID",type:"b",data:new k.Buffer([21,73,169,102])});break;case"Tracks":a.push({name:"SeekID",type:"b",data:new k.Buffer([22,84,174,107])});break;case"Cues":a.push({name:"SeekID",type:"b",data:new k.Buffer([28,83,187,107])});break}a.push({name:"SeekPosition",type:"u",data:E(i+n)});a.push({name:"Seek",type:"m",isEnd:true})});return a}function m(e,t){var i=[];e.forEach(function(e){i.push({name:"Seek",type:"m",isEnd:false});i.push({name:"SeekID",type:"b",data:new k.Buffer([31,67,182,117])});i.push({name:"SeekPosition",type:"u",data:E(e+t)});i.push({name:"Seek",type:"m",isEnd:true})});return i}function v(e,n){var a=[];e.forEach(function(e){var t=e.CueTrack,i=e.CueClusterPosition,r=e.CueTime;a.push({name:"CuePoint",type:"m",isEnd:false});a.push({name:"CueTime",type:"u",data:E(r)});a.push({name:"CueTrackPositions",type:"m",isEnd:false});a.push({name:"CueTrack",type:"u",data:E(t)});a.push({name:"CueClusterPosition",type:"u",data:E(i+n)});a.push({name:"CueTrackPositions",type:"m",isEnd:true});a.push({name:"CuePoint",type:"m",isEnd:true})});return a}function y(t,e,i,r){if(r===void 0){r=false}var n=-1;for(var a=0;a<t.length;a++){var s=t[a];if(s.type==="m"&&s.name===e&&s.isEnd===false){n=a;break}}if(n>=0){Array.prototype.splice.apply(t,[n+1,0].concat(i))}else if(r){[].concat([{name:e,type:"m",isEnd:false}],i,[{name:e,type:"m",isEnd:true}]).reverse().forEach(function(e){t.unshift(e)})}else{t.push({name:e,type:"m",isEnd:false});i.forEach(function(e){t.push(e)});t.push({name:e,type:"m",isEnd:true})}}function g(e){var t=0;var i=0;for(;t<e.length;++t){i+=e[t].length}var r=k.Buffer.allocUnsafe(i);var n=0;for(t=0;t<e.length;++t){var a=e[t];a.copy(r,n);n+=a.length}return r}k.concat=g;function _(e){var t=new k.Buffer(0);if(e.type==="m"){return e}switch(e.type){case"u":t=E(e.value);break;case"i":t=b(e.value);break;case"f":t=x(e.value);break;case"s":t=new k.Buffer(e.value,"ascii");break;case"8":t=new k.Buffer(e.value,"utf8");break;case"b":t=e.value;break;case"d":t=new r.Int64BE(e.value.getTime().toString()).toBuffer();break}return Object.assign({},e,{data:t})}k.encodeValueToBuffer=_;function E(e){var t=1;for(;e>=Math.pow(2,8*t);t++){}if(t>=7){console.warn("7bit or more bigger uint not supported.");return new r.Uint64BE(e).toBuffer()}var i=new k.Buffer(t);i.writeUIntBE(e,0,t);return i}k.createUIntBuffer=E;function b(e){var t=1;for(;e>=Math.pow(2,8*t);t++){}if(t>=7){console.warn("7bit or more bigger uint not supported.");return new r.Int64BE(e).toBuffer()}var i=new k.Buffer(t);i.writeIntBE(e,0,t);return i}k.createIntBuffer=b;function x(e,t){if(t===void 0){t=8}if(t===8){var i=new k.Buffer(8);i.writeDoubleBE(e,0);return i}else if(t===4){var i=new k.Buffer(4);i.writeFloatBE(e,0);return i}else{throw new Error("float type bits must 4bytes or 8bytes")}}k.createFloatBuffer=x;function w(e){if(e instanceof Date){return e}return new Date(new Date("2001-01-01T00:00:00.000Z").getTime()+Number(e)/1e3/1e3)}k.convertEBMLDateToJSDate=w},{"./EBMLEncoder":77,"buffer/":81,"ebml-block":6,"ebml/lib/ebml/tools":82,"int64-buffer":16}],81:[function($,e,Z){(function(e){(function(){"use strict";var r=$("base64-js");var a=$("ieee754");var e=typeof Symbol==="function"&&typeof Symbol["for"]==="function"?Symbol["for"]("nodejs.util.inspect.custom"):null;Z.Buffer=f;Z.SlowBuffer=y;Z.INSPECT_MAX_BYTES=50;var i=2147483647;Z.kMaxLength=i;f.TYPED_ARRAY_SUPPORT=t();if(!f.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function t(){try{var e=new Uint8Array(1);var t={foo:function(){return 42}};Object.setPrototypeOf(t,Uint8Array.prototype);Object.setPrototypeOf(e,t);return e.foo()===42}catch(e){return false}}Object.defineProperty(f.prototype,"parent",{enumerable:true,get:function(){if(!f.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(f.prototype,"offset",{enumerable:true,get:function(){if(!f.isBuffer(this))return undefined;return this.byteOffset}});function s(e){if(e>i){throw new RangeError('The value "'+e+'" is invalid for option "size"')}var t=new Uint8Array(e);Object.setPrototypeOf(t,f.prototype);return t}function f(e,t,i){if(typeof e==="number"){if(typeof t==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return d(e)}return n(e,t,i)}f.poolSize=8192;function n(e,t,i){if(typeof e==="string"){return l(e,t)}if(ArrayBuffer.isView(e)){return h(e)}if(e==null){throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof e)}if(J(e,ArrayBuffer)||e&&J(e.buffer,ArrayBuffer)){return p(e,t,i)}if(typeof SharedArrayBuffer!=="undefined"&&(J(e,SharedArrayBuffer)||e&&J(e.buffer,SharedArrayBuffer))){return p(e,t,i)}if(typeof e==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var r=e.valueOf&&e.valueOf();if(r!=null&&r!==e){return f.from(r,t,i)}var n=m(e);if(n)return n;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof e[Symbol.toPrimitive]==="function"){return f.from(e[Symbol.toPrimitive]("string"),t,i)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof e)}f.from=function(e,t,i){return n(e,t,i)};Object.setPrototypeOf(f.prototype,Uint8Array.prototype);Object.setPrototypeOf(f,Uint8Array);function o(e){if(typeof e!=="number"){throw new TypeError('"size" argument must be of type number')}else if(e<0){throw new RangeError('The value "'+e+'" is invalid for option "size"')}}function c(e,t,i){o(e);if(e<=0){return s(e)}if(t!==undefined){return typeof i==="string"?s(e).fill(t,i):s(e).fill(t)}return s(e)}f.alloc=function(e,t,i){return c(e,t,i)};function d(e){o(e);return s(e<0?0:v(e)|0)}f.allocUnsafe=function(e){return d(e)};f.allocUnsafeSlow=function(e){return d(e)};function l(e,t){if(typeof t!=="string"||t===""){t="utf8"}if(!f.isEncoding(t)){throw new TypeError("Unknown encoding: "+t)}var i=g(e,t)|0;var r=s(i);var n=r.write(e,t);if(n!==i){r=r.slice(0,n)}return r}function u(e){var t=e.length<0?0:v(e.length)|0;var i=s(t);for(var r=0;r<t;r+=1){i[r]=e[r]&255}return i}function h(e){if(J(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return u(e)}function p(e,t,i){if(t<0||e.byteLength<t){throw new RangeError('"offset" is outside of buffer bounds')}if(e.byteLength<t+(i||0)){throw new RangeError('"length" is outside of buffer bounds')}var r;if(t===undefined&&i===undefined){r=new Uint8Array(e)}else if(i===undefined){r=new Uint8Array(e,t)}else{r=new Uint8Array(e,t,i)}Object.setPrototypeOf(r,f.prototype);return r}function m(e){if(f.isBuffer(e)){var t=v(e.length)|0;var i=s(t);if(i.length===0){return i}e.copy(i,0,0,t);return i}if(e.length!==undefined){if(typeof e.length!=="number"||K(e.length)){return s(0)}return u(e)}if(e.type==="Buffer"&&Array.isArray(e.data)){return u(e.data)}}function v(e){if(e>=i){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+i.toString(16)+" bytes")}return e|0}function y(e){if(+e!=e){e=0}return f.alloc(+e)}f.isBuffer=function e(t){return t!=null&&t._isBuffer===true&&t!==f.prototype};f.compare=function e(t,i){if(J(t,Uint8Array))t=f.from(t,t.offset,t.byteLength);if(J(i,Uint8Array))i=f.from(i,i.offset,i.byteLength);if(!f.isBuffer(t)||!f.isBuffer(i)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(t===i)return 0;var r=t.length;var n=i.length;for(var a=0,s=Math.min(r,n);a<s;++a){if(t[a]!==i[a]){r=t[a];n=i[a];break}}if(r<n)return-1;if(n<r)return 1;return 0};f.isEncoding=function e(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};f.concat=function e(t,i){if(!Array.isArray(t)){throw new TypeError('"list" argument must be an Array of Buffers')}if(t.length===0){return f.alloc(0)}var r;if(i===undefined){i=0;for(r=0;r<t.length;++r){i+=t[r].length}}var n=f.allocUnsafe(i);var a=0;for(r=0;r<t.length;++r){var s=t[r];if(J(s,Uint8Array)){if(a+s.length>n.length){f.from(s).copy(n,a)}else{Uint8Array.prototype.set.call(n,s,a)}}else if(!f.isBuffer(s)){throw new TypeError('"list" argument must be an Array of Buffers')}else{s.copy(n,a)}a+=s.length}return n};function g(e,t){if(f.isBuffer(e)){return e.length}if(ArrayBuffer.isView(e)||J(e,ArrayBuffer)){return e.byteLength}if(typeof e!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof e)}var i=e.length;var r=arguments.length>2&&arguments[2]===true;if(!r&&i===0)return 0;var n=false;for(;;){switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return i*2;case"hex":return i>>>1;case"base64":return z(e).length;default:if(n){return r?-1:G(e).length}t=(""+t).toLowerCase();n=true}}}f.byteLength=g;function _(e,t,i){var r=false;if(t===undefined||t<0){t=0}if(t>this.length){return""}if(i===undefined||i>this.length){i=this.length}if(i<=0){return""}i>>>=0;t>>>=0;if(i<=t){return""}if(!e)e="utf8";while(true){switch(e){case"hex":return B(this,t,i);case"utf8":case"utf-8":return x(this,t,i);case"ascii":return I(this,t,i);case"latin1":case"binary":return A(this,t,i);case"base64":return E(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();r=true}}}f.prototype._isBuffer=true;function b(e,t,i){var r=e[t];e[t]=e[i];e[i]=r}f.prototype.swap16=function e(){var t=this.length;if(t%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<t;i+=2){b(this,i,i+1)}return this};f.prototype.swap32=function e(){var t=this.length;if(t%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<t;i+=4){b(this,i,i+3);b(this,i+1,i+2)}return this};f.prototype.swap64=function e(){var t=this.length;if(t%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<t;i+=8){b(this,i,i+7);b(this,i+1,i+6);b(this,i+2,i+5);b(this,i+3,i+4)}return this};f.prototype.toString=function e(){var t=this.length;if(t===0)return"";if(arguments.length===0)return x(this,0,t);return _.apply(this,arguments)};f.prototype.toLocaleString=f.prototype.toString;f.prototype.equals=function e(t){if(!f.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(this===t)return true;return f.compare(this,t)===0};f.prototype.inspect=function e(){var t="";var i=Z.INSPECT_MAX_BYTES;t=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim();if(this.length>i)t+=" ... ";return"<Buffer "+t+">"};if(e){f.prototype[e]=f.prototype.inspect}f.prototype.compare=function e(t,i,r,n,a){if(J(t,Uint8Array)){t=f.from(t,t.offset,t.byteLength)}if(!f.isBuffer(t)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof t)}if(i===undefined){i=0}if(r===undefined){r=t?t.length:0}if(n===undefined){n=0}if(a===undefined){a=this.length}if(i<0||r>t.length||n<0||a>this.length){throw new RangeError("out of range index")}if(n>=a&&i>=r){return 0}if(n>=a){return-1}if(i>=r){return 1}i>>>=0;r>>>=0;n>>>=0;a>>>=0;if(this===t)return 0;var s=a-n;var o=r-i;var c=Math.min(s,o);var d=this.slice(n,a);var l=t.slice(i,r);for(var u=0;u<c;++u){if(d[u]!==l[u]){s=d[u];o=l[u];break}}if(s<o)return-1;if(o<s)return 1;return 0};function w(e,t,i,r,n){if(e.length===0)return-1;if(typeof i==="string"){r=i;i=0}else if(i>2147483647){i=2147483647}else if(i<-2147483648){i=-2147483648}i=+i;if(K(i)){i=n?0:e.length-1}if(i<0)i=e.length+i;if(i>=e.length){if(n)return-1;else i=e.length-1}else if(i<0){if(n)i=0;else return-1}if(typeof t==="string"){t=f.from(t,r)}if(f.isBuffer(t)){if(t.length===0){return-1}return S(e,t,i,r,n)}else if(typeof t==="number"){t=t&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(n){return Uint8Array.prototype.indexOf.call(e,t,i)}else{return Uint8Array.prototype.lastIndexOf.call(e,t,i)}}return S(e,[t],i,r,n)}throw new TypeError("val must be string, number or Buffer")}function S(e,t,i,r,n){var a=1;var s=e.length;var o=t.length;if(r!==undefined){r=String(r).toLowerCase();if(r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le"){if(e.length<2||t.length<2){return-1}a=2;s/=2;o/=2;i/=2}}function c(e,t){if(a===1){return e[t]}else{return e.readUInt16BE(t*a)}}var d;if(n){var l=-1;for(d=i;d<s;d++){if(c(e,d)===c(t,l===-1?0:d-l)){if(l===-1)l=d;if(d-l+1===o)return l*a}else{if(l!==-1)d-=d-l;l=-1}}}else{if(i+o>s)i=s-o;for(d=i;d>=0;d--){var u=true;for(var f=0;f<o;f++){if(c(e,d+f)!==c(t,f)){u=false;break}}if(u)return d}}return-1}f.prototype.includes=function e(t,i,r){return this.indexOf(t,i,r)!==-1};f.prototype.indexOf=function e(t,i,r){return w(this,t,i,r,true)};f.prototype.lastIndexOf=function e(t,i,r){return w(this,t,i,r,false)};function k(e,t,i,r){i=Number(i)||0;var n=e.length-i;if(!r){r=n}else{r=Number(r);if(r>n){r=n}}var a=t.length;if(r>a/2){r=a/2}for(var s=0;s<r;++s){var o=parseInt(t.substr(s*2,2),16);if(K(o))return s;e[i+s]=o}return s}function C(e,t,i,r){return X(G(t,e.length-i),e,i,r)}function T(e,t,i,r){return X(H(t),e,i,r)}function P(e,t,i,r){return X(z(t),e,i,r)}function R(e,t,i,r){return X(q(t,e.length-i),e,i,r)}f.prototype.write=function e(t,i,r,n){if(i===undefined){n="utf8";r=this.length;i=0}else if(r===undefined&&typeof i==="string"){n=i;r=this.length;i=0}else if(isFinite(i)){i=i>>>0;if(isFinite(r)){r=r>>>0;if(n===undefined)n="utf8"}else{n=r;r=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var a=this.length-i;if(r===undefined||r>a)r=a;if(t.length>0&&(r<0||i<0)||i>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!n)n="utf8";var s=false;for(;;){switch(n){case"hex":return k(this,t,i,r);case"utf8":case"utf-8":return C(this,t,i,r);case"ascii":case"latin1":case"binary":return T(this,t,i,r);case"base64":return P(this,t,i,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,i,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase();s=true}}};f.prototype.toJSON=function e(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function E(e,t,i){if(t===0&&i===e.length){return r.fromByteArray(e)}else{return r.fromByteArray(e.slice(t,i))}}function x(e,t,i){i=Math.min(e.length,i);var r=[];var n=t;while(n<i){var a=e[n];var s=null;var o=a>239?4:a>223?3:a>191?2:1;if(n+o<=i){var c,d,l,u;switch(o){case 1:if(a<128){s=a}break;case 2:c=e[n+1];if((c&192)===128){u=(a&31)<<6|c&63;if(u>127){s=u}}break;case 3:c=e[n+1];d=e[n+2];if((c&192)===128&&(d&192)===128){u=(a&15)<<12|(c&63)<<6|d&63;if(u>2047&&(u<55296||u>57343)){s=u}}break;case 4:c=e[n+1];d=e[n+2];l=e[n+3];if((c&192)===128&&(d&192)===128&&(l&192)===128){u=(a&15)<<18|(c&63)<<12|(d&63)<<6|l&63;if(u>65535&&u<1114112){s=u}}}}if(s===null){s=65533;o=1}else if(s>65535){s-=65536;r.push(s>>>10&1023|55296);s=56320|s&1023}r.push(s);n+=o}return D(r)}var M=4096;function D(e){var t=e.length;if(t<=M){return String.fromCharCode.apply(String,e)}var i="";var r=0;while(r<t){i+=String.fromCharCode.apply(String,e.slice(r,r+=M))}return i}function I(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n){r+=String.fromCharCode(e[n]&127)}return r}function A(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n){r+=String.fromCharCode(e[n])}return r}function B(e,t,i){var r=e.length;if(!t||t<0)t=0;if(!i||i<0||i>r)i=r;var n="";for(var a=t;a<i;++a){n+=Y[e[a]]}return n}function L(e,t,i){var r=e.slice(t,i);var n="";for(var a=0;a<r.length-1;a+=2){n+=String.fromCharCode(r[a]+r[a+1]*256)}return n}f.prototype.slice=function e(t,i){var r=this.length;t=~~t;i=i===undefined?r:~~i;if(t<0){t+=r;if(t<0)t=0}else if(t>r){t=r}if(i<0){i+=r;if(i<0)i=0}else if(i>r){i=r}if(i<t)i=t;var n=this.subarray(t,i);Object.setPrototypeOf(n,f.prototype);return n};function O(e,t,i){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function e(t,i,r){t=t>>>0;i=i>>>0;if(!r)O(t,i,this.length);var n=this[t];var a=1;var s=0;while(++s<i&&(a*=256)){n+=this[t+s]*a}return n};f.prototype.readUintBE=f.prototype.readUIntBE=function e(t,i,r){t=t>>>0;i=i>>>0;if(!r){O(t,i,this.length)}var n=this[t+--i];var a=1;while(i>0&&(a*=256)){n+=this[t+--i]*a}return n};f.prototype.readUint8=f.prototype.readUInt8=function e(t,i){t=t>>>0;if(!i)O(t,1,this.length);return this[t]};f.prototype.readUint16LE=f.prototype.readUInt16LE=function e(t,i){t=t>>>0;if(!i)O(t,2,this.length);return this[t]|this[t+1]<<8};f.prototype.readUint16BE=f.prototype.readUInt16BE=function e(t,i){t=t>>>0;if(!i)O(t,2,this.length);return this[t]<<8|this[t+1]};f.prototype.readUint32LE=f.prototype.readUInt32LE=function e(t,i){t=t>>>0;if(!i)O(t,4,this.length);return(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};f.prototype.readUint32BE=f.prototype.readUInt32BE=function e(t,i){t=t>>>0;if(!i)O(t,4,this.length);return this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};f.prototype.readIntLE=function e(t,i,r){t=t>>>0;i=i>>>0;if(!r)O(t,i,this.length);var n=this[t];var a=1;var s=0;while(++s<i&&(a*=256)){n+=this[t+s]*a}a*=128;if(n>=a)n-=Math.pow(2,8*i);return n};f.prototype.readIntBE=function e(t,i,r){t=t>>>0;i=i>>>0;if(!r)O(t,i,this.length);var n=i;var a=1;var s=this[t+--n];while(n>0&&(a*=256)){s+=this[t+--n]*a}a*=128;if(s>=a)s-=Math.pow(2,8*i);return s};f.prototype.readInt8=function e(t,i){t=t>>>0;if(!i)O(t,1,this.length);if(!(this[t]&128))return this[t];return(255-this[t]+1)*-1};f.prototype.readInt16LE=function e(t,i){t=t>>>0;if(!i)O(t,2,this.length);var r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r};f.prototype.readInt16BE=function e(t,i){t=t>>>0;if(!i)O(t,2,this.length);var r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r};f.prototype.readInt32LE=function e(t,i){t=t>>>0;if(!i)O(t,4,this.length);return this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};f.prototype.readInt32BE=function e(t,i){t=t>>>0;if(!i)O(t,4,this.length);return this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};f.prototype.readFloatLE=function e(t,i){t=t>>>0;if(!i)O(t,4,this.length);return a.read(this,t,true,23,4)};f.prototype.readFloatBE=function e(t,i){t=t>>>0;if(!i)O(t,4,this.length);return a.read(this,t,false,23,4)};f.prototype.readDoubleLE=function e(t,i){t=t>>>0;if(!i)O(t,8,this.length);return a.read(this,t,true,52,8)};f.prototype.readDoubleBE=function e(t,i){t=t>>>0;if(!i)O(t,8,this.length);return a.read(this,t,false,52,8)};function F(e,t,i,r,n,a){if(!f.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<a)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function e(t,i,r,n){t=+t;i=i>>>0;r=r>>>0;if(!n){var a=Math.pow(2,8*r)-1;F(this,t,i,r,a,0)}var s=1;var o=0;this[i]=t&255;while(++o<r&&(s*=256)){this[i+o]=t/s&255}return i+r};f.prototype.writeUintBE=f.prototype.writeUIntBE=function e(t,i,r,n){t=+t;i=i>>>0;r=r>>>0;if(!n){var a=Math.pow(2,8*r)-1;F(this,t,i,r,a,0)}var s=r-1;var o=1;this[i+s]=t&255;while(--s>=0&&(o*=256)){this[i+s]=t/o&255}return i+r};f.prototype.writeUint8=f.prototype.writeUInt8=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,1,255,0);this[i]=t&255;return i+1};f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,2,65535,0);this[i]=t&255;this[i+1]=t>>>8;return i+2};f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,2,65535,0);this[i]=t>>>8;this[i+1]=t&255;return i+2};f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,4,4294967295,0);this[i+3]=t>>>24;this[i+2]=t>>>16;this[i+1]=t>>>8;this[i]=t&255;return i+4};f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,4,4294967295,0);this[i]=t>>>24;this[i+1]=t>>>16;this[i+2]=t>>>8;this[i+3]=t&255;return i+4};f.prototype.writeIntLE=function e(t,i,r,n){t=+t;i=i>>>0;if(!n){var a=Math.pow(2,8*r-1);F(this,t,i,r,a-1,-a)}var s=0;var o=1;var c=0;this[i]=t&255;while(++s<r&&(o*=256)){if(t<0&&c===0&&this[i+s-1]!==0){c=1}this[i+s]=(t/o>>0)-c&255}return i+r};f.prototype.writeIntBE=function e(t,i,r,n){t=+t;i=i>>>0;if(!n){var a=Math.pow(2,8*r-1);F(this,t,i,r,a-1,-a)}var s=r-1;var o=1;var c=0;this[i+s]=t&255;while(--s>=0&&(o*=256)){if(t<0&&c===0&&this[i+s+1]!==0){c=1}this[i+s]=(t/o>>0)-c&255}return i+r};f.prototype.writeInt8=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,1,127,-128);if(t<0)t=255+t+1;this[i]=t&255;return i+1};f.prototype.writeInt16LE=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,2,32767,-32768);this[i]=t&255;this[i+1]=t>>>8;return i+2};f.prototype.writeInt16BE=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,2,32767,-32768);this[i]=t>>>8;this[i+1]=t&255;return i+2};f.prototype.writeInt32LE=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,4,2147483647,-2147483648);this[i]=t&255;this[i+1]=t>>>8;this[i+2]=t>>>16;this[i+3]=t>>>24;return i+4};f.prototype.writeInt32BE=function e(t,i,r){t=+t;i=i>>>0;if(!r)F(this,t,i,4,2147483647,-2147483648);if(t<0)t=4294967295+t+1;this[i]=t>>>24;this[i+1]=t>>>16;this[i+2]=t>>>8;this[i+3]=t&255;return i+4};function j(e,t,i,r,n,a){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function V(e,t,i,r,n){t=+t;i=i>>>0;if(!n){j(e,t,i,4,34028234663852886e22,-34028234663852886e22)}a.write(e,t,i,r,23,4);return i+4}f.prototype.writeFloatLE=function e(t,i,r){return V(this,t,i,true,r)};f.prototype.writeFloatBE=function e(t,i,r){return V(this,t,i,false,r)};function N(e,t,i,r,n){t=+t;i=i>>>0;if(!n){j(e,t,i,8,17976931348623157e292,-17976931348623157e292)}a.write(e,t,i,r,52,8);return i+8}f.prototype.writeDoubleLE=function e(t,i,r){return N(this,t,i,true,r)};f.prototype.writeDoubleBE=function e(t,i,r){return N(this,t,i,false,r)};f.prototype.copy=function e(t,i,r,n){if(!f.isBuffer(t))throw new TypeError("argument should be a Buffer");if(!r)r=0;if(!n&&n!==0)n=this.length;if(i>=t.length)i=t.length;if(!i)i=0;if(n>0&&n<r)n=r;if(n===r)return 0;if(t.length===0||this.length===0)return 0;if(i<0){throw new RangeError("targetStart out of bounds")}if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");if(n>this.length)n=this.length;if(t.length-i<n-r){n=t.length-i+r}var a=n-r;if(this===t&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(i,r,n)}else{Uint8Array.prototype.set.call(t,this.subarray(r,n),i)}return a};f.prototype.fill=function e(t,i,r,n){if(typeof t==="string"){if(typeof i==="string"){n=i;i=0;r=this.length}else if(typeof r==="string"){n=r;r=this.length}if(n!==undefined&&typeof n!=="string"){throw new TypeError("encoding must be a string")}if(typeof n==="string"&&!f.isEncoding(n)){throw new TypeError("Unknown encoding: "+n)}if(t.length===1){var a=t.charCodeAt(0);if(n==="utf8"&&a<128||n==="latin1"){t=a}}}else if(typeof t==="number"){t=t&255}else if(typeof t==="boolean"){t=Number(t)}if(i<0||this.length<i||this.length<r){throw new RangeError("Out of range index")}if(r<=i){return this}i=i>>>0;r=r===undefined?this.length:r>>>0;if(!t)t=0;var s;if(typeof t==="number"){for(s=i;s<r;++s){this[s]=t}}else{var o=f.isBuffer(t)?t:f.from(t,n);var c=o.length;if(c===0){throw new TypeError('The value "'+t+'" is invalid for argument "value"')}for(s=0;s<r-i;++s){this[s+i]=o[s%c]}}return this};var U=/[^+/0-9A-Za-z-_]/g;function W(e){e=e.split("=")[0];e=e.trim().replace(U,"");if(e.length<2)return"";while(e.length%4!==0){e=e+"="}return e}function G(e,t){t=t||Infinity;var i;var r=e.length;var n=null;var a=[];for(var s=0;s<r;++s){i=e.charCodeAt(s);if(i>55295&&i<57344){if(!n){if(i>56319){if((t-=3)>-1)a.push(239,191,189);continue}else if(s+1===r){if((t-=3)>-1)a.push(239,191,189);continue}n=i;continue}if(i<56320){if((t-=3)>-1)a.push(239,191,189);n=i;continue}i=(n-55296<<10|i-56320)+65536}else if(n){if((t-=3)>-1)a.push(239,191,189)}n=null;if(i<128){if((t-=1)<0)break;a.push(i)}else if(i<2048){if((t-=2)<0)break;a.push(i>>6|192,i&63|128)}else if(i<65536){if((t-=3)<0)break;a.push(i>>12|224,i>>6&63|128,i&63|128)}else if(i<1114112){if((t-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else{throw new Error("Invalid code point")}}return a}function H(e){var t=[];for(var i=0;i<e.length;++i){t.push(e.charCodeAt(i)&255)}return t}function q(e,t){var i,r,n;var a=[];for(var s=0;s<e.length;++s){if((t-=2)<0)break;i=e.charCodeAt(s);r=i>>8;n=i%256;a.push(n);a.push(r)}return a}function z(e){return r.toByteArray(W(e))}function X(e,t,i,r){for(var n=0;n<r;++n){if(n+i>=t.length||n>=e.length)break;t[n+i]=e[n]}return n}function J(e,t){return e instanceof t||e!=null&&e.constructor!=null&&e.constructor.name!=null&&e.constructor.name===t.name}function K(e){return e!==e}var Y=function(){var e="0123456789abcdef";var t=new Array(256);for(var i=0;i<16;++i){var r=i*16;for(var n=0;n<16;++n){t[r+n]=e[i]+e[n]}}return t}()}).call(this)}).call(this,$("buffer").Buffer)},{"base64-js":3,buffer:5,ieee754:15}],82:[function(e,t,i){(function(a){(function(){var e={readVint:function(e,t){t=t||0;for(var i=1;i<=8;i++){if(e[t]>=Math.pow(2,8-i)){break}}if(i>8){throw new Error("Unrepresentable length: "+i+" "+e.toString("hex",t,t+i))}if(t+i>e.length){return null}var r=e[t]&(1<<8-i)-1;for(var n=1;n<i;n++){if(n===7){if(r>=Math.pow(2,53-8)&&e[t+7]>0){return{length:i,value:-1}}}r*=Math.pow(2,8);r+=e[t+n]}return{length:i,value:r}},writeVint:function(e){if(e<0||e>Math.pow(2,53)){throw new Error("Unrepresentable value: "+e)}for(var t=1;t<=8;t++){if(e<Math.pow(2,7*t)-1){break}}var i=new a(t);for(var r=1;r<=t;r++){var n=e&255;i[t-r]=n;e-=n;e/=Math.pow(2,8)}i[0]=i[0]|1<<8-t;return i}};t.exports=e}).call(this)}).call(this,e("buffer").Buffer)},{buffer:5}],83:[function(e,t,i){t.exports={_from:"ts-ebml@2.0.2",_id:"ts-ebml@2.0.2",_inBundle:false,_integrity:"sha512-V/HdlCn3FITQrFHQlVE02XtfMiRLab2QB/YOCfkbJWqiFYG/j5v7gHKV+wem6g0PD6/uxXs5oxMQfDXILmts/Q==",_location:"/ts-ebml",_phantomChildren:{"base64-js":"1.5.1",buffers:"0.1.1",ieee754:"1.2.1",ms:"2.0.0"},_requested:{type:"version",registry:true,raw:"ts-ebml@2.0.2",name:"ts-ebml",escapedName:"ts-ebml",rawSpec:"2.0.2",saveSpec:null,fetchSpec:"2.0.2"},_requiredBy:["#DEV:/"],_resolved:"https://registry.npmjs.org/ts-ebml/-/ts-ebml-2.0.2.tgz",_shasum:"5e2c65b35ee6f1c030f51668666f3c018f4d9578",_spec:"ts-ebml@2.0.2",_where:"C:\\Works\\Git\\Video\\Wasm\\tstWeb",author:{name:"legokichi duckscallion"},bin:{"ts-ebml":"lib/cli.js"},bugs:{url:"https://github.com/legokichi/ts-ebml/issues"},bundleDependencies:false,dependencies:{buffer:"^5.0.7",commander:"^2.11.0",ebml:"^2.2.1","ebml-block":"^1.1.0",events:"^1.1.1","int64-buffer":"^0.1.9",matroska:"^2.2.3"},deprecated:false,description:"ebml decoder and encoder",devDependencies:{"@types/commander":"^2.9.1","@types/qunit":"^2.0.31",browserify:"^13.1.0",empower:"^1.2.3","espower-cli":"^1.1.0","power-assert":"^1.4.4","power-assert-formatter":"^1.4.1","qunit-tap":"^1.5.1",qunitjs:"^2.4.0",tslint:"^3.15.1",typedoc:"^0.5.3",typescript:"^2.4.2",watchify:"^3.7.0"},homepage:"https://github.com/legokichi/ts-ebml#readme",keywords:["ebml","webm","mkv","matrosika","webp"],license:"MIT",main:"./lib/index.js",name:"ts-ebml",repository:{type:"git",url:"git+https://github.com/legokichi/ts-ebml.git"},scripts:{browserify:"browserify lib/index.js --standalone EBML -o dist/EBML.js",build:"npm run clean   && tsc    -p .; npm run browserify",check:"tsc -w --noEmit -p ./",clean:"rm -rf lib/* dist/* test/*.js; mkdir -p dist",doc:"typedoc --mode modules --out doc --disableOutputCheck",example:"tsc; browserify lib/example_seekable.js -o test/example_seekable.js",examples:"tsc; for file in `find lib -name 'example_*.js' -type f -printf '%f\\n'`; do browserify lib/$file -o test/$file; done",examples_bsd:"tsc; for file in `find lib -name 'example_*.js' -type f -print`; do browserify lib/$(basename $file) -o test/$(basename $file); done",init:"npm run update; npm run mkdir; npm run build",lint:"tslint -c ./tslint.json --project ./tsconfig.json --type-check",mkdir:"mkdir lib dist 2>/dev/null",reset:"rm -rf node_modules",setup:"npm install -g http-server;",start:"http-server . -s & tsc -w -p .& watchify lib/example_seekable.js -o test/example_seekable.js",stop:"killall -- node */tsc -w -p",test:"tsc; espower lib/test.js > lib/test.tmp; mv -f lib/test.tmp lib/test.js; browserify lib/test.js -o test/test.js",update:"npm run reset; npm update",watchify:"watchify lib/index.js --standalone EBML -o dist/EBMl.js -v"},typings:"./lib/index.d.ts",version:"2.0.2"}},{}],84:[function(n,d,e){(function(c){(function(){"use strict";var h=n("requires-port"),p=n("querystringify"),s=/^[A-Za-z][A-Za-z0-9+-.]*:[\\/]+/,a=/^([a-z][a-z0-9.+-]*:)?([\\/]{1,})?([\S\s]*)/i,e="[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]",t=new RegExp("^"+e+"+");function m(e){return(e?e:"").toString().replace(t,"")}var v=[["#","hash"],["?","query"],function e(t){return t.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",undefined,1,1],[/:(\d+)$/,"port",undefined,1],[NaN,"hostname",undefined,1,1]];var o={hash:1,query:1};function y(e){var t;if(typeof window!=="undefined")t=window;else if(typeof c!=="undefined")t=c;else if(typeof self!=="undefined")t=self;else t={};var i=t.location||{};e=e||i;var r={},n=typeof e,a;if("blob:"===e.protocol){r=new b(unescape(e.pathname),{})}else if("string"===n){r=new b(e,{});for(a in o)delete r[a]}else if("object"===n){for(a in e){if(a in o)continue;r[a]=e[a]}if(r.slashes===undefined){r.slashes=s.test(e.href)}}return r}function g(e){e=m(e);var t=a.exec(e),i=t[1]?t[1].toLowerCase():"",r=!!(t[2]&&t[2].length>=2),n=t[2]&&t[2].length===1?"/"+t[3]:t[3];return{protocol:i,slashes:r,rest:n}}function _(e,t){if(e==="")return t;var i=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=i.length,n=i[r-1],a=false,s=0;while(r--){if(i[r]==="."){i.splice(r,1)}else if(i[r]===".."){i.splice(r,1);s++}else if(s){if(r===0)a=true;i.splice(r,1);s--}}if(a)i.unshift("");if(n==="."||n==="..")i.push("");return i.join("/")}function b(e,t,i){e=m(e);if(!(this instanceof b)){return new b(e,t,i)}var r,n,a,s,o,c,d=v.slice(),l=typeof t,u=this,f=0;if("object"!==l&&"string"!==l){i=t;t=null}if(i&&"function"!==typeof i)i=p.parse;t=y(t);n=g(e||"");r=!n.protocol&&!n.slashes;u.slashes=n.slashes||r&&t.slashes;u.protocol=n.protocol||t.protocol||"";e=n.rest;if(!n.slashes)d[3]=[/(.*)/,"pathname"];for(;f<d.length;f++){s=d[f];if(typeof s==="function"){e=s(e);continue}a=s[0];c=s[1];if(a!==a){u[c]=e}else if("string"===typeof a){if(~(o=e.indexOf(a))){if("number"===typeof s[2]){u[c]=e.slice(0,o);e=e.slice(o+s[2])}else{u[c]=e.slice(o);e=e.slice(0,o)}}}else if(o=a.exec(e)){u[c]=o[1];e=e.slice(0,o.index)}u[c]=u[c]||(r&&s[3]?t[c]||"":"");if(s[4])u[c]=u[c].toLowerCase()}if(i)u.query=i(u.query);if(r&&t.slashes&&u.pathname.charAt(0)!=="/"&&(u.pathname!==""||t.pathname!=="")){u.pathname=_(u.pathname,t.pathname)}if(u.pathname.charAt(0)!=="/"&&u.hostname){u.pathname="/"+u.pathname}if(!h(u.port,u.protocol)){u.host=u.hostname;u.port=""}u.username=u.password="";if(u.auth){s=u.auth.split(":");u.username=s[0]||"";u.password=s[1]||""}u.origin=u.protocol&&u.host&&u.protocol!=="file:"?u.protocol+"//"+u.host:"null";u.href=u.toString()}function i(e,t,i){var r=this;switch(e){case"query":if("string"===typeof t&&t.length){t=(i||p.parse)(t)}r[e]=t;break;case"port":r[e]=t;if(!h(t,r.protocol)){r.host=r.hostname;r[e]=""}else if(t){r.host=r.hostname+":"+t}break;case"hostname":r[e]=t;if(r.port)t+=":"+r.port;r.host=t;break;case"host":r[e]=t;if(/:\d+$/.test(t)){t=t.split(":");r.port=t.pop();r.hostname=t.join(":")}else{r.hostname=t;r.port=""}break;case"protocol":r.protocol=t.toLowerCase();r.slashes=!i;break;case"pathname":case"hash":if(t){var n=e==="pathname"?"/":"#";r[e]=t.charAt(0)!==n?n+t:t}else{r[e]=t}break;default:r[e]=t}for(var a=0;a<v.length;a++){var s=v[a];if(s[4])r[s[1]]=r[s[1]].toLowerCase()}r.origin=r.protocol&&r.host&&r.protocol!=="file:"?r.protocol+"//"+r.host:"null";r.href=r.toString();return r}function r(e){if(!e||"function"!==typeof e)e=p.stringify;var t,i=this,r=i.protocol;if(r&&r.charAt(r.length-1)!==":")r+=":";var n=r+(i.slashes?"//":"");if(i.username){n+=i.username;if(i.password)n+=":"+i.password;n+="@"}n+=i.host+i.pathname;t="object"===typeof i.query?e(i.query):i.query;if(t)n+="?"!==t.charAt(0)?"?"+t:t;if(i.hash)n+=i.hash;return n}b.prototype={set:i,toString:r};b.extractProtocol=g;b.location=y;b.trimLeft=m;b.qs=p;d.exports=b}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{querystringify:66,"requires-port":68}],85:[function(e,t,i){var r;if(typeof globalThis==="object"){r=globalThis}else{try{r=e("es5-ext/global")}catch(e){}finally{if(!r&&typeof window!=="undefined"){r=window}if(!r){throw new Error("Could not determine global this")}}}var n=r.WebSocket||r.MozWebSocket;var a=e("./version");function s(e,t){var i;if(t){i=new n(e,t)}else{i=new n(e)}return i}if(n){["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(s,e,{get:function(){return n[e]}})})}t.exports={w3cwebsocket:n?s:null,version:a}},{"./version":86,"es5-ext/global":9}],86:[function(e,t,i){t.exports=e("../package.json").version},{"../package.json":87}],87:[function(e,t,i){t.exports={_from:"websocket@^1.0.33",_id:"websocket@1.0.34",_inBundle:false,_integrity:"sha512-PRDso2sGwF6kM75QykIesBijKSVceR6jL2G8NGYyq2XrItNC2P5/qL5XeR056GhA+Ly7JMFvJb9I312mJfmqnQ==",_location:"/websocket",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"websocket@^1.0.33",name:"websocket",escapedName:"websocket",rawSpec:"^1.0.33",saveSpec:null,fetchSpec:"^1.0.33"},_requiredBy:["/protoo-client"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.34.tgz",_shasum:"2bdc2602c08bf2c82253b730655c0ef7dcab3111",_spec:"websocket@^1.0.33",_where:"C:\\Works\\Git\\Video\\Wasm\\tstWeb\\node_modules\\protoo-client",author:{name:"Brian McKelvey",email:"theturtle32@gmail.com",url:"https://github.com/theturtle32"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},bundleDependencies:false,config:{verbose:false},contributors:[{name:"Iaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},deprecated:false,description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.9.1"},directories:{lib:"./lib"},engines:{node:">=4.0.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",test:"tape test/unit/*.js"},version:"1.0.34"}},{}],88:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("./events");var h=v(n);var a=e("./utils/logger");var s=v(a);var o=e("./utils/g726conf");var c=v(o);var d=e("./UCMain");var l=v(d);var u=e("./utils/cvComm");var p=v(u);var f=e("./JX/JTT1078");var m=v(f);function v(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var g=function(){function f(){y(this,f)}r(f,null,[{key:"Init",value:function e(i){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};s.default.SetLevel(1);var n=new l.default;if(document.readyState!=="complete"&&document.readyState!=="loaded"){window.addEventListener("load",function(){n.Init(i,t,r)},false)}else{n.Init(i,t,r)}this.uc=n;["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"].forEach(function(e,t){i.addEventListener(e,function(){if(!p.default.IsFullscreen()){n._resize();var e=new Event("resize");window.dispatchEvent(e)}})});return n}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;return this.uc.StartRealTimeVideo(t,i,r,n,a,s,o,c)}},{key:"GovPlay",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;return this.uc.GovPlay(t,i,r,n)}},{key:"PlaybackVideo",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments[8];var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:{};var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;var h=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var p=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;return this.uc.PlaybackVideo(t,i,r,n,a,s,o,c,d,l,u,f,h,p)}},{key:"PlayBackVideoByPlayer",value:function e(t,i,r){return this.uc.PlayBackVideoByPlayer(t,i,r)}},{key:"Stop",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;return this.uc.Stop(t)}},{key:"StartSpeek",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this.uc.StartSpeek(t,i,r)}},{key:"StopSpeak",value:function e(){return this.uc.StopSpeak()}},{key:"SetSpeekVolume",value:function e(t){this.uc.SetSpeakVolume(t)}},{key:"StartBroadcast",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this.uc.StartBroadcast(t,i)}},{key:"StopBroadcast",value:function e(){return this.uc.StopBroadcast()}},{key:"GetPlayBackCacheTime",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return this.uc.GetPlayBackCacheTime(t)}},{key:"IsPlaying",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return this.uc.IsPlaying(t)}},{key:"Refreash",value:function e(t){return this.uc.Refreash(t)}},{key:"Pause",value:function e(t){return this.uc.Pause(t)}},{key:"Resume",value:function e(t){return this.uc.Resume(t)}},{key:"GetVolume",value:function e(t){return this.uc.GetVolume(t)}},{key:"SetVolume",value:function e(t,i){return this.uc.SetVolume(t,i)}},{key:"SetFull",value:function e(t,i){return this.uc.SetFull(t)}},{key:"StartRecord",value:function e(t){return this.uc.StartRecord(t)}},{key:"StopRecord",value:function e(t){return this.uc.StopRecord(t)}},{key:"SetAdaptRatio",value:function e(t,i){return this.uc.SetAdaptRatio(t,i)}},{key:"SetPlaySpeed",value:function e(t,i){return this.uc.SetPlaySpeed(t,i)}},{key:"Capture",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;return this.uc.Capture(t,i,r,n)}},{key:"SetRotate",value:function e(t,i){return this.uc.SetRotate(t,i)}},{key:"SetMirrorInver",value:function e(t){return this.uc.SetMirrorInver(t)}},{key:"SetTimeoutMsec",value:function e(t,i){return this.uc.SetTimeoutMsec(t,i)}},{key:"CustomScreens",value:function e(t,i){return this.uc.CustomScreens(t,i)}},{key:"LayoutByScreens",value:function e(t){return this.uc.LayoutByScreens(t)}},{key:"Resize",value:function e(t,i){return this.uc.Resize(t,i)}},{key:"FullScreen",value:function e(){return this.uc.FullScreen()}},{key:"GetContainerSize",value:function e(){return this.uc.GetContainerSize()}},{key:"ZoomUC",value:function e(t){return this.uc.ZoomUC(t)}},{key:"UnZoomUC",value:function e(){return this.uc.UnZoomUC()}},{key:"SetOsdVisible",value:function e(t,i){return this.uc.SetOsdVisible(t,i)}},{key:"SetOsdColor",value:function e(t,i){return this.uc.SetOsdColor(t,i)}},{key:"SetOsdText",value:function e(t,i){return this.uc.SetOsdText(t,i)}},{key:"SetPriority",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.uc.SetPriority(t,i)}},{key:"SetRealOrBack",value:function e(t){return this.uc.SetRealOrBack(t)}},{key:"SetBackDateTime",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var d=arguments.length>8&&arguments[8]!==undefined?arguments[8]:{};var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;return this.uc.SetBackDateTime(t,i,r,n,a,s,o,c,d,l)}},{key:"Snapshot",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.Snapshot(t,i,r,n,a)}},{key:"Split1X1",value:function e(t,i){return this.uc.Split1X1(t,i)}},{key:"Split2",value:function e(t,i){return this.uc.Split2(t,i)}},{key:"Split2X2",value:function e(t,i){return this.uc.Split2X2(t,i)}},{key:"Split1P5",value:function e(t,i){return this.uc.Split1P5(t,i)}},{key:"Split1P7",value:function e(t,i){return this.uc.Split1P7(t,i)}},{key:"Split3X3",value:function e(t,i){return this.uc.Split3X3(t,i)}},{key:"Split1P9",value:function e(t,i){return this.uc.Split1P9(t,i)}},{key:"Split1P12",value:function e(t,i){return this.uc.Split1P12(t,i)}},{key:"Split4X4",value:function e(t,i){return this.uc.Split4X4(t,i)}},{key:"GetOperateUCVideo",value:function e(){return this.uc.GetOperateUCVideo()}},{key:"ContainsScreen",value:function e(t){return this.uc.ContainsScreen(t)}},{key:"ScreenNumToSplidIndex",value:function e(t){return this.uc.ScreenNumToSplidIndex(t)}},{key:"GetSelectedVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this.uc.GetSelectedVideo(t,i)}},{key:"AVTransferControl",value:function e(t,i,r,n,a){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:{};return this.uc.AVTransferControl(t,i,r,n,a,s,o)}},{key:"PlaybackVideoControl",value:function e(t,i,r,n,a){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:{};return this.uc.PlaybackVideoControl(t,i,r,n,a,s,o)}},{key:"QueryVideoFileList",value:function e(t,i,r,n,a,s,o,c,d){var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:{};var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;return this.uc.QueryVideoFileList(t,i,r,n,a,s,o,c,d,l,u,f)}},{key:"FtpVideoFileUpload",value:function e(t,i,r,n,a,s,o,c,d,l,u,f,h,p,m){var v=arguments.length>15&&arguments[15]!==undefined?arguments[15]:0;var y=arguments.length>16&&arguments[16]!==undefined?arguments[16]:{};return this.uc.FtpVideoFileUpload(t,i,r,n,a,s,o,c,d,l,u,f,h,p,m,v,y)}},{key:"FtpVideoFileUploadControl",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};return this.uc.FtpVideoFileUploadControl(t,i,r,n,a,s)}},{key:"RotationControl",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};return this.uc.RotationControl(t,i,r,n,a,s)}},{key:"FocusControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.FocusControl(t,i,r,n,a)}},{key:"ApertureControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.ApertureControl(t,i,r,n,a)}},{key:"WiperControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.WiperControl(t,i,r,n,a)}},{key:"InfraredControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.InfraredControl(t,i,r,n,a)}},{key:"TimesControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return this.uc.TimesControl(t,i,r,n,a)}},{key:"DownLoadFmp4",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments[8];var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:{};var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:4;return this.uc.DownLoadFmp4(t,i,r,n,a,s,o,c,d,l,u,f)}},{key:"DownLoadVideo",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments[8];var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:{};var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:4;var h=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;return this.uc.DownLoadVideo(t,i,r,n,a,s,o,c,d,l,u,f,h)}},{key:"InitWasm",value:async function e(t){if(f.wasmState==0){f.wasmState=1;f.supportCodec=await p.default.SupportCodec();console.log("supportCodec:"+f.supportCodec);if(t.callback){f._initCallbacks.push(t.callback)}p.default.loadJs(t.libffmpegUrl,function(){addOnPostRun(function(){try{f.WASM.FfmpegInit();f.WASM.SetLogLevel(t.wasmloglevel);if(t.govmd5!=""){f.WASM.FMp4SetUser(t.govmd5,t.govnum,t.govet)}f.wasmState=2;while(f._initCallbacks.length>0){f._initCallbacks.pop()()}}catch(e){f.wasmState=0;console.error(e)}})})}else if(f.wasmState==1){if(t.callback){f._initCallbacks.push(t.callback)}}else if(f.wasmState==2){if(t.callback){t.callback()}}}},{key:"JXFMp4",value:function e(t,i,r){var n=f.WasmId2Uc.v[t];if(n){var a=Module.HEAPU8.slice(i,i+r);if(n.player.GetFisrtMsg()){if(a.length==5&&a[0]==119&&a[1]==119){var s=a[2].toString(16).length==1?"0"+a[2].toString(16):a[2].toString(16);var o=a[3].toString(16).length==1?"0"+a[3].toString(16):a[3].toString(16);var c=a[4].toString(16).length==1?"0"+a[4].toString(16):a[4].toString(16);var d="avc1."+s+o+c+",mp4a.40.2";n.trigger(h.default.BUFFER_RESET,{mimeType:d});return}else if(a.length==5&&a[0]==119&&a[1]==120){if(a[2]==1){var d="hev1.1.6.L"+a[3]+".90,mp4a.40.2";var l="video/mp4;codecs="+d;if(MediaSource.isTypeSupported(l)===true){n.trigger(h.default.BUFFER_RESET,{mimeType:d})}}else if(a[2]==2){var d="hev1.2.4.L"+a[3]+".90,mp4a.40.2";var u="video/mp4;codecs="+d;if(MediaSource.isTypeSupported(u)===true){n.trigger(h.default.BUFFER_RESET,{mimeType:d})}}return}}else{n.trigger(h.default.BUFFER_APPENDING,{type:"video",data:a})}}return 1}},{key:"JXRGB",value:function e(t,i,r,n,a){var s=f.WasmId2Uc.v[t];if(s){if(i>0&&r>0&&n>0){var o=Module.HEAPU32[n/4];var c=Module.HEAPU8.subarray(o,o+a);s.trigger(h.default.JT1078_RGB_OUT,{width:i,height:r,imageBuffer:c})}}return 1}},{key:"JXPCM",value:function e(t,i,r){var n=f.WasmId2Uc.d[t];if(n){var a=Module.HEAPF32.slice(i/4,(i+r)/4);n.InputPcm(t,a,a.length)}}},{key:"JXEncodeAudio",value:function e(t,i,r){var n=f.WasmId2Uc.e[t];if(n){var a=Module.HEAPU8.subarray(i,i+r);n.InputEncodeAudio(t,a,a.length)}}},{key:"JXBareRecord",value:function e(t,i,r){var n=f.WasmId2Uc.r[t];if(n){var a=Module.HEAPU8.slice(i,i+r);n.RecordDataOutput(a)}}},{key:"JXFmp4Record",value:function e(t,i,r){var n=f.WasmId2Uc.r[t];if(n){var a=Module.HEAPU8.slice(i,i+r);n.RecordDataOutput(a)}}},{key:"version",get:function e(){return"CvNetVideo1.3.0_240705"}},{key:"logger",get:function e(){return s.default}},{key:"DefaultConfig",get:function e(){if(!f.defaultConfig){f.defaultConfig={media:null,MaxUcNum:16,videoWidth:352,videoHeight:288,libffmpegUrl:"resource/rtvs/1.3.0/libffmpeg.js",cssUrl:"resource/rtvs/1.3.0/CVNetVideo.css",EncodeAudioWorkerUrl:"resource/rtvs/1.3.0/EncodeAudioWorker.js",DecodeAudioWorkerUrl:"resource/rtvs/1.3.0/DecodeAudioWorker.js",DecodeWasmWorkerUrl:"resource/rtvs/1.3.0/DecodeVideoWorker.js",recordVideo:true,screenshot:true,yuntaiCtrl:true,networkSpeaking:true,timeoutWarningMsec:27e4,timeoutCloseMsec:3e5,events:{timeoutWarning:null,timeoutCanceled:null,timeoutClose:null,onCapture:null,onStop:null,onDevConnect:null,onDevDisconnect:null,onWsClose:null,onServerNotice:null,onEndByServer:null,onHlsPlay:null,onStartSpeek:null,onChangeH265Player:null,onMicError:null,onTimeStamp:null,onPlayBackCacheTime:null,onUcDbclick:null,onKBpsChange:null,onEndRecord:null,onCvFullScreen:null},callback:null,usePlaybar:true,usePlaybarFmp4SliceSize:1024*1024*80,tokenType:0,token:null,unmuteBySelected:true,selectedZIndex:999,enableDbcZoom:true,playerMode:0,usingCluster:true,clusterHost:"127.0.0.1",clusterPort:17e3,remoteHost:"127.0.0.1",remotePortWs:18002,remotePortFmp4:18003,priority:0,forceKeyFrameOnDiscontinuity:true,useWasmWebWorker:true,useoffcanvas:false,maxWasmWaitDecode:65535,stopOnEndByServer:false,speekSendMode:0,showLoadingByPlay:true,showLoadDelayMs:1e3,seekMode:1,maxDelay:8,selectedEvent:null,captureType:0,captureQuality:null,smoothMode:false,govmd5:"",govnum:100,govet:0,govTimeoutMsec:5e3,maxRtpLen:1280,protocol:0,isUseCdn:false,tstCdnOid:"",audioBufferMax:3,audioBufferRecovery:1,webCodecVideoDecodeBufferMax:250,webCodecSmoothMode:true,defaultCtags:null,wasmloglevel:1,playbackStartCache:2e3,language:{timeout:"",connect_failed:"",connect_error:"",connect_close:"",connect_down:"",device_connected:"",device_disconnect:"",gov_player_http_request_failed:"URL",gov_player_http_request_error:"URL",gov_player_limited_connection:"",gov_player_limited_play_time:"",gov_player_protocol_error:"",loading_page_wait_video:"...",loading_page_wait_search_record:"",menu_stop:"",menu_screen_full:"",menu_stretch:"",menu_capture:"",menu_rotate:"",menu_mirrorinver:"",menu_mime:"",control_tip_refresh:"",control_tip_play:"",control_tip_stop:"",control_tip_sound:"",control_tip_screen_full:"",control_tip_capture:"",control_tip_record:"",control_tip_stretch:""}}}return f.defaultConfig}},{key:"Events",get:function e(){return h.default}},{key:"Videos",get:function e(){return this.uc.Videos}},{key:"WasmId2Uc",get:function e(){if(!f.wasmId2Uc){f.wasmId2Uc={v:{},d:{},e:{},r:{}}}return f.wasmId2Uc}},{key:"WASM",get:function e(){if(!f.wasm){f.wasm={FfmpegInit:Module["cwrap"]("FfmpegInit","number"),SetLogLevel:Module["cwrap"]("SetLogLevel","number",["number"]),CreateAVideoDecoder:Module["cwrap"]("CreateAVideoDecoder","number",["number","number"]),VideoDecoderDecode:Module["cwrap"]("VideoDecoderDecode","number",["number","array","number"]),VideoDecoderFlush:Module["cwrap"]("VideoDecoderFlush","number",["number"]),VideoDecoderClear:Module["cwrap"]("VideoDecoderClear","number",["number"]),CreateAAudioEncoder:Module["cwrap"]("CreateAAudioEncoder","number",["number","number","number","number","number","number","number","number","number"]),AudioEncoderEncode:Module["cwrap"]("AudioEncoderEncode","number",["number","array","number"]),AudioEncoderClear:Module["cwrap"]("AudioEncoderClear","number",["number"]),CreateAAudioDecoder:Module["cwrap"]("CreateAAudioDecoder","number",["number","number","number","number","number","number","number"]),AudioDecoderDecode:Module["cwrap"]("AudioDecoderDecode","number",["number","array","number"]),AudioDecoderFlush:Module["cwrap"]("AudioDecoderFlush","number",["number"]),AudioDecoderClear:Module["cwrap"]("AudioDecoderClear","number",["number"]),CreateAAacTranscoder:Module["cwrap"]("CreateAAacTranscoder","number",["number","number","number","number"]),AacTranscoderTrans:Module["cwrap"]("AacTranscoderTrans","number",["number","array","number"]),AacTranscoderFlush:Module["cwrap"]("AacTranscoderFlush","number",["number"]),AacTranscoderClear:Module["cwrap"]("AacTranscoderClear","number",["number","number","number","number","number"]),FMp4SetUser:Module["cwrap"]("FMp4SetUser","number",["string","number","number"]),CreateFMp4Muxer:Module["cwrap"]("CreateFMp4Muxer","number",["number"]),FMp4SetAudioInfo:Module["cwrap"]("FMp4SetAudioInfo","number",["number","number","number","number","number"]),FMp4Input1078Package:Module["cwrap"]("FMp4Input1078Package","number",["number","array","number"]),FMp4InputVideo:Module["cwrap"]("FMp4InputVideo","number",["number","array","number","number","number","number","number"]),FMp4InputAudio:Module["cwrap"]("FMp4InputAudio","number",["number","array","number","number","number"]),FMp4MuxClear:Module["cwrap"]("FMp4MuxClear","number",["number"]),CreateRecordFmp4FromBare:Module["cwrap"]("CreateRecordFmp4FromBare","number",["number"]),RecordFmp4FromBareSetAudioInfo:Module["cwrap"]("RecordFmp4FromBareSetAudioInfo","number",["number","number","number","number","number"]),RecordFmp4FromBareInputVideo:Module["cwrap"]("RecordFmp4FromBareInputVideo","number",["number","array","number","number","number","number","number"]),RecordFmp4FromBareInputAudio:Module["cwrap"]("RecordFmp4FromBareInputAudio","number",["number","array","number","number","number"]),RecordFmp4FromBareClear:Module["cwrap"]("RecordFmp4FromBareClear","number",["number"]),CreateRecordFmp4FromFmp4:Module["cwrap"]("CreateRecordFmp4FromFmp4","number"),RecordFmp4FromFmp4Input:Module["cwrap"]("RecordFmp4FromFmp4Input","number",["number","array","number"]),RecordFmp4FromFmp4Clear:Module["cwrap"]("RecordFmp4FromFmp4Clear","number",["number"]),JX_H264:98,JX_H265:99,JX_G711A:6,JX_G711U:7,JX_G726:8,JX_ADPCMA:26,JX_G726_16K:253,JX_G726_24K:254,JX_G726_40K:255,JX_AAC:19,AV_PIX_FMT_RGB24:2,AV_PIX_FMT_ARGB:27,AV_PIX_FMT_RGBA:28}}return f.wasm}}]);return f}();g.wasmState=0;g.g726_conf=c.default.getDefault();g._initCallbacks=[];g.supportCodec=false;g.JT1078=m.default;i.default=g},{"./JX/JTT1078":89,"./UCMain":90,"./events":93,"./utils/cvComm":125,"./utils/g726conf":126,"./utils/logger":127}],89:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../helper/ByteHelper");var E=c(n);var a=e("../events");var s=c(a);var o=e("../utils/logger");var d=c(o);function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var w=function(){function R(e){l(this,R);this.wfs=e;this.msg_serial_number=0;this.v2=true}r(R,[{key:"JT1078808Package7",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;return this.JT1078808Package(t,i,r,n,a,s,7,o)}},{key:"JT1078808Package",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:8;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var d=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;if(a==null){a=r}var l=0;if(i){l=i.GetLength()}var u=0;if(c){u=c.msg_serial_number;if(u>=255)c.msg_serial_number=0;else c.msg_serial_number+=1}else{u=this.msg_serial_number;if(u>=255)this.msg_serial_number=0;else this.msg_serial_number+=1}var f=this.wfs.config.protocol!=0;var h=new R.JTHeader(t,false,0,l,a,u,f);var p=0;var m;m=new Uint8Array(l+h.GetLength());h.GetBinaryData(m,p);p+=h.GetLength();if(l>0){i.GetBinaryData(m,p)}var v=new R.JT808Package(m,0,m.length);var y=0;if(d==null&&this.wfs&&this.wfs.config){d=this.wfs.config.defaultCtags}if(d!=null){y=d.length+2}else{y=2}var g=void 0,_=void 0;if(this.wfs.config.isUseCdn&&this.wfs.config.cdnOid!=""){var b=new window.TextEncoder("utf8");g=b.encode(this.wfs.config.cdnOid);_=g.length+2}else{_=2}var w=void 0,S=void 0;var k=this.wfs.config.tokenType;if(k>0&&this.wfs.config.token!=null){var C=new window.TextEncoder("utf8");S=C.encode(this.wfs.config.token);w=S.length+3}else{w=1}var T=new R.JTRTHead(false,s,0,r,n,o,0,0,0,0,v.length+y+_+w,f,this.wfs.config.protocol==2);p=0;var P=new Uint8Array(T.GetLength()+v.length+y+_+w);T.GetBinaryData(P,0);p+=T.GetLength();P.set(v,p);p+=v.length;if(y>2){E.default.UIntToByte2(P,p,d.length);E.default.StringToGBK(P,p+2,d)}else{E.default.UIntToByte2(P,p,0)}p+=y;if(_>2){E.default.UIntToByte2(P,p,g.length);P.set(g,p+2)}else{E.default.UIntToByte2(P,p,0)}p+=_;if(w>1){P[p]=k;E.default.UIntToByte2(P,p+1,S.length);P.set(S,p+3)}else{P[p]=0}return{binary:P,head:h}}},{key:"Send9101",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var s=new R.JTRealVideoTransferRequest("",0,this.wfs.config.udp?1:0,i,r,n);var o=this.JT1078808Package(37121,s,t,i,t,a);this.Send(o.binary)}},{key:"Send9102",value:function e(t,i,r,n,a){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var o=new R.JTRealVideoTransferControl(i,r,n,a);var c=this.JT1078808Package(37122,o,t,i,s);this.Send(c.binary)}},{key:"Send9201",value:function e(t,i,r,n,a,s,o,c,d,l){var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:null;var f=new R.JTVideoPlaybackRequest("",0,this.wfs.config.udp?1:0,i,r,n,a,s,o,c,d,l);var h=this.JT1078808Package(37377,f,t,i,t,u);this.Send(h.binary)}},{key:"Send9202",value:function e(t,i,r,n,a){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var o=new R.JTVideoPlaybackControl(i,r,n,a);var c=this.JT1078808Package(37378,o,t,i,s);this.Send(c.binary)}},{key:"Send9205",value:function e(t,i,r,n,a,s,o,c,d,l,u){var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;var h=new R.JTQueryVideoFileList(r,n,a,s,o,c,d,l);var p=this.JT1078808Package(37381,h,i,r,null,0,8,t,f);t.sendMessage(p.binary,u,4613,p.head.SerialNumber)}},{key:"Send9206",value:function e(t,i,r,n,a,s,o,c,d,l,u,f,h,p,m,v){var y=arguments.length>16&&arguments[16]!==undefined?arguments[16]:null;var g=new R.JTVideoFileUpload(r,n,a,s,o,c,d,l,u,f,h,p,m);var _=this.JT1078808Package(37382,g,i,r,null,0,8,t,y);t.sendMessage(_.binary,v,4614)}},{key:"Send9207",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var s=new R.JTVideoFileUploadControl(r,n);var o=this.JT1078808Package(37383,s,t,i,a);this.Send(o.binary)}},{key:"Send9301",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var s=new R.JTRTPTZRotate(i,r,n);var o=this.JT1078808Package(37633,s,t,i,a);this.Send(o.binary)}},{key:"Send9302",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var a=new R.JTRPTZControl(i,r);var s=this.JT1078808Package(37634,a,t,i,n);this.Send(s.binary)}},{key:"Send9303",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var a=new R.JTRPTZControl(i,r);var s=this.JT1078808Package(37635,a,t,i,n);this.Send(s.binary)}},{key:"Send9304",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var a=new R.JTRPTZControl(i,r);var s=this.JT1078808Package(37636,a,t,i,n);this.Send(s.binary)}},{key:"Send9305",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var a=new R.JTRPTZControl(i,r);var s=this.JT1078808Package(37637,a,t,i,n);this.Send(s.binary)}},{key:"Send9306",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var a=new R.JTRPTZControl(i,r);var s=this.JT1078808Package(37638,a,t,i,n);this.Send(s.binary)}},{key:"Send8881",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var a=new R.JTPrioritySetExt(r);var s=this.JT1078808Package(34945,a,t,i,n);this.Send(s.binary)}},{key:"Send9101Webrtc",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;this.Send9101_SpecialSim(this.GetWebrtcSim(t),t,i,r,n,a)}},{key:"Send9201Webrtc",value:function e(t,i,r,n,a,s,o,c,d,l){var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:null;this.Send9201_SpecialSim(this.GetWebrtcSim(t),t,i,r,n,a,s,o,c,d,l,u)}},{key:"Send8801",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var a=new R.JT0x8886(5,r,null,null);var s=this.JT1078808Package(34950,a,t,i,n);this.Send(s.binary)}},{key:"SendHeartRtmp",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var s=new R.JT0x8886(6,null,r,n);var o=this.JT1078808Package(34950,s,t,i,a);this.Send(o.binary)}},{key:"Send9101Rtmp",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;this.Send9101_SpecialSim(this.GetRtmpSim(t),t,i,r,n,a)}},{key:"Send9201Rtmp",value:function e(t,i,r,n,a,s,o,c,d,l){var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:null;this.Send9201_SpecialSim(this.GetRtmpSim(t),t,i,r,n,a,s,o,c,d,l,u)}},{key:"Send9101_SpecialSim",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var o=new R.JTRealVideoTransferRequest("",0,this.wfs.config.udp?1:0,r,n,a);var c=this.JT1078808Package7(37121,o,i,r,t,s);this.Send(c.binary)}},{key:"Send9201_SpecialSim",value:function e(t,i,r,n,a,s,o,c,d,l,u){var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;var h=new R.JTVideoPlaybackRequest("",0,this.wfs.config.udp?1:0,r,n,a,s,o,c,d,l,u);var p=this.JT1078808Package7(37377,h,i,r,t,f);this.Send(p.binary)}},{key:"Send8890",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var s=new R.JT0x8890(r,n);var o=this.JT1078808Package(34960,s,t,i,a);this.Send(o.binary)}},{key:"Send8890Snapshot",value:function e(t,i,r,n,a){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var o=new R.JT0x8890(r,n);var c=this.JT1078808Package(34960,o,t,i,s);a(c.binary)}},{key:"SendAudio",value:function e(t,i,r,n,a,s){var o=new R.JTRTHead(1,a,n,t,i,3,0,s,0,0,r.length,this.wfs.config.protocol!=0,this.wfs.config.protocol==2);var c=new Uint8Array(o.GetLength()+r.length);o.GetBinaryData(c,0);var d=o.GetLength();c.set(r,d);this.Send(c)}},{key:"Send",value:function e(t){this.wfs.trigger(s.default.WEBSOCKET_DATA_UPLOADING,{data:t})}},{key:"GetRtmpSim",value:function e(t){var i="1234888888ec";if(i==t.toLowerCase()){return"1234888888eb"}return i}},{key:"GetWebrtcSim",value:function e(t){var i="1234888888ee";if(i==t.toLowerCase()){return"1234888888ed"}return i}}]);return R}();w.GetFirstSerialNumber=function(e){var t=void 0;if(e.PackInfo){t=e.SerialNumber-e.PackInfo.Index+1}else{t=e.SerialNumber}return t};w.GetMsbBody=function(e,t){var i=e.GetLength();return t.slice(i,i+e.MsgLen)};w.JTRTHead=function(r,n,a,s,o,c,d,l,u,f,h,p,m){this.V=2;this.P=false;this.X=false;this.CC=1;this.M=r;this.PT=n;this.SerialNumber=a;this.Sim=s;this.Channel=o;this.XXXX=c;this.YYYY=d;this.RTTimeSpan=l;this.LastIFrameInterval=u;this.LastFrameInterval=f;this.DLen=h;this.BinaryDataLen=0;this.Sim20=p;this.SimDynamic=m;this.DtsDiff=0;this.FillByBinary=function(e,t,i){if(isNaN(t)){t=0}if(isNaN(i)){i=e.length}var r=t;if(e[r]===48&&e[r+1]===49&&e[r+2]===99){if(e[r+3]===114){this.SimDynamic=true}else if(e[r+3]!==100){return}r+=4;this.V=e[r]>>6;this.P=(e[r]&32)===32;this.X=(e[r]&16)===16;this.CC=e[r]&15;r+=1;this.M=(e[r]&128)===128;this.PT=e[r]&127;r+=1;this.SerialNumber=E.default.Byte2ToUInt(e,r);r+=2;if(this.SimDynamic){var n=E.default.Byte2ToUInt(e,r);s=E.default.GBKToString(e,r+2,n);r+=n+2}if(this.Sim20){this.Sim=E.default.BcdToString(e,r,20);r+=10}else{this.Sim=E.default.BcdToString(e,r,12);r+=6}this.Channel=e[r];r+=1;this.XXXX=e[r]>>4;this.YYYY=e[r]&15;r+=1;if(this.XXXX<4){this.RTTimeSpan=E.default.Byte8ToULong(e,r);r+=8}if(this.XXXX<3){this.LastIFrameInterval=E.default.Byte2ToUInt(e,r);r+=2;if(this.V==1&&!this.P&&!this.X&&this.CC==2){this.DtsDiff=E.default.Byte2ToUInt(e,r)}else{this.LastFrameInterval=E.default.Byte2ToUInt(e,r)}r+=2}this.DLen=E.default.Byte2ToUInt(e,r);r+=2;this.BinaryDataLen=r-t}};this.GetBinaryData=function(e,t){var i=t;e[i++]=48;e[i++]=49;e[i++]=99;if(m)e[i++]=114;else e[i++]=100;e[i++]=129;if(r==1){e[i++]=n|128}else{e[i++]=n}E.default.UIntToByte2(e,i,a);i+=2;if(m){E.default.UIntToByte2(e,i,s.length);E.default.StringToGBK(e,i+2,s);i+=s.length+2}else if(p){E.default.StringToBcd(e,i,s,20);i+=10}else{E.default.StringToBcd(e,i,s,12);i+=6}e[i++]=o;e[i++]=c<<4&240|d&15;if(c>=4){E.default.UIntToByte2(e,i,h)}else if(c===3){E.default.ULongToByte8(e,i,l);E.default.UIntToByte2(e,i+8,h)}else{E.default.ULongToByte8(e,i,l);E.default.UIntToByte2(e,i+8,u);E.default.UIntToByte2(e,i+10,f);E.default.UIntToByte2(e,i+12,h)}};this.GetLength=function(){var e=0;if(m){e=2+s.length}else if(p){e=10}else{e=6}if(c>=4){return e+12}else if(c==3){return e+20}else{return e+24}}};w.JTHeader=function(n,e,a,s,o,c,t,i){this.MsgId=n;this.Sub=e;this.DataEncryptType=a;this.MsgLen=s;this.Sim=o;this.SerialNumber=c;this.Length=0;this.PackInfo=null;this.Is2019=t?true:false;this.Ver=i==null?1:i;this.FillByBinary=function(e,t,i){var r=t;this.MsgId=E.default.Byte2ToUInt(e,r);this.Is2019=(e[r+2]&64)===64;this.Sub=(e[r+2]&32)===32;this.DataEncryptType=(e[r+2]&28)>>2;e[r+2]=e[r+2]&3;this.MsgLen=E.default.Byte2ToUInt(e,r+2);if(this.Is2019){this.Ver=e[r+4];this.Sim=E.default.BcdToString(e,r+5,20);r+=15}else{this.Sim=E.default.BcdToString(e,r+4,12);r+=10}this.SerialNumber=E.default.Byte2ToUInt(e,r);if(this.Sub){this.PackInfo=new w.JTPackageInfo;this.PackInfo.Sum=E.default.Byte2ToUInt(e,r+2);this.PackInfo.Index=E.default.Byte2ToUInt(e,r+4)}};this.GetBinaryData=function(e,t){var i=t;E.default.UIntToByte2(e,i,n);i+=2;E.default.UIntToByte2(e,i,s);var r=64;if(!this.Is2019){r=0}if(this.Sub){r=r|32}r=r|(a&7)<<2;e[i]=e[i]|r;i+=2;if(this.Is2019){e[i]=this.Ver;E.default.StringToBcd(e,i+1,o,20);i+=11}else{E.default.StringToBcd(e,i,o,12);i+=6}E.default.UIntToByte2(e,i,c);if(this.Sub){E.default.UIntToByte2(e,i+2,this.PackInfo.Sum);E.default.UIntToByte2(e,i+4,this.PackInfo.Index)}};this.GetLength=function(){if(this.Is2019){return this.Sub?21:17}return this.Sub?16:12}};w.JTPackageInfo=function(e,t){this.Index=e;this.Sum=t};w.JTRealVideoTransferRequest=function(i,r,n,a,s,o){this.IPAddress=i;this.TcpPort=r;this.UdpPort=n;this.Channel=a;this.DataType=s;this.StreamType=o;this.Length=0;this.GetBinaryData=function(e,t){e[t]=E.default.StringToGBK(e,t+1,i);t=t+1+e[t];E.default.UIntToByte2(e,t,r);t+=2;E.default.UIntToByte2(e,t,n);t+=2;e[t++]=a;e[t++]=s;e[t++]=o};this.GetLength=function(){var e=i.length;return e+8}};w.JTRealVideoTransferControl=function(i,r,n,a){this.Channel=i;this.ControlCommand=r;this.SwitchStreamType=n;this.TurnOffMediaType=a;this.GetBinaryData=function(e,t){e[t]=i;t+=1;e[t]=r;t+=1;e[t]=a;t+=1;e[t]=n;t+=1};this.GetLength=function(){return 4}};w.JTVideoPlaybackRequest=function(n,a,s,o,c,d,l,u,f,h,p,m){this.IPAddress=n;this.TcpPort=a;this.UdpPort=s;this.Channel=o;this.MediaType=c;this.StreamType=d;this.StorageType=l;this.PlaybackMode=u;this.Multiple=f;this.StartTime=h;this.EndTime=p;this.DataSource=m;this.Length=0;this.GetBinaryData=function(e,t){e[t]=E.default.StringToGBK(e,t+1,n);t=t+1+e[t];E.default.UIntToByte2(e,t,a);t+=2;E.default.UIntToByte2(e,t,s);t+=2;e[t++]=o;e[t++]=c;e[t++]=d;e[t++]=l;e[t++]=u;e[t++]=f;var i=w.GetYYMMddHHmmssByDate(h);E.default.StringToBcd(e,t,i,12);t+=6;if(p===""){E.default.StringToBcd(e,t,"000000000000",12)}else{var r=w.GetYYMMddHHmmssByDate(p);E.default.StringToBcd(e,t,r,12)}t+=6;e[t++]=m};this.GetLength=function(){var e=n.length;return e+24}};w.JTVideoPlaybackControl=function(r,n,a,s){this.Channel=r;this.PlaybackControl=n;this.Multiple=a;this.DragPlaybackPosition=s;this.GetBinaryData=function(e,t){e[t]=r;t+=1;e[t]=n;t+=1;e[t]=a;t+=1;if(n===5){var i=w.GetYYMMddHHmmssByDate(s);E.default.StringToBcd(e,t,i,12);t+=6}};this.GetLength=function(){return 9}};w.JTQueryVideoFileList=function(s,o,c,d,l,u,f,h){this.Channel=s,this.StartTime=o,this.EndTime=c,this.Alarm=d,this.MediaType=l,this.StreamType=u,this.StorageType=f,this.DataSource=h;this.GetBinaryData=function(e,t){e[t]=s;t+=1;if(o===0){E.default.StringToBcd(e,t,"000000000000",12)}else{var i=w.UnixLongToDate(o);var r=w.GetYYMMddHHmmssByDate(i);E.default.StringToBcd(e,t,r,12)}t+=6;if(c===0){E.default.StringToBcd(e,t,"000000000000",12)}else{var n=w.UnixLongToDate(c);var a=w.GetYYMMddHHmmssByDate(n);E.default.StringToBcd(e,t,a,12)}t+=6;E.default.ULongToByte8(e,t,d);t+=8;e[t]=l;t+=1;e[t]=u;t+=1;e[t]=f;t+=1;e[t]=h;t+=1};this.GetLength=function(){return 25}};w.JTVideoFileUpload=function(c,d,l,u,f,h,p,m,v,y,g,_,b){this.Channel=c;this.FtpAddress=d;this.FtpPort=l;this.UserName=u;this.Password=f;this.FileUploadPath=h;this.StartTime=p;this.EndTime=m;this.Alarm=v;this.MediaType=y;this.StreamType=g;this.StorageType=_;this.TaskExecutionCondition=b;this.GetBinaryData=function(e,t){var i=E.default.StringToGBK(e,t+1,d);e[t]=i;t+=1;t+=i;E.default.UIntToByte2(e,t,l);t+=2;var r=E.default.StringToGBK(e,t+1,u);e[t]=r;t+=1;t+=r;var n=E.default.StringToGBK(e,t+1,f);e[t]=n;t+=1;t+=n;var a=E.default.StringToGBK(e,t+1,h);e[t]=a;t+=1;t+=a;e[t]=c;t+=1;var s=w.GetYYMMddHHmmssByDate(p);E.default.StringToBcd(e,t,s,12);t+=6;var o=w.GetYYMMddHHmmssByDate(m);E.default.StringToBcd(e,t,o,12);t+=6;E.default.ULongToByte8(e,t,v);t+=8;e[t]=y;t+=1;e[t]=g;t+=1;e[t]=_;t+=1;e[t]=b;t+=1};this.GetLength=function(){return 31+d.length+u.length+f.length+h.length}};w.JTVideoFileUploadControl=function(i,r){this.SerialNumber=i;this.UploadControl=r;this.GetBinaryData=function(e,t){E.default.UIntToByte2(e,t,i);t+=2;e[t]=r;t+=1};this.GetLength=function(){return 3}};w.JTRTPTZRotate=function(i,r,n){this.LogicalChannel=i;this.Direction=r;this.Speed=n;this.GetBinaryData=function(e,t){e[t]=i;t+=1;e[t]=r;t+=1;e[t]=n;t+=1};this.GetLength=function(){return 3}};w.JTRPTZControl=function(i,r){this.Channel=i;this.Flag=r;this.GetBinaryData=function(e,t){e[t]=i;t+=1;e[t]=r;t+=1};this.GetLength=function(){return 2}};w.JT808Package=function(e,t,i){var r=i+2;var n=t;var a=0;for(;n<i+t;n++){a=e[n]^a;if(e[n]===126||e[n]===125){r++}}if(a===126||a===125){r+=2}else{r+=1}var s=new Uint8Array(r);var o=0;s[o++]=126;for(n=t;n<i+t;n++,o++){s[o]=e[n];if(e[n]===126){s[o]=125;s[++o]=2}else if(e[n]===125){s[++o]=1}}if(a===126){s[o++]=125;s[o++]=2}else if(a===125){s[o++]=125;s[o++]=1}else{s[o++]=a}s[o]=126;return s};w.JTVideoListInfo=function(){this.SerialNumber;this.FileCount;this.FileList;this.FillByBinary=function(e,t,i){this.FileList=[];var r=t;this.SerialNumber=E.default.Byte2ToUInt(e,r);r+=2;this.FileCount=E.default.Byte4ToUInt(e,r);r+=4;if(this.FileCount>0&&e.length>=28*this.FileCount+r){for(var n=0;n<this.FileCount;n++){var a=new w.JTVideoFileListItem;a.FillByBinary(e,r);this.FileList.push(a);r+=28}}}};w.JTVideoFileListItem=function(){this.Channel;this.StartTime;this.EndTime;this.Alarm;this.MediaType;this.StreamType;this.StorageType;this.FileSize;this.FillByBinary=function(e,t){this.Channel=e[t];t+=1;this.StartTime=E.default.BcdToString(e,t,12);t+=6;this.EndTime=E.default.BcdToString(e,t,12);t+=6;this.Alarm=E.default.Byte8ToULong(e,t);t+=8;this.MediaType=e[t];t+=1;this.StreamType=e[t];t+=1;this.StorageType=e[t];t+=1;this.FileSize=E.default.Byte4ToUInt(e,t);t+=4}};w.JTVideoFileUploadEndInform=function(){this.SerialNumber;this.Result;this.FillByBinary=function(e,t){this.SerialNumber=E.default.Byte2ToUInt(e,t);t+=2;this.Result=e[t];t+=1}};w.SplitData=function(){var c=[];this.SplitDataBy7E=function(e,t,i,r){try{var n=0;var a=false;var s=false;var o=[];if(c!=[]&&(i>0&&e[t]!=126||i>1&&e[t]==126&&e[t+1]==126)){o=c;a=false;if(c.length>0)s=c[c.length-1]==125}else{o=[];a=true;s=false}while(n<i){if(e[t+n]==126){a=!a;if(a){try{r(o)}catch(e){d.default.error("SplitDataBy7E analyze exeception:"+e)}}else{while(i>n+1&&e[t+n+1]==126){n++}o=[]}}else if(s){if(e[t+n]==1)o[o.length-1]=125;else if(e[t+n]==2)o[o.length-1]=126;else{d.default.error("ErrorBinaryData7E");break}}else{o.push(e[t+n])}s=e[t+n]==125;n++}c=a?[]:o}catch(e){d.default.error("SplitDataBy7E exception:"+e)}}};w.CheckHelper=function(){this.CheckXOR=function(e,t,i){var r=0;for(var n=0;n<i;n++){r=(e[n+t]^r)&255}return r}};w.GetYYMMddHHmmssByDate=function(e){try{var t="";var i=w.ParseDate(e);var r=i.getFullYear()-2e3;t+=(r+"").length<2?"0"+r:r;var n=i.getMonth()+1;t+=(n+"").length<2?"0"+n:n;var a=i.getDate();t+=(a+"").length<2?"0"+a:a;var s=i.getHours();t+=(s+"").length<2?"0"+s:s;var o=i.getMinutes();t+=(o+"").length<2?"0"+o:o;var c=i.getSeconds();t+=(c+"").length<2?"0"+c:c;return t}catch(e){d.default.error("Datetime format must match:yyyy-mm-dd hh:mm:ss");return""}};w.ParseDate=function(e){var t=Date.parse(e);if(isNaN(t)){return new Date(Date.parse(e.replace(/-/g,"/")))}else{return new Date(t)}};w.DateToUnixLong=function(e){return Date.parse(w.ParseDate(e))/1e3};w.UnixLongToDate=function(e){return new Date(e*1e3)};w.JTPrioritySetExt=function(i){this.Priority=i;this.GetBinaryData=function(e,t){e[t]=i;t+=1};this.GetLength=function(){return 1}};w.ExtendRefuse=function(){this.DLen;this.Reason;this.FillByBinary=function(e,t,i){if(isNaN(t)){t=0}if(isNaN(i)){i=e.length}var r=t;this.DLen=E.default.Byte2ToUInt(e,r);r+=2;this.Reason=n(e,r,this.DLen)};function n(e,t,i){var r="",n=e;for(var a=t;a<i+t;a++){var s=n[a].toString(2),o=s.match(/^1+?(?=0)/);if(o&&s.length==8){var c=o[0].length;var d=n[a].toString(2).slice(7-c);for(var l=1;l<c;l++){d+=n[l+a].toString(2).slice(2)}r+=String.fromCharCode(parseInt(d,2));a+=c-1}else{r+=String.fromCharCode(n[a])}}return r}};w.JT0x8886=function(r,n,a,s){this.Type=r;this.WebrtcRoomid=n;this.RtmpURL=a;this.RtmpClientId=s;this.Length=0;this.GetBinaryData=function(e,t){e[t]=r;t+=1;if(r==5){var i=E.default.StringToGBK(e,t+2,n);E.default.UIntToByte2(e,t,i)}if(r==6){var i=E.default.StringToGBK(e,t+2,a);E.default.UIntToByte2(e,t,i);t=t+2+i;i=E.default.StringToGBK(e,t+2,s);E.default.UIntToByte2(e,t,i)}};this.GetLength=function(){var e=1;if(r==5){e+=n.length+2}if(r==6){e+=a.length+s.length+4}return e}};w.JT0x0889=function(){this.ASerial;this.Type;this.Url;this.FillByBinary=function(e,t,i){this.ASerial=E.default.Byte2ToUInt(e,t);this.Type=e[t+2];this.Url=E.default.GBKToString(e,t+3,i-3)}};w.JT0x8890=function(e,t){this.NType=e;this.Notice=t;this.FillByBinary=function(e,t,i){this.NType=E.default.Byte2ToUInt(e,t);var r=E.default.Byte2ToUInt(e,t+2);this.Notice=E.default.Utf8ArrayToStr(e,t+4,r)};this.GetBinaryData=function(e,t){E.default.UIntToByte2(e,t,this.NType);if(this.Notice!=null&&this.Notice.length>0){E.default.UIntToByte2(e,t+2,this.Notice.length);E.default.StringToGBK(e,t+4,this.Notice)}};this.GetLength=function(){if(this.Notice!=null){return 4+this.Notice.length}else{return 4}}};w.JT1003=function(){this.AudioCodeType;this.AudioChannels;this.AudioSamplingRate;this.AudioSamplingDigit;this.AudioFrameLength;this.AudioOut;this.VideoCodeType;this.AudioMaxChannels;this.VideoMaxChannels;this.FillByBinary=function(e,t,i){var r=t;this.AudioCodeType=e[r];r++;this.AudioChannels=e[r];r++;this.AudioSamplingRate=e[r];r++;this.AudioSamplingDigit=e[r];r++;this.AudioFrameLength=E.default.Byte2ToUInt(e,r);r+=2;this.AudioOut=e[r];r++;this.VideoCodeType=e[r];r+=1;this.AudioMaxChannels=e[r];r+=1;this.VideoMaxChannels=e[r];r+=1}};i.default=w},{"../events":93,"../helper/ByteHelper":94,"../utils/logger":127}],90:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("./UCVideo");var h=k(n);var a=e("./loader/cmdChannel");var s=k(a);var o=e("./loader/cluster-websocket-loader");var f=k(o);var c=e("./loader/snapshot-loader");var p=k(c);var _=e("./utils/long");var d=e("./utils/logger");var m=k(d);var l=e("./player/PlayerAudioMan");var u=k(l);var v=e("./utils/cvComm");var y=k(v);var g=e("./timedTask");var b=k(g);var w=e("./loader/downFmp4");var S=k(w);function k(e){return e&&e.__esModule?e:{default:e}}function C(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var T=function(){function e(){C(this,e);this.m_border=0;this.SelectChangeZIndex=true;this.audioPlayer=null;this.NowSelectVideo=1;this.NowPlayVideosCount=0;this.cmds={};this.customScreens={};this.Zoomed=false;this.rdx=0}r(e,[{key:"Init",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!this.ContainsScreen(i)){m.default.warn("Init VideoNums is not in  [1, 2, 4, 6, 8, 9, 10, 13, 16]");return}this.m_is_real=true;var n=CvNetVideo.DefaultConfig;if(t){this.dom=t;this.Container=document.createElement("div");this.Container.classList.add("video-container");if(t.append){t.append(this.Container)}else{t.appendChild(this.Container)}r.dom=t}for(var a in n){if(a in r){continue}r[a]=n[a]}console.log("playerMode:"+r.playerMode);r.remotePort=r.remotePortFmp4;this.config=r;if(document.querySelector("#CVNetVideoCss")==null){y.default.loadCss(r.cssUrl,"CVNetVideoCss",function(){this._Init2(i)}.bind(this),true)}else{this._Init2(i)}}},{key:"_Init2",value:function e(t){this._InitUC(t);if(this.config.networkSpeaking)this.audio_player=new u.default(this.config,this);CvNetVideo.InitWasm(this.config);if(this.timedTask==undefined){this.timedTask=new b.default(this.config,this)}}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;if(!this.m_is_real){m.default.warn("");return}var d=this.GetSelectedVideo(a,s);d.StartRealTimeVideo(t,i,r,n,c);if(this.audioPlayer)this.audioPlayer.StartPlay()}},{key:"GovPlay",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!this.m_is_real){m.default.warn("");return}var a=this.GetSelectedVideo(i,r);a.GovPlay(t,n)}},{key:"PlaybackVideo",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments[8];var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:{};var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;var h=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var p=arguments.length>13&&arguments[13]!==undefined?arguments[13]:0;var m=this.GetSelectedVideo(l,u);m.PlaybackVideo(t,i,r,n,a,s,o,c,d,h,p);if(this.audioPlayer)this.audioPlayer.StartPlay()}},{key:"PlayBackVideoByPlayer",value:function e(t,i,r){var n=this.GetSelectedVideo(t);n.PlayBackVideoByPlayer(i,r)}},{key:"Stop",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;if(t===-1){for(var i in this.Videos){var r=this.Videos[i];if(r){r.Stop()}}}else{var n=this.GetSelectedVideo(t,{});if(n){n.Stop()}}if(this.NowPlayVideosCount===0){if(this.audioPlayer)this.audioPlayer.StopPlay()}}},{key:"StartSpeek",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(this.audio_player.AudioSpeek.audiocapture.GetUserMedia()==null){m.default.warn("no getUserMedia, Speek exit.");return false}for(var n in r){this.audio_player.config[n]=r[n]}this.audio_player.StartSpeek(t,i);return true}},{key:"StopSpeak",value:function e(){this.audio_player.StopSpeek()}},{key:"StartBroadcast",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this.audio_player.AudioSpeek.audiocapture.GetUserMedia()==null){m.default.warn("no getUserMedia, Speek exit.");return false}for(var r in i){this.audio_player.config[r]=i[r]}this.audio_player.StartBroadcast(t);return true}},{key:"StopBroadcast",value:function e(){this.audio_player.StopBroadcast()}},{key:"SetSpeakVolume",value:function e(t){var i=this.audio_player.AudioSpeek.audioplay;if(t>=0&&t<=1){i.SetVolume(t);i.SetVolumeEnhance(1)}else if(t<=10){i.SetVolume(1);i.SetVolumeEnhance(t)}}},{key:"GetPlayBackCacheTime",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=this.GetSelectedVideo(t,{});if(i){return i.GetPlayBackCacheTime()}return null}},{key:"IsPlaying",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=this.GetSelectedVideo(t,{});if(i){return i.IsPlaying()}return false}},{key:"Refreash",value:function e(t){var i=this.GetSelectedVideo(t,{});if(i){return i.Refreash()}return false}},{key:"Pause",value:function e(t){var i=this.GetSelectedVideo(t,{});if(i){return i.Pause()}return false}},{key:"Resume",value:function e(t){var i=this.GetSelectedVideo(t,{});if(i){return i.Resume()}return false}},{key:"GetVolume",value:function e(t){var i=this.GetSelectedVideo(t,{});if(i){return i.GetVolume()*100}return 0}},{key:"SetVolume",value:function e(t,i){var r=this.GetSelectedVideo(t,{});if(r){return r.SetVolume(i/100)}return false}},{key:"SetFull",value:function e(t,i){var r=this.GetSelectedVideo(t,{});if(r){return r.SetFull(i)}return false}},{key:"StartRecord",value:function e(t){var i=this.GetSelectedVideo(t,{});if(i){return i.StartRecord()}return false}},{key:"StopRecord",value:function e(t){var i=this.GetSelectedVideo(t,{});if(i){return i.StopRecord()}return false}},{key:"SetAdaptRatio",value:function e(t,i){var r=this.GetSelectedVideo(t,{});if(r){return r.SetAdaptRatio(i)}return false}},{key:"SetPlaySpeed",value:function e(t,i){var r=this.GetSelectedVideo(t,{});if(r){return r.SetPlaySpeed(i)}return false}},{key:"SetRotate",value:function e(t,i){if(i!=0&&i!=90&&i!=180&&i!=270)return false;var r=this.GetSelectedVideo(t,{});if(r){r.SetRotate(i);return true}return false}},{key:"SetMirrorInver",value:function e(t){var i=this.GetSelectedVideo(t,{});if(i){i.SetMirrorInver();return true}return false}},{key:"SetTimeoutMsec",value:function e(t,i){this.timedTask.config.timeoutCloseMsec=t;this.timedTask.config.timeoutWarningMsec=i}},{key:"CustomScreens",value:function e(t,i){this.customScreens[t]=i}},{key:"LayoutByScreens",value:function e(t){if(this.customScreens[t]){this.ScreenIndex=t}else{if(!this.ContainsScreen(t)){m.default.warn("LayoutScreens num is not in 1, 2, 4, 6, 8, 9, 10, 13, 16");return}else{this.ScreenIndex=this.ScreenNumToSplidIndex(t)}}this._resize()}},{key:"Resize",value:function e(t,i){if(this.nofs==null){this.nofs={}}this.nofs.width=t;this.nofs.height=i;this._resize(this.nofs)}},{key:"_resize",value:function e(t){if(t==null){if(this.nofs==null){t=this.GetContainerSize()}else{t=this.nofs}}var i=parseInt(t.width);var r=parseInt(t.height);this.SelectChangeZIndex=true;if(this.customScreens[this.ScreenIndex]){this.customScreens[this.ScreenIndex](i,r)}else if(this.ScreenIndex==0){this.Split1X1(i,r)}else if(this.ScreenIndex==1){this.Split2(i,r)}else if(this.ScreenIndex==2){this.Split2X2(i,r)}else if(this.ScreenIndex==3){this.Split1P5(i,r)}else if(this.ScreenIndex==4){this.Split1P7(i,r)}else if(this.ScreenIndex==5){this.Split3X3(i,r)}else if(this.ScreenIndex==6){this.Split1P9(i,r)}else if(this.ScreenIndex==7){this.Split1P12(i,r)}else if(this.ScreenIndex==8){this.Split4X4(i,r)}else{this.Split2X2(i,r)}this.Zoomed=false}},{key:"DelayResizeWindowScreen",value:function e(t){this.rdx++;setTimeout(function(e){if(this.rdx==e&&y.default.IsFullscreen()){this._resize(window.screen);t&&t()}}.bind(this),1e3,this.rdx)}},{key:"FullScreen",value:function e(){var t=this.Container;if(!y.default.IsFullscreen()){y.default.Fullscreen=true;if(y.default.FullscreenEnabled()){t.requestFullscreen&&t.requestFullscreen()||t.mozRequestFullScreen&&t.mozRequestFullScreen()||t.webkitRequestFullscreen&&t.webkitRequestFullscreen()||t.msRequestFullscreen&&t.msRequestFullscreen();this._resize(window.screen);this.DelayResizeWindowScreen()}else if(this.config.events&&this.config.events.onCvFullScreen){if(!this.config.events.onCvFullScreen(true,0)){this._resize(window.screen);this.DelayResizeWindowScreen()}}}else{y.default.Fullscreen=false;if(y.default.FullscreenEnabled()){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():"";setTimeout(function(){this._resize()}.bind(this),300)}else if(this.config.events&&this.config.events.onCvFullScreen){if(!this.config.events.onCvFullScreen(false,0)){setTimeout(function(){this._resize()}.bind(this),300)}}}}},{key:"GetContainerSize",value:function e(t){if(t||y.default.IsFullscreen()){return{width:window.screen.width,height:window.screen.height}}else{return{width:this.Container.clientWidth,height:this.Container.clientHeight}}}},{key:"ZoomUC",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(t>=0){var r=this.GetSelectedVideo(t);this.Zoomed=true;var n=this.GetContainerSize(i);this.VideosforEach(function(e,t){var i=e.GetVideoDiv();if(r==e){i.style.display="block";i.style.left="0px";i.style.top="0px";i.style.width=n.width-this.m_border*2+"px";i.style.height=n.height-this.m_border*2+"px";this.rdx++;e.Resize()}else{i.style.display="none"}})}}},{key:"UnZoomUC",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this._resize(this.GetContainerSize(t))}},{key:"SetOsdVisible",value:function e(i,t){if(t>=0){var r=this.GetSelectedVideo(t);if(r)r.SetOsdVisible(i)}else{this.VideosforEach(function(e,t){e.SetOsdVisible(i)})}}},{key:"SetOsdColor",value:function e(i,t){if(t>=0){var r=this.GetSelectedVideo(t);if(r)r.SetOsdColor(i)}else{this.VideosforEach(function(e,t){e.SetOsdColor(i)})}}},{key:"SetOsdText",value:function e(t,i){if(t>=0){var r=this.GetSelectedVideo(t);if(r)r.SetOsdText(i)}else{this.VideosforEach(function(e,t){e.SetOsdText(i)})}}},{key:"Capture",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=this.GetSelectedVideo(n);return a.Capture(t,i,r)}},{key:"SetPriority",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var r=this.GetSelectedVideo(i);r.config.priority=t}},{key:"SetRealOrBack",value:function e(i){if(this.m_is_real==i)return;this.Stop();this.m_is_real=i;this.VideosforEach(function(e,t){e.SetRealOrBack(i)})}},{key:"SetBackDateTime",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var d=arguments.length>8&&arguments[8]!==undefined?arguments[8]:{};var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;if(this.m_is_real){m.default.warn("");return}var u=this.GetSelectedVideo(n,d);u.SetBackDateTime(t,i,r,n,a,s,o,c,l)}},{key:"Split1X1",value:function e(r,n){this.Container.style.width=r+"px";this.Container.style.height=n+"px";r=r-this.m_border*2;n=n-this.m_border*2;this.VideosforEach(function(e,t){var i=e.GetVideoDiv();if(1<t){i.style.display="none"}else{i.style.display="block";i.style.left="0px";i.style.top="0px";i.style.width=r+"px";i.style.height=n+"px";e.Resize()}})}},{key:"Split2",value:function e(a,s){this.SelectChangeZIndex=false;this.Container.style.width=a+"px";this.Container.style.height=s+"px";a=a-this.m_border*2;s=s-this.m_border*2;this.VideosforEach(function(e,t){var i=e.GetVideoDiv();if(t>2){i.style.display="none"}else if(t==1){i.style.display="block";i.style.left="0px";i.style.top="0px";i.style.width=a+"px";i.style.height=s+"px";i.style.zIndex=t;e.Resize()}else if(t==2){i.style.display="block";var r=parseInt(a/3);var n=parseInt(s/3);i.style.left=r*2+"px";i.style.top=n*2-42+"px";i.style.width=r+"px";i.style.height=n+"px";i.style.zIndex=t;e.Resize()}})}},{key:"Split2X2",value:function e(t,i){this.SplitXY(t,i,2,2)}},{key:"Split1P5",value:function e(r,n){this.Container.style.width=r-parseInt((r-this.m_border*4)%3)+"px";this.Container.style.height=n-parseInt((n-this.m_border*4)%3)+"px";r=parseInt((r-this.m_border*4)/3);n=parseInt((n-this.m_border*4)/3);this.VideosforEach(function(e,t){var i=e.GetVideoDiv();if(6<t){i.style.display="none"}else{i.style.display="block";if(t==1){i.style.left="0px";i.style.top="0px";i.style.width=r*2+this.m_border+"px";i.style.height=n*2+this.m_border+"px";e.Resize();return}else if(t==2){i.style.left=(r+this.m_border)*2+"px";i.style.top="0px"}else if(t==3){i.style.left=(r+this.m_border)*2+"px";i.style.top=n+this.m_border+"px"}else if(t==4){i.style.left="0px";i.style.top=(n+this.m_border)*2+"px"}else if(t==5){i.style.left=r+this.m_border+"px";i.style.top=(n+this.m_border)*2+"px"}else if(t==6){i.style.left=(r+this.m_border)*2+"px";i.style.top=(n+this.m_border)*2+"px"}i.style.width=r+"px";i.style.height=n+"px";e.Resize()}})}},{key:"Split1P7",value:function e(r,n){this.Container.style.width=r-parseInt((r-this.m_border*5)%4)+"px";this.Container.style.height=n-parseInt((n-this.m_border*5)%4)+"px";r=parseInt((r-this.m_border*5)/4);n=parseInt((n-this.m_border*5)/4);this.VideosforEach(function(e,t){var i=e.GetVideoDiv();if(8<t){i.style.display="none"}else{i.style.display="block";if(t==1){i.style.left="0px";i.style.top="0px";i.style.width=r*3+this.m_border*2+"px";i.style.height=n*3+this.m_border*2+"px";e.Resize();return}else if(t==2){i.style.left=(r+this.m_border)*3+"px";i.style.top="0px"}else if(t==3){i.style.left=(r+this.m_border)*3+"px";i.style.top=n+this.m_border+"px"}else if(t==4){i.style.left=(r+this.m_border)*3+"px";i.style.top=(n+this.m_border)*2+"px"}else if(t==5){i.style.left="0px";i.style.top=(n+this.m_border)*3+"px"}else if(t==6){i.style.left=r+this.m_border+"px";i.style.top=(n+this.m_border)*3+"px"}else if(t==7){i.style.left=(r+this.m_border)*2+"px";i.style.top=(n+this.m_border)*3+"px"}else if(t==8){i.style.left=(r+this.m_border)*3+"px";i.style.top=(n+this.m_border)*3+"px"}i.style.width=r+"px";i.style.height=n+"px";e.Resize()}})}},{key:"Split3X3",value:function e(t,i){this.SplitXY(t,i,3,3)}},{key:"Split1P9",value:function e(r,n){this.Container.style.width=r-parseInt((r-this.m_border*6)%5)+"px";this.Container.style.height=n-parseInt((n-this.m_border*6)%5)+"px";r=parseInt((r-this.m_border*6)/5);n=parseInt((n-this.m_border*6)/5);this.VideosforEach(function(e,t){var i=e.GetVideoDiv();if(10<t){i.style.display="none"}else{i.style.display="block";if(t==1){i.style.left="0px";i.style.top="0px";i.style.width=r*4+this.m_border*3+"px";i.style.height=n*4+this.m_border*3+"px";e.Resize();return}else if(t==2){i.style.left=(r+this.m_border)*4+"px";i.style.top="0px"}else if(t==3){i.style.left=(r+this.m_border)*4+"px";i.style.top=n+this.m_border+"px"}else if(t==4){i.style.left=(r+this.m_border)*4+"px";i.style.top=(n+this.m_border)*2+"px"}else if(t==5){i.style.left=(r+this.m_border)*4+"px";i.style.top=(n+this.m_border)*3+"px"}else if(t==6){i.style.left="0px";i.style.top=(n+this.m_border)*4+"px"}else if(t==7){i.style.left=r+this.m_border+"px";i.style.top=(n+this.m_border)*4+"px"}else if(t==8){i.style.left=(r+this.m_border)*2+"px";i.style.top=(n+this.m_border)*4+"px"}else if(t==9){i.style.left=(r+this.m_border)*3+"px";i.style.top=(n+this.m_border)*4+"px"}else if(t==10){i.style.left=(r+this.m_border)*4+"px";i.style.top=(n+this.m_border)*4+"px"}i.style.width=r+"px";i.style.height=n+"px";e.Resize()}})}},{key:"Split1P12",value:function e(r,n){this.Container.style.width=r-parseInt((r-this.m_border*5)%4)+"px";this.Container.style.height=n-parseInt((n-this.m_border*5)%4)+"px";r=parseInt((r-this.m_border*5)/4);n=parseInt((n-this.m_border*5)/4);this.VideosforEach(function(e,t){var i=e.GetVideoDiv();if(13<t){i.style.display="none"}else{i.style.display="block";if(t==1){i.style.left="0px";i.style.top="0px"}else if(t==2){i.style.left=r+this.m_border+"px";i.style.top="0px"}else if(t==3){i.style.left=(r+this.m_border)*2+"px";i.style.top="0px"}else if(t==4){i.style.left=(r+this.m_border)*3+"px";i.style.top="0px"}else if(t==5){i.style.left="0px";i.style.top=n+this.m_border+"px"}else if(t==6){i.style.left=r+this.m_border+"px";i.style.top=n+this.m_border+"px";i.style.width=r*2+this.m_border+"px";i.style.height=n*2+this.m_border+"px";e.Resize();return}else if(t==7){i.style.left=(r+this.m_border)*3+"px";i.style.top=n+this.m_border+"px"}else if(t==8){i.style.left="0px";i.style.top=(n+this.m_border)*2+"px"}else if(t==9){i.style.left=(r+this.m_border)*3+"px";i.style.top=(n+this.m_border)*2+"px"}else if(t==10){i.style.left="0px";i.style.top=(n+this.m_border)*3+"px"}else if(t==11){i.style.left=r+this.m_border+"px";i.style.top=(n+this.m_border)*3+"px"}else if(t==12){i.style.left=(r+this.m_border)*2+"px";i.style.top=(n+this.m_border)*3+"px"}else if(t==13){i.style.left=(r+this.m_border)*3+"px";i.style.top=(n+this.m_border)*3+"px"}i.style.width=r+"px";i.style.height=n+"px";e.Resize()}})}},{key:"Split4X4",value:function e(t,i){this.SplitXY(t,i,4,4)}},{key:"SplitXY",value:function e(s,o,c,d){this.Container.style.width=s-parseInt((s-this.m_border*(c+1))%c)+"px";this.Container.style.height=o-parseInt((o-this.m_border*(d+1))%d)+"px";s=parseInt((s-this.m_border*(c+1))/c);o=parseInt((o-this.m_border*(d+1))/d);this.VideosforEach(function(e,t){var i=e.GetVideoDiv();if(c*d<t){i.style.display="none"}else{i.style.display="block";var r=t-1;var n=r%c*(s+this.m_border);var a=parseInt(r/c)*(o+this.m_border);i.style.left=n+"px";i.style.top=a+"px";i.style.width=s+"px";i.style.height=o+"px";e.Resize()}})}},{key:"GetOperateUCVideo",value:function e(){return this.Videos[this.NowSelectVideo]}},{key:"_InitUC",value:function e(){var n=this;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:4;var i=0;var r="";{r+="<div class='video-menu-context' id='video-menu-mime-0'>"+this.config.language.menu_mime+"<span class='icon'> > </span>"+"<div class='sub-menu'><div class='sub-menu-item' id='video-menu-mime-video'></div><div class='sub-menu-item' id='video-menu-mime-audio'></div></div></div>";r+="<div class='video-menu-context' id='video-menu-stop-0'>"+this.config.language.menu_stop+"</div>";r+="<div class='video-menu-context' id='video-menu-full-0'>"+this.config.language.menu_screen_full+"</div>";r+="<div class='video-menu-context' id='video-menu-stretch-0'>"+this.config.language.menu_stretch+"</div>";r+="<div class='video-menu-context' id='video-menu-capture-0'>"+this.config.language.menu_capture+"</div>";r+="<div class='video-menu-context' id='video-menu-rotate-0'>"+this.config.language.menu_rotate+"</div>";r+="<div class='video-menu-context' id='video-menu-mirrorinver-0'>"+this.config.language.menu_mirrorinver+"</div>";if(this.config.addMenu){for(i=0;i<this.config.addMenu.length;i++){if(this.config.addMenu[i].child&&this.config.addMenu[i].child.length>0){r+="<div class='video-menu-context' id='video-menu-add"+i+"-0'>"+this.config.addMenu[i].title+"<span class='icon'> > </span>";r+="<div id='sub-menu' class='sub-menu'>";for(var a=0;a<this.config.addMenu[i].child.length;a++){r+="<div class='sub-menu-item' id='video-menu-add"+i+"_"+a+"-0'>"+this.config.addMenu[i].child[a].title+"</div>"}r+="</div>";r+="</div>"}else{r+="<div class='video-menu-context' id='video-menu-add"+i+"-0'>"+this.config.addMenu[i].title+"</div>"}}}}this.menu=document.createElement("div");this.menu.classList.add("video-menu-new");this.menu.innerHTML=r;this.menu.style.zIndex=1e3;this.menu.mimeInfo=this.menu.querySelector("#video-menu-mime-0");this.menu.mimeVideo=this.menu.querySelector("#video-menu-mime-video");this.menu.mimeAudioInfo=this.menu.querySelector("#video-menu-mime-audio");this.menu.querySelector("#video-menu-stop-0").onclick=function(){this.Videos[this.menu_context_index].player.interface_player.onClickedStopBtn()}.bind(this);this.menu.querySelector("#video-menu-full-0").onclick=function(){this.Videos[this.menu_context_index].player.interface_player.onClickedFullScreenBar()}.bind(this);this.menu.querySelector("#video-menu-stretch-0").onclick=function(){this.Videos[this.menu_context_index].player.interface_player.onClickedStretchBtn()}.bind(this);this.menu.querySelector("#video-menu-capture-0").onclick=function(){this.Videos[this.menu_context_index].player.interface_player.onClickedCaptureBtn()}.bind(this);this.menu.querySelector("#video-menu-rotate-0").onclick=function(){this.Videos[this.menu_context_index].player.interface_player.onClickedRotateBtn()}.bind(this);this.menu.querySelector("#video-menu-mirrorinver-0").onclick=function(){this.Videos[this.menu_context_index].player.interface_player.onClickedMirrorInverBtn()}.bind(this);if(this.config.addMenu){for(i=0;i<this.config.addMenu.length;i++){if(this.config.addMenu[i].child&&this.config.addMenu[i].child.length>0){for(var s=0;s<this.config.addMenu[i].child.length;s++){if(this.config.addMenu[i].child[s].onClicked){(function(){var e=i;var t=s;n.menu.querySelector("#video-menu-add"+i+"_"+s+"-0").onclick=function(){this.config.addMenu[e].child[t].onClicked(this.menu_context_index-1)}.bind(n)})()}}}else if(this.config.addMenu[i].onClicked){(function(){var e=i;n.menu.querySelector("#video-menu-add"+i+"-0").onclick=function(){this.config.addMenu[e].onClicked(this.menu_context_index-1)}.bind(n)})()}}}var o=function e(){var t={};for(d in n.config){t[d]=n.config[d]}var i=new h.default(t,c,n);n.Videos[c]=i;var r=n;l=i.GetVideoDiv();if(l){l.index=c;l.parentContainer=n.Container;l.onclick=function(){r.NowSelectVideo=this.index;var i=this;r.VideosforEach(function(e,t){if(t===r.NowSelectVideo){if(r.SelectChangeZIndex)i.style.zIndex=this.config.selectedZIndex;i.classList.add("video-select");e.SetSelected(true)}else{if(r.SelectChangeZIndex)e.GetVideoDiv().style.zIndex=t;e.GetVideoDiv().classList.remove("video-select");e.SetSelected(false)}});if(t.selectedEvent!=null){t.selectedEvent(r.NowSelectVideo)}}}};for(var c=1;c<=this.config.MaxUcNum;c++){var d;var l;o()}if(this.Container.append){this.Container.append(this.menu)}else{this.Container.appendChild(this.menu)}var u=this.videos[1].GetVideoDiv();if(u){u.classList.add("video-select");u.style.zIndex=this.config.selectedZIndex}this.videos[1].SetSelected(true);if(this.config.dom&&this.m_border==0){var f=window.getComputedStyle(u,null);this.m_border=parseInt(f.borderWidth.charAt(0));if(isNaN(this.m_border)||this.m_border<=0){this.m_border=2}}this.LayoutByScreens(t)}},{key:"get808Cmd",value:function e(t,i){if(t.usingCluster){var r=this.cmds["C:"+t.clusterHost+":"+t.clusterPort+"_"+t.protocol];if(r===undefined){r=new s.default(t,i);this.cmds["C:"+t.clusterHost+":"+t.clusterPort+"_"+t.protocol]=r;r.connect();return r}return r}else{var n=this.cmds[t.remoteHost+":"+t.remotePortWs+"_"+t.protocol];if(n===undefined){n=new s.default(t,i);this.cmds[t.remoteHost+":"+t.remotePortWs+"_"+t.protocol]=n;n.connect();return n}return n}}},{key:"loadJs",value:function e(t,i){var r=document.createElement("script");r.type="text/javascript";if(typeof i!="undefined"){if(r.readyState){r.onreadystatechange=function(){if(r.readyState=="loaded"||r.readyState=="complete"){r.onreadystatechange=null;i()}}}else{r.onload=function(){i()}}}r.src=t;document.body.appendChild(r)}},{key:"loadCss",value:function e(t,i,r,n){var a=document.createElement("link");a.type="text/css";a.rel="stylesheet";if(i){a.id=i}if(typeof r!="undefined"){if(a.readyState){a.onreadystatechange=function(){if(a.readyState=="loaded"||a.readyState=="complete"){a.onreadystatechange=null;r()}}}else{a.onload=function(){r()}}}a.href=t;if(n)document.head.prepend(a);else document.head.appendChild(a)}},{key:"ContainsScreen",value:function e(t){var i=[1,2,4,6,8,9,10,13,16];for(var r=0;r<i.length;r++){if(i[r]===t||i[r]+""===t){return true}}return false}},{key:"ScreenNumToSplidIndex",value:function e(t){if(t==1){return 0}else if(t==2){return 1}else if(t==4){return 2}else if(t==6){return 3}else if(t==8){return 4}else if(t==9){return 5}else if(t==10){return 6}else if(t==13){return 7}else if(t==16){return 8}else{return 2}}},{key:"GetSelectedVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=void 0;if(t===0){r=this.GetOperateUCVideo()}else{r=this.Videos[t]}if(r){for(var n in i){r.config[n]=i[n]}return r}}},{key:"AVTransferControl",value:function e(t,i,r,n,a){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:{};var c=this.GetSelectedVideo(s,o);c.AVTransferControl(t,i,r,n,a)}},{key:"PlaybackVideoControl",value:function e(t,i,r,n,a){var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:{};var c=this.GetSelectedVideo(s,o);c.PlaybackVideoControl(t,i,r,n,a)}},{key:"QueryVideoFileList",value:function e(t,i,r,n,a,s,o,c,d){var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:{};var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;u.isUseCdn=false;var h=this.GetSelectedVideo(l,u);if(!(0,_.isLong)(a)){a=(0,_.fromString)(a.toString(),true)}h.QueryVideoFileList(t,i,r,n,a,s,o,c,f,d)}},{key:"FtpVideoFileUpload",value:function e(t,i,r,n,a,s,o,c,d,l,u,f,h,p,m){var v=arguments.length>15&&arguments[15]!==undefined?arguments[15]:0;var y=arguments.length>16&&arguments[16]!==undefined?arguments[16]:{};var g=this.GetSelectedVideo(v,y);if(!(0,_.isLong)(l)){l=(0,_.fromString)(l.toString(),true)}g.FtpVideoFileUpload(t,i,r,n,a,s,o,c,d,l,u,f,h,p,m)}},{key:"FtpVideoFileUploadControl",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};var o=this.GetSelectedVideo(a,s);o.FtpVideoFileUploadControl(t,i,r,n)}},{key:"RotationControl",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};var o=this.GetSelectedVideo(a,s);o.RotationControl(t,i,r,n)}},{key:"FocusControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var s=this.GetSelectedVideo(n,a);s.FocusControl(t,i,r)}},{key:"ApertureControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var s=this.GetSelectedVideo(n,a);s.ApertureControl(t,i,r)}},{key:"WiperControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var s=this.GetSelectedVideo(n,a);s.WiperControl(t,i,r)}},{key:"InfraredControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var s=this.GetSelectedVideo(n,a);s.InfraredControl(t,i,r)}},{key:"TimesControl",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var s=this.GetSelectedVideo(n,a);s.TimesControl(t,i,r)}},{key:"VideosforEach",value:function e(t){for(var i=1;i<=this.config.MaxUcNum;i++){t.apply(this,[this.videos[i],i])}}},{key:"DownLoadFmp4",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments[8];var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:{};var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:4;return this.DownLoadVideo(t,i,r,n,a,s,o,c,d,l,u,f,0)}},{key:"DownLoadVideo",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments[8];var l=arguments.length>9&&arguments[9]!==undefined?arguments[9]:{};var u=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var f=arguments.length>11&&arguments[11]!==undefined?arguments[11]:4;var h=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;for(var p in l){this.config[p]=l[p]}var m=y.default.SimChannelLen(t,i,this.config.protocol);var v=new S.default(this.config);v.DownLoad(m.Sim,m.Channel,r,n,a,s,o,c,d,u,f,h);return v}},{key:"Snapshot",value:function e(s,o,c,d){var t=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};if(!this.snapshot_config){this.snapshot_config={};for(var i in this.config){this.snapshot_config[i]=this.config[i]}}for(var i in t){this.snapshot_config[i]=t[i]}var r=y.default.SimChannelLen(s,o,this.snapshot_config.protocol);s=r.Sim;o=r.Channel;if(this.snapshot_config.usingCluster){var n=1003;var l=new f.default(0);l.getConnByCluster(this.snapshot_config["clusterHost"],y.default.GetClusterPort(this.snapshot_config),n,s,function(e,t,i){if(e==null){l.close()}else{var r=e.split(":");var n=void 0;if(r.length==3){n=y.default.GetWsp()+r[0]+":"+r[1]}else{n=y.default.GetWsp()+e}var a=new p.default(this.config);a.SnapshotRequest(n,s,o,c,d);l.close()}}.bind(this),null)}else{var a=y.default.GetWsp()+this.snapshot_config["clusterHost"]+":"+this.snapshot_config["remotePortFmp4"];var u=new p.default(this.snapshot_config);u.SnapshotRequest(a,s,o,c,d)}}},{key:"Videos",get:function e(){if(!this.videos){this.videos={}}return this.videos}}]);return e}();i.default=T},{"./UCVideo":91,"./loader/cluster-websocket-loader":96,"./loader/cmdChannel":97,"./loader/downFmp4":98,"./loader/snapshot-loader":99,"./player/PlayerAudioMan":109,"./timedTask":122,"./utils/cvComm":125,"./utils/logger":127,"./utils/long":128}],91:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var h=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("./events");var a=w(r);var s=e("events");var o=w(s);var c=e("./loader/websocket-loader");var d=w(c);var l=e("./JX/JTT1078");var u=w(l);var f=e("./loader/cluster-websocket-loader");var p=w(f);var m=e("./utils/logger");var v=w(m);var y=e("./utils/cvComm");var g=w(y);var _=e("./player/PlayerMan");var b=w(_);function w(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(e))e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var i in t){if(new RegExp("("+i+")").test(e))e=e.replace(RegExp.$1,RegExp.$1.length==1?t[i]:("00"+t[i]).substr((""+t[i]).length))}return e};var k=function(){function r(e,t,i){S(this,r);this.config=e;this.ucMain=i;var a=this.observer=new o.default;a.trigger=function e(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++){r[n-1]=arguments[n]}a.emit.apply(a,[t,t].concat(r))};a.off=function e(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++){r[n-1]=arguments[n]}a.removeListener.apply(a,[t].concat(r))};this.on=a.on.bind(a);this.off=a.off.bind(a);this.trigger=a.trigger.bind(a);this.jt1078=new u.default(this);this.websocketLoader=new d.default(this);this.socket=null;this.socketCreatedId=0;this.video_id=t;this.player=new b.default(this);this.playermode=b.default.PlayerMode.None;this.IsPlay=false;this.IsRequestPlay=false;this.ShowKBps=true;this.req_id=0}n(r,[{key:"destroy",value:function e(){if(this.websocketLoader){this.websocketLoader.destroy()}if(this.player){this.player.destory()}EventHandler.prototype.destroy.call(this)}},{key:"attachWebsocket",value:function e(t,i,r,n){this.trigger(a.default.WEBSOCKET_ATTACHING,{websocket:t,channelName:i,playerMode:this.playermode,onOpen:r,onCallback:n,reqId:this.req_id})}},{key:"createSocketAndSendCmd",value:function e(t,a,s){var o=this;this.Sim=t;this.Channel=a;var c=this.socketCreatedId;this.req_id++;if(this.config.usingCluster){var i=1002;if(this.playermode===b.default.PlayerMode.Fmp4){i=1003}else if(this.playermode===b.default.PlayerMode.Webrtc){i=1003}else if(this.playermode==b.default.PlayerMode.Hls){i=1003}var d=new p.default(this.req_id);d.getConnByCluster(this.config["clusterHost"],g.default.GetClusterPort(this.config),i,t,function(e,t,i){if(e==null){d.close()}else{var r=e.split(":");o.config["remoteHost"]=r[0];o.config["remotePort"]=r[1];if(c==o.socketCreatedId){o.CloseSocket();var n=void 0;if(r.length==3){n=g.default.GetWsp()+r[0]+":"+r[1]}else{n=g.default.GetWsp()+e}o.player.SetRtvsAddr(o.config["remoteHost"]);o.socket=new WebSocket(n);t.ok=true;o.attachWebsocket(o.socket,"ch"+a,function(){o.config.cdnOid=i;s()});d.close()}}},this)}else{if(c==this.socketCreatedId){this.CloseSocket();this.config["remoteHost"]=this.config["clusterHost"];this.config["remotePort"]=this.config["clusterPort"];if(this.playermode==b.default.PlayerMode.Fmp4){this.config["remotePort"]=this.config["remotePortFmp4"]}else if(this.playermode==b.default.PlayerMode.Wasm||this.playermode==b.default.PlayerMode.WebCodec){this.config["remotePort"]=this.config["remotePortWs"]}this.player.SetRtvsAddr(this.config["remoteHost"]);this.socket=new WebSocket(g.default.GetWsp()+this.config["remoteHost"]+":"+this.config["remotePort"]);this.attachWebsocket(this.socket,"ch"+a,function(){s()})}}}},{key:"Flush",value:function e(){this.player.Flush()}},{key:"ShowKBpsText",value:function e(){var t=-1;if(this.ShowKBps&&(this.playermode==b.default.PlayerMode.Fmp4||this.playermode==b.default.PlayerMode.Wasm||this.playermode==b.default.PlayerMode.WebCodec)){t=this.websocketLoader.trafficStat.getKBps()}else if(this.ShowKBps&&this.playermode==b.default.PlayerMode.Gov&&this.player.player!=null){t=this.player.player.trafficStat.getKBps()}if(t>=0){this.SetKBpsText(t.toFixed(2)+"KB/s");if(this.config.events&&this.config.events.onKBpsChange){this.config.events.onKBpsChange(t,this.video_id,this)}}}},{key:"SetShowKBps",value:function e(t,i,r){if(r&&this.req_id!=r){return}this.ShowKBps=t;if(i!=null&&this.IsPlaying()){this.SetKBpsText(i)}}},{key:"SetRealOrBack",value:function e(t){this.player.SetRealOrBack(t)}},{key:"SetBackDateTime",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var d=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var l=g.default.SimChannelLen(t,i,this.config.protocol);t=l.Sim;i=l.Channel;this.Stop();var u=new Date(r);u.setHours(0);u.setMinutes(0);u.setSeconds(0);this.StartTime=parseInt(u.getTime()/1e3);u.setHours(23);u.setMinutes(59);u.setSeconds(59);this.EndTime=parseInt(u.getTime()/1e3);this.Sim=t;this.Channel=i;this.Alarm=a;this.MediaType=s;this.StreamType=o;this.StorageType=c;this.DataSource=d;this.player.QueryVideoListBegin();function f(e){if(h(e.FileList)!="object")return;this.player.AddVideoList(e,this.StartTime,this.EndTime);return}this.QueryVideoFileList(t,i,this.StartTime,this.EndTime,a,s,o,c,d,f.bind(this))}},{key:"PlayBackVideoByPlayer",value:function e(t,i){var r=this;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;this.Stop();this.IsRealPlay=false;this.IsRequestPlay=true;n=this.SetPlayermode(n);var a=new Date(t*1e3).Format("yyyy-MM-dd hh:mm:ss");var s=new Date(i*1e3).Format("yyyy-MM-dd hh:mm:ss");this.player.PlayBackVideoBegin(this.Sim,this.Channel,a,s,this.StreamType,n);this.createSocketAndSendCmd(this.Sim,this.Channel,function(){r.IsPlay=true;if(r.config.priority!=0){r.jt1078.Send8881(r.Sim,r.Channel,r.config.priority)}r.jt1078.Send9201(r.Sim,r.Channel,r.MediaType,r.StreamType,r.StorageType,0,0,a,s,r.DataSource);r.ucMain.NowPlayVideosCount+=1})}},{key:"GetPlayBackCacheTime",value:function e(){return this.player.interface_player.interfaceplayerbar.GetPlayBackCacheTime()}},{key:"IsPlaying",value:function e(){return this.IsRequestPlay}},{key:"Refreash",value:function e(){return this.player.interface_player.onClickedLoadBtn()}},{key:"Pause",value:function e(){return this.player.interface_player.Pause()}},{key:"Resume",value:function e(){return this.player.interface_player.Resume()}},{key:"GetVolume",value:function e(){return this.player.interface_player.GetVolume()}},{key:"SetVolume",value:function e(t){return this.player.interface_player.SetVolume(t)}},{key:"SetFull",value:function e(t){return this.player.interface_player.SetFull(t)}},{key:"StartRecord",value:function e(){return this.player.interface_player.StartRecord()}},{key:"StopRecord",value:function e(){return this.player.interface_player.StopRecord()}},{key:"SetAdaptRatio",value:function e(t){return this.player.interface_player.SetAdaptRatio(t)}},{key:"SetPlaySpeed",value:function e(t){return this.player.SetPlaySpeed(t)}},{key:"SetRotate",value:function e(t){this.player.SetRotate(t)}},{key:"SetMirrorInver",value:function e(t){this.player.SetMirrorInver()}},{key:"SetOsdVisible",value:function e(t){this.player.SetOsdVisible(t)}},{key:"GetVideoDiv",value:function e(){return this.player.GetVideoDiv()}},{key:"SetOsdColor",value:function e(t){this.player.SetOsdColor(t)}},{key:"SetOsdText",value:function e(t){this.player.SetOsdText(t)}},{key:"SetKBpsText",value:function e(t){this.player.SetKBpsText(t)}},{key:"ShowRecordText",value:function e(){this.player.ShowRecordText()}},{key:"Check",value:function e(){this.player.Check()}},{key:"SetSelected",value:function e(t){this.player.SetSelected(t)}},{key:"Capture",value:function e(t,i,r){return this.player.interface_player.Capture(t,i,r)}},{key:"SetPlayermode",value:function e(t){if(t==0)t=this.config.playerMode;if(t==0)t=this.GetPlayMode(this.IsRealPlay);this.playermode=t;return t}},{key:"GovPlay",value:function e(t,i){this.Stop();this.playermode=b.default.PlayerMode.Gov;this.IsRequestPlay=true;this.req_id++;this.player.PlayRealVideoBegin(t,null,null,this.playermode,this.req_id);this.player.GovPlay(t,i);this.IsPlay=true;this.ucMain.NowPlayVideosCount+=1;this.SetShowKBps(true,"")}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var a=this;var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;this.IsRealPlay=true;this.Sim=t;this.Channel=i;this.streamType=r;this.hasAudio=n;this.Callback=o;this.Stop();s=this.SetPlayermode(s);var c=g.default.SimChannelLen(t,i,this.config.protocol);t=c.Sim;i=c.Channel;this.IsRequestPlay=true;this.player.PlayRealVideoBegin(t,i,r,s);if(s==b.default.PlayerMode.Webrtc){this.createSocketAndSendCmd(t,i,function(){a.IsPlay=true;if(n){a.jt1078.Send9101Webrtc(t,i,0,r)}else{a.jt1078.Send9101Webrtc(t,i,1,r)}a.ucMain.NowPlayVideosCount+=1})}else if(s==b.default.PlayerMode.Fmp4){this.createSocketAndSendCmd(t,i,function(){a.IsPlay=true;if(a.config.priority!=0){a.jt1078.Send8881(t,i,a.config.priority)}if(n){if(n==203){a.jt1078.Send9101(t,i,3,r)}else{a.jt1078.Send9101(t,i,0,r)}}else{a.jt1078.Send9101(t,i,1,r)}a.ucMain.NowPlayVideosCount+=1})}else if(s==b.default.PlayerMode.Hls){this.createSocketAndSendCmd(t,i,function(){a.IsPlay=true;if(n){a.jt1078.Send9101Rtmp(t,i,0,r)}else{a.jt1078.Send9101Rtmp(t,i,1,r)}a.ucMain.NowPlayVideosCount+=1})}else if(s==b.default.PlayerMode.Wasm||s==b.default.PlayerMode.WebCodec){this.createSocketAndSendCmd(t,i,function(){a.IsPlay=true;if(n){if(n==203){a.jt1078.Send9101(t,i,3,r)}else{a.jt1078.Send9101(t,i,0,r)}}else{a.jt1078.Send9101(t,i,1,r)}a.ucMain.NowPlayVideosCount+=1})}}},{key:"AVTransferControl",value:function e(t,i,r,n,a){var s=this;var o=g.default.SimChannelLen(t,i,this.config.protocol);t=o.Sim;i=o.Channel;if(this.IsPlay){this.jt1078.Send9102(t,i,r,n,a)}else{this.createSocketAndSendCmd(t,i,function(){s.jt1078.Send9102(t,i,r,n,a)})}}},{key:"PlaybackVideo",value:function e(t,i,r){var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments[7];var d=arguments.length>8&&arguments[8]!==undefined?arguments[8]:"";var l=this;var u=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var f=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;this.IsRealPlay=false;this.Sim=t;this.Channel=i;this.MediaType=r;this.StreamType=n;this.StorageType=a;this.PlaybackMode=s;this.Multiple=o;this.StartTime=c;this.EndTime=d;this.DataSource=f;var h=g.default.SimChannelLen(t,i,this.config.protocol);t=h.Sim;i=h.Channel;this.Stop();this.IsRequestPlay=true;u=this.SetPlayermode(u);this.player.PlayBackVideoBegin(t,i,c,d,r,s,o,u);if(u==b.default.PlayerMode.Webrtc){this.createSocketAndSendCmd(t,i,function(){l.IsPlay=true;l.jt1078.Send9201Webrtc(t,i,r,n,a,s,o,c,d,f);l.ucMain.NowPlayVideosCount+=1})}else if(u==b.default.PlayerMode.Fmp4){this.createSocketAndSendCmd(t,i,function(){l.IsPlay=true;if(l.config.priority!=0){l.jt1078.Send8881(t,i,l.config.priority)}l.jt1078.Send9201(t,i,r,n,a,s,o,c,d,f);l.ucMain.NowPlayVideosCount+=1})}else if(u==b.default.PlayerMode.Hls){this.createSocketAndSendCmd(t,i,function(){l.IsPlay=true;l.jt1078.Send9201Rtmp(t,i,r,n,a,s,o,c,d,f);l.ucMain.NowPlayVideosCount+=1})}else if(u==b.default.PlayerMode.Wasm||u==b.default.PlayerMode.WebCodec){this.createSocketAndSendCmd(t,i,function(){l.IsPlay=true;l.jt1078.Send9201(t,i,r,n,a,s,o,c,d,f);l.ucMain.NowPlayVideosCount+=1})}}},{key:"PlaybackVideoControl",value:function e(t,i,r,n,a){var s=this;var o=g.default.SimChannelLen(t,i,this.config.protocol);t=o.Sim;i=o.Channel;if(this.IsPlay){this.jt1078.Send9202(t,i,r,n,a)}else{this.createSocketAndSendCmd(t,i,function(){s.jt1078.Send9202(t,i,r,n,a)})}}},{key:"SeekPlayBackVideoControl",value:function e(t){if(this.IsPlay){this.jt1078.Send9202(this.Sim,this.Channel,5,1,t)}}},{key:"QueryVideoFileList",value:function e(t,i,r,n,a,s,o,c,d,l){var u=g.default.SimChannelLen(t,i,this.config.protocol);t=u.Sim;i=u.Channel;var f=this.ucMain.get808Cmd(this.config,this);this.jt1078.Send9205(f,t,i,r,n,a,s,o,c,d,l)}},{key:"FtpVideoFileUpload",value:function e(t,i,r,n,a,s,o,c,d,l,u,f,h,p,m){var v=g.default.SimChannelLen(t,i,this.config.protocol);t=v.Sim;i=v.Channel;var y=this.ucMain.get808Cmd(this.config,this);this.jt1078.Send9206(y,t,i,r,n,a,s,o,c,d,l,u,f,h,p,m)}},{key:"FtpVideoFileUploadControl",value:function e(t,i,r,n){var a=this;var s=g.default.SimChannelLen(t,i,this.config.protocol);t=s.Sim;i=s.Channel;if(this.IsPlay){this.jt1078.Send9207(t,i,r,n)}else{this.createSocketAndSendCmd(t,i,function(){a.jt1078.Send9207(t,i,r,n)})}}},{key:"RotationControl",value:function e(t,i,r,n){var a=this;var s=g.default.SimChannelLen(t,i,this.config.protocol);t=s.Sim;i=s.Channel;v.default.debug(":0x9301");if(this.IsPlay){this.jt1078.Send9301(t,i,r,n)}else{this.createSocketAndSendCmd(t,i,function(){a.jt1078.Send9301(t,i,r,n)})}}},{key:"FocusControl",value:function e(t,i,r){var n=this;var a=g.default.SimChannelLen(t,i,this.config.protocol);t=a.Sim;i=a.Channel;v.default.debug(":0x9302");if(this.IsPlay){this.jt1078.Send9302(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9302(t,i,r)})}}},{key:"ApertureControl",value:function e(t,i,r){var n=this;var a=g.default.SimChannelLen(t,i,this.config.protocol);t=a.Sim;i=a.Channel;v.default.debug(":0x9303");if(this.IsPlay){this.jt1078.Send9303(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9303(t,i,r)})}}},{key:"WiperControl",value:function e(t,i,r){var n=this;var a=g.default.SimChannelLen(t,i,this.config.protocol);t=a.Sim;i=a.Channel;v.default.debug(":0x9304");if(this.IsPlay){this.jt1078.Send9304(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9304(t,i,r)})}}},{key:"InfraredControl",value:function e(t,i,r){var n=this;var a=g.default.SimChannelLen(t,i,this.config.protocol);t=a.Sim;i=a.Channel;v.default.debug(":0x9305");if(this.IsPlay){this.jt1078.Send9305(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9305(t,i,r)})}}},{key:"TimesControl",value:function e(t,i,r){var n=this;var a=g.default.SimChannelLen(t,i,this.config.protocol);t=a.Sim;i=a.Channel;v.default.debug(":0x9306");if(this.IsPlay){this.jt1078.Send9306(t,i,r)}else{this.createSocketAndSendCmd(t,i,function(){n.jt1078.Send9306(t,i,r)})}}},{key:"ChangeH265Player",value:function e(){if(this.IsRealPlay){this.StartRealTimeVideo(this.Sim,this.Channel,this.streamType,this.hasAudio,b.default.PlayerMode.Wasm,this.Callback)}else{this.PlaybackVideo(this.Sim,this.Channel,this.MediaType,this.StreamType,this.StorageType,this.PlaybackMode,this.Multiple,this.StartTime,this.EndTime,b.default.PlayerMode.Wasm,this.DataSource)}}},{key:"Stop",value:function e(){var t=this.IsRequestPlay;this.IsRequestPlay=false;this.player.StopPlay();this.CloseSocket();if(this.IsPlay){this.IsPlay=false;this.ucMain.NowPlayVideosCount-=1}if(t){if(this.config.events&&this.config.events.onStop){this.config.events.onStop(this.video_id,this)}}this.SetKBpsText("")}},{key:"CloseSocket",value:function e(){if(this.socket){v.default.debug("");this.socket.close();this.socket=null;this.socketCreatedId++}}},{key:"Resize",value:function e(){this.player.interface_player.Resize()}},{key:"GetPlayMode",value:function e(t){if(t&&CvNetVideo.supportCodec){return b.default.PlayerMode.WebCodec}var i=navigator.userAgent;var r=i.indexOf("Android")>-1||i.indexOf("Adr")>-1;var n=!!i.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(r){return b.default.PlayerMode.Fmp4}else if(n){return b.default.PlayerMode.Wasm}else{return b.default.PlayerMode.Fmp4}}}]);return r}();i.default=k},{"./JX/JTT1078":89,"./events":93,"./loader/cluster-websocket-loader":96,"./loader/websocket-loader":100,"./player/PlayerMan":111,"./utils/cvComm":125,"./utils/logger":127,events:10}],92:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var a=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=function(){function n(e){s(this,n);this.wfs=e;this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++){i[r-1]=arguments[r]}this.handledEvents=i;this.useGenericHandler=true;this.registerListeners()}a(n,[{key:"destroy",value:function e(){this.unregisterListeners()}},{key:"isEventHandler",value:function e(){return r(this.handledEvents)==="object"&&this.handledEvents.length&&typeof this.onEvent==="function"}},{key:"registerListeners",value:function e(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){if(e==="wfsEventGeneric"){}this.wfs.on(e,this.onEvent)}.bind(this))}}},{key:"unregisterListeners",value:function e(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){this.wfs.off(e,this.onEvent)}.bind(this))}}},{key:"onEvent",value:function e(t,i){this.onEventGeneric(t,i)}},{key:"onEventGeneric",value:function e(t,i){var r=function e(t,i){var r="on"+t.replace("wfs","");if(typeof this[r]!=="function"){}return this[r].bind(this,i)};r.call(this,t,i).call()}}]);return n}();i.default=n},{}],93:[function(e,t,i){"use strict";t.exports={MEDIA_ATTACHING:"wfsMediaAttaching",MEDIA_ATTACHED:"wfsMediaAttached",FRAG_LOADING:"wfsFragLoading",BUFFER_CREATED:"wfsBufferCreated",BUFFER_APPENDING:"wfsBufferAppending",BUFFER_RESET:"wfsBufferReset",FRAG_PARSING_DATA:"wfsFragParsingData",FRAG_PARSING_INIT_SEGMENT:"wfsFragParsingInitSegment",MEDIA_INFO:"wfsMediaInfo",H264_DATA_PARSING:"wfsH264DataParsing",WEBSOCKET_ATTACHED:"wfsWebsocketAttached",WEBSOCKET_ATTACHING:"wfsWebsocketAttaching",WEBSOCKET_DATA_UPLOADING:"wfsWebsocketDataUploading",WEBSOCKET_MESSAGE_SENDING:"wfsWebsocketMessageSending",WEBSOCKET_CLOSE:"wfsWebsocketClose",WEBSOCKET_OPEN:"wfsWebsocketOpen",FILE_HEAD_LOADING:"wfsFileHeadLoading",FILE_HEAD_LOADED:"wfsFileHeadLoaded",FILE_DATA_LOADING:"wfsFileDataLoading",FILE_DATA_LOADED:"wfsFileDataLoaded",FILE_PARSING_DATA:"wfsFileParsingData",JT1078_DATA_PARSING:"wfsJT1078DataParsing",JT1078_PCM_OUT:"wfsJT1078PcmOut",JT1078_RGB_OUT:"wfsJT1078RgbOut",JT1078_YUV_OUT:"wfsJT1078YuvOut",JT1078ToFMp4_DATA_PARSING:"wfsJT1078ToFMp4DataParsing",WEBRTC_SFU_INFO:"wfsWebrtcSFUInfo",HLS_INFO:"wfsHlsInfo",SPEEK_DATA:"wfsSpeekParsingData"}},{}],94:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../utils/long");var a=s(r);function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function r(){o(this,r)}n(r,[{key:"toHex",value:function e(t){return r.toHex(t)}}],[{key:"concatenate",value:function e(t,i){var r=0;var n=true;var a=false;var s=undefined;try{for(var o=i[Symbol.iterator](),c;!(n=(c=o.next()).done);n=true){var d=c.value;r+=d.length}}catch(e){a=true;s=e}finally{try{if(!n&&o.return){o.return()}}finally{if(a){throw s}}}var l=new t(r);var u=0;var f=true;var h=false;var p=undefined;try{for(var m=i[Symbol.iterator](),v;!(f=(v=m.next()).done);f=true){var y=v.value;l.set(y,u);u+=y.length}}catch(e){h=true;p=e}finally{try{if(!f&&m.return){m.return()}}finally{if(h){throw p}}}return l}},{key:"toHex",value:function e(t){var i=t.toString(16);if(i.length<2){return"0"+i}return i}},{key:"Byte2ToUInt",value:function e(t,i){return t[i+1]|t[i]<<8}},{key:"Byte4ToUInt",value:function e(t,i){return t[i+3]|t[i+2]<<8|t[i+1]<<16|t[i]<<24}},{key:"BcdToString",value:function e(t,i,r){var n="";for(var a=0;a<r/2;a++){n+=this.toHex(t[i+a])}return n}},{key:"StringTimeToUnixLong",value:function e(t){var i=parseInt("20"+t.substring(0,2));var r=parseInt(t.substring(2,4));var n=parseInt(t.substring(4,6));var a=parseInt(t.substring(6,8));var s=parseInt(t.substring(8,10));var o=parseInt(t.substring(10,12));if(n==0||r==0||r>12||n>31||a>24||s>60||o>60){return}var c=i+"-"+r+"-"+n+" "+a+":"+s+":"+o;return parseInt(new Date(c).getTime()/1e3)}},{key:"StringToBcd",value:function e(t,i,r,n){while(r.length<n){r="0"+r}for(var a=0;a<n/2;a++){t[i+a]=parseInt("0x"+r.substring(a*2,a*2+2))}}},{key:"Byte8ToULong",value:function e(t,i){return new a.default(r.Byte4ToUInt(t,i+4),r.Byte4ToUInt(t,i),true)}},{key:"UIntToByte2",value:function e(t,i,r){t[i++]=r>>8&255;t[i++]=r&255}},{key:"IntToByte4",value:function e(t,i,r){t[i++]=r>>24&255;t[i++]=r>>16&255;t[i++]=r>>8&255;t[i++]=r&255}},{key:"ULongToByte8",value:function e(t,i,r){if(!a.default.isLong(r)){r=a.default.fromString(r.toString(),true)}var n=r.toBytesBE();t[i++]=n[0];t[i++]=n[1];t[i++]=n[2];t[i++]=n[3];t[i++]=n[4];t[i++]=n[5];t[i++]=n[6];t[i++]=n[7]}},{key:"StringToGBK",value:function e(t,i,r){for(var n=0;n<r.length;n++){t[i+n]=r.charCodeAt(n)}return r.length}},{key:"GBKToString",value:function e(t,i,r){if(i===undefined){i=0}if(r===undefined){r=t.length}var n="";for(var a=0;a<r;a++){n+=String.fromCharCode(t[a+i])}return n}},{key:"Utf8ArrayToStr",value:function e(t,i,r){if(i===undefined){i=0}if(r===undefined){r=t.length}var n,a,r,s;var o,c;n="";r=r;a=i;while(a-i<r){s=t[a++];switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(s);break;case 12:case 13:o=t[a++];n+=String.fromCharCode((s&31)<<6|o&63);break;case 14:o=t[a++];c=t[a++];n+=String.fromCharCode((s&15)<<12|(o&63)<<6|(c&63)<<0);break}}return n}}]);return r}();i.default=c},{"../utils/long":128}],95:[function(e,t,i){"use strict";t.exports=e("./CVNetVideo.js").default},{"./CVNetVideo.js":88}],96:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../helper/ByteHelper");var s=l(n);var a=e("../utils/logger");var o=l(a);var c=e("../utils/cvComm");var d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function t(e){u(this,t);this.req_id=e}r(t,[{key:"destroy",value:function e(){}},{key:"getConnByCluster",value:function e(t,i,r,n,a,s){this.wfs=s;this.clusterHost=t;this.clusterPort=i;this.callback=a;this.type=r;this.tag=n;if(s){this.isUseCdn=this.wfs.config.isUseCdn;this.tstCdnOid=this.wfs.config.tstCdnOid}if(d.default.IsHttps()){this.n1006=true}this.client=new WebSocket(d.default.GetWsp()+t+":"+i);this.ok=false;this.client.onopen=this.initSocketClient.bind(this);this.client.onclose=function(e){this.closeSocket(e,this.req_id)}.bind(this)}},{key:"close",value:function e(){this.client.close()}},{key:"closeSocket",value:function e(t,i){o.default.debug("ClusterWebsocket Disconnected!");if(this.n1006){this.n1006=false;this.client=new WebSocket(d.default.GetWsp()+this.clusterHost+":"+this.clusterPort);this.client.onopen=this.initSocketClient.bind(this);this.client.onclose=this.closeSocket.bind(this)}else if(!this.ok){if(this.wfs){if(this.wfs.SetShowKBps){this.wfs.SetShowKBps(false,this.wfs.config.language.connect_failed,i)}if(this.wfs.config.events){if(this.wfs.config.events.onWsClose){this.wfs.config.events.onWsClose(this.wfs.video_id,this.wfs)}if(this.wfs.config.events.onServerNotice){this.wfs.config.events.onServerNotice("onWsClose",this.wfs.video_id,this.wfs)}}}}}},{key:"initSocketClient",value:function e(t){this.client.binaryType="arraybuffer";this.client.onmessage=this.receiveSocketMessage.bind(this);o.default.debug("ClusterWebsocket Open!");var i=5;if(this.tag!==undefined&&this.tag!==null){i+=this.tag.length}var r=new Uint8Array(i);if(this.isUseCdn)r[0]=2;else r[0]=1;if(this.n1006)s.default.IntToByte4(r,1,1006);else s.default.IntToByte4(r,1,this.type);if(this.tag!==undefined&&this.tag!==null){s.default.StringToGBK(r,5,this.tag)}this.client.send(r)}},{key:"receiveSocketMessage",value:function e(t){var i=new Uint8Array(t.data);var r=s.default.GBKToString(i);var n="";if(this.isUseCdn){var a=r.split("#");n=a[1];r=a[0]}else{n=this.tstCdnOid}if(this.n1006&&r!==null){var a=r.split(":");if(a.length==3){r=a[0]+":"+a[1]+"/"+this.type+":"+a[2]}else r+="/"+this.type}this.n1006=false;this.callback(r,this,n)}}]);return t}();i.default=f},{"../helper/ByteHelper":94,"../utils/cvComm":125,"../utils/logger":127}],97:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../JX/JTT1078");var s=p(n);var a=e("../utils/queue");var o=p(a);var c=e("./cluster-websocket-loader");var d=p(c);var l=e("../utils/logger");var u=p(l);var f=e("../utils/cvComm");var h=p(f);function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var v=function(){function i(e,t){m(this,i);this.config=e;this.wfs=t;this.websocket=undefined;this.splitData=new s.default.SplitData;this.checkHelper=new s.default.CheckHelper;this.AllSimPackData={};this.sendCache=new o.default;this.onCallback={};this.msg_serial_number=0}r(i,[{key:"connect",value:function e(){var i=this;if(this.config.usingCluster){var r=new d.default;r.getConnByCluster(this.config.clusterHost,h.default.GetClusterPort(this.config),1002,null,function(e){if(e==null){r.close()}else{var t=e.split(":");i.config.remoteHost=t[0];i.config.remotePortWs=t[1];r.close();i.wsconnect(i.config.remoteHost,i.config.remotePortWs,e)}},this.wfs)}else{this.wsconnect(this.config.remoteHost,this.config.remotePortWs)}}},{key:"wsconnect",value:function e(t,i,r){this.host=t;this.port=i;var n=h.default.GetWsp();if(r==null){n+=this.host+":"+this.port}else{n+=r}this.websocket=new WebSocket(n);this.websocket.onopen=this.openSocket.bind(this);this.websocket.onclose=this.closeSocket.bind(this);this.websocket.binaryType="arraybuffer";this.websocket.onmessage=this.receiveSocketMessage.bind(this)}},{key:"closeSocket",value:function e(t){u.default.debug("Websocket808 Disconnected!")}},{key:"openSocket",value:function e(){u.default.debug("Websocket808 Open!");if(this.config.protocol!=0){this.sendData(new Uint8Array([48,49,99,100,231,255,253,242,0,0,0,0,0,0,0,128,0,0]))}while(this.sendCache.size()>0){this.sendData(this.sendCache.dequeue())}}},{key:"receiveSocketMessage",value:function e(t){var i=this;var r=new Uint8Array(t.data);this.splitData.SplitDataBy7E(r,18,r.byteLength-18,function(e){if(e.length>11&&i.checkHelper.CheckXOR(e,0,e.length-1)===e[e.length-1]){i.JX808DataPD(new Uint8Array(e))}})}},{key:"JX808DataPD",value:function e(t){var i=new s.default.JTHeader;i.FillByBinary(t,0);if(i.PackInfo){var r=s.default.GetFirstSerialNumber(i);var n=this.AllSimPackData[i.Sim];if(!n){n={};this.AllSimPackData[i.Sim]=n}var a=n[r];if(a){if(!a.PackData[i.PackInfo.Index]){a.PackData.Count+=1;a.PackData.totalLength+=i.MsgLen}a.PackData[i.PackInfo.Index]=s.default.GetMsbBody(i,t);a.LastRTime=new Date;if(this.CheckPackByPD(a))n[r]=null}else{a={};a.PackData={};a.PackData[i.PackInfo.Index]=s.default.GetMsbBody(i,t);a.PackData.Count=1;a.PackData.totalLength=i.MsgLen;a.Head=new s.default.JTHeader(i.MsgId,i.Sub,i.DataEncryptType,i.MsgLen,i.Sim,r,i.Is2019,i.Ver);a.Head.PackInfo=new s.default.JTPackageInfo(1,i.PackInfo.Sum);a.StartTime=a.LastRTime=new Date;n[r]=a}}else{this.JX808Data(i,s.default.GetMsbBody(i,t))}}},{key:"CheckPackByPD",value:function e(t){if(t.PackData.Count===t.Head.PackInfo.Sum){var i=new Uint8Array(t.PackData.totalLength);var r=0;for(var n=1;n<=t.Head.PackInfo.Sum;n++){i.set(t.PackData[n],r);r+=t.PackData[n].byteLength}try{this.JX808Data(t.Head,i)}catch(e){console.error(e);return true}return true}return false}},{key:"JX808Data",value:function e(t,i){switch(t.MsgId){case 4613:var r=new s.default.JTVideoListInfo;r.FillByBinary(i,0);var n=this.onCallback[4613+":"+r.SerialNumber];if(n){delete this.onCallback[4613+":"+r.SerialNumber];n(r)}break;case 4614:var a=new s.default.JTVideoFileUploadEndInform;a.FillByBinary(i,0);this.onCallback[4614](a);break;default:}}},{key:"printState",value:function e(){switch(this.websocket.readyState){case 0:u.default.debug("Websocket808 readyState=CONNECTING");break;case 1:u.default.debug("Websocket808 readyState=OPEN");break;case 2:u.default.debug("Websocket808 readyState=CLOSING");break;case 3:u.default.debug("Websocket808 readyState=CLOSED");break}}},{key:"sendData",value:function e(t){this.websocket.send(t)}},{key:"sendMessage",value:function e(t,i,r,n){if(i){if(n!==undefined){r=r+":"+n}this.onCallback[r]=i}if(this.websocket===undefined||this.websocket.readyState===0){this.sendCache.enqueue(t)}else if(this.websocket.readyState===2||this.websocket.readyState===3){this.printState();this.sendCache.enqueue(t);this.connect()}else{this.sendData(t)}}}]);return i}();i.default=v},{"../JX/JTT1078":89,"../utils/cvComm":125,"../utils/logger":127,"../utils/queue":129,"./cluster-websocket-loader":96}],98:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("./cluster-websocket-loader");var c=o(n);var a=e("../JX/JTT1078");var y=o(a);var s=e("../utils/cvComm");var g=o(s);function o(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var l=function(){function t(e){d(this,t);this.config=e}r(t,[{key:"DownLoad",value:function e(n,a,s){var o=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var c=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var d=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var l=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var u=arguments[7];var f=arguments.length>8&&arguments[8]!==undefined?arguments[8]:"";var h=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var p=this;var m=arguments.length>10&&arguments[10]!==undefined?arguments[10]:4;var v=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0;this.IsRealPlay=false;this.Sim=n;this.Channel=a;this.MediaType=s;this.StreamType=o;this.StorageType=c;this.PlaybackMode=d;this.Multiple=l;this.StartTime=u;this.EndTime=f;this.DataSource=h;this.Speed=m;this.VideoFormat=v;this.createSocketAndSendCmd(n,function(e,t){var i="http"+(g.default.IsHttps()?"s":"")+"://"+e+":"+t+"/"+n+"_"+a+"_"+y.default.DateToUnixLong(u)+"_"+y.default.DateToUnixLong(f)+(v==1?".flv":".mp4")+"?MediaType="+s+"&StreamType="+o+"&StorageType="+c+"&PlaybackMode="+d+"&Multiple="+l+"&DataSource="+h+"&Speed="+m+"&CTags="+p.config.defaultCtags;var r=document.createElement("a");r.style.display="none";r.href=i;document.body.appendChild(r);r.click();document.body.removeChild(r)})}},{key:"createSocketAndSendCmd",value:function e(t,n){var a=this;var s=this.socketCreatedId;if(this.config.usingCluster){var i=1005;var o=new c.default;o.getConnByCluster(this.config["clusterHost"],g.default.GetClusterPort(this.config),i,t,function(e,t,i){if(e==null){o.close()}else{var r=e.split(":");a.config["remoteHost"]=r[0];a.config["remotePort"]=r[1];if(s==a.socketCreatedId){t.ok=true;o.close();a.config.cdnOid=i;n(r[0],r[1])}}},this)}else{if(s==this.socketCreatedId){n(this.config["clusterHost"],this.config["clusterPort"])}}}}]);return t}();i.default=l},{"../JX/JTT1078":89,"../utils/cvComm":125,"./cluster-websocket-loader":96}],99:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../JX/JTT1078");var a=l(n);var s=e("../utils/logger");var o=l(s);var c=e("../helper/ByteHelper");var d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function t(e){u(this,t);this.jt1078=new a.default(this);this.config={};this.config["protocol"]=e["protocol"]}r(t,[{key:"SnapshotRequest",value:function e(t,i,r,n,a){this._ConnectServer(t);this.sim=i;this.channel=r;this.update=n;this.callback=a;setTimeout(function(){this._CallBack(false,"",this.config.language.timeout)}.bind(this),8e3)}},{key:"_ConnectServer",value:function e(t){this._socket=new WebSocket(t);this._socket.onopen=this._OnOpen.bind(this);this._socket.onclose=this._OnClose.bind(this);this._socket.onerror=function(e){o.default.debug("websocket onerror:"+e);this._CallBack(false,"",this.config.language.connect_error)}.bind(this)}},{key:"_OnOpen",value:function e(t){this._isconnected=true;this._socket.binaryType="arraybuffer";this._socket.onmessage=this._OnMessage.bind(this);if(this.config.protocol!=0){this._socket.send(new Uint8Array([48,49,99,100,231,255,253,242,0,0,0,0,0,0,0,128,0,0]))}this.jt1078.Send8890Snapshot(this.sim,this.channel,7,'{"IsUpdate":'+this.update+",OnlyUrl:true}",function(e){this._socket.send(e)}.bind(this))}},{key:"_OnClose",value:function e(){o.default.debug("connect stream server failed");this._CallBack(false,"",this.config.language.connect_close)}},{key:"_OnMessage",value:function e(t){try{var i=new Uint8Array(t.data);var r=d.default.Utf8ArrayToStr(i,0,i.length);var n=JSON.parse(r);if(!n.HasBytes)this._CallBack(n.IsSuccess,n.Url,n.Reason)}catch(e){}}},{key:"_CallBack",value:function e(t,i,r){if(this.callback){this.callback(t,i,r);this.callback=null}this._socket.close()}}]);return t}();i.default=f},{"../JX/JTT1078":89,"../helper/ByteHelper":94,"../utils/logger":127}],100:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../events");var v=h(n);var a=e("../event-handler");var s=h(a);var o=e("../JX/JTT1078");var y=h(o);var c=e("../player/PlayerMan.js");var g=h(c);var d=e("../utils/logger");var l=h(d);var u=e("../utils/trafficStat");var f=h(u);function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function m(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function _(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var b=function(e){_(i,e);function i(e){p(this,i);var t=m(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,v.default.WEBSOCKET_ATTACHING,v.default.WEBSOCKET_DATA_UPLOADING,v.default.WEBSOCKET_MESSAGE_SENDING));t.buf=null;t.channelName=undefined;t.onOpen=undefined;t.trafficStat=new f.default;t.isClose=true;return t}r(i,[{key:"destroy",value:function e(){s.default.prototype.destroy.call(this)}},{key:"onWebsocketAttaching",value:function e(t){this.channelName=t.channelName;this.onOpen=t.onOpen;this.playermode=t.playerMode;var i=t.reqId;if(t.websocket instanceof WebSocket){this.client=t.websocket;this.client.onopen=function(e){this.initSocketClient(e,i)}.bind(this);this.client.onclose=function(e){if(this.wfs.SetShowKBps){if(this.isClose)this.wfs.SetShowKBps(false,this.wfs.config.language.connect_failed,i);else this.wfs.SetShowKBps(false,this.wfs.config.language.connect_down,i)}this.isClose=true;if(this.wfs.config.events){if(this.wfs.config.events.onWsClose){this.wfs.config.events.onWsClose(this.wfs.video_id,this.wfs)}if(this.wfs.config.events.onServerNotice){this.wfs.config.events.onServerNotice("onWsClose",this.wfs.video_id,this.wfs)}}l.default.debug("Websocket Disconnected!");this.wfs.trigger(v.default.WEBSOCKET_CLOSE,{e:e})}.bind(this)}}},{key:"initSocketClient",value:function e(t,i){this.first_msg=false;this.isClose=false;this.client.binaryType="arraybuffer";this.client.onmessage=function(e){this.receiveSocketMessage(e,i)}.bind(this);if(this.wfs.config.protocol!=0){this.onWebsocketDataUploading({data:new Uint8Array([48,49,99,100,231,255,253,242,0,0,0,0,0,0,0,128,0,0])})}if(this.onOpen){this.onOpen()}l.default.debug("Websocket Open!")}},{key:"Utf8ArrayToStr",value:function e(t){var i,r,n,a;var s,o;i="";n=t.length;r=0;while(r<n){a=t[r++];switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(a);break;case 12:case 13:s=t[r++];i+=String.fromCharCode((a&31)<<6|s&63);break;case 14:s=t[r++];o=t[r++];i+=String.fromCharCode((a&15)<<12|(s&63)<<6|(o&63)<<0);break}}return i}},{key:"receiveSocketMessage",value:function e(t,i){this.trafficStat.addbytes(t.data.byteLength);var r=new Uint8Array(t.data);if(r[0]==126&&r[r.length-1]==126){var n=new y.default.JTHeader;n.FillByBinary(r,1);if(this.JX808Data(n,r,n.GetLength()+1,i)){return}}if(this.playermode===g.default.PlayerMode.Webrtc){var a=String.fromCharCode.apply(null,r);var s=JSON.parse(a);this.wfs.trigger(v.default.WEBRTC_SFU_INFO,s);return}if(this.playermode===g.default.PlayerMode.Fmp4){if(r.length===5&&r[0]===119&&r[1]===119){var o=r[2].toString(16).length===1?"0"+r[2].toString(16):r[2].toString(16);var c=r[3].toString(16).length===1?"0"+r[3].toString(16):r[3].toString(16);var d=r[4].toString(16).length===1?"0"+r[4].toString(16):r[4].toString(16);var l="avc1."+o+c+d+",mp4a.40.2";this.wfs.trigger(v.default.BUFFER_RESET,{mimeType:l});this.first_msg=true;return}else if(r.length===5&&r[0]===119&&r[1]===120){var u=false;if(r[2]==1){var l="hev1.1.6.L"+r[3]+".90,mp4a.40.2";var f="video/mp4;codecs="+l;if(MediaSource.isTypeSupported(f)===true){u=true}}else if(r[2]==2){var l="hev1.2.4.L"+r[3]+".90,mp4a.40.2";var h="video/mp4;codecs="+l;if(MediaSource.isTypeSupported(h)===true){u=true}}if(u){this.wfs.trigger(v.default.BUFFER_RESET,{mimeType:l});this.first_msg=true}else{this.client.close();if(this.wfs.config.events.onChangeH265Player){if(this.wfs.config.events.onChangeH265Player(this.wfs.playermode,this.wfs.video_id,this.wfs)){return true}}this.wfs.ChangeH265Player()}return}else{this.wfs.trigger(v.default.BUFFER_APPENDING,{type:"video",data:r})}return}if(this.playermode===g.default.PlayerMode.Hls){var p=String.fromCharCode.apply(null,r);var m=JSON.parse(p);this.wfs.trigger(v.default.HLS_INFO,m)}if(this.playermode===g.default.PlayerMode.Speek){this.wfs.trigger(v.default.SPEEK_DATA,{type:"Audio",data:r})}if(this.playermode==g.default.PlayerMode.Wasm||this.playermode==g.default.PlayerMode.WebCodec){this.wfs.trigger(v.default.BUFFER_APPENDING,{type:"video",data:r})}}},{key:"JX808Data",value:function e(t,i,r,n){switch(t.MsgId){case 34960:var a=new y.default.JT0x8890;a.FillByBinary(i,r);if(this.wfs.config.events){if(a.NType==0){if(this.wfs.SetShowKBps){this.wfs.SetShowKBps(true,this.wfs.config.language.device_connected,n);this.trafficStat.getKBps()}if(this.wfs.config.events.onDevConnect){this.wfs.config.events.onDevConnect(this.wfs.video_id,this.wfs)}if(this.wfs.config.events.onServerNotice){this.wfs.config.events.onServerNotice("onDevConnect",this.wfs.video_id,this.wfs)}}if(a.NType==1){if(this.wfs.config.events.onDevDisconnect){this.wfs.config.events.onDevDisconnect(this.wfs.video_id,this.wfs)}if(this.wfs.config.events.onServerNotice){this.wfs.config.events.onServerNotice("onDevDisconnect",this.wfs.video_id,this.wfs)}if(this.wfs.SetShowKBps)this.wfs.SetShowKBps(false,this.wfs.config.language.device_disconnect,n);if(this.wfs.Flush)this.wfs.Flush()}if(a.NType==2){if(this.wfs.config.events.onEndByServer){if(this.wfs.config.events.onEndByServer(a.Notice,this.wfs.video_id,this.wfs)||this.wfs.IsRealPlay==false&&!this.wfs.config.stopOnEndByServer){this.wfs.CloseSocket();return true}}this.wfs.Stop()}if(a.NType==4){if(this.wfs.config.events.onChangeH265Player){if(this.wfs.config.events.onChangeH265Player(this.wfs.playermode,this.wfs.video_id,this.wfs)){return true}}this.wfs.ChangeH265Player()}if(a.NType==6){var s=a.Notice.split(":");var o=parseInt(s[0]);var c=parseInt(s[1]);var d=s[2];this.wfs.trigger(v.default.MEDIA_INFO,{video_width:o,video_height:c,video_mime:d})}}return true;case 2185:var l=new y.default.JT0x0889;l.FillByBinary(i,r,t.MsgLen);this.wfs.trigger(v.default.WEBRTC_SFU_INFO,JSON.parse(l.Url));return true;default:}return false}},{key:"onWebsocketDataUploading",value:function e(t){if(this.client.readyState==WebSocket.CONNECTING||this.client.readyState==WebSocket.CLOSING||this.client.readyState==WebSocket.CLOSED)return;this.client.send(t.data)}},{key:"onWebsocketMessageSending",value:function e(t){this.client.send(JSON.stringify({t:t.commandType,c:t.channelName,v:t.commandValue}))}}]);return i}(s.default);i.default=b},{"../JX/JTT1078":89,"../event-handler":92,"../events":93,"../player/PlayerMan.js":111,"../utils/logger":127,"../utils/trafficStat":130}],101:[function(t,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var a=t("../../utils/logger");var s=o(a);function o(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var d=function(){function t(e){c(this,t);this.track=null;this.audioInput=null;this.recorder=null;this.wfs=e}n(t,[{key:"Start",value:function t(i){navigator.getUserMedia=this.GetUserMedia();var r=window.AudioContext||window.webkitAudioContext;var n=new r;var a={};a.channelCount=1;a.numberOfInputChannels=a.channelCount;a.numberOfOutputChannels=a.channelCount;a.bufferSize=2048;navigator.mediaDevices.getUserMedia({audio:true,video:false}).then(function(e){this.track=e.getTracks()[0];this.audioInput=n.createMediaStreamSource(e);this.recorder=n.createScriptProcessor(a.bufferSize,1,1);this.recorder.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);if(this.recorder){i(t,t.length)}}.bind(this);this.audioInput.connect(this.recorder);this.recorder.connect(n.destination)}.bind(this)).catch(function(t){s.default.warn("navigator.mediaDevices.getUserMedia err:"+t);if(this.wfs.config.onMicError){this.wfs.config.onMicError(e)}}.bind(this))}},{key:"Stop",value:function e(){if(this.track){this.track.stop();this.track=null}if(this.audioInput){this.audioInput.disconnect(this.recorder);this.audioInput=null;this.recorder.context.close();this.recorder=null}}},{key:"GetUserMedia",value:function e(){if(navigator.mediaDevices){return navigator.mediaDevices.getUserMedia}return navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}},{key:"GetRawDate",value:function e(){}},{key:"GetSampleRate",value:function e(){return this.recorder.context.sampleRate}}]);return t}();r.default=d},{"../../utils/logger":127}],102:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../../utils/logger");var a=s(n);function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function i(e,t){o(this,i);this.is_start=false;this.audio_context=null;this.config=e;this.audioSpeek=t;this.volume=1;this.factor=1;this.gain=null;this.paused=false;this._divide_in_second=0;this._is_wait_iframe=false;this._play_count=0}r(i,[{key:"destroy",value:function e(){this.Stop()}},{key:"Start",value:function e(){if(this.audio_context==null){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;try{this.audio_context=new window.AudioContext;this.gain=this.audio_context.createGain();this.gain.gain.value=this.volume;this.pts=0}catch(e){a.default.warn("dont support audio context!")}}if(!this.is_start){this.is_start=true}this._is_wait_iframe=false;this._divide_in_second=0;this._play_count=0}},{key:"Stop",value:function e(){this.is_start=false;if(this.audio_context){this.gain=null;this.audio_context.close();this.audio_context=null}}},{key:"Pause",value:function e(){this.paused=true;this.Stop()}},{key:"Play",value:function e(){this.paused=false;this.Start()}},{key:"InputPcm",value:function e(t,i,r){if(this.factor!=1){var n=-340282347e30;var a=340282347e30;for(var s=0;s<i.length;s++){var o=i[s]*this.factor;if(o>a)o=a;else if(o<n)o=n;i[s]=o}}this.PlayPCM(i)}},{key:"InputDate",value:function e(t,i){this.PlayPCM(t)}},{key:"SetVolume",value:function e(t){this.volume=t;if(this.gain){this.gain.gain.value=t}}},{key:"SetVolumeEnhance",value:function e(t){this.factor=t}},{key:"ClearData",value:function e(){}},{key:"PlayPCM",value:function e(t,i){if(this.paused)return;if(!i)i=this.audio_context.sampleRate;if(this._divide_in_second==0){this._divide_in_second=-1;return}if(this._divide_in_second==-1){this._divide_in_second=i/t.length;this._audio_max=this.config.audioBufferMax*this._divide_in_second;this._audio_recovery=this.config.audioBufferRecovery*this._divide_in_second}if(this.is_start){try{if(this._is_wait_iframe){if(this._play_count<this._audio_recovery){this._is_wait_iframe=false}else{return}}if(this._play_count>this._audio_max){this._is_wait_iframe=true;return}var r=this.audio_context;var n=r.createBuffer(1,t.length,i);if(n.copyToChannel){n.copyToChannel(t,0,0)}else{n.getChannelData(0).set(t)}var a=r.createBufferSource();a.connect(this.gain);this.gain.connect(r.destination);a.buffer=n;a.onended=function(){this._play_count--}.bind(this);if(this.pts<r.currentTime){this.pts=r.currentTime}this._play_count++;a.start(this.pts);this.pts+=n.duration}catch(e){console.error(e)}}}},{key:"GetSampleRate",value:function e(){return this.audio_context.sampleRate}}]);return i}();i.default=c},{"../../utils/logger":127}],103:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../../loader/websocket-loader");var a=P(n);var s=e("../../loader/cluster-websocket-loader");var d=P(s);var o=e("../../JX/JTT1078");var c=P(o);var l=e("./AudioCapture");var u=P(l);var f=e("./AudioPlay");var h=P(f);var p=e("../PlayerMan");var m=P(p);var v=e("../../events");var y=P(v);var g=e("../../event-handler");var _=P(g);var b=e("../../utils/logger");var w=P(b);var S=e("../../utils/cvComm");var k=P(S);var C=e("../../utils/aacAdtsParse");var T=P(C);function P(e){return e&&e.__esModule?e:{default:e}}function R(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function E(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function x(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var M=function(e){x(i,e);function i(e){R(this,i);var t=E(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,y.default.SPEEK_DATA));t.number=0;t.pts=0;t.pts_package=0;t.config=e.config;t.config.playermode=m.default.PlayerMode.Speek;t.playermode=m.default.PlayerMode.Speek;t.socket=null;t.socketCreatedId=0;t.websocketLoader=new a.default(e);t.jt1078=new c.default(e);t.audiocapture=new u.default(e);t.audioplay=new h.default(t.config,t);t.codec_type=26;t.channel=1;t.sample_rate=8e3;t.sample_bit=16;t.frame_length=168;t.has_haisi=1;t.decoder_id=-1;t.encoder_id=-1;t.first_pts=-1;t.first_time=-1;t.m_first_pts=0;t.m_total_pts=0;t.wasm_codec_type=-1;return t}r(i,[{key:"destory",value:function e(){this.websocketLoader.destroy()}},{key:"StartSpeek",value:function e(t,i){var r=this;this.number=0;this.pts=0;this.pts_package=0;this.sim=t;this.channel=i;this.m_first_pts=0;this.m_total_pts=0;this.first_msg=false;this.createSocketAndSendCmd(t,i,function(){r.jt1078.Send9101(t,i,2,0)});this.audioplay.Start()}},{key:"StopSpeek",value:function e(){this._StopAudio()}},{key:"StartBroadcast",value:function e(t){var i=this;this.createSocketAndSendCmd(t[0].Sim,t[0].Channel,function(){for(var e=0;e<t.length;e++){i.jt1078.Send9101(t[e].Sim,t[e].Channel,4,0)}});this.sim=t[0].Sim;this.wasm_codec_type=CvNetVideo.WASM.JX_G711U;this.codec_type=7;this.audiocapture.Start(function(e,t){if(this.encoder_id==-1){w.default.debug("codectype:%d, samplerate:%d, haisi:%d, frame_length:%d",this.codec_type,this.audiocapture.GetSampleRate(),this.has_haisi,this.frame_length);this.encoder_id=CvNetVideo.WASM.CreateAAudioEncoder(this.wasm_codec_type,this.audiocapture.GetSampleRate(),32,1,8e3,16,1,this.has_haisi,this.frame_length);if(this.encoder_id>=0){CvNetVideo.WasmId2Uc.e[this.encoder_id]=this.wfs}}if(this.encoder_id>=0){var i=new Uint8Array(e.buffer);CvNetVideo.WASM.AudioEncoderEncode(this.encoder_id,i,i.length)}}.bind(this))}},{key:"StopBroadcast",value:function e(){this._StopAudio()}},{key:"_StopAudio",value:function e(){this.CloseSocket();if(this.decoder_id!=-1){CvNetVideo.WASM.AudioDecoderClear(this.decoder_id);this.decoder_id=-1}if(this.encoder_id!=-1){CvNetVideo.WASM.AudioEncoderClear(this.encoder_id);this.encoder_id=-1}this.audioplay.Stop();this.audiocapture.Stop()}},{key:"InputPcmData",value:function e(t,i,r){this.audioplay.InputDate(i,r)}},{key:"ClearPcmDate",value:function e(){this.audioplay.ClearData()}},{key:"InputEncodeAudio",value:function e(t,i,r){if(this.wasm_codec_type==CvNetVideo.WASM.JX_AAC&&this.is_have_adts){var n=new Uint8Array(r+7);T.default.AacAdtsPack(n,this.sample_index,1);n.set(i,7);i=n;r=i.length}if(this.first_pts==-1){this.first_pts=this.pts;this.first_time=new Date;this.jt1078.SendAudio(this.sim,this.channel,i,this.number,this.codec_type,this.pts)}else{if(this.config.speekSendMode==0){this.jt1078.SendAudio(this.sim,this.channel,i,this.number,this.codec_type,this.pts)}else{var a=this.pts-this.first_pts;var s=(new Date).getTime()-this.first_time.getTime();if(s<a){var o=new Uint8Array(i.length);o.set(i,0);var c={sim:this.sim,channel:this.channel,number:this.number,codec_type:this.codec_type,pts:this.pts,data:o};setTimeout(function(){this.jt1078.SendAudio(c.sim,c.channel,c.data,c.number,c.codec_type,c.pts)}.bind(this),a-s)}else{this.jt1078.SendAudio(this.sim,this.channel,i,this.number,this.codec_type,this.pts)}}}if(this.pts_package==0){var d=0;if(this.has_haisi){d=r-4}else{d=r}switch(this.codec_type){case 6:case 7:d=d*2;break;case 8:d=d*4;break;case 26:d=(d-4)*4}this.pts_package=Math.floor(d*1e3/16e3)}this.pts+=this.pts_package;this.number++;if(this.number>=65535){this.number=0}}},{key:"onSpeekParsingData",value:function e(t){var i=t.data;if(!this.first_msg){this.in_sample_rate=8e3;this.in_channel=1;this.is_have_adts=false;if(i.length==11&&i[0]==0&&i[1]==0&&i[2]==1&&i[3]==145){if(i[4]==6||i[4]==7||i[4]==8||i[4]==26||i[4]==19){this.codec_type=i[4];switch(i[6]){case 0:this.sample_rate=8e3;break;case 1:this.sample_rate=22050;break;case 2:this.sample_rate=44100;break;case 3:this.sample_rate=48e3;break}switch(i[7]){case 0:this.sample_bit=8;break;case 1:this.sample_bit=16;break;case 2:this.sample_bit=32;break}this.AudioFrameLength=(i[8]<<8)+i[9];this.frame_length=this.AudioFrameLength;this.has_haisi=i[10];this.bits_per_coded_sample=4;this.wasm_codec_type=this.codec_type;switch(this.codec_type){case 6:case 7:this.frame_length=320;break;case 8:this.bits_per_coded_sample=CvNetVideo.g726_conf.get_bits_per_coded_sample(this.AudioFrameLength);this.frame_length=this.bits_per_coded_sample*40;this.pts_package=40;this.wasm_codec_type=CvNetVideo.g726_conf.getPT(this.AudioFrameLength);break;case 26:this.frame_length=164;break}}this.first_pts=-1;this.first_msg=true}else if(i.length==5&&i[0]==0&&i[1]==0&&i[2]==1&&i[3]==146){var r=i[4]}return}if(this.decoder_id==-1&&this.wasm_codec_type!=-1){if(this.wasm_codec_type==CvNetVideo.WASM.JX_AAC){var n=T.default.AacAdtsDemux(i),a=n.errcode,s=n.sample_rate,o=n.channel;if(a==0){this.is_have_adts=true;this.in_sample_rate=s;this.in_channel=o}}this.decoder_id=CvNetVideo.WASM.CreateAAudioDecoder(this.wasm_codec_type,this.in_sample_rate,16,this.in_channel,this.audioplay.GetSampleRate(),32,1);if(this.decoder_id>=0){CvNetVideo.WasmId2Uc.d[this.decoder_id]=this.audioplay}if(this.config.events&&this.config.events.onStartSpeek){this.config.events.onStartSpeek()}this.audiocapture.Start(function(e,t){if(this.encoder_id==-1){w.default.debug("codectype:%d, samplerate:%d, haisi:%d, frame_length:%d",this.codec_type,this.audiocapture.GetSampleRate(),this.has_haisi,this.frame_length);this.encoder_id=CvNetVideo.WASM.CreateAAudioEncoder(this.wasm_codec_type,this.audiocapture.GetSampleRate(),32,1,8e3,16,1,this.has_haisi,this.frame_length);if(this.encoder_id>=0){this.sample_index=T.default.AacAdtsGetSampleRateIndex(8e3);CvNetVideo.WasmId2Uc.e[this.encoder_id]=this.wfs}}if(this.encoder_id>=0){var i=new Uint8Array(e.buffer);CvNetVideo.WASM.AudioEncoderEncode(this.encoder_id,i,i.length)}}.bind(this))}if(this.decoder_id>=0){CvNetVideo.WASM.AudioDecoderDecode(this.decoder_id,i,i.length)}}},{key:"createSocketAndSendCmd",value:function e(t,n,a){var s=this;var o=this.socketCreatedId;if(this.config.usingCluster){var i=1003;var c=new d.default;c.getConnByCluster(this.config["clusterHost"],k.default.GetClusterPort(this.config),i,t,function(e,t,i){if(e==null){c.close()}else{var r=e.split(":");s.config["remoteHost"]=r[0];s.config["remotePort"]=r[1];if(o==s.socketCreatedId){s.CloseSocket();s.socket=new WebSocket(k.default.GetWsp()+r[0]+":"+r[1]);t.ok=true;s.attachWebsocket(s.socket,"ch"+n,function(){s.config.cdnOid=i;a()});c.close()}}},this.wfs)}else{if(o==this.socketCreatedId){this.CloseSocket();this.config["remoteHost"]=this.config["clusterHost"];this.config["remotePort"]=this.config["clusterPort"];this.socket=new WebSocket(k.default.GetWsp()+this.config["remoteHost"]+":"+this.config["remotePort"]);this.attachWebsocket(this.socket,"ch"+n,function(){a()})}}}},{key:"attachWebsocket",value:function e(t,i,r,n){this.wfs.trigger(y.default.WEBSOCKET_ATTACHING,{websocket:t,channelName:i,playerMode:this.playermode,onOpen:r,onCallback:n})}},{key:"CloseSocket",value:function e(){if(this.socket){w.default.debug("");this.socket.close();this.socket=null;this.socketCreatedId++}}}]);return i}(_.default);i.default=M},{"../../JX/JTT1078":89,"../../event-handler":92,"../../events":93,"../../loader/cluster-websocket-loader":96,"../../loader/websocket-loader":100,"../../utils/aacAdtsParse":123,"../../utils/cvComm":125,"../../utils/logger":127,"../PlayerMan":111,"./AudioCapture":101,"./AudioPlay":102}],104:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../PlayerInterface.js");var a=l(r);var s=e("../../utils/logger.js");var o=l(s);var c=e("../../JX/JTT1078");var d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var p=function(e){h(r,e);function r(e,t){u(this,r);var i=f(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));i.ucvideo=e;i.videodom=t;i.mediaSource=new Array;i.mediaSourceBuffer=new Array;i.mediaSourceInfo=new Array;i.videolist=new Array;i.mediacurrentindex=-1;i.segments=[];i.appended=0;i.multiple=1;i.count=0;i.browserType=0;if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1){i.browserType=1}i.appending=false;i.appendedErr=false;i.onsbue=i.onSourceBufferUpdateEnd.bind(i);i.onmso=i.onMediaSourceOpen.bind(i);i.onmse=i.onMediaSourceEnded.bind(i);i.onmsc=i.onMediaSourceClose.bind(i);i.fmp4header1=null;i.fmp4header2=null;i.delay_flush_timer=null;i.isFlush=false;i.last_time=0;i.timer=null;i.playspeed=1;i.m_manual_switch_lasttime=0;i.m_manual_switch_times=0;return i}n(r,[{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.playspeed=1}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;this.fmp4header1=null;this.fmp4header2=null;if(r instanceof Date){this.starttime=r.getTime()/1e3}else{var c=r.replace(/-/g,"/");this.starttime=new Date(c).getTime()/1e3}if(n instanceof Date){this.endtime=n.getTime()/1e3}else{var d=n.replace(/-/g,"/");this.endtime=new Date(d).getTime()/1e3}this.multiple=1;if(s==1){if(o==2){this.multiple=2}else if(o==3){this.multiple=4}else if(o==4){this.multiple=8}else if(o==5){this.multiple=16}}this.playspeed=1}},{key:"StopVideo",value:function e(){if(this.delay_flush_timer){clearTimeout(this.delay_flush_timer);this.delay_flush_timer=null}if(this.is_playing){for(var t=0;t<this.mediaSource.length;t++){this.mediaSource[t].removeEventListener("sourceopen",this.onmso);this.mediaSource[t].removeEventListener("sourceended",this.onmse);this.mediaSource[t].removeEventListener("sourceclose",this.onmsc)}this.mediaSourceBuffer.length=0;this.mediaSource.length=0;this.mediaSourceInfo.length=0;for(var i=0;i<this.videolist.length;i++){if(i==0){this.ucvideo.player.interface_player.ChangeVideoDom(this.videolist[0]);this.videodom=this.videolist[0]}this.videolist[i].src=null}this.videolist.length=0;this.is_playing=false;this.videodom.src=null}}},{key:"SetPlaySpeed",value:function e(t){this.playspeed=t;for(var i=0;i<this.videolist.length;i++){this.videolist[i].playbackRate=this.playspeed}}},{key:"Flush",value:function e(){this.delay_flush_timer=setTimeout(function(){this.isFlush=true;if(this.appendedErr&&!this.appending){this.doAppending()}}.bind(this),6e4)}},{key:"RecordStart",value:function e(t){this.is_recording=true;this.recoder=t}},{key:"RecordDataInput",value:function e(t){if(!this.is_recording)return;if(this.fmp4header1==null||this.fmp4header2==null)return;if(!this.record_id){this.record_id=CvNetVideo.WASM.CreateRecordFmp4FromFmp4();CvNetVideo.WasmId2Uc.r[this.record_id]=this.recoder;CvNetVideo.WASM.RecordFmp4FromFmp4Input(this.record_id,this.fmp4header1.data,this.fmp4header1.data.length);CvNetVideo.WASM.RecordFmp4FromFmp4Input(this.record_id,this.fmp4header2.data,this.fmp4header2.data.length)}CvNetVideo.WASM.RecordFmp4FromFmp4Input(this.record_id,t,t.length)}},{key:"RecordStop",value:function e(){this.is_recording=false;if(this.record_id){CvNetVideo.WASM.RecordFmp4FromFmp4Clear(this.record_id);this.record_id=null}}},{key:"onBufferAppending",value:function e(t){if(this.delay_flush_timer){clearTimeout(this.delay_flush_timer);this.delay_flush_timer=null}if(t.data[0]==0&&t.data[1]==0&&t.data[2]==1&&t.data[3]==153){if(t.data[4]==136&&t.data[5]==128){var i=new d.default.ExtendRefuse;i.FillByBinary(t.data,6,t.data.length);this.StopPlay();this.LoadingPage(true,i.Reason)}}else{if(this.mediaSource==null)return;this.count++;if(this.count%20==0){this.ucvideo.player.interface_player.interfaceplayerbar.UpdateAll(this)}if(this.fmp4header1==null){this.fmp4header1=t}else if(this.fmp4header2==null){this.fmp4header2=t}this.segments.push(t);if(this.smoothCheck&&this.ucvideo.config.smoothMode){var r=parseInt(this.ucvideo.config.smoothMode);if(isNaN(r)){r=15}if(this.segments.length<r){return}}this.smoothCheck=false;this.doAppending()}}},{key:"onBufferReset",value:function e(t){this.mimeType=t.mimeType;this.smoothCheck=true;this.StartVide()}},{key:"onMediaWaiting",value:function e(){if(this.appendedErr&&!this.appending){this.doAppending()}this.smoothCheck=true;if(this.videodom.playbackRate>1){this.videodom.playbackRate=1;this.ucvideo.player.interface_player.seek2last()}if(this.ucvideo.IsRealPlay||this.ucvideo.config.playbackStartCache<=0){}else{this.start_play_cache=true;this.videodom.pause()}}},{key:"onMediaSourceOpen",value:function e(){o.default.custom("fmp4","media source open");var t=this.mediaSource.length-1;if(!this.mediaSource[t]||this.mediaSource[t].readyState!=="open"){return}this._createSourceBuffers();this.doAppending()}},{key:"onMediaSourceClose",value:function e(){o.default.custom("fmp4","media source close")}},{key:"onMediaSourceEnded",value:function e(){o.default.custom("fmp4","media source ended")}},{key:"onSourceBufferUpdateEnd",value:function e(t){this.appending=false;this.doAppending();if(this.start_play_cache){var i=this.videolist[this.videolist.length-1].buffered;if(i.length==0)return;var r=i.end(i.length-1);if(this.ucvideo.config.playbackStartCache>(r-this.videolist[this.mediacurrentindex].currentTime)*1e3){return}this.videodom.play();this.start_play_cache=false}}},{key:"onMediaTimeUpdate",value:function e(){if(this.appendedErr&&!this.appending){this.doAppending()}this.ucvideo.player.interface_player.interfaceplayerbar.UpdateAll(this);if(this.ucvideo.config.events.onTimeStamp){var t=Math.round(this.PlayerBarFrameBufferGetBegin());if(this.last_time!=t){this.ucvideo.config.events.onTimeStamp(this.ucvideo.video_id,t);this.last_time=t}o.default.debug("onMediaTimeUpdate current"+t+" end_time:"+this.PlayerBarFrameBufferGetEnd())}var i=this.videolist[this.mediacurrentindex].buffered;if(i.length==0)return;var r=i.end(i.length-1);if(this.videolist[this.mediacurrentindex].currentTime>=r){if(this.m_manual_switch_lasttime!=this.videolist[this.mediacurrentindex].currentTime){this.m_manual_switch_times=0;this.m_manual_switch_lasttime=this.videolist[this.mediacurrentindex].currentTime}else{if(this.m_manual_switch_times>3){this.m_manual_switch_times=0;this.m_manual_switch_lasttime=0;o.default.debug("manual media end");this.onMediaEnded()}this.m_manual_switch_times++}}}},{key:"onMediaEnded",value:function e(){o.default.debug("onMediaEnded");if(this.mediacurrentindex<this.mediaSource.length-1){this.mediacurrentindex++;this.ucvideo.player.interface_player.ChangeVideoDom(this.videolist[this.mediacurrentindex]);this.videolist[this.mediacurrentindex].currentTime=0;this.videolist[this.mediacurrentindex].play()}}},{key:"StartVide",value:function e(){this.is_playing=true;this.isFlush=false;if(this.delay_flush_timer){clearTimeout(this.delay_flush_timer);this.delay_flush_timer=null}for(var t=0;t<this.mediaSource.length;t++){this.mediaSource[t].removeEventListener("sourceopen",this.onmso);this.mediaSource[t].removeEventListener("sourceended",this.onmse);this.mediaSource[t].removeEventListener("sourceclose",this.onmsc)}this.mediaSourceBuffer.length=0;this.mediaSource.length=0;this.mediaSourceInfo.length=0;this._CreateNewMediaSource();this.mediacurrentindex=0;this.videolist[0]=this.videodom;this.videodom.src=URL.createObjectURL(this.mediaSource[0]);if(this.IEVersion()!="-1")this.videodom.play()}},{key:"_CreateNewMediaSource",value:function e(){o.default.debug("_CreateNewMediaSource call");var t=this.mediaSource.length;if(t!=0){if(this.fmp4header2==null||this.fmp4header1==null){return}this.segments.unshift(this.fmp4header2);this.segments.unshift(this.fmp4header1);this.mediaSourceInfo[t-1].timelength=this.videodom.currentTime}this.mediaSource[t]=new MediaSource;this.mediaSource[t].addEventListener("sourceopen",this.onmso);this.mediaSource[t].addEventListener("sourceended",this.onmse);this.mediaSource[t].addEventListener("sourceclose",this.onmsc)}},{key:"_createSourceBuffers",value:function e(){var t=void 0;if(this.mimeType===""){t="video/mp4;codecs=avc1.42c01e,mp4a.40.2"}else{t="video/mp4;codecs="+this.mimeType}var i=this.mediaSource.length-1;if(this.mediaSourceBuffer[i])return;try{this.mediaSourceBuffer[i]=this.mediaSource[i].addSourceBuffer(t);this.mediaSourceBuffer[i].mode="sequence";this.mediaSourceBuffer[i].addEventListener("updateend",this.onsbue);this.mediaSourceInfo[i]={recvsize:0,timelength:0}}catch(e){this.mediaSourceBuffer[i]=null;console.error(e)}if(i==this.mediacurrentindex){if(this.ucvideo.IsRealPlay||this.ucvideo.config.playbackStartCache<=0){this.videodom.play()}else{this.start_play_cache=true;this.videodom.pause()}}else this.videodom.pause()}},{key:"doAppending",value:function e(){if(this.mediaSource.length==0||this.mediaSource.length!=this.mediaSourceBuffer.length){return}var t=this.mediaSource.length-1;var i=this.mediaSource[t];var r=this.mediaSourceBuffer[t];var n=this.segments;if(i.readyState==="ended"){if(this.ucvideo.IsRealPlay){this.ucvideo.jt1078.Send8890(this.ucvideo.Sim,this.ucvideo.Channel,3)}else{this.videodom=this.ucvideo.player.interface_player.CreateNewVideoDom();this.videodom.onended=this.onMediaEnded.bind(this);this._CreateNewMediaSource();this.videolist[this.mediaSource.length-1]=this.videodom;this.videodom.src=URL.createObjectURL(this.mediaSource[this.mediaSource.length-1]);this.videodom.playbackRate=this.playspeed;this.videodom.pause()}return}if(!i||i.readyState!=="open"){return}if(this.videodom.error){if(this.ucvideo.IsRealPlay){this.ucvideo.jt1078.Send8890(this.ucvideo.Sim,this.ucvideo.Channel,3)}this.segments=[];o.default.warn("video error code:"+this.videodom.error.code+" message:"+this.videodom.error.message);return}if(this.appending){return}if(!this.ucvideo.IsRealPlay){if(this.mediaSourceInfo[t].recvsize>this.ucvideo.config.usePlaybarFmp4SliceSize){i.endOfStream();this.videodom=this.ucvideo.player.interface_player.CreateNewVideoDom();this.videodom.onended=this.onMediaEnded.bind(this);this._CreateNewMediaSource();this.videolist[this.mediaSource.length-1]=this.videodom;this.videodom.src=URL.createObjectURL(this.mediaSource[this.mediaSource.length-1]);this.videodom.pause();return}}if(n&&n.length){var a=n.shift();try{this.appendedErr=false;r.appendBuffer(a.data);this.mediaSourceInfo[t].recvsize+=a.data.length;this.appendError=0;this.appended++;this.appending=true;this.RecordDataInput(a.data)}catch(e){n.unshift(a);if(e.code===22){}o.default.debug(e);this.appendedErr=true}}if(this.isFlush&&n.length==0){if(i.readyState==="open"&&!r.updating)i.endOfStream();return}}},{key:"getLastTime",value:function e(){var t=this.videodom.buffered;if(t.length===1){return t.end(t.length-1)}}},{key:"IEVersion",value:function e(){var t=navigator.userAgent;if(!!window.ActiveXObject||"ActiveXObject"in window)return"IE";else if(t.indexOf("Edge")>-1){return"Edge"}else{return"-1"}}},{key:"PlayerBarIsReady",value:function e(){return true}},{key:"PlayerBarGetLength",value:function e(){return this.endtime-this.starttime}},{key:"PlayerBarHaveBackupBuffer",value:function e(){return true}},{key:"PlayerBarBackupBufferGetBegin",value:function e(){return 0}},{key:"PlayerBarBackupBufferGetEnd",value:function e(){if(this.mediacurrentindex<0)return 0;var t=0;for(var i=0;i<this.mediacurrentindex;i++){var r=this.videolist[i].buffered;if(r.length==0)break;t+=r.end(r.length-1)*1e3}return t+this.videolist[this.mediacurrentindex].currentTime*1e3}},{key:"PlayerBarHaveFrameBuffer",value:function e(){return true}},{key:"PlayerBarFrameBufferGetBegin",value:function e(){if(this.mediacurrentindex<0)return 0;var t=0;for(var i=0;i<this.mediacurrentindex;i++){var r=this.videolist[i].buffered;if(r.length==0)break;t+=r.end(r.length-1)*1e3}return t+this.videolist[this.mediacurrentindex].currentTime*1e3+1}},{key:"PlayerBarFrameBufferGetEnd",value:function e(){var t=0;for(var i=0;i<this.videolist.length;i++){var r=this.videolist[i].buffered;if(r.length==0)break;t+=r.end(r.length-1)*1e3}return t}},{key:"PlayerBarSeek",value:function e(t){var i=0;var r=0;var n=0;for(;n<this.videolist.length;n++){var a=this.videolist[n].buffered;if(a.length==0)return;r+=a.end(a.length-1);if(t<r)break;i=r}if(n==this.videolist.length)return;if(n!=this.mediacurrentindex){this.ucvideo.player.interface_player.ChangeVideoDom(this.videolist[n]);this.mediacurrentindex=n}var s=this.videolist[n].buffered;if(s.length==0)return;if(t-i>s.end(s.length-1))return;this.videolist[n].currentTime=t-i;this.videolist[n].play()}},{key:"PlayerBarGetMultiple",value:function e(){return this.multiple}},{key:"Playing",get:function e(){return this.is_playing}}]);return r}(a.default);i.default=p},{"../../JX/JTT1078":89,"../../utils/logger.js":127,"../PlayerInterface.js":110}],105:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../../../lib/player/PlayerInterface");var a=p(n);var s=e("../../JX/JTT1078");var f=p(s);var o=e("../../utils/logger.js");var c=p(o);var d=e("../../utils/trafficStat");var l=p(d);var u=e("../../utils/bytes.js");var h=p(u);function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function v(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function y(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var g=function(e){y(n,e);function n(e,t,i){m(this,n);var r=v(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t));r.ucvideo=e;r.videodom=t;r.req_id=i;r.is_playing=false;r._requestAbort=false;r._receivedLength=0;r._fmp4muxer_id=-1;r._firstmsg=true;r._WaitIFrame=true;r._isaudioinit=false;r.trafficStat=new l.default;r.mediaSource=null;r.mediaSourceBuffer=null;r.mediaSourceBufferArray={};r.segments=[];r.appended=0;r.appending=false;r.appendedErr=false;r.onsbue=r.onSourceBufferUpdateEnd.bind(r);r.onmso=r.onMediaSourceOpen.bind(r);r.onmse=r.onMediaSourceEnded.bind(r);r.onmsc=r.onMediaSourceClose.bind(r);r.bytes=new h.default;r.frame_combine=new h.default;r.fmp4header1=null;r.fmp4header2=null;r.last_time=0;return r}r(n,[{key:"GetFmp4ID",value:function e(){return this._fmp4muxer_id}},{key:"GetFisrtMsg",value:function e(){return this._firstmsg}},{key:"GovPlay",value:function e(t,i){this.fmp4header1=null;this.fmp4header2=null;this._firstmsg=true;this._lastRecTime=(new Date).getTime();c.default.custom("Gov","StartVideo url:"+t);this.controller=new AbortController;this._mh=this.ucvideo.config.protocol==0?30:34;this._FetchImpl(t,i)}},{key:"Check",value:function e(){if(this._receivedLength>0&&(new Date).getTime()-this._lastRecTime>this.ucvideo.config.govTimeoutMsec){this._requestAbort=true;this.Flush();this.controller.abort();this.ucvideo.SetShowKBps(false,this.ucvideo.config.language.connect_down,this.req_id)}}},{key:"StopVideo",value:function e(){c.default.custom("Gov","StopVideos");this._requestAbort=true;this.Flush();this.controller.abort();if(this.is_playing){if(this.mediaSourceBuffer){this.mediaSourceBuffer=null}if(this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onmso);this.mediaSource.removeEventListener("sourceended",this.onmse);this.mediaSource.removeEventListener("sourceclose",this.onmsc);this.mediaSource=null}this.is_playing=false;this.segments=[];this.videodom.src=null}if(this._fmp4muxer_id>=0){CvNetVideo.WasmId2Uc.v[this._fmp4muxer_id]=null;var t=this._fmp4muxer_id;this._fmp4muxer_id=-1;CvNetVideo.WASM.FMp4MuxClear(t)}}},{key:"RecordStart",value:function e(t){this.is_recording=true;this.recoder=t}},{key:"RecordDataInput",value:function e(t){if(!this.is_recording)return;if(this.fmp4header1==null||this.fmp4header2==null)return;if(!this.record_id){this.record_id=CvNetVideo.WASM.CreateRecordFmp4FromFmp4();CvNetVideo.WasmId2Uc.r[this.record_id]=this.recoder;CvNetVideo.WASM.RecordFmp4FromFmp4Input(this.record_id,this.fmp4header1.data,this.fmp4header1.data.length);CvNetVideo.WASM.RecordFmp4FromFmp4Input(this.record_id,this.fmp4header2.data,this.fmp4header2.data.length)}CvNetVideo.WASM.RecordFmp4FromFmp4Input(this.record_id,t,t.length)}},{key:"RecordStop",value:function e(){this.is_recording=false;if(this.record_id){CvNetVideo.WASM.RecordFmp4FromFmp4Clear(this.record_id);this.record_id=null}}},{key:"onBufferAppending",value:function e(t){if(t.data[0]==0&&t.data[1]==0&&t.data[2]==1&&t.data[3]==153){if(t.data[4]==136&&t.data[5]==128){var i=new f.default.ExtendRefuse;i.FillByBinary(t.data,6,t.data.length);this.StopPlay();this.LoadingPage(true,i.Reason)}}else{if(this.mediaSource==null)return;if(this.fmp4header1==null){this.fmp4header1=t}else if(this.fmp4header2==null){this.fmp4header2=t}if(!this.segments){this.segments=[t]}else{this.segments.push(t)}if(this.smoothCheck&&this.ucvideo.config.smoothMode){var r=parseInt(this.ucvideo.config.smoothMode);if(isNaN(r)){r=15}if(this.segments.length<r){return}}this.smoothCheck=false;this.doAppending()}}},{key:"onBufferReset",value:function e(t){c.default.custom("Gov","onBufferReset");this._firstmsg=false;this.mimeType=t.mimeType;this.smoothCheck=true;this.StartVide()}},{key:"onMediaWaiting",value:function e(){if(this.appendedErr&&!this.appending){this.doAppending()}this.smoothCheck=true;if(this.videodom.playbackRate>1){this.videodom.playbackRate=1;this.ucvideo.player.interface_player.seek2last()}}},{key:"StartVide",value:function e(){this.is_playing=true;if(this.mediaSourceBuffer){this.mediaSourceBuffer=null}if(this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onmso);this.mediaSource.removeEventListener("sourceended",this.onmse);this.mediaSource.removeEventListener("sourceclose",this.onmsc);this.mediaSource=null}this.mediaSource=new MediaSource;this.mediaSource.addEventListener("sourceopen",this.onmso);this.mediaSource.addEventListener("sourceended",this.onmse);this.mediaSource.addEventListener("sourceclose",this.onmsc);this.videodom.src=URL.createObjectURL(this.mediaSource);if(this.IEVersion()=="IE")this.videodom.play()}},{key:"onMediaSourceOpen",value:function e(){if(!this.mediaSource||this.mediaSource.readyState!=="open"){return}c.default.custom("Gov","media source open");this.createSourceBuffers({tracks:"video",mimeType:this.mimeType})}},{key:"onMediaSourceClose",value:function e(){c.default.custom("Gov","media source close")}},{key:"onMediaSourceEnded",value:function e(){c.default.custom("Gov","media source ended")}},{key:"onSourceBufferUpdateEnd",value:function e(t){this.appending=false;this.doAppending()}},{key:"onMediaTimeUpdate",value:function e(){if(this.ucvideo.config.events.onTimeStamp){var t=Math.round(this.videodom.currentTime*1e3);if(this.last_time!=t){this.ucvideo.config.events.onTimeStamp(this.ucvideo.video_id,t);this.last_time=t}}}},{key:"createSourceBuffers",value:function e(t){var i=this.mediaSourceBufferArray,r=this.mediaSource;var n=void 0;if(t.mimeType===""){n="video/mp4;codecs=avc1.42c01e,mp4a.40.2"}else{n="video/mp4;codecs="+t.mimeType}try{this.mediaSourceBuffer=i["video"]=r.addSourceBuffer(n);this.mediaSourceBuffer.mode="sequence";this.mediaSourceBuffer.addEventListener("updateend",this.onsbue)}catch(e){this.mediaSourceBuffer=null;console.error(e)}this.ucvideo.trigger(Event.BUFFER_CREATED,{tracks:t});this.videodom.play()}},{key:"doAppending",value:function e(){if(!this.mediaSource||this.mediaSource.readyState!=="open"){return}this.ucvideo.player.interface_player.seekcheck();var t=this.ucvideo,i=this.mediaSourceBufferArray,r=this.segments;if(Object.keys(i).length){if(this.videodom.error){this.segments=[];c.default.warn("video error code:"+this.videodom.error.code+" message:"+this.videodom.error.message);this._RestartMSE();return}if(this.appending){return}if(r&&r.length){var n=r.shift();try{this.appendedErr=false;if(i[n.type]){this.parent=n.parent;i[n.type].appendBuffer(n.data);this.appendError=0;this.appended++;this.appending=true;this.RecordDataInput(n.data)}else{}}catch(e){r.unshift(n);c.default.debug(e);this.appendedErr=true}}}}},{key:"IEVersion",value:function e(){var t=navigator.userAgent;if(!!window.ActiveXObject||"ActiveXObject"in window)return"IE";else if(t.indexOf("Edge")>-1){return"Edge"}else{return"-1"}}},{key:"_RestartMSE",value:function e(){this.segments=[];if(this.mediaSourceBuffer){this.mediaSourceBuffer=null}if(this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onmso);this.mediaSource.removeEventListener("sourceended",this.onmse);this.mediaSource.removeEventListener("sourceclose",this.onmsc);this.mediaSource=null}this.videodom.src=null;if(this._fmp4muxer_id>=0){CvNetVideo.WasmId2Uc.v[this._fmp4muxer_id]=null;var t=this._fmp4muxer_id;this._fmp4muxer_id=-1;setTimeout(function(){CvNetVideo.WASM.FMp4MuxClear(t)},1e3)}this._WaitIFrame=true;this._firstmsg=true;this._isaudioinit=false}},{key:"_FetchImpl",value:function e(t,i){var r=this;var n={method:"GET",mode:"cors",cache:"no-cache",referrerPolicy:"no-referrer-when-downgrade",signal:this.controller.signal};this._receivedLength=0;this._requestAbort=false;this._isaudioinit=false;this._firstPkg=true;this._sim20=this.ucvideo.config.protocol!=0;this._mh=this._sim20?34:30;fetch(t,n).then(function(e){if(e.ok&&e.status>=200&&e.status<=299){var t=e.body.getReader();r._pump(t,i)}else{if(i){i(-2,r.ucvideo.config.language.gov_player_http_request_failed)}}}).catch(function(e){if(i){c.default.custom("Gov","fetch error",e);i(-1,r.ucvideo.config.language.gov_player_http_request_error)}})}},{key:"Flush",value:function e(){if(this.mediaSource&&this.mediaSource.readyState=="open"){this.mediaSource.endOfStream()}}},{key:"_pump",value:function e(d,l){var u=this;return d.read().then(function(e){if(e.done){u.Flush()}else{if(u._requestAbort===true){u._requestAbort=false;u.Flush();return d.cancel()}u._lastRecTime=(new Date).getTime();var t=e.value;u.trafficStat.addbytes(t.byteLength);u._receivedLength+=t.byteLength;u.bytes.push(t);var i=u.ucvideo.config.maxRtpLen;while(u.bytes.byteLength>u._mh){var r=new f.default.JTRTHead;r.Sim20=u._sim20;var n=null;var a=null;var s=u.bytes.take(u._mh,0,false);if(s){r.FillByBinary(s,0,u._mh);if(u._firstPkg){if(r.DLen>i){u._firstPkg=false;u._sim20=!u._sim20;u._mh=u._sim20?34:30;continue}else if(u.bytes.byteLength>=r.BinaryDataLen+r.DLen+4){u._firstPkg=false;var o=u.bytes.take(4,r.BinaryDataLen+r.DLen,false);if(o[0]==48&&o[1]==49&&o[2]==99&&o[3]==100){n=u.bytes.take(r.DLen,r.BinaryDataLen)}else{u._sim20=!u._sim20;u._mh=u._sim20?34:30;continue}}}else if(u.bytes.byteLength>=r.BinaryDataLen+r.DLen){n=u.bytes.take(r.DLen,r.BinaryDataLen)}}if(n!=null){if(r.YYYY==0){a=n}else if(r.YYYY==1){u.frame_combine.clear();u.frame_combine.push(n,n.length);continue}else if(r.YYYY==2){u.frame_combine.push(n,n.length);a=u.frame_combine.combine()}else if(r.YYYY==3){u.frame_combine.push(n,n.length);continue}else{continue}if(r.PT===CvNetVideo.WASM.JX_H264||r.PT===CvNetVideo.WASM.JX_H265){if(u._fmp4muxer_id<0){u._WaitIFrame=true;u._fmp4muxer_id=CvNetVideo.WASM.CreateFMp4Muxer(r.PT);if(u._fmp4muxer_id==-101){if(l){l(-101,u.ucvideo.config.language.gov_player_limited_connection)}u.Flush();return d.cancel()}else if(u._fmp4muxer_id>=0){CvNetVideo.WasmId2Uc.v[u._fmp4muxer_id]=u.ucvideo}}if(u._fmp4muxer_id>=0){if(u._WaitIFrame){if(r.XXXX==0){u._WaitIFrame=false}}if(!u._WaitIFrame){var c=CvNetVideo.WASM.FMp4InputVideo(u._fmp4muxer_id,a,a.length,r.RTTimeSpan.high,r.RTTimeSpan.low,r.XXXX,r.DtsDiff);if(c==-102){if(l){l(-102,u.ucvideo.config.language.gov_player_limited_play_time)}u.Flush();return d.cancel()}}}}else if(r.PT==CvNetVideo.WASM.JX_ADPCMA||r.PT==CvNetVideo.WASM.JX_G711A||r.PT==CvNetVideo.WASM.JX_G711U||r.PT==CvNetVideo.WASM.JX_G726||r.PT==CvNetVideo.WASM.JX_AAC){if(u._fmp4muxer_id>=0){if(!u._isaudioinit){if(r.PT==CvNetVideo.WASM.JX_G726){r.PT=CvNetVideo.g726_conf.getPT(r.DLen)}CvNetVideo.WASM.FMp4SetAudioInfo(u._fmp4muxer_id,8e3,16,1,r.PT);u._isaudioinit=true}CvNetVideo.WASM.FMp4InputAudio(u._fmp4muxer_id,a,a.length,r.RTTimeSpan.high,r.RTTimeSpan.low)}}}else{break}}if(u.bytes.byteLength>=i){if(l){l(-103,u.ucvideo.config.language.gov_player_protocol_error)}u.Flush();return d.cancel()}u._pump(d,l)}}).catch(function(e){u.Flush();u._receivedLength=0;if(!u._requestAbort){throw e}})}},{key:"Playing",get:function e(){return this.is_playing}}]);return n}(a.default);i.default=g},{"../../../lib/player/PlayerInterface":1,"../../JX/JTT1078":89,"../../utils/bytes.js":124,"../../utils/logger.js":127,"../../utils/trafficStat":130}],106:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../PlayerInterface.js");var a=l(r);var s=e("../../utils/logger.js");var o=l(s);var c=e("../../utils/cvComm");var d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var p=function(e){h(r,e);function r(e,t){u(this,r);var i=f(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));i.wfs=e;i.videodom=t;i.time_id=-1;i.is_playing=false;i.StartID=0;return i}n(r,[{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.is_playing=true;this.Sim=t;this.Channel=i;if(!this.onlyGetPullUrl){this.videodom.src=this.hls_url;this.videodom.play()}this.StartHeartbeat()}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;this.is_playing=true;this.Sim=t;this.Channel=i;if(!this.onlyGetPullUrl){this.videodom.src=this.hls_url;this.videodom.play()}this.StartHeartbeat()}},{key:"StopVideo",value:function e(){this.is_playing=false;if(this.videodom){this.videodom.src=null}this.hls_url=null;this.StopHeartbeat()}},{key:"onMediaError",value:function e(){if(this.hls_url!=null&&this.hls_url!="undefined"){var t=this.StartID;setTimeout(function(){if(t==this.StartID)this.StartRealTimeVideo(this.Sim,this.Channel)}.bind(this),2e3)}}},{key:"onHlsInfo",value:function e(t){this.hls_url_http=t.HlsAddr;this.hls_url_https=t.HlsHttpsAddr;this.rtmp_url=t.ServerAddr;this.clientid=t.ClinetID;if(d.default.IsHttps()&&this.hls_url_https){this.hls_url=this.hls_url_https}else{this.hls_url=this.hls_url_http}o.default.custom("hls","hls url:%s",t.hls_url);if(this.wfs.config.events&&this.wfs.config.events.onHlsPlay){var i="mytv";var r=1935;var n=/rtmp:\/\/[^\/:]+:(\d+)\/([^\/]+)\//.exec(t.ServerAddr);if(n.length>1){r=n[1];i=n[2]}this.onlyGetPullUrl=this.wfs.config.events.onHlsPlay(this.wfs.video_id,this.wfs,t.HlsAddr,t.HlsHttpsAddr,t.ServerAddr,t.ClinetID,this.hls2flvurl(t.HlsAddr,i,r),this.hls2flvurl(t.HlsHttpsAddr,i,r));if(this.onlyGetPullUrl==null){this.onlyGetPullUrl=false}}}},{key:"hls2flvurl",value:function e(t,i,r){var n=/(http(s){0,1}:\/\/[^\/]+\/)hls\/(.+)\.m3u8/.exec(t);return n[1]+"live.flv?port="+r+"&app="+i+"&stream="+n[3]}},{key:"StartHeartbeat",value:function e(){this.StartID++;if(this.time_id===-1){this.time_id=setInterval(this.SendHeartbeatPackage.bind(this),1e3*5)}}},{key:"StopHeartbeat",value:function e(){clearInterval(this.time_id);this.time_id=-1;this.StartID++}},{key:"SendHeartbeatPackage",value:function e(){this.wfs.jt1078.SendHeartRtmp(this.Sim,this.Channel,this.rtmp_url,this.clientid)}},{key:"Playing",get:function e(){return this.is_playing}}]);return r}(a.default);i.default=p},{"../../utils/cvComm":125,"../../utils/logger.js":127,"../PlayerInterface.js":110}],107:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../../helper/ByteHelper");var l=C(n);var a=e("../../utils/logger");var o=C(a);var s=e("../VideoRecorder");var u=C(s);var c=e("../Wasm/WasmPlayer");var f=C(c);var d=e("../Wasm/WasmPlayerBW");var h=C(d);var p=e("../WebCodec/WebCodecPlayer");var m=C(p);var v=e("../PlayerMan");var y=C(v);var g=e("../../utils/cvComm");var _=C(g);var b=e("./interface_player_bar");var w=C(b);var S=e("../Wasm/WasmVideoPlayerBWImpl.js");var k=C(S);function C(e){return e&&e.__esModule?e:{default:e}}function T(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var P=function(){function d(e,r,t){var n=this;T(this,d);this.ucVideo=e;this.config=r;this.playerman=t;this.is_playing=false;this.is_real=true;this.is_real_or_back=true;this.start_time_minute_back=0;this.back_drag=false;this.is_cursor_in_dom=false;this.timer_audioscrollhide=-1;this.audioscroll_offsettop=75;this.audioscroll_height=60;this.isCanvas=false;this.interfaceplayerbar=new w.default(this,r);this._is_selected=false;if(e.ucMain.Container){this.video_index=e.ucMain.Container.childElementCount;var i="";{i+="<div class='video-div-rotate' id='video-div-rotate"+this.video_index+"'>                     <video class=\"video-body\" wmode='Opaque' preload='none' id='videoBody-"+this.video_index+"'></video>                     <canvas class=\"video-body hide\" id='canvasBody-"+this.video_index+"'></canvas>                     <canvas class=\"video-body hide\" id='canvasWebCodec-"+this.video_index+"'></canvas></div>";i+="<div class='video-control-real hide' id='video-control-real-"+this.video_index+"'>";{i+="<div class='playbackbarloader'id='PlayBackBarLoader-"+this.video_index+"'>";{i+="<div class='playbackbarbackgroud hide' id='PlayBackBarBackgroud-"+this.video_index+"'></div>";i+="<div class='playbackbarplayed hide' id='PlayBackBarPlayed-"+this.video_index+"'></div>";i+="<div class='playbackbarplaying hide' id='PlayBackBarPlaying-"+this.video_index+"'></div>";i+="<div class='playbackbarslide hide' id='PlayBackBarSlide-"+this.video_index+"'></div>"}i+="</div>";i+='<div class="video-control-real-bg pull-left fontzero control-leftview">';{i+="<div title="+this.config.language.control_tip_refresh+' class="control-btn loadbtn" id=\'loadBtn-'+this.video_index+"'></div>";i+="<div title="+this.config.language.control_tip_play+' class="control-btn playpausebtn" id=\'playPauseBtn-'+this.video_index+"'></div>";i+="<div title="+this.config.language.control_tip_stop+' class="control-btn stopbtn" id=\'stopBtn-'+this.video_index+"'></div>";i+="<div title="+this.config.language.control_tip_sound+' class="control-btn mutedbtn" id=\'mutedBtn-'+this.video_index+"'></div>";i+="<div class='bufferbarbackgroud hide' id='bufferBarbackground-"+this.video_index+"'></div>";i+="<div class='bufferbar hide' id='bufferBar-"+this.video_index+"'></div>";i+="<div class='currentbar hide' id='currentBar-"+this.video_index+"'></div>";i+="<div class='drawbar hide' id='drawBar-"+this.video_index+"'></div>";i+="<div title="+this.config.language.control_tip_screen_full+' class="control-btn fullscreenbtn" id=\'fullScreenBtn-'+this.video_index+"'></div>";i+="<div title="+this.config.language.control_tip_capture+' class="control-btn capturebtn" id=\'captureBtn-'+this.video_index+"'></div>";i+="<div title="+this.config.language.control_tip_record+' class="control-btn recorderbtn" id=\'recorderBtn-'+this.video_index+"'></div>";i+="<div title="+this.config.language.control_tip_stretch+' class="control-btn stretchbtn" id=\'stretchBtn-'+this.video_index+"'></div>";if(r.addButtons){for(var a=0;a<r.addButtons.length;a++){i+="<div title='"+r.addButtons[a].title+"' class='"+r.addButtons[a].class+"' id='addButton"+a+"-"+this.video_index+"'></div>"}}}i+="</div>"}i+="</div>";i+="<div class='video-time-rule hide' id='video-time-rule-"+this.video_index+"'>";{i+="<div class='video-time-day' id='time-day-"+this.video_index+"'>";{for(var s=0;s<60*24;s++){if(s<0){i+="<div class='video-time-minute active' id='video-time-minute"+s+"-"+this.video_index+"'></div>"}else{i+="<div class='video-time-minute' id='video-time-minute"+s+"-"+this.video_index+"'></div > "}}i+="<div class='video-time-hour-first'>00:00</div>";i+="<div class='video-time-hour'>01:00</div>";i+="<div class='video-time-hour'>02:00</div>";i+="<div class='video-time-hour'>03:00</div>";i+="<div class='video-time-hour'>04:00</div>";i+="<div class='video-time-hour'>05:00</div>";i+="<div class='video-time-hour'>06:00</div>";i+="<div class='video-time-hour'>07:00</div>";i+="<div class='video-time-hour'>08:00</div>";i+="<div class='video-time-hour'>09:00</div>";i+="<div class='video-time-hour'>10:00</div>";i+="<div class='video-time-hour'>11:00</div>";i+="<div class='video-time-hour'>12:00</div>";i+="<div class='video-time-hour'>13:00</div>";i+="<div class='video-time-hour'>14:00</div>";i+="<div class='video-time-hour'>15:00</div>";i+="<div class='video-time-hour'>16:00</div>";i+="<div class='video-time-hour'>17:00</div>";i+="<div class='video-time-hour'>18:00</div>";i+="<div class='video-time-hour'>19:00</div>";i+="<div class='video-time-hour'>20:00</div>";i+="<div class='video-time-hour'>21:00</div>";i+="<div class='video-time-hour'>22:00</div>";i+="<div class='video-time-hour'>23:00</div>"}i+="</div>";i+="<div class='video-time-cursor' id='video-time-cursor-body-"+this.video_index+"'>";i+="<div class='video-time-cursor-text' id='video-time-cursor-"+this.video_index+"'>00:00:00</div >";i+="</div> "}i+="</div>";i+="<div class='video-waiting-page hide' id='video-waiting-page-"+this.video_index+"'>";i+="<div class='video-loading-btn'></div>";i+="<div class='video-loading-text' id='video-loading-text-"+this.video_index+"'>"+this.config.language.loading_page_wait_video+"</div>";i+="</div>";i+="<div class='video-osd-text hide' id='video-osd-text-"+this.video_index+"'>";i+="</div>";i+="<div class='video-kbps-text' id='video-kbps-text-"+this.video_index+"'>";i+="</div>";i+="<div class='video-record-text' id='video-record-text-"+this.video_index+"'>";i+="</div>"}this.video_div=document.createElement("div");this.video_div.classList.add("video-box-body");this.video_div.draggable=true;this.video_div.style.zIndex=this.video_index+1;this.video_div.ondrop=this.ondrop.bind(this);this.video_div.ondragstart=this.ondragstart.bind(this);this.video_div.ondragover=this.ondragover.bind(this);this.video_div.ondragend=this.ondragend.bind(this);this.video_div.innerHTML=i;if(e.ucMain.Container.append){e.ucMain.Container.append(this.video_div)}else{e.ucMain.Container.appendChild(this.video_div)}this.video=this.video_div.querySelector("#videoBody-"+this.video_index);this.canvas=this.video_div.querySelector("#canvasBody-"+this.video_index);this.canvas_webcodec=this.video_div.querySelector("#canvasWebCodec-"+this.video_index);if(r.useWasmWebWorker&&r.useoffcanvas){if(this.canvas.transferControlToOffscreen!=undefined){this.offcanvas=this.canvas.transferControlToOffscreen()}}this.playbackbarloader=this.video_div.querySelector("#PlayBackBarLoader-"+this.video_index);this.playbackbarbackgroud=this.video_div.querySelector("#PlayBackBarBackgroud-"+this.video_index);this.playbackbarplayed=this.video_div.querySelector("#PlayBackBarPlayed-"+this.video_index);this.playbackbarplaying=this.video_div.querySelector("#PlayBackBarPlaying-"+this.video_index);this.playbackbarslide=this.video_div.querySelector("#PlayBackBarSlide-"+this.video_index);this.btn_mute=this.video_div.querySelector("#mutedBtn-"+this.video_index);this.btn_fullscreen=this.video_div.querySelector("#fullScreenBtn-"+this.video_index);this.btn_playorpause=this.video_div.querySelector("#playPauseBtn-"+this.video_index);this.btn_stretch=this.video_div.querySelector("#stretchBtn-"+this.video_index);this.scroll_thumb=this.video_div.querySelector("#drawBar-"+this.video_index);this.scroll_bar=this.video_div.querySelector("#currentBar-"+this.video_index);this.scroll_bar_background=this.video_div.querySelector("#bufferBar-"+this.video_index);this.scroll_bar_background_bg=this.video_div.querySelector("#bufferBarbackground-"+this.video_index);this.playback_bar=this.video_div.querySelector("#drawPlayBackBar-"+this.video_index);this.osd_text=this.video_div.querySelector("#video-osd-text-"+this.video_index);this.osd_text.innerText="";this.kbps_text=this.video_div.querySelector("#video-kbps-text-"+this.video_index);this.kbps_text.innerText="";this.record_text=this.video_div.querySelector("#video-record-text-"+this.video_index);this.record_text.innerText="";this.btn_recorder=this.video_div.querySelector("#recorderBtn-"+this.video_index);this.video_div.onmouseenter=this.onPlayerMouseEnter.bind(this);this.video_div.onmouseleave=this.onPlayerMouseLeave.bind(this);this.video.oncontextmenu=this.onContextMenu.bind(this);this.canvas.oncontextmenu=this.onContextMenu.bind(this);this.canvas_webcodec.oncontextmenu=this.onContextMenu.bind(this);this.btn_mute.onclick=this.onClickedMutedBtn.bind(this);this.btn_mute.onmouseenter=this.onClickedMutedBtnEnter.bind(this);this.btn_mute.onmouseleave=this.onClickedMutedBtnLeave.bind(this);this.btn_fullscreen.onclick=this.onClickedFullScreenBar.bind(this);this.scroll_bar_background_bg.onmouseenter=this.onAudioScrollEnter.bind(this);this.scroll_bar_background_bg.onmouseleave=this.onAudioScrollLeave.bind(this);this.scroll_bar_background.onmousedown=this.onVolumeMouseDown.bind(this);this.scroll_bar_background.onmouseenter=this.onAudioScrollEnter.bind(this);this.scroll_bar_background.onmouseleave=this.onAudioScrollLeave.bind(this);this.scroll_thumb.onmousedown=this.onScrollThumbMouseEvent.bind(this);this.scroll_thumb.onmouseenter=this.onAudioScrollEnter.bind(this);this.scroll_thumb.onmouseleave=this.onAudioScrollLeave.bind(this);this.btn_playorpause.onclick=this.onClickedPlayPauseBtn.bind(this);this.btn_stretch.onclick=this.onClickedStretchBtn.bind(this);this.btn_recorder.onclick=this.onClickedRecorderBtn.bind(this);this.video_div.querySelector("#loadBtn-"+this.video_index).onclick=this.onClickedLoadBtn.bind(this);this.video_div.querySelector("#captureBtn-"+this.video_index).onclick=this.onClickedCaptureBtn.bind(this);this.video_div.querySelector("#stopBtn-"+this.video_index).onclick=this.onClickedStopBtn.bind(this);this.real_controlbar=this.video_div.querySelector("#video-control-real-"+this.video_index);this.real_controlbar.classList.add("disable");this.real_controlbar.onclick=this.onPlayerBarClicked.bind(this);this.controlbar_enable=false;this.playbackbarloader.onmouseenter=this.interfaceplayerbar.onBackgroudMouseEnter.bind(this.interfaceplayerbar);this.playbackbarloader.onmouseleave=this.interfaceplayerbar.onBackgroudMouseLeave.bind(this.interfaceplayerbar);this.playbackbarbackgroud.onmousedown=this.interfaceplayerbar.onBackgroudMouseDown.bind(this.interfaceplayerbar);this.playbackbarslide.onmousedown=this.interfaceplayerbar.onBackgroudMouseDown.bind(this.interfaceplayerbar);this.playbackbarslide.onmouseenter=this.interfaceplayerbar.onBackgroudMouseEnter.bind(this.interfaceplayerbar);this.playbackbarslide.onmouseleave=this.interfaceplayerbar.onBackgroudMouseLeave.bind(this.interfaceplayerbar);this.time_rule_body=this.video_div.querySelector("#video-time-rule-"+this.video_index);this.time_day=this.video_div.querySelector("#time-day-"+this.video_index);this.cursor=this.video_div.querySelector("#video-time-cursor-"+this.video_index);this.cursor_body=this.video_div.querySelector("#video-time-cursor-body-"+this.video_index);this.time_day.ondblclick=this.onTimeDayDBClicked.bind(this);this.time_day.onmousedown=this.onTimeDayMouseEvent.bind(this);this.cursor.onmousedown=this.onCursorMouseEvent.bind(this);if(r.addButtons){var o=function e(t){var i=t;n.video_div.querySelector("#addButton"+t+"-"+n.video_index).onclick=function(){r.addButtons[t].onClicked(this.video_index)}.bind(n)};for(var c=0;c<r.addButtons.length;c++){o(c)}}this.video_rotate=this.video_div.querySelector("#video-div-rotate"+this.video_index);this.rotate=0;this.mirrorinver=false;this.loading_page=this.video_div.querySelector("#video-waiting-page-"+this.video_index);this.loading_text=this.video_div.querySelector("#video-loading-text-"+this.video_index);this.loading_page.oncontextmenu=this.onContextMenuCatchPage.bind(this);this.video.style.objectFit="fill";this.btn_stretch.classList.add("off");this.onwindowclicked=function e(){this.ucVideo.ucMain.menu.classList.remove("active")}.bind(this);this.onwindowresize=function e(){if(!_.default.IsFullscreen(this.video_div)){this.video_div.classList.remove("full");this.btn_fullscreen.classList.remove("off");if(this.rotate==0){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==90){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px"}else if(this.rotate==180){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==270){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px"}}}.bind(this);window.addEventListener("click",this.onwindowclicked);window.addEventListener("resize",this.onwindowresize);this.video.muted=true;this.btn_mute.classList.add("off");this.videoRecorder=new u.default(this,function(e){if(e){this.btn_recorder.classList.add("off")}else{this.btn_recorder.classList.remove("off");this.record_text.innerText=""}}.bind(this));this.videoDblclick=function(e){var t=this.config.events&&this.config.events.onUcDbclick&&this.config.events.onUcDbclick(this.ucVideo.video_id,this.ucVideo)?false:this.config.enableDbcZoom;if(t){if(this.ucVideo.ucMain.Zoomed){this.ucVideo.ucMain.UnZoomUC()}else this.ucVideo.ucMain.ZoomUC(0)}}.bind(this);this.video.addEventListener("dblclick",this.videoDblclick);this.canvas.addEventListener("dblclick",this.videoDblclick);this.canvas_webcodec.addEventListener("dblclick",this.videoDblclick);this.wasmplayer=null;this.webcodecplayer=null;this.wasm_video_player=new k.default(this.config,this.canvas,this)}}r(d,[{key:"CreateNewVideoDom",value:function e(){this.videonew=document.createElement("video");this.videonew.id="videoBody-"+this.video_index;this.videonew.classList.add("video-body");this.videonew.preload="none";this.videonew.oncontextmenu=this.onContextMenu.bind(this);this.videonew.style.objectFit="fill";this.videonew.muted=true;if(this.config.enableDbcZoom){this.videonew.addEventListener("dblclick",this.videoDblclick)}return this.videonew}},{key:"ChangeVideoDom",value:function e(t){this.video.remove();this.video_rotate.append(t);this.video=t;this.ucVideo.player.onChangeVideoDom(this.video,t)}},{key:"StartPlay",value:function e(){this.is_playing=true;this.interfaceplayerbar.Clear();if(this.video){this.LoadingPage(true,this.config.language.loading_page_wait_video);this.real_controlbar.classList.remove("disable");this.btn_playorpause.classList.add("off")}if(this.is_cursor_in_dom)this.onPlayerMouseEnter()}},{key:"StopPlay",value:function e(){this.is_playing=false;if(this.video){this.LoadingPage(false);this.real_controlbar.classList.add("disable");this.controlbar_enable=false;setTimeout(function(){if(!this.controlbar_enable)this.real_controlbar.classList.add("hide")}.bind(this),300);this.videoRecorder.stop()}if(this.wasmplayer)this.wasmplayer.StopVideo();if(this.webcodecplayer)this.webcodecplayer.StopVideo()}},{key:"QueryVideoListBegin",value:function e(){for(var t=0;t<60*24;t++){this.video_div.querySelector("#video-time-minute"+t+"-"+this.video_index).classList.remove("active")}if(!this.is_real_or_back){this.LoadingPage(true,this.config.language.loading_page_wait_search_record)}}},{key:"AddVideoList",value:function e(t,i,r){this.video_list=t;this.start_time=i;this.end_time=r;for(var n=0;n<t.FileList.length;n++){var a=l.default.StringTimeToUnixLong(t.FileList[n].StartTime);var s=l.default.StringTimeToUnixLong(t.FileList[n].EndTime);var o=parseInt((a-i)/60);var c=parseInt((s-i)/60);o=o<0?0:o;if(c>o){for(var d=o;d<c;d++){if(d<60*24){this.video_div.querySelector("#video-time-minute"+d+"-"+this.video_index).classList.add("active")}}}}this.LoadingPage(false)}},{key:"WasmPlayerSetVolume",value:function e(){if(this.wasmplayer){if(this.video.muted)this.wasmplayer.SetVolume(0);else this.wasmplayer.SetVolume(this.video.volume)}if(this.webcodecplayer){if(this.video.muted)this.webcodecplayer.SetVolume(0);else this.webcodecplayer.SetVolume(this.video.volume)}}},{key:"SwitchVideoOrCanvas",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(t){this.video.classList.remove("hide");this.canvas.classList.add("hide");this.canvas_webcodec.classList.add("hide");this.is_real=i;if(!this.is_real&&this.ucVideo.playermode==y.default.PlayerMode.Fmp4&&this.ucVideo.config.usePlaybar){this.playbackbarbackgroud.classList.remove("hide");this.playbackbarplayed.classList.remove("hide");this.playbackbarplaying.classList.remove("hide");this.interfaceplayerbar.Clear()}else{this.playbackbarbackgroud.classList.add("hide");this.playbackbarplayed.classList.add("hide");this.playbackbarplaying.classList.add("hide")}}else{this.video.classList.add("hide");this.is_real=i;if(this.is_real||!this.ucVideo.config.usePlaybar){this.playbackbarbackgroud.classList.add("hide");this.playbackbarplayed.classList.add("hide");this.playbackbarplaying.classList.add("hide")}else{this.playbackbarbackgroud.classList.remove("hide");this.playbackbarplayed.classList.remove("hide");this.playbackbarplaying.classList.remove("hide");this.interfaceplayerbar.Clear()}this.is_wasmorwebcodec=r;if(r){this.canvas.classList.remove("hide");this.canvas_webcodec.classList.add("hide");this.isCanvasWebCodec=false;if(this.wasmplayer==null){if(this.config.useWasmWebWorker)this.wasmplayer=new h.default(this.ucVideo,this.canvas,this,this.wasm_video_player);else this.wasmplayer=new f.default(this.ucVideo,this.canvas,this);this.wasmplayer.SetWhetherPlayAudio(this._is_selected)}this.WasmPlayerSetVolume()}else{this.canvas.classList.add("hide");this.canvas_webcodec.classList.remove("hide");this.isCanvasWebCodec=true;this.webcodecplayer=new m.default(this.ucVideo,this.canvas_webcodec,this,this.wasm_video_player,function(){this.isCanvasWebCodec=false;this.canvas.classList.remove("hide");this.canvas_webcodec.classList.add("hide")}.bind(this));this.webcodecplayer.SetWhetherPlayAudio(this._is_selected);this.WasmPlayerSetVolume()}}this.isCanvas=!t}},{key:"GetVideoOrCanvas",value:function e(){if(this.isCanvas){return this.GetCanvas()}else{return this.GetVideo()}}},{key:"GetVideo",value:function e(){return this.video}},{key:"GetCanvas",value:function e(){if(this.isCanvasWebCodec){return this.canvas_webcodec}else{return this.canvas}}},{key:"GetOffCancas",value:function e(){return this.offcanvas}},{key:"SetSelected",value:function e(t){this._is_selected=t;if(this.wasmplayer){this.wasmplayer.SetWhetherPlayAudio(this._is_selected)}if(this.webcodecplayer){this.webcodecplayer.SetWhetherPlayAudio(this._is_selected)}if(t){if(this.config.unmuteBySelected){this.SetMuted(false)}}else{this.SetMuted(true)}}},{key:"SetMuted",value:function e(t){if(this.video){if(t===this.video.muted)return;if(this.video.muted){this.video.muted=false;this.btn_mute.classList.remove("off")}else{this.video.muted=true;this.btn_mute.classList.add("off")}this.updateAudioScrollLocation();this.WasmPlayerSetVolume()}}},{key:"Capture",value:function e(t,i,r){if(!this.is_playing)return;if(i==null){i=this.config.captureType}if(r==null){r=this.config.captureQuality}var n="png";if(i==1){n="jpeg"}else if(i==2){n="webp"}var a=void 0;if(this.isCanvas){if(this.isCanvasWebCodec)a=this.canvas_webcodec;else a=this.canvas}else{a=document.createElement("canvas");a.width=this.video.videoWidth;a.height=this.video.videoHeight;a.getContext("2d").drawImage(this.video,0,0,a.width,a.height)}var s=a.toDataURL("image/"+n,r);if(this.config.events&&this.config.events.onCapture){if(this.config.events.onCapture(s,this.ucVideo.video_id,this.ucVideo)){return s}}if(t!=null){var o=s.split(",");var c=o[0].match(/:(.*?);/);var d=c?c.length:0;if(d<2){alert("");return}var l=c[1],u=atob(o[1]),f=u.length,h=new Uint8Array(f);while(f--){h[f]=u.charCodeAt(f)}var p=new Blob([h],{type:l});var m=window.URL.createObjectURL(p);var v=document.createElement("a");v.style.display="none";v.href=m;v.download=t;document.body.appendChild(v);v.click();setTimeout(function(){document.body.removeChild(v);window.URL.revokeObjectURL(m)},1e3)}return s}},{key:"SetRealOrBack",value:function e(t){if(t){this.video.classList.remove("back");this.real_controlbar.classList.remove("back");this.time_rule_body.classList.add("hide");this.loading_page.classList.remove("back");this.LoadingPage(false);this.is_real_or_back=true}else{this.video.classList.add("back");this.real_controlbar.classList.add("back");this.time_rule_body.classList.remove("hide");this.loading_page.classList.add("back");this.LoadingPage(false);this.is_real_or_back=false}}},{key:"LoadingPage",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(this.video){if(this.LoadingPageID!=null){clearTimeout(this.LoadingPageID);this.LoadingPageID=null}if(t){if(r>0){this.LoadingPageID=setTimeout(this._ShowLoadingPage.bind(this,i),r)}else{this._ShowLoadingPage(i)}}else{this.loading_page.classList.add("hide")}}}},{key:"_ShowLoadingPage",value:function e(t){this.LoadingPageID=null;this.loading_page.classList.remove("hide");this.loading_text.innerText=t}},{key:"SetOsdVisible",value:function e(t){if(this.video){if(t){this.osd_text.classList.remove("hide")}else{this.osd_text.classList.add("hide")}}}},{key:"SetOsdColor",value:function e(t){this.osd_text.style.color=t}},{key:"SetOsdText",value:function e(t){this.osd_text.innerText=t}},{key:"SetKBpsText",value:function e(t){if(this.kbps_text){this.kbps_text.innerText=t}}},{key:"ShowRecordText",value:function e(){if(this.videoRecorder.started){this.record_text.innerText=o.default.diffTimeStr(this.videoRecorder.startTime,new Date)}else this.record_text.innerText=""}},{key:"SetRotate",value:function e(t){if(this.rotate==90){this.video_rotate.classList.remove("rotate90")}else if(this.rotate==180){this.video_rotate.classList.remove("rotate180")}else if(this.rotate==270){this.video_rotate.classList.remove("rotate270")}this.rotate=t;if(this.rotate==0){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==90){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px";this.video_rotate.classList.add("rotate90")}else if(this.rotate==180){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px";this.video_rotate.classList.add("rotate180")}else if(this.rotate==270){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px";this.video_rotate.classList.add("rotate270")}}},{key:"SetMirrorInver",value:function e(){if(this.mirrorinver){this.video_rotate.classList.remove("mirrorinver")}this.mirrorinver=!this.mirrorinver;if(this.mirrorinver){this.video_rotate.classList.add("mirrorinver")}}},{key:"Resize",value:function e(){if(this.rotate==0){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==90){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px"}else if(this.rotate==180){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=this.video_div.offsetWidth+"px";this.video_rotate.style.height=this.video_div.offsetHeight+"px"}else if(this.rotate==270){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=this.video_div.offsetHeight+"px";this.video_rotate.style.height=this.video_div.offsetWidth+"px"}}},{key:"ondragstart",value:function e(){this.ucVideo.ucMain.dragStart=this}},{key:"ondrop",value:function e(){var t=this.ucVideo.ucMain.dragStart;if(t!==this){var i=this.video_div.style.width;var r=this.video_div.style.height;var n=this.video_div.style.left;var a=this.video_div.style.top;var s=this.video_div.style.zIndex;var o=this.video_div.className;this.video_div.style.left=t.video_div.style.left;this.video_div.style.top=t.video_div.style.top;this.video_div.style.width=t.video_div.style.width;this.video_div.style.height=t.video_div.style.height;this.video_div.style.zIndex=t.video_div.style.zIndex;this.video_div.className=t.video_div.className;t.video_div.style.left=n;t.video_div.style.top=a;t.video_div.style.width=i;t.video_div.style.height=r;t.video_div.style.zIndex=s;t.video_div.className=o;t.ucVideo.Resize();this.ucVideo.Resize();this.ucVideo.ucMain.dragStart=null}}},{key:"ondragend",value:function e(){this.ucVideo.ucMain.dragStart=null}},{key:"ondragleave",value:function e(){this.ucVideo.ucMain.dragStart=null}},{key:"ondragover",value:function e(t){if(this.ucVideo.ucMain.dragStart){t.preventDefault()}}},{key:"onPlayerMouseEnter",value:function e(){this.is_cursor_in_dom=true;if(!this.is_playing)return;this.controlbar_enable=true;this.real_controlbar.classList.remove("hide");if(this.ucVideo.config.usePlaybar&&this.interfaceplayerbar){if(this.ucVideo.playermode==y.default.PlayerMode.Fmp4){this.interfaceplayerbar.UpdateAll(this.ucVideo.player.player)}else if(this.ucVideo.playermode==y.default.PlayerMode.Wasm){if(this.wasmplayer)this.interfaceplayerbar.UpdateAll(this.wasmplayer.wasmplayercom)}}if(this.video.muted){var t=0;this.scroll_thumb.style.top=this.scroll_bar_background.offsetTop+t-3+"px";this.scroll_bar.style.height=t+"px"}else{var i=this.video.volume*this.scroll_bar_background.clientHeight;this.scroll_thumb.style.top=this.scroll_bar_background.offsetTop+i-3+"px";this.scroll_bar.style.height=i+"px"}}},{key:"onPlayerMouseLeave",value:function e(){this.is_cursor_in_dom=false;this.controlbar_enable=false;setTimeout(function(){if(!this.controlbar_enable)this.real_controlbar.classList.add("hide");this.onTimerAudioScrollHide()}.bind(this),300)}},{key:"onPlayerBarClicked",value:function e(t){if(typeof t!="undefined"){if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}}}},{key:"onClickedLoadBtn",value:function e(){if(!this.is_playing)return false;if(this.isCanvas){if(!this.is_wasmorwebcodec)this.webcodecplayer.Refreash();else this.wasmplayer.Refreash()}else{this.seek2last()}return true}},{key:"onClickedPlayPauseBtn",value:function e(){if(!this.is_playing)return false;if(this.isCanvas){if(!this.is_wasmorwebcodec){if(this.webcodecplayer.playercom.paused){this.webcodecplayer.Play();this.btn_playorpause.classList.add("off")}else{this.webcodecplayer.Pause();this.btn_playorpause.classList.remove("off")}}else{if(this.wasmplayer.wasmplayercom.paused){this.wasmplayer.Play();this.btn_playorpause.classList.add("off")}else{this.wasmplayer.Pause();this.btn_playorpause.classList.remove("off")}}}else{if(this.video.paused){if(this.video.ended){return}this.video.play();this.btn_playorpause.classList.add("off");this.seekcheck()}else{this.video.pause();this.btn_playorpause.classList.remove("off")}}return true}},{key:"Pause",value:function e(){if(!this.is_playing)return false;if(this.isCanvas){if(!this.is_wasmorwebcodec){if(this.webcodecplayer.playercom.paused){}else{this.webcodecplayer.Pause();this.btn_playorpause.classList.remove("off")}}else{if(this.wasmplayer.wasmplayercom.paused){}else{this.wasmplayer.Pause();this.btn_playorpause.classList.remove("off")}}}else{if(this.video.paused){}else{this.video.pause();this.btn_playorpause.classList.remove("off")}}}},{key:"Resume",value:function e(){if(!this.is_playing)return false;if(this.isCanvas){if(!this.is_wasmorwebcodec){if(this.webcodecplayer.playercom.paused){this.webcodecplayer.Play();this.btn_playorpause.classList.add("off")}else{}}else{if(this.wasmplayer.wasmplayercom.paused){this.wasmplayer.Play();this.btn_playorpause.classList.add("off")}else{}}}else{if(this.video.paused){if(this.video.ended){return}this.video.play();this.btn_playorpause.classList.add("off");this.seekcheck()}else{}}}},{key:"onClickedStopBtn",value:function e(){this.ucVideo.ucMain.Stop(this.video_index+1);this.LoadingPage(false)}},{key:"onAudioScrollEnter",value:function e(){this.stopAudioScrollHide()}},{key:"onAudioScrollLeave",value:function e(){this.startAudioScrollHide()}},{key:"onVolumeMouseDown",value:function e(t){if(this.video.muted){this.video.muted=false;this.btn_mute.classList.remove("off");this.WasmPlayerSetVolume()}var i=t.layerY;this.scroll_thumb.style.top=this.scroll_bar_background.offsetTop+i-3+"px";this.scroll_bar.style.top=this.scroll_bar_background.offsetTop+i+"px";this.scroll_bar.style.height=this.audioscroll_height-i+"px";this.video.volume=this.scroll_bar.clientHeight/this.scroll_bar_background.clientHeight;this.WasmPlayerSetVolume()}},{key:"GetVolume",value:function e(){if(this.video.muted){return 0}return this.video.volume}},{key:"SetVolume",value:function e(t){if(t==0){this.SetMuted(true)}else{if(this.video.muted){this.video.muted=false;this.btn_mute.classList.remove("off")}this.video.volume=t;var i=this.video.volume*this.scroll_bar_background.clientHeight;this.scroll_thumb.style.top=this.scroll_bar_background.offsetTop+i-3+"px";this.scroll_bar.style.height=i+"px";this.WasmPlayerSetVolume()}return true}},{key:"onClickedMutedBtn",value:function e(){if(this.video.muted){this.SetMuted(false)}else{this.SetMuted(true)}}},{key:"onClickedMutedBtnEnter",value:function e(){this.stopAudioScrollHide();this.scroll_thumb.classList.remove("hide");this.scroll_bar.classList.remove("hide");this.scroll_bar_background.classList.remove("hide");this.scroll_bar_background_bg.classList.remove("hide");this.updateAudioScrollLocation()}},{key:"onClickedMutedBtnLeave",value:function e(){this.startAudioScrollHide()}},{key:"startAudioScrollHide",value:function e(){if(this.time_id!=-1){clearInterval(this.timer_audioscrollhide)}this.timer_audioscrollhide=setTimeout(this.onTimerAudioScrollHide.bind(this),1200)}},{key:"stopAudioScrollHide",value:function e(){if(this.time_id!=-1){clearInterval(this.timer_audioscrollhide);this.timer_audioscrollhide=-1}}},{key:"onTimerAudioScrollHide",value:function e(){this.scroll_thumb.classList.add("hide");this.scroll_bar.classList.add("hide");this.scroll_bar_background.classList.add("hide");this.scroll_bar_background_bg.classList.add("hide")}},{key:"updateAudioScrollLocation",value:function e(){var t=this.btn_mute.offsetLeft+10;var i=this.btn_mute.offsetTop-this.audioscroll_offsettop;this.scroll_bar_background_bg.style.left=t-8+"px";this.scroll_bar_background_bg.style.top=i-5+"px";this.scroll_bar_background_bg.style.width="20px";this.scroll_bar_background_bg.style.height=this.audioscroll_height+18+"px";this.scroll_bar_background.style.left=t+"px";this.scroll_bar_background.style.top=i+"px";this.scroll_bar_background.style.height=this.audioscroll_height+"px";var r=this.audioscroll_height-this.audioscroll_height*this.video.volume;if(this.video.muted){r=this.audioscroll_height}this.scroll_bar.style.left=t+"px";this.scroll_bar.style.top=i+r+"px";this.scroll_bar.style.height=this.audioscroll_height-r+"px";this.scroll_thumb.style.top=i+r-3+"px";this.scroll_thumb.style.left=t-4+"px"}},{key:"onScrollThumbMouseEvent",value:function e(t){if(this.video.muted==true){this.video.muted=false;this.btn_mute.classList.remove("off");this.WasmPlayerSetVolume()}t=t||window.event;this.start_y=t.clientY;var n=this;function i(e){e.preventDefault()}function r(e){e.preventDefault()}function a(e){var t=n.audioscroll_height;var i=void 0;var r=e.clientY;if(n.start_y>r){i=n.start_y-r;n.start_y=r;i=n.scroll_thumb.offsetTop-i;if(i<n.scroll_bar_background.offsetTop-3){n.scroll_thumb.style.top=n.scroll_bar_background.offsetTop-3+"px";n.scroll_bar.style.top=n.scroll_bar_background.offsetTop+"px";n.scroll_bar.style.height=t+"px"}else if(i>n.scroll_bar_background.offsetTop-3+t){n.scroll_thumb.style.top=n.scroll_bar_background.offsetTop+t-3+"px";n.scroll_bar.style.top=n.scroll_bar_background.offsetTop+t+"px";n.scroll_bar.style.height=0+"px"}else{n.scroll_thumb.style.top=i+"px";n.scroll_bar.style.top=i+3+"px";n.scroll_bar.style.height=n.scroll_bar_background.offsetTop+t-i-3+"px"}n.video.volume=n.scroll_bar.clientHeight/t;n.WasmPlayerSetVolume()}else if(n.start_y<r){i=r-n.start_y;n.start_y=r;i=n.scroll_thumb.offsetTop+i;if(i<n.scroll_bar_background.offsetTop-3){n.scroll_thumb.style.top=n.scroll_bar_background.offsetTop-3+"px";n.scroll_bar.style.top=n.scroll_bar_background.offsetTop+"px";n.scroll_bar.style.height=t+"px"}else if(i>n.scroll_bar_background.offsetTop-3+t){n.scroll_thumb.style.top=n.scroll_bar_background.offsetTop+t-3+"px";n.scroll_bar.style.top=n.scroll_bar_background.offsetTop+t+"px";n.scroll_bar.style.height=0+"px"}else{n.scroll_thumb.style.top=i+"px";n.scroll_bar.style.top=i+3+"px";n.scroll_bar.style.height=n.scroll_bar_background.offsetTop+t-i-3+"px"}n.video.volume=n.scroll_bar.clientHeight/t;n.WasmPlayerSetVolume()}}function s(e){document.removeEventListener("dragstart",i,false);document.removeEventListener("dragend",r,false);document.removeEventListener("mousemove",a,false);document.removeEventListener("mouseup",s,false)}document.addEventListener("dragstart",i,false);document.addEventListener("dragend",r,false);document.addEventListener("mousemove",a,false);document.addEventListener("mouseup",s,false)}},{key:"onClickedFullScreenBar",value:function e(){var t=this;var i=this.video_index+1;if(!_.default.IsFullscreen(this.video_div)){_.default.Fullscreen=true;if(_.default.FullscreenEnabled()){this.video_div.requestFullscreen&&this.video_div.requestFullscreen()||this.video_div.mozRequestFullScreen&&this.video_div.mozRequestFullScreen()||this.video_div.webkitRequestFullscreen&&this.video_div.webkitRequestFullscreen()||this.video_div.msRequestFullscreen&&this.video_div.msRequestFullscreen();this.btn_fullscreen.classList.add("off");this.video_div.classList.add("full");this.ucVideo.ucMain.DelayResizeWindowScreen()}else if(this.config.events&&this.config.events.onCvFullScreen){this.ucVideo.ucMain.ZoomUC(i);this.btn_fullscreen.classList.add("off");this.video_div.classList.add("full");if(!this.config.events.onCvFullScreen(true,i)){this.ucVideo.ucMain.DelayResizeWindowScreen(function(){t.ucVideo.ucMain.ZoomUC(i)})}else{this.ucVideo.ucMain.ZoomUC(i)}}}else{_.default.Fullscreen=false;if(_.default.FullscreenEnabled()){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():"";this.btn_fullscreen.classList.remove("off");this.video_div.classList.remove("full")}else if(this.config.events&&this.config.events.onCvFullScreen){this.btn_fullscreen.classList.remove("off");this.video_div.classList.remove("full");this.ucVideo.ucMain.UnZoomUC();this.config.events.onCvFullScreen(false,i)}}if(this.rotate==0){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=window.screen.availWidth+"px";this.video_rotate.style.height=window.screen.availHeight+"px"}else if(this.rotate==90){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=window.screen.availHeight+"px";this.video_rotate.style.height=window.screen.availWidth+"px"}else if(this.rotate==180){this.video_rotate.style.left=0+"px";this.video_rotate.style.top=0+"px";this.video_rotate.style.width=window.screen.availWidth+"px";this.video_rotate.style.height=window.screen.availHeight+"px"}else if(this.rotate==270){this.video_rotate.style.left=(this.video_div.offsetWidth-this.video_div.offsetHeight)/2+"px";this.video_rotate.style.top=(this.video_div.offsetHeight-this.video_div.offsetWidth)/2+"px";this.video_rotate.style.width=window.screen.availHeight+"px";this.video_rotate.style.height=window.screen.availWidth+"px"}}},{key:"SetFull",value:function e(t){if(t!=_.default.IsFullscreen(this.video_div)){this.onClickedFullScreenBar()}return true}},{key:"onClickedRecorderBtn",value:function e(){if(!this.is_playing)return;if(this.videoRecorder.started){this.videoRecorder.stop()}else{this.videoRecorder.start(this.ucVideo.Sim,this.ucVideo.Channel,true)}}},{key:"StartRecord",value:function e(){if(!this.is_playing)return false;if(this.videoRecorder.started){}else{this.videoRecorder.start(this.ucVideo.Sim,this.ucVideo.Channel)}return true}},{key:"StopRecord",value:function e(){if(!this.is_playing)return false;if(this.videoRecorder.started){this.videoRecorder.stop()}else{}return true}},{key:"RecordSelfImplStart",value:function e(){switch(this.playerman.playermode){case y.default.PlayerMode.Fmp4:return false;case y.default.PlayerMode.Gov:return false;case y.default.PlayerMode.Webrtc:case y.default.PlayerMode.Hls:return false;case y.default.PlayerMode.Wasm:this.wasmplayer.RecordStart(this);break;case y.default.PlayerMode.WebCodec:this.webcodecplayer.RecordStart(this);break;default:return false}return true}},{key:"RecordDataOutput",value:function e(t){this.videoRecorder.handleSelfDownloadInput(t)}},{key:"RecordSelfImplStop",value:function e(){switch(this.playerman.playermode){case y.default.PlayerMode.Fmp4:case y.default.PlayerMode.Gov:this.playerman.player.RecordStop();break;case y.default.PlayerMode.Webrtc:case y.default.PlayerMode.Hls:break;case y.default.PlayerMode.Wasm:this.wasmplayer.RecordStop();break;case y.default.PlayerMode.WebCodec:this.webcodecplayer.RecordStop();break}}},{key:"onClickedCaptureBtn",value:function e(){var t="png";if(this.config.captureType==1){t="jpeg"}else if(this.config.captureType==2){t="webp"}this.Capture("capture_"+this.ucVideo.Sim+"_"+this.ucVideo.Channel+"."+t,this.config.captureType,this.config.captureQuality)}},{key:"onClickedRotateBtn",value:function e(){var t=0;if(this.rotate==0)t=90;else if(this.rotate==90)t=180;else if(this.rotate==180)t=270;this.SetRotate(t)}},{key:"onClickedMirrorInverBtn",value:function e(){this.SetMirrorInver()}},{key:"onClickedStretchBtn",value:function e(){if(!this.is_playing)return;if(this.video.style.objectFit==="fill"){this.video.style.objectFit="";this.btn_stretch.classList.remove("off")}else{this.video.style.objectFit="fill";this.btn_stretch.classList.add("off")}}},{key:"SetAdaptRatio",value:function e(t){if(!this.is_playing)return false;if(t){if(this.video.style.objectFit==="fill"){this.video.style.objectFit="";this.btn_stretch.classList.remove("off")}else{}}else{if(this.video.style.objectFit==="fill"){}else{this.video.style.objectFit="fill";this.btn_stretch.classList.add("off")}}return true}},{key:"onContextMenu",value:function e(t){var i=0;var r=0;var n=this.mirrorinver&&!this.isCanvas;if(this.rotate==0){if(n){i=this.video_rotate.offsetWidth-t.offsetX;r=t.offsetY}else{i=t.offsetX;r=t.offsetY}}else if(this.rotate==90){if(n){i=this.video_rotate.offsetHeight-t.offsetY;r=this.video_rotate.offsetWidth-t.offsetX}else{i=this.video_rotate.offsetHeight-t.offsetY;r=t.offsetX}}else if(this.rotate==180){if(n){i=t.offsetX;r=this.video_rotate.offsetHeight-t.offsetY}else{i=this.video_rotate.offsetWidth-t.offsetX;r=this.video_rotate.offsetHeight-t.offsetY}}else if(this.rotate==270){if(n){i=t.offsetY;r=t.offsetX}else{i=t.offsetY;r=this.video_rotate.offsetWidth-t.offsetX}}i+=this.video_div.offsetLeft;r+=this.video_div.offsetTop;if(i+125>this.ucVideo.ucMain.Container.clientWidth){i=i-125}if(r+this.ucVideo.ucMain.menu_hegith>this.ucVideo.ucMain.Container.clientHeight){r=r-this.ucVideo.ucMain.menu_hegith}this.ucVideo.ucMain.menu_context_index=this.video_index+1;this.ucVideo.ucMain.menu.style.left=i+"px";this.ucVideo.ucMain.menu.style.top=r+"px";this.ucVideo.ucMain.menu.classList.add("active");var a=this.ucVideo.ucMain.menu.mimeInfo;if(a){var s=this.ucVideo.ucMain.menu.mimeVideo;if(s){var o=this.playerman.GetVideoMime();if(o.length>0){s.innerHTML=o;s.hidden=false}else{s.hidden=true}}var c=this.ucVideo.ucMain.menu.mimeAudioInfo;if(c){var o=this.playerman.GetAudioMime();if(o.length>0){c.innerHTML=o;c.hidden=false}else{c.hidden=true}}a.hidden=s.hidden&&c.hidden}return false}},{key:"onContextMenuCatchPage",value:function e(t){this.ucVideo.ucMain.Container.querySelectorAll(".video-menu").forEach(function(e,t){e.style.width=0});var i=t.offsetX;var r=t.offsetY;this.menu.style.left=i+"px";this.menu.style.top=r+"px";this.menu.style.width="125px";return false}},{key:"onTimeDayDBClicked",value:function e(t){t=t||window.event;this.cursor_body.style.left=this.time_day.offsetLeft+t.layerX+"px";var i=-this.time_day.offsetLeft+this.cursor_body.offsetLeft+1;var r=this.PadNum(parseInt(i/60),2)+":"+this.PadNum(i%60,2);this.cursor.innerText=r;if(this.video_div.querySelector("#video-time-minute"+i+"-"+this.video_index).classList.contains("active")){var n=this.start_time+i*60;this.ucVideo.ucMain.PlayBackVideoByPlayer(this.video_index+1,n,this.end_time);this.start_time_minute_back=i}else{alert("")}}},{key:"onTimeDayMouseEvent",value:function e(t){t=t||window.event;this.start_x=t.clientX;var a=this;function i(e){e.preventDefault()}function r(e){e.preventDefault()}function n(e){var t=a.time_rule_body.clientWidth;var i=void 0,r=void 0;var n=e.clientX;if(a.start_x>n){i=a.start_x-n;a.start_x=n;if(a.time_day.offsetLeft-i<t-1440){i=a.time_day.offsetLeft-t+1440}if(i!=0){a.time_day.style.left=a.time_day.offsetLeft-i+"px";a.cursor_body.style.left=a.cursor_body.offsetLeft-i+"px"}}else if(a.start_x<n){i=n-a.start_x;a.start_x=n;if(a.time_day.offsetLeft+i>0){i=-a.time_day.offsetLeft}if(i!=0){a.time_day.style.left=a.time_day.offsetLeft+i+"px";a.cursor_body.style.left=a.cursor_body.offsetLeft+i+"px"}}}function s(e){document.removeEventListener("dragstart",i,false);document.removeEventListener("dragend",r,false);document.removeEventListener("mousemove",n,false);document.removeEventListener("mouseup",s,false)}document.addEventListener("dragstart",i,false);document.addEventListener("dragend",r,false);document.addEventListener("mousemove",n,false);document.addEventListener("mouseup",s,false)}},{key:"onCursorMouseEvent",value:function e(t){t=t||window.event;this.back_drag=true;this.start_x=t.clientX;var c=this;function r(e){e.preventDefault()}function n(e){e.preventDefault()}function a(e){var t=c.time_rule_body.clientWidth;var i=void 0;var r=e.clientX;if(c.start_x>r){i=c.start_x-r;c.start_x=r;i=c.cursor_body.offsetLeft-i;if(i<-1){c.cursor_body.style.left=-1+"px"}else{c.cursor_body.style.left=i+"px"}var n=-c.time_day.offsetLeft+c.cursor_body.offsetLeft+1;var a=c.PadNum(parseInt(n/60),2)+":"+c.PadNum(n%60,2);c.cursor.innerText=a}else if(c.start_x<r){i=r-c.start_x;c.start_x=r;i=c.cursor_body.offsetLeft+i;if(i>t-1){c.cursor_body.style.left=t-1+"px"}else{c.cursor_body.style.left=i+"px"}var s=-c.time_day.offsetLeft+c.cursor_body.offsetLeft+1;var o=c.PadNum(parseInt(s/60),2)+":"+c.PadNum(s%60,2);c.cursor.innerText=o}}function s(e){c.back_drag=false;document.removeEventListener("dragstart",r,false);document.removeEventListener("dragend",n,false);document.removeEventListener("mousemove",a,false);document.removeEventListener("mouseup",s,false);o.default.debug("");var t=c.cursor_body.offsetLeft+1-c.time_day.offsetLeft;if(c.video_div.querySelector("#video-time-minute"+t+"-"+c.video_index).classList.contains("active")){var i=c.start_time+t*60;c.ucVideo.ucMain.PlayBackVideoByPlayer(c.video_index+1,i,c.end_time);c.start_time_minute_back=t}else{alert("")}}document.addEventListener("dragstart",r,false);document.addEventListener("dragend",n,false);document.addEventListener("mousemove",a,false);document.addEventListener("mouseup",s,false)}},{key:"onMediaTimeUpdate",value:function e(){if(this.back_drag)return;var t=parseInt(this.video.currentTime)+1;if(!this.is_real_or_back&&this.is_playing&&t>0){var i=this.start_time_minute_back+parseInt(t/60);var r=this.time_rule_body.clientWidth;var n=this.time_day.offsetLeft;var a=i+n<0?0:i+n;a=a>r?r:a;this.cursor_body.style.left=a-1+"px";var s=this.PadNum(parseInt(i/60),2)+":"+this.PadNum(i%60,2);this.cursor.innerText=s}}},{key:"seekcheck",value:function e(){if(this.ucVideo.player.isReal&&this.is_real_or_back&&!this.video.paused&&this.config.seekMode>=0){var t=this.getLastTime();if(t){var i=t-this.video.currentTime;if(i>this.config.maxDelay){if(this.config.seekMode==0){this.video.currentTime=t}else this.video.playbackRate=8}}}}},{key:"getLastTime",value:function e(){var t=this.video.buffered;if(t.length===1){return t.end(t.length-1)}}},{key:"seek2last",value:function e(){var t=this.getLastTime();if(t){this.video.currentTime=t}else{this.video.currentTime=60*60*24*30}}},{key:"PadNum",value:function e(t,i){var r="000000000000000000000"+t;return r.substr(r.length-i)}}]);return d}();i.default=P},{"../../helper/ByteHelper":94,"../../utils/cvComm":125,"../../utils/logger":127,"../PlayerMan":111,"../VideoRecorder":112,"../Wasm/WasmPlayer":114,"../Wasm/WasmPlayerBW":115,"../Wasm/WasmVideoPlayerBWImpl.js":117,"../WebCodec/WebCodecPlayer":119,"./interface_player_bar":108}],108:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../PlayerMan");var o=a(n);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function i(e,t){s(this,i);this.ifce_player=e;this.config=t;this.playedMs=0;this.waitingPlayMs=0}r(i,[{key:"UpdateAll",value:function e(t){if(!t||!t.PlayerBarIsReady())return;var i=t.PlayerBarGetLength()*1e3/t.PlayerBarGetMultiple();var r=this.ifce_player.playbackbarbackgroud.offsetWidth;var n=0;if(t.PlayerBarHaveBackupBuffer()){var a=t.PlayerBarBackupBufferGetBegin();var s=t.PlayerBarBackupBufferGetEnd();this.playedMs=s-a;if(this.config.usePlaybar){if(r!=0){var o=Math.ceil(r*a/i);n=Math.ceil(r*s/i);var c=n<=o?1:n-o;this.ifce_player.playbackbarplayed.style.left=o+"px";this.ifce_player.playbackbarplayed.style.width=c+"px"}}}if(t.PlayerBarHaveFrameBuffer()>0){var d=t.PlayerBarFrameBufferGetBegin();var l=t.PlayerBarFrameBufferGetEnd();this.waitingPlayMs=l-d;if(this.config.usePlaybar){if(r>0){var u=n!=0?n+1:Math.ceil(r*d/i)+1;n=Math.ceil(r*l/i);var f=n<=u?1:n-u;this.ifce_player.playbackbarplaying.style.left=u+"px";this.ifce_player.playbackbarplaying.style.width=f+"px"}}}if(this.config.events.onPlayBackCacheTime){this.config.events.onPlayBackCacheTime(this.GetPlayBackCacheTime(),this.ifce_player.ucVideo.video_id,this.ifce_player.ucVideo)}}},{key:"GetPlayBackCacheTime",value:function e(){return{playedMs:this.playedMs,waitingPlayMs:this.waitingPlayMs}}},{key:"Clear",value:function e(){this.ifce_player.playbackbarplayed.style.width=0+"px";this.ifce_player.playbackbarplaying.style.width=0+"px";this.playedMs=0;this.waitingPlayMs=0}},{key:"onBackgroudMouseDown",value:function e(t){var i=t.layerX;var r=this.ifce_player.playbackbarbackgroud.offsetWidth;var n=void 0;if(this.ifce_player.ucVideo.playermode==o.default.PlayerMode.Fmp4){n=this.ifce_player.ucVideo.player.player}else if(this.ifce_player.ucVideo.playermode==o.default.PlayerMode.Wasm){n=this.ifce_player.wasmplayer.wasmplayercom}else if(this.ifce_player.ucVideo.playermode==o.default.PlayerMode.WebCodec){n=this.ifce_player.webcodecplayer.playercom}else{return}var a=n.PlayerBarGetLength()/n.PlayerBarGetMultiple();var s=Math.ceil(a*i/r);if(!n.PlayerBarSeek(s)){this.UpdateAll(n)}}},{key:"onBackgroudMouseEnter",value:function e(){this.ifce_player.playbackbarbackgroud.classList.add("hover");this.ifce_player.playbackbarplayed.classList.add("hover");this.ifce_player.playbackbarplaying.classList.add("hover")}},{key:"onBackgroudMouseLeave",value:function e(){this.ifce_player.playbackbarbackgroud.classList.remove("hover");this.ifce_player.playbackbarplayed.classList.remove("hover");this.ifce_player.playbackbarplaying.classList.remove("hover")}},{key:"onSlideMouseDown",value:function e(){console.log("onSlideMouseDown")}},{key:"onSlideMouseEnter",value:function e(){console.log("onSlideMouseEnter")}},{key:"onSlideMouseLeave",value:function e(){console.log("onSlideMouseLeave")}}]);return i}();i.default=c},{"../PlayerMan":111}],109:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("events");var s=l(n);var a=e("./Audio/AudioSpeek");var o=l(a);var c=e("../utils/cvComm");var d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function i(e,t){u(this,i);var a=this.observer=new s.default;a.trigger=function e(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++){r[n-1]=arguments[n]}a.emit.apply(a,[t,t].concat(r))};a.off=function e(t){for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++){r[n-1]=arguments[n]}a.removeListener.apply(a,[t].concat(r))};this.on=a.on.bind(a);this.off=a.off.bind(a);this.trigger=a.trigger.bind(a);this.config=e;this.ucMain=t;this.AudioSpeek=new o.default(this);this.video_id=-1;this.isspeaking=false}r(i,[{key:"StartSpeek",value:function e(t,i){var r=d.default.SimChannelLen(t,i,this.config.protocol);this.AudioSpeek.StartSpeek(r.Sim,r.Channel);this.isspeaking=true}},{key:"StopSpeek",value:function e(){this.AudioSpeek.StopSpeek();this.isspeaking=false}},{key:"Stop",value:function e(){this.StopSpeek()}},{key:"StartBroadcast",value:function e(t){var i=[];for(var r=0;r<t.length;r++){i.push(d.default.SimChannelLen(t[r].Sim,t[r].Channel,this.config.protocol))}this.AudioSpeek.StartBroadcast(i);this.isspeaking=true}},{key:"StopBroadcast",value:function e(){this.AudioSpeek.StopBroadcast();this.isspeaking=false}},{key:"CloseSocket",value:function e(){this.AudioSpeek.CloseSocket()}},{key:"InputPcm",value:function e(t,i,r){this.AudioSpeek.InputPcmData(t,i,r)}},{key:"InputEncodeAudio",value:function e(t,i,r){this.AudioSpeek.InputEncodeAudio(t,i,r)}}]);return i}();i.default=f},{"../utils/cvComm":125,"./Audio/AudioSpeek":103,events:10}],110:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function i(e,t){n(this,i)}r(i,[{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return-1}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;return-1}},{key:"StopVideo",value:function e(){}},{key:"onMediaWaiting",value:function e(){}},{key:"SetRtvsAddr",value:function e(t){}},{key:"onHlsInfo",value:function e(t){}},{key:"onMediaError",value:function e(){}},{key:"onWebrtcSFUInfo",value:function e(t){}},{key:"onBufferAppending",value:function e(t){}},{key:"onBufferReset",value:function e(t){}}]);return i}();i.default=a},{}],111:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../events");var a=b(n);var s=e("../event-handler");var o=b(s);var c=e("./Interface/interface_player.js");var l=b(c);var d=e("./WebRTC/WebRtcPlayer.js");var u=b(d);var f=e("./Fmp4/Fmp4Player.js");var h=b(f);var p=e("./Hls/HlsPlayer");var m=b(p);var v=e("../utils/logger.js");var y=b(v);var g=e("./Gov/GovPlayer");var _=b(g);function b(e){return e&&e.__esModule?e:{default:e}}function w(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function S(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function k(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var C=function(e){k(d,e);r(d,[{key:"Playing",get:function e(){return this.player.Playing}}],[{key:"PlayerMode",get:function e(){return{Fmp4:4,Webrtc:5,Gov:8,Hls:6,Wasm:3,WebCodec:7,Speek:2,None:0}}}]);function d(e){w(this,d);var t=S(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,e,a.default.BUFFER_APPENDING,a.default.BUFFER_RESET,a.default.WEBRTC_SFU_INFO,a.default.HLS_INFO,a.default.JT1078_RGB_OUT,a.default.JT1078_YUV_OUT,a.default.MEDIA_INFO));t.config=t.wfs.config;t.wfs=e;t.interface_player=new l.default(e,e.config,t);t.player=null;var i=t.interface_player.GetVideo();if(i){i.onplay=t.onMediaPlay.bind(t);i.onpause=t.onMediaPause.bind(t);i.ontimeupdate=t.onMediaTimeUpdate.bind(t);i.onwaiting=t.onMediaWaiting.bind(t);i.onerror=t.onMediaError.bind(t);i.onended=t.onMediaEnded.bind(t);i.onempty=t.onMediaEmpty.bind(t)}return t}r(d,[{key:"onChangeVideoDom",value:function e(t,i){t.onplay=null;t.onpause=null;t.ontimeupdate=null;t.onwaiting=null;t.onerror=null;t.onended=null;t.onempty=null;i.onplay=this.onMediaPlay.bind(this);i.onpause=this.onMediaPause.bind(this);i.ontimeupdate=this.onMediaTimeUpdate.bind(this);i.onwaiting=this.onMediaWaiting.bind(this);i.onerror=this.onMediaError.bind(this);i.onended=this.onMediaEnded.bind(this);i.onempty=this.onMediaEmpty.bind(this)}},{key:"onHlsInfo",value:function e(t){this.player.onHlsInfo(t);if(this.isReal){this.player.StartRealTimeVideo(this.sim,this.channel,this.streamtype)}else{this.player.StartBackTimeVideo(this.sim,this.channel,this.startTime,this.endTime,this.streamtype)}}},{key:"onWebrtcSFUInfo",value:function e(t){this.player.onWebrtcSFUInfo(t);if(this.isReal){this.player.StartRealTimeVideo(this.sim,this.channel,this.streamtype)}else{this.player.StartBackTimeVideo(this.sim,this.channel,this.startTime,this.endTime,this.streamtype)}}},{key:"onWebrtcSrsInfo",value:function e(t){this.player.onWebrtcSrsMsg(t)}},{key:"onMediaInfo",value:function e(t){this.mime_data=t;if(d.PlayerMode.WebCodec==this.playermode){this.interface_player.webcodecplayer.onMediaInfo(t)}}},{key:"onBufferAppending",value:function e(t){if(d.PlayerMode.Wasm==this.playermode){this.interface_player.wasmplayer.onBufferAppending(t)}else if(d.PlayerMode.WebCodec==this.playermode){this.interface_player.webcodecplayer.onBufferAppending(t)}else{this.player.onBufferAppending(t)}}},{key:"onBufferReset",value:function e(t){this.player.onBufferReset(t)}},{key:"GetVideoMime",value:function e(){if(this.mime_data!=null){var t=void 0;if(/avc/.test(this.mime_data.video_mime)){t="H.264"}else if(/hev/.test(this.mime_data.video_mime)){t="H.265"}else{t=this.mime_data.video_mime}return t+" "+this.mime_data.video_width+"x"+this.mime_data.video_height}return""}},{key:"GetAudioMime",value:function e(){if(this.audio_PT>=0){switch(this.audio_PT){case CvNetVideo.WASM.JX_G711A:return"G711.A";case CvNetVideo.WASM.JX_G711U:return"G711.U";case CvNetVideo.WASM.JX_G726:return"G726_32K";case CvNetVideo.WASM.JX_ADPCMA:return"ADPCMA";case CvNetVideo.WASM.JX_G726_16K:return"G726_16K";case CvNetVideo.WASM.JX_G726_24K:return"G726_24K";case CvNetVideo.WASM.JX_G726_40K:return"G726_40K";case CvNetVideo.WASM.JX_AAC:return"AAC";default:return this.audio_PT.toString()}}return""}},{key:"Flush",value:function e(){if(this.playermode==d.PlayerMode.Wasm){this.interface_player.wasmplayer.Flush()}else if(this.playermode==d.PlayerMode.Fmp4){this.player.Flush()}else if(this.playermode==d.PlayerMode.WebCodec){this.interface_player.webcodecplayer.Flush()}}},{key:"GovPlay",value:function e(t,i){this.player.GovPlay(t,i)}},{key:"GetFmp4ID",value:function e(){if(this.player==null)return-1;if(this.playermode!=d.PlayerMode.Gov)return-1;return this.player.GetFmp4ID()}},{key:"GetFisrtMsg",value:function e(){if(this.player==null)return-1;if(this.playermode!=d.PlayerMode.Gov)return-1;return this.player.GetFisrtMsg()}},{key:"onJT1078RgbOut",value:function e(t){this.onJT1078YuvOut(t)}},{key:"onJT1078YuvOut",value:function e(t){if(this.interface_player.wasmplayer==null&&this.interface_player.webcodecplayer==null||this.playermode!=d.PlayerMode.Wasm&&this.playermode!=d.PlayerMode.WebCodec)return-1;this.LoadingPage(false);if(this.playermode==d.PlayerMode.Wasm){if(!this.config.useWasmWebWorker){this.interface_player.wasmplayer.onYuvShow(t.imageBuffer,t.width,t.height)}}else{this.interface_player.webcodecplayer.onYuvShow(t.imageBuffer,t.width,t.height)}}},{key:"PlayRealVideoBegin",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:undefined;this.StopPlay();this.interface_player.StartPlay();this.sim=t;this.channel=i;this.streamtype=r;this.playermode=n;this.isReal=true;switch(this.playermode){case d.PlayerMode.Fmp4:this.interface_player.SwitchVideoOrCanvas(true,true);this.player=new h.default(this.wfs,this.interface_player.GetVideo());break;case d.PlayerMode.Webrtc:this.interface_player.SwitchVideoOrCanvas(true,true);this.player=new u.default(this.wfs,this.interface_player.GetVideo());break;case d.PlayerMode.Hls:this.interface_player.SwitchVideoOrCanvas(true,true);this.player=new m.default(this.wfs,this.interface_player.GetVideo());break;case d.PlayerMode.Wasm:this.interface_player.SwitchVideoOrCanvas(false,true);this.interface_player.wasmplayer.StartRealTimeVideo(t,i,r);break;case d.PlayerMode.WebCodec:this.interface_player.SwitchVideoOrCanvas(false,true,false);this.interface_player.webcodecplayer.StartRealTimeVideo(t,i,r);break;case d.PlayerMode.Gov:this.interface_player.SwitchVideoOrCanvas(true,true);this.player=new _.default(this.wfs,this.interface_player.GetVideo(),a);break}}},{key:"PlayBackVideoBegin",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var c=arguments.length>7&&arguments[7]!==undefined?arguments[7]:4;this.StopPlay();this.interface_player.StartPlay();this.sim=t;this.channel=i;this.startTime=r;this.endTime=n;this.streamtype=a;this.playermode=c;this.isReal=false;switch(this.playermode){case d.PlayerMode.Fmp4:this.interface_player.SwitchVideoOrCanvas(true,false);this.player=new h.default(this.wfs,this.interface_player.GetVideo());this.player.StartBackTimeVideo(t,i,r,n,a,s,o);break;case d.PlayerMode.Webrtc:this.interface_player.SwitchVideoOrCanvas(true,false);this.player=new u.default(this.wfs,this.interface_player.GetVideo());break;case d.PlayerMode.Hls:this.interface_player.SwitchVideoOrCanvas(true,false);this.player=new m.default(this.wfs,this.interface_player.GetVideo());break;case d.PlayerMode.Wasm:this.interface_player.SwitchVideoOrCanvas(false,false);this.interface_player.wasmplayer.StartBackTimeVideo(t,i,r,n,a,s,o);break;case d.PlayerMode.WebCodec:this.interface_player.SwitchVideoOrCanvas(false,false,false);this.interface_player.webcodecplayer.StartBackTimeVideo(t,i,r,n,a,s,o);break;case d.PlayerMode.Gov:this.interface_player.SwitchVideoOrCanvas(true,false);this.player=new _.default(this.wfs,this.interface_player.GetVideo());break}}},{key:"StopPlay",value:function e(){this.mime_data=null;this.audio_PT=-1;this.interface_player.StopPlay();if(this.player!=null){this.player.StopVideo();this.player=null}}},{key:"SetRtvsAddr",value:function e(t){if(this.player&&this.player.SetRtvsAddr)this.player.SetRtvsAddr(t)}},{key:"Check",value:function e(){if(this.player&&this.player.Check){this.player.Check()}}},{key:"PlayVideoBegin",value:function e(){this.interface_player.LoadingPage(true,this.config.language.loading_page_wait_video)}},{key:"SetSelected",value:function e(t){this.interface_player.SetSelected(t)}},{key:"LoadingPage",value:function e(t,i,r){this.interface_player.LoadingPage(t,i,r)}},{key:"SetOsdVisible",value:function e(t){this.interface_player.SetOsdVisible(t)}},{key:"SetOsdColor",value:function e(t){this.interface_player.SetOsdColor(t)}},{key:"SetOsdText",value:function e(t){this.interface_player.SetOsdText(t)}},{key:"SetKBpsText",value:function e(t){this.interface_player.SetKBpsText(t)}},{key:"ShowRecordText",value:function e(){this.interface_player.ShowRecordText()}},{key:"SetRotate",value:function e(t){this.interface_player.SetRotate(t)}},{key:"SetMirrorInver",value:function e(){this.interface_player.SetMirrorInver()}},{key:"QueryVideoListBegin",value:function e(){this.interface_player.QueryVideoListBegin()}},{key:"AddVideoList",value:function e(t,i,r){this.interface_player.AddVideoList(t,i,r)}},{key:"GetVideoDiv",value:function e(){return this.interface_player.video_div}},{key:"SetRealOrBack",value:function e(t){this.interface_player.SetRealOrBack(t)}},{key:"SetPlaySpeed",value:function e(t){if(this.isReal)return false;switch(this.playermode){case d.PlayerMode.Fmp4:this.player.SetPlaySpeed(t);break;case d.PlayerMode.Webrtc:case d.PlayerMode.Hls:case d.PlayerMode.Gov:var i=this.interface_player.GetVideo();i.playbackRate=t;break;case d.PlayerMode.Wasm:this.interface_player.wasmplayer.wasmplayercom.SetPlaySpeed(t);break;case d.PlayerMode.WebCodec:this.interface_player.webcodecplayer.playercom.SetPlaySpeed(t);break}return true}},{key:"onMediaPlay",value:function e(){y.default.debug("video play")}},{key:"onMediaPause",value:function e(){y.default.debug("video pause")}},{key:"onMediaTimeUpdate",value:function e(){if(this.interface_player.GetVideo().currentTime===0)return;if(this.playermode==d.PlayerMode.Fmp4||this.playermode==d.PlayerMode.Gov||this.playermode==d.PlayerMode.Webrtc){this.player.onMediaTimeUpdate()}this.LoadingPage(false);this.interface_player.onMediaTimeUpdate()}},{key:"onMediaWaiting",value:function e(){if(this.player)this.player.onMediaWaiting();if(this.wfs.config.showLoadingByPlay){this.LoadingPage(true,this.config.language.loading_page_wait_video,this.wfs.config.showLoadDelayMs)}}},{key:"onMediaError",value:function e(){y.default.debug("video error");if(this.player&&this.player.onMediaError){this.player.onMediaError()}}},{key:"onMediaEnded",value:function e(){y.default.debug("video ended");if(this.player&&this.player.onMediaEnded){this.player.onMediaEnded()}}},{key:"onMediaEmpty",value:function e(){y.default.debug("video empty")}}]);return d}(o.default);i.default=C},{"../event-handler":92,"../events":93,"../utils/logger.js":127,"./Fmp4/Fmp4Player.js":104,"./Gov/GovPlayer":105,"./Hls/HlsPlayer":106,"./Interface/interface_player.js":107,"./WebRTC/WebRtcPlayer.js":120}],112:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../utils/logger.js");var a=s(n);var d=e("ts-ebml");function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function i(e,t){o(this,i);this.chunks=[];this.types=[{mime:"video/webm",ft:"webm"},{mime:"video/webm;codecs=h264",ft:"webm"},{mime:"video/webm;codecs=vp8",ft:"webm"},{mime:"video/webm;codecs=vp9",ft:"webm"}];this.tp=this.types[0];this.iPlayer=e;this.onChange=t;this.is_selfdownload_recording=false}r(i,[{key:"start",value:function e(t,i,isRecord){this.startTime=new Date;this.sim=t;this.channel=i;this.chunks=[];if(isRecord){return this.startMediaRecorder()};if(!this.startSelfDownload()){return this.startMediaRecorder()}return true}},{key:"stop",value:function e(){if(this.mediaRecorder){this.mediaRecorder.stop();this.mediaRecorder=null}if(this.is_selfdownload_recording){this.iPlayer.RecordSelfImplStop();this.handleSelfDownloadStop()}}},{key:"startMediaRecorder",value:function e(){try{this.tp=null;for(var t in this.types){if(MediaRecorder.isTypeSupported(this.types[t].mime)){this.tp=this.types[t];break}}if(this.tp==null){a.default.error("MediaRecorder not supported mime");return false}var i=void 0;var r=this.iPlayer.GetVideoOrCanvas();if(r.captureStream){i=r.captureStream(25)}else if(r.mozCaptureStream){i=r.mozCaptureStream(25)}else{a.default.error("captureStream() not supported");return false}this.mediaRecorder=new MediaRecorder(i,{mimeType:'video/mp4;codecs=avc1.640028,mp4a.40.2'});this.mediaRecorder.ondataavailable=this.handle_dataavailable.bind(this);this.mediaRecorder.onstop=this.handleStop.bind(this);this.mediaRecorder.start();this.started=true;this.onChange(this.started)}catch(e){return false}return true}},{key:"startSelfDownload",value:function e(){if(this.iPlayer.RecordSelfImplStart()){this.started=true;this.onChange(this.started);this.is_selfdownload_recording=true;return true}return false}},{key:"handleSelfDownloadInput",value:function e(t){if(t.length==8&&t[0]==119&&t[1]==119){var i=t[2]<<8|t[3];this.chunks[0][i]=t[4];this.chunks[0][i+1]=t[5];this.chunks[0][i+2]=t[6];this.chunks[0][i+3]=t[7]}else{this.chunks.push(t)}}},{key:"handleSelfDownloadStop",value:function e(){a.default.debug("Recorder stopped: ");this.stopTime=new Date;var t=new Blob(this.chunks,{type:"application/octet-stream"});if(!(this.iPlayer.config.events&&this.iPlayer.config.events.onEndRecord&&this.iPlayer.config.events.onEndRecord(t,{type:"mp4",sim:this.sim,channel:this.channel,startTime:this.startTime.getTime(),stopTime:this.stopTime.getTime()},this.iPlayer.ucVideo.video_id,this.iPlayer.ucVideo))){a.default.downBlob(t,"R"+this.sim+"_"+this.channel+"_"+this.startTime.getTime()+"_"+this.stopTime.getTime()+".mp4")}this.chunks=[];this.started=false;this.onChange(this.started);this.is_selfdownload_recording=false}},{key:"handle_dataavailable",value:function e(t){this.chunks.push(t.data)}},{key:"handleStop",value:function e(t){var i=this;a.default.debug("Recorder stopped: ",t);this.stopTime=new Date;this.getBlob(function(e){const meediaType='mp4';if(!(i.iPlayer.config.events&&i.iPlayer.config.events.onEndRecord&&i.iPlayer.config.events.onEndRecord(e,{type:meediaType,sim:i.sim,channel:i.channel,startTime:i.startTime.getTime(),stopTime:i.stopTime.getTime()},i.iPlayer.ucVideo.video_id,i.iPlayer.ucVideo))){a.default.downBlob(e,"R"+i.sim+"_"+i.channel+"_"+i.startTime.getTime()+"_"+i.stopTime.getTime()+"."+meediaType)}});this.chunks=[];this.started=false;this.onChange(this.started)}},{key:"getSeekableBlob",value:function e(a){var s=new d.Reader;var o=new d.Decoder;var c=d.tools;var t=new FileReader;t.onload=function(e){var t=o.decode(this.result);t.forEach(function(e){s.read(e)});s.stop();var i=c.makeMetadataSeekable(s.metadatas,s.duration,s.cues);var r=this.result.slice(s.metadataSize);var n=new Blob([i,r],{type:"video/webm"});a(n)};t.readAsArrayBuffer(new Blob(this.chunks))}},{key:"getBlob",value:function e(a){const type='video/mp4';let n=new Blob([...this.chunks],{type});a(n)}}]);return i}();i.default=c},{"../utils/logger.js":127,"ts-ebml":79}],113:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../Audio/AudioPlay");var a=o(n);var s=e("../../utils/aacAdtsParse");var l=o(s);function o(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var d=function(){function t(e){c(this,t);this.ucvideo=e;this.audioplay=new a.default(e.config);window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;try{this.audio_context=new window.AudioContext}catch(e){Logger.warn("dont support audio context!")}this.wasm_audiodecoder_id=-1}r(t,[{key:"Start",value:function e(){this.audioplay.Start()}},{key:"Stop",value:function e(){if(this.wasm_audiodecoder_id!=-1){CvNetVideo.WASM.AudioEncoderClear(this.wasm_audiodecoder_id);this.wasm_audiodecoder_id=-1}this.audioplay.Stop()}},{key:"Pause",value:function e(){this.audioplay.Pause()}},{key:"Play",value:function e(){this.audioplay.Play()}},{key:"PlayFrame",value:function e(t,i,r){if(this.wasm_audiodecoder_id==-1){if(i==8){i=CvNetVideo.g726_conf.getPT(t.length)}this.ucvideo.player.audio_PT=i;var n=8e3;var a=1;if(i==CvNetVideo.WASM.JX_AAC){this.is_have_adts=false;var s=l.default.AacAdtsDemux(t),o=s.errcode,c=s.sample_rate,d=s.channel;if(o==0){this.is_have_adts=true;n=c;a=d}}this.wasm_audiodecoder_id=CvNetVideo.WASM.CreateAAudioDecoder(i,n,16,a,this.audio_context.sampleRate,32,1);if(this.wasm_audiodecoder_id>=0)CvNetVideo.WasmId2Uc.d[this.wasm_audiodecoder_id]=this.audioplay}CvNetVideo.WASM.AudioDecoderDecode(this.wasm_audiodecoder_id,t,t.length)}}]);return t}();i.default=d},{"../../utils/aacAdtsParse":123,"../Audio/AudioPlay":102}],114:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../Wasm/WebGLYuvShowV2");var a=f(n);var s=e("../Audio/AudioPlay");var o=f(s);var c=e("./WasmPlayerCom.js");var d=f(c);var l=e("../PlayerInterface.js");var u=f(l);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var v=function(e){m(n,e);function n(e,t,i){h(this,n);var r=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t));r.ucvideo=e;r.canvas=t;r.wasmplayercom=new d.default(i,r.PlayFrame.bind(r),e.config);r.webglv2=new a.default(r.canvas);r.audioplay=new o.default(r.ucvideo.config);r.videodecoder_id=-1;r.audiodecoder_id=-1;r.refreash=false;r._is_play_audio=false;window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;try{r.audio_context=new window.AudioContext}catch(e){Logger.warn("dont support audio context!")}return r}r(n,[{key:"Flush",value:function e(){if(this.videodecoder_id>=0){CvNetVideo.WASM.VideoDecoderFlush(this.videodecoder_id)}}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.refreash=false;this.audioplay.Start();this.wasmplayercom.StartRealTimeVideo()}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;this.refreash=false;this.audioplay.Start();this.wasmplayercom.StartBackTimeVideo(r,n,s,o)}},{key:"StopVideo",value:function e(){this.wasmplayercom.StopVideo();this.webglv2.clear();if(this.videodecoder_id!=-1){CvNetVideo.WASM.VideoDecoderClear(this.videodecoder_id);this.videodecoder_id=-1}if(this.audiodecoder_id!=-1){CvNetVideo.WASM.AudioEncoderClear(this.audiodecoder_id);this.audiodecoder_id=-1}this.audioplay.Stop()}},{key:"Pause",value:function e(){this.audioplay.Pause();this.wasmplayercom.Pause()}},{key:"Play",value:function e(){this.audioplay.Play();this.wasmplayercom.Play()}},{key:"Refreash",value:function e(){this.refreash=true;this.wasmplayercom.Refreash()}},{key:"SetRtvsAddr",value:function e(t){}},{key:"SetWhetherPlayAudio",value:function e(t){this._is_play_audio=t}},{key:"PlayFrame",value:function e(t,i){if(i===CvNetVideo.WASM.JX_H264||i===CvNetVideo.WASM.JX_H265){if(this.videodecoder_id==-1){this.videodecoder_id=CvNetVideo.WASM.CreateAVideoDecoder(i,CvNetVideo.WASM.AV_PIX_FMT_RGBA);if(this.videodecoder_id>=0){CvNetVideo.WasmId2Uc.v[this.videodecoder_id]=this.ucvideo}}if(this.videodecoder_id>=0){var r=CvNetVideo.WASM.VideoDecoderDecode(this.videodecoder_id,t,t.length)}}else if(i===CvNetVideo.WASM.JX_AAC||i===CvNetVideo.WASM.JX_ADPCMA||i===CvNetVideo.WASM.JX_G711A||i===CvNetVideo.WASM.JX_G711U||i===CvNetVideo.WASM.JX_G726){if(!this._is_play_audio)return;if(this.audiodecoder_id==-1){if(i==8){i=CvNetVideo.g726_conf.getPT(t.length)}this.audiodecoder_id=CvNetVideo.WASM.CreateAAudioDecoder(i,8e3,16,1,this.audio_context.sampleRate,32,1);if(this.audiodecoder_id>=0)CvNetVideo.WasmId2Uc.d[this.audiodecoder_id]=this.audioplay}if(this.audiodecoder_id>=0){CvNetVideo.WASM.AudioDecoderDecode(this.audiodecoder_id,t,t.length)}}}},{key:"onYuvShow",value:function e(t,i,r){if(!this.wasmplayercom.paused){this.webglv2.renderFrame(i,r,t)}else if(this.refreash){this.refreash=false;this.webglv2.renderFrame(i,r,t)}}},{key:"onBufferAppending",value:function e(t){this.wasmplayercom.onBufferAppending(t)}},{key:"Playing",get:function e(){return false}}]);return n}(u.default);i.default=v},{"../Audio/AudioPlay":102,"../PlayerInterface.js":110,"../Wasm/WebGLYuvShowV2":118,"./WasmPlayerCom.js":116}],115:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../PlayerInterface.js");var a=l(n);var s=e("./WasmPlayerCom.js");var o=l(s);var c=e("./WasmAudioPlayerImpl.js");var d=l(c);function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function h(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var p=function(e){h(a,e);function a(e,t,i,r){u(this,a);var n=f(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e,t));n.ucvideo=e;n.wasmplayercom=new o.default(i,n.PlayFrame.bind(n),e.config);n.config=e.config;n.id=0;n._is_play_audio=false;n.wasm_audio_player=new d.default(e);n.wasm_video_player=r;return n}r(a,[{key:"Flush",value:function e(){this.wasm_video_player.Flush()}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.refreash=false;this.wasm_audio_player.Start();this.wasm_video_player.StartPlay(true);this.wasmplayercom.StartRealTimeVideo()}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;this.refreash=false;this.wasm_audio_player.Start();this.wasm_video_player.StartPlay(false);this.wasmplayercom.StartBackTimeVideo(r,n,s,o)}},{key:"StopVideo",value:function e(){this.wasmplayercom.StopVideo();this.wasm_video_player.StopPlay();this.wasm_audio_player.Stop()}},{key:"SetVolume",value:function e(t){this.wasm_audio_player.audioplay.SetVolume(t)}},{key:"Pause",value:function e(){this.wasm_audio_player.Pause();this.wasmplayercom.Pause();this.wasm_video_player.Pause()}},{key:"Play",value:function e(){this.wasm_audio_player.Play();this.wasmplayercom.Play();this.wasm_video_player.ResumePlay()}},{key:"Refreash",value:function e(){this.refreash=true;this.wasmplayercom.Refreash();this.wasm_video_player.Refreash()}},{key:"RecordStart",value:function e(t){this.is_recording=true;this.is_record_audioinit=false;this.recoder=t}},{key:"RecordDataInput",value:function e(t,i,r,n){if(!this.is_recording)return;if(!this.record_id){this.record_id=CvNetVideo.WASM.CreateRecordFmp4FromBare(i);CvNetVideo.WasmId2Uc.r[this.record_id]=this.recoder}if(i===CvNetVideo.WASM.JX_H264||i===CvNetVideo.WASM.JX_H265){CvNetVideo.WASM.RecordFmp4FromBareInputVideo(this.record_id,t,t.length,r.high,r.low,n,0)}else if(i===CvNetVideo.WASM.JX_AAC||i===CvNetVideo.WASM.JX_ADPCMA||i===CvNetVideo.WASM.JX_G711A||i===CvNetVideo.WASM.JX_G711U||i===CvNetVideo.WASM.JX_G726){if(!this.is_record_audioinit){if(i==CvNetVideo.WASM.JX_G726){i=CvNetVideo.g726_conf.getPT(head.DLen)}CvNetVideo.WASM.RecordFmp4FromBareSetAudioInfo(this.record_id,8e3,16,1,i);this.is_record_audioinit=true}CvNetVideo.WASM.RecordFmp4FromBareInputAudio(this.record_id,t,t.length,r.high,r.low)}}},{key:"RecordStop",value:function e(){this.is_recording=false;if(this.record_id){CvNetVideo.WASM.RecordFmp4FromBareClear(this.record_id);this.record_id=null}}},{key:"SetRtvsAddr",value:function e(t){}},{key:"SetWhetherPlayAudio",value:function e(t){this._is_play_audio=t}},{key:"PlayFrame",value:function e(t,i,r,n){this.RecordDataInput(t,i,r,n);if(i===CvNetVideo.WASM.JX_H264||i===CvNetVideo.WASM.JX_H265){this.wasm_video_player.PlayFrame(t,i,r,n)}else if(i===CvNetVideo.WASM.JX_AAC||i===CvNetVideo.WASM.JX_ADPCMA||i===CvNetVideo.WASM.JX_G711A||i===CvNetVideo.WASM.JX_G711U||i===CvNetVideo.WASM.JX_G726){if(!this._is_play_audio)return;this.wasm_audio_player.PlayFrame(t,i,r)}}},{key:"onBufferAppending",value:function e(t){this.wasmplayercom.onBufferAppending(t)}},{key:"Playing",get:function e(){return false}}]);return a}(a.default);i.default=p},{"../PlayerInterface.js":110,"./WasmAudioPlayerImpl.js":113,"./WasmPlayerCom.js":116}],116:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../../helper/ByteHelper");var a=c(r);var s=e("../../utils/long");var o=c(s);function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var l=function(){function r(e,t,i){d(this,r);this.i_player=e;this.FunPlayFrame=t;this.config=i;this.playing=false;this.paused=false;this.waitiframe=false;this.isseek=false;this.first_timestamp=new o.default(0,0,true);this.isrealpaly=true;this.framebuffer=[];this.backupbuffer=[];this.PT=-1;this.multiple=1;this.count=0;this.speed=1}n(r,[{key:"StartRealTimeVideo",value:function e(){this.paused=false;this.waitiframe=true;this.playing=true;this.isrealpaly=true}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){this.paused=false;this.waitiframe=true;this.playing=true;if(t instanceof Date){this.starttime=t.getTime()/1e3}else{var a=t.replace(/-/g,"/");this.starttime=new Date(a).getTime()/1e3}if(i instanceof Date){this.endtime=i.getTime()/1e3}else{var s=i.replace(/-/g,"/");this.endtime=new Date(s).getTime()/1e3}this.multiple=1;if(r==1){if(n==2){this.multiple=2}else if(n==3){this.multiple=4}else if(n==4){this.multiple=8}else if(n==5){this.multiple=16}}this.isrealpaly=false;this.speed=1;this.BackPlayPlay()}},{key:"StopVideo",value:function e(){this.playing=false;this.framebuffer.length=0;this.backupbuffer.length=0;this.first_timestamp=new o.default(0,0,true)}},{key:"Pause",value:function e(){this.paused=true}},{key:"Play",value:function e(){this.paused=false}},{key:"Seek",value:function e(t){if(this.isrealpaly)return false;if(this.first_timestamp==-1){return false}var i=t;i=i<0?0:i;var r=this.first_timestamp.add(i*1e3);var n=0;if(this.backupbuffer.length>0){if(r.gt(this.backupbuffer[0].timestamp)&&r.lt(this.backupbuffer[this.backupbuffer.length-1].timestamp)){while(this.backupbuffer.length>0){var a=this.backupbuffer.pop();this.framebuffer.unshift(a);if(a.XXXX==0){if(a.timestamp.lt(r))break}}return true}if(r.gt(this.backupbuffer[this.backupbuffer.length-1].timestamp)&&r.lt(this.backupbuffer[this.backupbuffer.length-1].timestamp.add(2e3))){return true}}if(this.framebuffer.length>0){if(r.gt(this.framebuffer[0].timestamp)&&r.lt(this.framebuffer[this.framebuffer.length-1].timestamp)){while(this.framebuffer.length>0){if(this.framebuffer[0].XXXX==0&&this.framebuffer[0].timestamp.gt(r)){break}var s=this.framebuffer.shift();this.backupbuffer.push(s)}if(this.framebuffer.length==0){this.waitiframe=true}return true}}return false}},{key:"Refreash",value:function e(){while(this.framebuffer.length>0){var t=this.framebuffer.pop();if(t.PT==CvNetVideo.WASM.JX_H264||t.PT==CvNetVideo.WASM.JX_H265){if(t.XXXX==0){this.FunPlayFrame(t.data,t.PT,t.timestamp,t.XXXX);break}}}this.backupbuffer.length=0;this.framebuffer.length=0;this.waitiframe=true}},{key:"RealPlayInput",value:function e(t,i,r,n){this.FunPlayFrame(t,i,r,n)}},{key:"BackPlayInput",value:function e(t,i,r,n){if(this.first_timestamp.isZero()){this.first_timestamp=r}var a={data:t,timestamp:r,PT:i,XXXX:n};this.framebuffer.push(a)}},{key:"BackPlayPlay",value:function e(){if(!this.playing)return;this.count++;if(this.count%20==0){this.i_player.interfaceplayerbar.UpdateAll(this)}if(this.framebuffer.length==0||this.paused){this.start_play_cache=true;setTimeout(this.BackPlayPlay.bind(this),50);return}if(this.start_play_cache){var t=this.framebuffer[this.framebuffer.length-1].timestamp-this.framebuffer[0].timestamp;if(t<this.config.playbackStartCache){setTimeout(this.BackPlayPlay.bind(this),50/this.speed);return}this.start_play_cache=false}var i=void 0;var r=void 0;do{r=this.framebuffer.shift();this.backupbuffer.push(r);if(this.waitiframe&&(r.PT==CvNetVideo.WASM.JX_H264||r.PT==CvNetVideo.WASM.JX_H265)){if(r.XXXX!=0){if(this.framebuffer.length==0){this.start_play_cache=true;setTimeout(this.BackPlayPlay.bind(this),50);return}else{r.PT=-1;continue}}this.waitiframe=false}this.FunPlayFrame(r.data,r.PT,r.timestamp,r.XXXX);if(!i)i=r;if(this.framebuffer.length==0){this.start_play_cache=true;setTimeout(this.BackPlayPlay.bind(this),50/this.speed);return}r=this.framebuffer[0]}while(r.PT!=CvNetVideo.WASM.JX_H264&&r.PT!=CvNetVideo.WASM.JX_H265);var n=(r.timestamp-i.timestamp)/this.speed;n=n>200?200:n;if(n<=0){setTimeout(this.BackPlayPlay.bind(this),10)}else{setTimeout(this.BackPlayPlay.bind(this),n)}}},{key:"onBufferAppending",value:function e(t){if(!this.playing)return;if(t.data.length==12&&t.data[0]==255&&t.data[1]==254){this.PT=t.data[2];this.XXXX=t.data[3];this.Timestamp=a.default.Byte8ToULong(t.data,4)}else if(this.PT==-1){}else{if(this.isrealpaly){this.RealPlayInput(t.data,this.PT,this.Timestamp,this.XXXX)}else{this.BackPlayInput(t.data,this.PT,this.Timestamp,this.XXXX)}this.PT=-1}}},{key:"SetPlaySpeed",value:function e(t){this.speed=t}},{key:"PlayerBarIsReady",value:function e(){if(this.first_timestamp.isZero())return false;else return true}},{key:"PlayerBarGetLength",value:function e(){return this.endtime-this.starttime}},{key:"PlayerBarHaveBackupBuffer",value:function e(){if(this.backupbuffer.length>0)return true;else return false}},{key:"PlayerBarBackupBufferGetBegin",value:function e(){if(this.backupbuffer[0].timestamp.lt(this.first_timestamp))return 0;else return this.backupbuffer[0].timestamp.sub(this.first_timestamp).toInt()}},{key:"PlayerBarBackupBufferGetEnd",value:function e(){return this.backupbuffer[this.backupbuffer.length-1].timestamp.sub(this.first_timestamp).toInt()}},{key:"PlayerBarHaveFrameBuffer",value:function e(){if(this.framebuffer.length>0)return true;else return false}},{key:"PlayerBarFrameBufferGetBegin",value:function e(){if(this.framebuffer.length==0)return 0;return this.framebuffer[0].timestamp.sub(this.first_timestamp).toInt()}},{key:"PlayerBarFrameBufferGetEnd",value:function e(){if(this.framebuffer.length==0)return 0;return this.framebuffer[this.framebuffer.length-1].timestamp.sub(this.first_timestamp).toInt()}},{key:"PlayerBarSeek",value:function e(t){this.Seek(t)}},{key:"PlayerBarGetMultiple",value:function e(){return this.multiple}}]);return r}();i.default=l},{"../../helper/ByteHelper":94,"../../utils/long":128}],117:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("./WebGLYuvShowV2");var a=s(r);function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function r(e,t,i){o(this,r);this._config=e;this._canvas_gl=t;this._is_init=false;this._interface_player=i;this._playing=false;this._paused=false;this._refreash=false;this.working_count=0;this.wait_iframe=true;this._first_timestamp=-1;this._list_timestamps=[];this._last_time=0}n(r,[{key:"_Init",value:function e(){this.is_init=true;this.webglv2=new a.default(this._canvas_gl);this.id=0;var r=this;this.work_de=new Worker(window.URL.createObjectURL(new Blob(['importScripts("'+this._config.DecodeWasmWorkerUrl+'")'],{type:"application/javascript"})));this.work_de.onmessage=function(e){if(e.data.type==1){}else if(e.data.type==2){if(e.data.pid!=r.id)return;r.list_timestamp.shift();r.working_count--}else if(e.data.type==3){if(e.data.pid!=r.id)return;r._interface_player.LoadingPage(false);var t=r._list_timestamps.shift();if(r._config.events.onTimeStamp){var i=Math.abs(Math.round(t-r._first_timestamp));if(r._last_time!=i){r._config.events.onTimeStamp(r._interface_player.ucVideo.video_id,i);r._last_time=i}}if(r._playing){if(!r._paused)r.webglv2.renderFrame(e.data.width,e.data.height,e.data.data);else if(r._refreash){r._refreash=false;r.webglv2.renderFrame(e.data.width,e.data.height,e.data.data)}}r.working_count--}};if(this.offcanvas==undefined){this.work_de.postMessage({t:1,libffmpegUrl:this._config.libffmpegUrl})}else{this.work_de.postMessage({t:1,canvas:this.offcanvas,libffmpegUrl:this._config.libffmpegUrl},[this.offcanvas])}this.working_count=0}},{key:"StartPlay",value:function e(t){if(!this._is_init){this._Init();this._is_init=true}this.is_realplay=t;this._playing=true;this._paused=false;this._refreash=false;this.working_count=0;this.wait_iframe=true;this._first_timestamp=-1;this._list_timestamps=[];this._last_time=0;this.id++;this.work_de.postMessage({t:2,id:this.id})}},{key:"StopPlay",value:function e(){if(!this._is_init)return;this._playing=false;this.work_de.postMessage({t:4});if(this.webglv2){this.webglv2.clear()}}},{key:"Pause",value:function e(){this._paused=true}},{key:"ResumePlay",value:function e(){this._paused=false}},{key:"Refreash",value:function e(){this._refreash=true}},{key:"Flush",value:function e(){if(!this._is_init)return;this.work_de.postMessage({t:5})}},{key:"PlayFrame",value:function e(t,i,r,n){if(this.working_count>this._config.maxWasmWaitDecode){this.wait_iframe=true}if(this.wait_iframe){if(n!=0)return;else this.wait_iframe=false}this._list_timestamps.push(r);if(this._first_timestamp==-1){this._first_timestamp=r}if(this._config.usePlaybar&&!this.is_realplay){var a=t.slice();this.work_de.postMessage({t:3,p:i,a:a,x:n},[a.buffer]);this.working_count++}else{this.work_de.postMessage({t:3,p:i,a:t,x:n},[t.buffer]);this.working_count++}}}]);return r}();i.default=c},{"./WebGLYuvShowV2":118}],118:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function t(e){n(this,t);this.canvas=e;this.gl=e.getContext("webgl",{preserveDrawingBuffer:true})||e.getContext("experimental-webgl",{preserveDrawingBuffer:true});this._init()}r(t,[{key:"renderFrame",value:function e(t,i,r){this.canvas.width=t;this.canvas.height=i;var n=this.gl;n.viewport(0,0,t,i);n.clearColor(0,0,0,0);n.clear(n.COLOR_BUFFER_BIT);var a=t*i;var s=(t>>1)*(i>>1);n.bindTexture(n.TEXTURE_2D,n.y);n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,t,i,0,n.LUMINANCE,n.UNSIGNED_BYTE,r.subarray(0,a));n.bindTexture(n.TEXTURE_2D,n.u);n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,t>>1,i>>1,0,n.LUMINANCE,n.UNSIGNED_BYTE,r.subarray(a,a+s));n.bindTexture(n.TEXTURE_2D,n.v);n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,t>>1,i>>1,0,n.LUMINANCE,n.UNSIGNED_BYTE,r.subarray(a+s,r.length));n.drawArrays(n.TRIANGLE_STRIP,0,4)}},{key:"clear",value:function e(){var t=this.gl;t.clearColor(0,0,0,0);t.clear(t.COLOR_BUFFER_BIT)}},{key:"setSize",value:function e(t,i,r){var n=Math.min(r,t);this.canvas.width=n;this.canvas.height=n*i/t}},{key:"destroy",value:function e(){var t=this.gl;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)}},{key:"_init",value:function e(){var t=this.gl;if(!t){console.log("gl not support");return}t.pixelStorei(t.UNPACK_ALIGNMENT,1);var i="\n            attribute lowp vec4 a_vertexPosition;\n            attribute vec2 a_texturePosition;\n            varying vec2 v_texCoord;\n            void main() {\n                gl_Position = a_vertexPosition;\n                v_texCoord = a_texturePosition;\n            }\n        ";var r="\n            precision lowp float;\n            uniform sampler2D samplerY;\n            uniform sampler2D samplerU;\n            uniform sampler2D samplerV;\n            varying vec2 v_texCoord;\n            void main() {\n                float r,g,b,y,u,v,fYmul;\n                y = texture2D(samplerY, v_texCoord).r;\n                u = texture2D(samplerU, v_texCoord).r;\n                v = texture2D(samplerV, v_texCoord).r;\n\n                fYmul = y * 1.1643828125;\n                r = fYmul + 1.59602734375 * v - 0.870787598;\n                g = fYmul - 0.39176171875 * u - 0.81296875 * v + 0.52959375;\n                b = fYmul + 2.01723046875 * u - 1.081389160375;\n                gl_FragColor = vec4(r, g, b, 1.0);\n            }\n        ";var n=this._compileShader(i,t.VERTEX_SHADER);var a=this._compileShader(r,t.FRAGMENT_SHADER);var s=this._createProgram(n,a);this._initVertexBuffers(s);t.activeTexture(t.TEXTURE0);t.y=this._createTexture();t.uniform1i(t.getUniformLocation(s,"samplerY"),0);t.activeTexture(t.TEXTURE1);t.u=this._createTexture();t.uniform1i(t.getUniformLocation(s,"samplerU"),1);t.activeTexture(t.TEXTURE2);t.v=this._createTexture();t.uniform1i(t.getUniformLocation(s,"samplerV"),2)}},{key:"_initVertexBuffers",value:function e(t){var i=this.gl;var r=i.createBuffer();var n=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]);i.bindBuffer(i.ARRAY_BUFFER,r);i.bufferData(i.ARRAY_BUFFER,n,i.STATIC_DRAW);var a=i.getAttribLocation(t,"a_vertexPosition");i.vertexAttribPointer(a,3,i.FLOAT,false,0,0);i.enableVertexAttribArray(a);var s=new Float32Array([1,0,0,0,1,1,0,1]);var o=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,o);i.bufferData(i.ARRAY_BUFFER,s,i.STATIC_DRAW);var c=i.getAttribLocation(t,"a_texturePosition");i.vertexAttribPointer(c,2,i.FLOAT,false,0,0);i.enableVertexAttribArray(c)}},{key:"_compileShader",value:function e(t,i){var r=this.gl.createShader(i);this.gl.shaderSource(r,t);this.gl.compileShader(r);var n=this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS);if(!n){var a=this.gl.getShaderInfoLog(r);this.gl.deleteShader(r);console.error("could not compile shader",a);return}return r}},{key:"_createProgram",value:function e(t,i){var r=this.gl;var n=r.createProgram();r.attachShader(n,t);r.attachShader(n,i);r.linkProgram(n);r.useProgram(n);var a=this.gl.getProgramParameter(n,this.gl.LINK_STATUS);if(!a){console.err("program fail to link"+this.gl.getShaderInfoLog(n));return}return n}},{key:"_createTexture",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.gl.LINEAR;var i=this.gl;var r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t);return r}}]);return t}();i.default=a},{}],119:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("../PlayerInterface.js");var a=f(n);var s=e("../../utils/logger.js");var d=f(s);var o=e("../Wasm/WasmPlayerCom.js");var c=f(o);var l=e("../Wasm/WasmAudioPlayerImpl");var u=f(l);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var v=function(e){m(s,e);function s(e,t,i,r,n){h(this,s);var a=p(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t));a.ucvideo=e;a.canvas_2d=t;a.interface_player=i;a.change_wasmplayer=n;a.playercom=new c.default(i,a.PlayFrame.bind(a),e.config);a._is_play_audio=false;a.wait_iframe=true;a.webc_video_decoder=null;a.webc_audio_decoder=null;a.webc_context=null;a.webc_is_support=true;a.webc_video_pendingframes=[];a.is_use_smooth=a.ucvideo.config.webCodecSmoothMode;a.wasm_audio_player=new u.default(a.ucvideo);a.wasm_video_player=r;a.last_timestamp=0x10000000000000000;a.last_time=0;a.first_timestamp=-1;a.last_play_time=0;return a}r(s,[{key:"Pause",value:function e(){}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.webc_video_decoder=null;this.webc_audio_decoder=null;this.webc_is_support=true;this.timestamp=0;this.PT=-1;this._mime=null;this._width=0;this._height=0;this.wait_iframe=true;this.first_timestamp=-1;this.last_play_time=0;this.wasm_audio_player.Start();this.playercom.StartRealTimeVideo()}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var o=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;this.webc_video_decoder=null;this.webc_audio_decoder=null;this.webc_is_support=true;this.timestamp=0;this.PT=-1;this._mime=null;this._width=0;this._height=0;this.wait_iframe=true;this.first_timestamp=-1;this.last_play_time=0;this.refreash=false;this.wasm_audio_player.Start();this.playercom.StartBackTimeVideo(r,n,s,o)}},{key:"RecordStart",value:function e(t){this.is_recording=true;this.is_record_audioinit=false;this.recoder=t}},{key:"RecordDataInput",value:function e(t,i,r,n){if(!this.is_recording)return;if(!this.record_id){this.record_id=CvNetVideo.WASM.CreateRecordFmp4FromBare(i);CvNetVideo.WasmId2Uc.r[this.record_id]=this.recoder}if(i===CvNetVideo.WASM.JX_H264||i===CvNetVideo.WASM.JX_H265){CvNetVideo.WASM.RecordFmp4FromBareInputVideo(this.record_id,t,t.length,r.high,r.low,n,0)}else if(i===CvNetVideo.WASM.JX_AAC||i===CvNetVideo.WASM.JX_ADPCMA||i===CvNetVideo.WASM.JX_G711A||i===CvNetVideo.WASM.JX_G711U||i===CvNetVideo.WASM.JX_G726){if(!this.is_record_audioinit){if(i==CvNetVideo.WASM.JX_G726){i=CvNetVideo.g726_conf.getPT(head.DLen)}CvNetVideo.WASM.RecordFmp4FromBareSetAudioInfo(this.record_id,8e3,16,1,i);this.is_record_audioinit=true}CvNetVideo.WASM.RecordFmp4FromBareInputAudio(this.record_id,t,t.length,r.high,r.low)}}},{key:"RecordStop",value:function e(){this.is_recording=false;if(this.record_id){CvNetVideo.WASM.RecordFmp4FromBareClear(this.record_id);this.record_id=null}}},{key:"StopVideo",value:function e(){this.playercom.StopVideo();if(this.webc_audio_decoder){if(this.webc_audio_decoder.state!="closed")this.webc_audio_decoder.close();this.webc_audio_decoder=null}if(this.webc_video_decoder){while(this.webc_video_pendingframes.length>0){var t=this.webc_video_pendingframes.shift();t.close()}if(this.webc_video_decoder.state!="closed")this.webc_video_decoder.close();this.webc_video_decoder=null}if(this.webc_context){this.webc_context.clearRect(0,0,this.canvas_2d.width,this.canvas_2d.height);if(this.webc_context.reset)this.webc_context.reset();this.webc_context=null}this.wasm_audio_player.Stop();this.wasm_video_player.StopPlay();this.playercom.StopVideo()}},{key:"SetVolume",value:function e(t){this.wasm_audio_player.audioplay.SetVolume(t)}},{key:"Pause",value:function e(){this.wasm_audio_player.Pause();this.playercom.Pause();this.wasm_video_player.Pause()}},{key:"Play",value:function e(){this.wasm_audio_player.Play();this.playercom.Play();this.wasm_video_player.ResumePlay()}},{key:"Refreash",value:function e(){this.refreash=true;this.playercom.Refreash();this.wasm_video_player.Refreash()}},{key:"SetWhetherPlayAudio",value:function e(t){this._is_play_audio=t}},{key:"Flush",value:async function e(){if(this.webc_video_decoder){await this.webc_video_decoder.flush()}else{this.wasm_video_player.Flush()}}},{key:"onMediaInfo",value:function e(t){this._width=t.video_width;this._height=t.video_height;this._mime=t.video_mime}},{key:"onBufferAppending",value:function e(t){this.playercom.onBufferAppending(t)}},{key:"PlayFrame",value:async function e(t,i,r,n){this.RecordDataInput(t,i,r,n);if(i===CvNetVideo.WASM.JX_H264||i===CvNetVideo.WASM.JX_H265){if(this.webc_video_decoder==null&&this.webc_is_support){if(this._mime==null){this._mime=i==CvNetVideo.WASM.JX_H264?"avc1.4d401f":"hev1.1.6.L93.90"}await this._InitVideoDecoder(this._mime,this._width,this._height);if(this.webc_video_decoder==null){this.change_wasmplayer();this.webc_is_support=false;this.wasm_video_player.StartPlay(this.playercom.isrealpaly)}}if(this.webc_video_decoder){if(this.wait_iframe){if(n!=0)return;else{this.wait_iframe=false;d.default.debug("wait i frame end")}}if(n==0&&this.webc_video_decoder.decodeQueueSize+this.webc_video_pendingframes.length>this.ucvideo.config.webCodecVideoDecodeBufferMax){d.default.debug("wait i frame begin decoder_size:"+this.webc_video_decoder.decodeQueueSize+" play_size:"+this.webc_video_pendingframes.length);this.wait_iframe=true}var a=new EncodedVideoChunk({timestamp:r,type:n==0?"key":"delta",data:t});try{this.webc_video_decoder.decode(a)}catch(e){while(this.webc_video_pendingframes.length>0){var s=this.webc_video_pendingframes.shift();s.close()}this.webc_video_decoder=null}}else{this.wasm_video_player.PlayFrame(t,i,r,n)}}else if(i===CvNetVideo.WASM.JX_AAC||i===CvNetVideo.WASM.JX_ADPCMA||i===CvNetVideo.WASM.JX_G711A||i===CvNetVideo.WASM.JX_G711U||i===CvNetVideo.WASM.JX_G726){if(!this._is_play_audio)return;if(this.webc_audio_decoder==null){var o="";if(i===CvNetVideo.WASM.JX_AAC)o="mp4a.40.2";else if(i==CvNetVideo.WASM.JX_G711A)o="alaw";else if(i==CvNetVideo.WASM.JX_G711U)o="ulaw";if(o!=""){}}if(this.webc_audio_decoder){if(t[1]==1&&t.length==t[2]*2+4){t=t.subarray(4,t.length)}var c=new EncodedAudioChunk({timestamp:0,type:"key",data:t});this.webc_audio_decoder.decode(c)}else{this.wasm_audio_player.PlayFrame(t,i,r)}}}},{key:"_InitVideoDecoder",value:async function e(t,i,r){var n=void 0;if(i>0&&r>0){n={codec:t,codedWidth:i,codedHeight:r}}else{n={codec:t}}try{var a=await VideoDecoder.isConfigSupported(n),s=a.supported;if(s){var o={output:this._HandleVideoFrame.bind(this),error:function(e){console.log(e.message)}.bind(this)};this.webc_video_decoder=new VideoDecoder(o);this.webc_video_decoder.configure(n);this.webc_context=this.canvas_2d.getContext("2d");window.requestAnimationFrame(this._RenderFrame.bind(this))}else{d.default.warn("dont support video codec mime:"+t)}}catch(e){d.default.warn("dont support video codec mime:"+t)}}},{key:"_InitAudioDecoder",value:async function e(t,i,r){var n={codec:t,sampleRate:i,numberOfChannels:r};try{var a=await AudioDecoder.isConfigSupported(n),s=a.supported;if(s){var o={output:this._HandleAudioFrame.bind(this),error:function(e){console.log(e.message)}.bind(this)};this.webc_audio_decoder=new AudioDecoder(o);this.webc_audio_decoder.configure(n)}else{d.default.warn("dont support audio codec mime:"+t)}}catch(e){d.default.warn("dont support audio codec mime:"+t)}}},{key:"_HandleVideoFrame",value:function e(t){this.interface_player.LoadingPage(false);this.webc_video_pendingframes.push(t)}},{key:"_HandleAudioFrame",value:function e(t){var i=new Float32Array(t.numberOfFrames);if(t.format=="f32-planar"){t.copyTo(i,{planeIndex:0})}else{var r=new Uint16Array(t.numberOfFrames);t.copyTo(r,{planeIndex:0});for(var n=0;n<r.length;n++){i[n]=r[n]>=32768?-(65536-r[n])/32768:r[n]/32767}}this.audioplay.PlayPCM(i,t.sampleRate)}},{key:"_RenderFrame",value:async function e(){if(this.webc_video_pendingframes.length){if(this.is_use_smooth&&this.webc_video_decoder.decodeQueueSize<25){var t=(new Date).getTime();var i=this.webc_video_pendingframes[0].timestamp;var r=(i-this.last_timestamp)*this.playercom.speed;var n=t-this.last_time;var a=100*this.playercom.speed;if(r-15<n||a<n||this.webc_video_pendingframes.length>25){this._RenderFrameDo();this.last_time=t;this.last_timestamp=i;d.default.debug("[mediacodec]render frame time differ:"+n+" differ_pts:"+r+" buf:"+this.webc_video_pendingframes.length)}}else{this._RenderFrameDo()}}if(this.webc_video_decoder){window.requestAnimationFrame(this._RenderFrame.bind(this))}}},{key:"_RenderFrameDo",value:function e(){var t=this.webc_video_pendingframes.shift();if(this.webc_video_decoder){if(!this.playercom.paused){this.canvas_2d.width=t.codedWidth;this.canvas_2d.height=t.codedHeight;this.webc_context.drawImage(t,0,0,this.canvas_2d.width,this.canvas_2d.height);if(this.ucvideo.config.events.onTimeStamp){if(this.first_timestamp==-1){this.first_timestamp=t.timestamp}var i=Math.abs(Math.round(t.timestamp-this.first_timestamp));if(this.last_play_time!=i){this.ucvideo.config.events.onTimeStamp(this.ucvideo.video_id,i);this.last_play_time=i}}}else if(this.refreash){this.refreash=false;this.canvas_2d.width=t.codedWidth;this.canvas_2d.height=t.codedHeight;this.webc_context.drawImage(t,0,0,this.canvas_2d.width,this.canvas_2d.height)}}t.close()}},{key:"Playing",get:function e(){return false}}]);return s}(a.default);i.default=v},{"../../utils/logger.js":127,"../PlayerInterface.js":110,"../Wasm/WasmAudioPlayerImpl":113,"../Wasm/WasmPlayerCom.js":116}],120:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=e("../PlayerInterface.js");var a=g(r);var s=e("protoo-client");var o=g(s);var c=e("mediasoup-client");var _=y(c);var d=e("url-parse");var l=g(d);var u=e("random-string");var p=g(u);var f=e("../../utils/logger");var b=g(f);var h=e("../../utils/cvComm");var m=g(h);var v=e("./urlFactory");function y(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var i in e){if(Object.prototype.hasOwnProperty.call(e,i))t[i]=e[i]}}t.default=e;return t}}function g(e){return e&&e.__esModule?e:{default:e}}function w(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function S(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function k(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var C=function(e){k(r,e);function r(e,t){w(this,r);var i=S(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));i.wfs=e;i.ucvideo=e;i.videodom=t;i.webrtcInit(false);i.time_id=-1;i.last_time=0;return i}n(r,[{key:"onWebrtcSFUInfo",value:function e(t){this._webrtc_ip=t.webrtc_ip;if(m.default.IsHttps()){this._webrtc_port=t.webrtc_port_ssl}else{this._webrtc_port=t.webrtc_port}this.roomid=t.roomid}},{key:"StartRealTimeVideo",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this.Sim=t;this.Channel=i;var n=t;var a=i;var s=(0,p.default)({length:8}).toLowerCase();var o=this._webrtc_ip;var c=this._webrtc_port;var d=this.roomid;b.default.custom("webrtc","StartRealTimeVideo webrtc:%s:%s",o,c);this._protooUrl=(0,v.getProtooUrl)({sim:n,channel:a,peerId:s,webrtcip:o,webrtcport:c,roomid:d,streamType:r});this.StartVideo()}},{key:"StartBackTimeVideo",value:function e(t,i,r,n){var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;this.Sim=t;this.Channel=i;var s=t;var o=i;var c=(0,p.default)({length:8}).toLowerCase();var d=this._webrtc_ip;var l=this._webrtc_port;var u=this.roomid;var f=r;var h=n;b.default.custom("webrtc","StartBackTimeVideo webrtc:%s:%s",d,l);this._protooUrl=(0,v.getProtooUrlHistory)({sim:s,channel:o,peerId:c,webrtcip:d,webrtcport:l,roomid:u,startTime:f,endTime:h,streamType:a});this.StartVideo()}},{key:"StopVideo",value:function e(){this.webrtcClose();this.videodom.srcObject=null}},{key:"SetRtvsAddr",value:function e(t){this._rtvs_ip=t}},{key:"onMediaTimeUpdate",value:function e(){if(this.ucvideo.config.events.onTimeStamp){if(this.ucvideo.config.events.onTimeStamp){var t=Math.round(this.videodom.currentTime*1e3);if(this.last_time!=t){this.ucvideo.config.events.onTimeStamp(this.ucvideo.video_id,t);this.last_time=t}}}}},{key:"StartHeartbeat",value:function e(){if(this.time_id===-1){this.time_id=setInterval(this.SendHeartbeatPackage.bind(this),1e3*5)}}},{key:"StopHeartbeat",value:function e(){clearInterval(this.time_id);this.time_id=-1}},{key:"SendHeartbeatPackage",value:function e(){this.wfs.jt1078.Send8801(this.Sim,this.Channel,this._roomId.roomid)}},{key:"StartVideo",value:function e(){var g=this;var t=new o.default.WebSocketTransport(this._protooUrl);this._protoo=new o.default.Peer(t);this._protoo.on("open",function(){return g._joinRoom()});this._protoo.on("disconnected",function(){if(g._recvTransport){g._recvTransport.close();g._recvTransport=null}});this._protoo.on("close",function(){if(g._closed)return;g.webrtcClose()});this._protoo.on("request",async function(e,t,i){b.default.custom("webrtc",'proto "request" event [method:%s, data:%o]',e.method,e.data);switch(e.method){case"newConsumer":{var r=e.data,n=r.peerId,a=r.producerId,s=r.id,o=r.kind,c=r.rtpParameters,d=r.type,l=r.appData,u=r.producerPaused;var f=void 0;if(o==="audio"){f={opusStereo:1}}try{var h=await g._recvTransport.consume({id:s,producerId:a,kind:o,rtpParameters:c,codecOptions:f,appData:{appData:l,peerId:n}});g._consumers.set(h.id,h);h.on("transportclose",function(){g._consumers.delete(h.id)});var p=_.parseScalabilityMode(h.rtpParameters.encodings[0].scalabilityMode),m=p.spatialLayers,v=p.temporalLayers;var y=h.track;if(g.videodom.srcObject==null){g.videodom.srcObject=new MediaStream([y])}else{g.videodom.srcObject.addTrack(y)}g.videodom.play();t()}catch(e){b.default.error('"newConsumer" request failed:%o',e);throw e}break}}});this._protoo.on("notification",function(e){b.default.custom("webrtc",'proto "notification" event [method:%s, data:%o]',e.method,e.data);switch(e.method){case"consumerClosed":{var t=e.data.consumerId;var i=g._consumers.get(t);if(!i)break;i.close();g._consumers.delete(t);break}}});this._closed=false}},{key:"webrtcInit",value:function e(t){this._closed=true;this._forceTcp=t;this._protoo=null;this._recvTransport=null;this._consumers=new Map;var i=new l.default(window.location.href,true);this._handlerName=i.query.handler}},{key:"webrtcClose",value:function e(){if(this._closed)return;this._closed=true;b.default.custom("webrtc","close()");this._protoo.close();if(this._recvTransport){this._recvTransport.close();this.StopHeartbeat()}}},{key:"_joinRoom",value:async function e(){var n=this;b.default.custom("webrtc","_joinRoom()");try{this._mediasoupDevice=new _.Device({handlerName:this._handlerName});var t=await this._protoo.request("getRouterRtpCapabilities");this._roomId=await this._protoo.request("getRoomId");await this._mediasoupDevice.load({routerRtpCapabilities:t});if(true){var i=await this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:false,consuming:true,sctpCapabilities:undefined});var r=i.id,a=i.iceParameters,s=i.iceCandidates,o=i.dtlsParameters,c=i.sctpParameters;this._recvTransport=this._mediasoupDevice.createRecvTransport({id:r,iceParameters:a,iceCandidates:s,dtlsParameters:o,sctpParameters:c,iceServers:[]});this._recvTransport.on("connect",function(e,t,i){var r=e.dtlsParameters;b.default.custom("webrtc","_recvTransport.on connect");n._protoo.request("connectWebRtcTransport",{transportId:n._recvTransport.id,dtlsParameters:r}).then(t).catch(i)});this.StartHeartbeat()}var d=await this._protoo.request("join",{displayName:"rtvs",device:"rtvs",rtpCapabilities:this._mediasoupDevice.rtpCapabilities,sctpCapabilities:undefined}),l=d.peers}catch(e){b.default.custom("webrtc","_joinRoom() failed:%o",e);this.webrtcClose()}}},{key:"enableAudioOnly",value:async function e(){b.default.custom("webrtc","enableAudioOnly()");var t=true;var i=false;var r=undefined;try{for(var n=this._consumers.values()[Symbol.iterator](),a;!(t=(a=n.next()).done);t=true){var s=a.value;if(s.kind!=="video")continue;this._pauseConsumer(s)}}catch(e){i=true;r=e}finally{try{if(!t&&n.return){n.return()}}finally{if(i){throw r}}}}},{key:"disableAudioOnly",value:async function e(){b.default.custom("webrtc","disableAudioOnly()");var t=true;var i=false;var r=undefined;try{for(var n=this._consumers.values()[Symbol.iterator](),a;!(t=(a=n.next()).done);t=true){var s=a.value;if(s.kind!=="video")continue;this._resumeConsumer(s)}}catch(e){i=true;r=e}finally{try{if(!t&&n.return){n.return()}}finally{if(i){throw r}}}}},{key:"restartIce",value:async function e(){b.default.custom("webrtc","restartIce()");try{if(this._recvTransport){var t=await this._protoo.request("restartIce",{transportId:this._recvTransport.id});await this._recvTransport.restartIce({iceParameters:t})}}catch(e){b.default.error("restartIce() | failed:%o",e)}}},{key:"setConsumerPreferredLayers",value:async function e(t,i,r){b.default.custom("webrtc","setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",t,i,r);try{await this._protoo.request("setConsumerPreferredLayers",{consumerId:t,spatialLayer:i,temporalLayer:r})}catch(e){b.default.error("setConsumerPreferredLayers() | failed:%o",e)}}},{key:"setConsumerPriority",value:async function e(t,i){b.default.custom("webrtc","setConsumerPriority() [consumerId:%s, priority:%d]",t,i);try{await this._protoo.request("setConsumerPriority",{consumerId:t,priority:i})}catch(e){b.default.error("setConsumerPriority() | failed:%o",e)}}},{key:"requestConsumerKeyFrame",value:async function e(t){b.default.custom("webrtc","requestConsumerKeyFrame() [consumerId:%s]",t);try{await this._protoo.request("requestConsumerKeyFrame",{consumerId:t})}catch(e){b.default.error("requestConsumerKeyFrame() | failed:%o",e)}}},{key:"changeDisplayName",value:async function e(t){b.default.custom("webrtc",'changeDisplayName() [displayName:"%s"]',t);try{await this._protoo.request("changeDisplayName",{displayName:t});this._displayName=t}catch(e){b.default.error("changeDisplayName() | failed: %o",e)}}},{key:"getRecvTransportRemoteStats",value:async function e(){b.default.custom("webrtc","getRecvTransportRemoteStats()");if(!this._recvTransport)return;return this._protoo.request("getTransportStats",{transportId:this._recvTransport.id})}},{key:"getConsumerRemoteStats",value:async function e(t){b.default.custom("webrtc","getConsumerRemoteStats()");var i=this._consumers.get(t);if(!i)return;return this._protoo.request("getConsumerStats",{consumerId:t})}},{key:"getRecvTransportLocalStats",value:async function e(){b.default.custom("webrtc","getRecvTransportLocalStats()");if(!this._recvTransport)return;return this._recvTransport.getStats()}},{key:"getConsumerLocalStats",value:async function e(t){var i=this._consumers.get(t);if(!i)return;return i.getStats()}},{key:"applyNetworkThrottle",value:async function e(t){var i=t.uplink,r=t.downlink,n=t.rtt,a=t.secret;b.default.custom("webrtc","applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",i,r,n);try{await this._protoo.request("applyNetworkThrottle",{uplink:i,downlink:r,rtt:n,secret:a})}catch(e){b.default.error("applyNetworkThrottle() | failed:%o",e)}}},{key:"resetNetworkThrottle",value:async function e(t){var i=t.silent,r=i===undefined?false:i,n=t.secret;b.default.custom("webrtc","resetNetworkThrottle()");try{await this._protoo.request("resetNetworkThrottle",{secret:n})}catch(e){if(!r){b.default.error("resetNetworkThrottle() | failed:%o",e)}}}},{key:"_pauseConsumer",value:async function e(t){if(t.paused)return;try{await this._protoo.request("pauseConsumer",{consumerId:t.id});t.pause()}catch(e){b.default.error("_pauseConsumer() | failed:%o",e)}}},{key:"_resumeConsumer",value:async function e(t){if(!t.paused)return;try{await this._protoo.request("resumeConsumer",{consumerId:t.id});t.resume()}catch(e){b.default.error("_resumeConsumer() | failed:%o",e)}}},{key:"Playing",get:function e(){return!this._closed}}]);return r}(a.default);i.default=C},{"../../utils/cvComm":125,"../../utils/logger":127,"../PlayerInterface.js":110,"./urlFactory":121,"mediasoup-client":46,"protoo-client":59,"random-string":67,"url-parse":84}],121:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i.getProtooUrl=a;i.getProtooUrlHistory=s;var r=e("../../utils/cvComm");var f=n(r);function n(e){return e&&e.__esModule?e:{default:e}}function h(){function e(){return((1+Math.random())*65536|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function a(e){var t=e.sim,i=e.channel,r=e.peerId,n=e.webrtcip,a=e.webrtcport,s=e.roomid,o=e.streamType;var c=f.default.GetWsp()+(n+":"+a+"/?sim="+t+"&channel="+i+"&peerId="+r+"&roomid="+s+"&streamType="+o+"&isReal=1");return c}function s(e){var t=e.sim,i=e.channel,r=e.peerId,n=e.webrtcip,a=e.webrtcport,s=e.roomid,o=e.startTime,c=e.endTime,d=e.streamType;var l=h();var u=f.default.GetWsp()+(n+":"+a+"/?sim="+t+"&channel="+i+"&peerId="+r+"&roomid="+s+"&startTime="+o+"&endTime="+c+"&guid="+l+"&streamType="+d+"&isReal=0");return u}},{"../../utils/cvComm":125}],122:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=function(){function e(r,n){a(this,e);this.changeTime=(new Date).getTime();this.ucMain=n;this.status=0;this.regEventListener();this.config=r;this.interval=setInterval(function(){if(n.NowPlayVideosCount>0){var e=(new Date).getTime()-this.changeTime;if(r.timeoutWarningMsec>0){if(this.status==0&&e>=r.timeoutWarningMsec){this.status=1;if(r.events.timeoutWarning)r.events.timeoutWarning(r.timeoutCloseMsec-e,this.changeTime)}}if(r.timeoutCloseMsec>0){if(this.status<2&&e>=r.timeoutCloseMsec){this.status=2;if(r.events.timeoutClose)r.events.timeoutClose(this.changeTime)}}for(var t in n.Videos){var i=n.Videos[t];if(i&&i.IsPlaying()){if(i.tmpShowKBpsText){i.tmpShowKBpsText=false}else{i.tmpShowKBpsText=true;i.ShowKBpsText()}i.ShowRecordText();i.Check()}}}}.bind(this),1e3)}r(e,[{key:"regEventListener",value:function e(){window.addEventListener("click",this.onevent.bind(this));window.addEventListener("keydown",this.onevent.bind(this));window.addEventListener("mousemove",this.onevent.bind(this));window.addEventListener("mousewheel",this.onevent.bind(this))}},{key:"onevent",value:function e(){if(this.status==1){if(this.config.events.timeoutCanceled)this.config.events.timeoutCanceled()}this.status=0;this.changeTime=(new Date).getTime()}}]);return e}();i.default=n},{}],123:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e)}r(e,null,[{key:"AacAdtsDemux",value:function e(t){if(!this.IsAdts(t)){return{errcode:-1}}var i=1;i++;var r=t[i]>>6&3;var n=t[i]>>2&15;var a=(t[i]&1)<<2|t[i+1]>>6&3;var s=void 0;switch(n){case 0:s=96e3;break;case 1:s=88200;break;case 2:s=64e3;break;case 3:s=48e3;break;case 4:s=44100;break;case 5:s=32e3;break;case 6:s=24e3;break;case 7:s=22050;break;case 8:s=16e3;break;case 9:s=12e3;break;case 10:s=11025;break;case 11:s=8e3;break;case 12:s=7350;break;default:return{errcode:-1}}return{errcode:0,profile:r,sample_rate:s,channel:a}}},{key:"IsAdts",value:function e(t){if(t.length<7)return false;var i=0;if((t[i]&255)!=255||(t[i+1]&240)!=240){return false}return true}},{key:"AacAdtsPack",value:function e(t,i,r){t[0]=255;t[1]=241;t[2]=64+(i<<2)+(r>>2);t[3]=((r&3)<<6)+(t.length>>11);t[4]=(t.length&2047)>>3;t[5]=((t.length&7)<<5)+31;t[6]=252}},{key:"AacAdtsGetSampleRateIndex",value:function e(t){switch(t){case 96e3:return 0;case 88200:return 1;case 64e3:return 2;case 48e3:return 3;case 44100:return 4;case 32e3:return 5;case 24e3:return 6;case 22050:return 7;case 16e3:return 8;case 12e3:return 9;case 11025:return 10;case 8e3:return 11;case 7350:return 12;default:return 4}}}]);return e}();i.default=a},{}],124:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this.items=[];this.byteLength=0}r(e,[{key:"push",value:function e(t){this.items.push(t);this.byteLength+=t.byteLength}},{key:"take",value:function e(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var n=t+i;if(this.byteLength<n){return}var a=new Uint8Array(t);var s=0;var o=n;for(var c=0;c<this.items.length;c++){if(this.items[c].byteLength>=o){a.set(this.items[c].subarray(i,o),s);if(r){if(this.items[c].byteLength==o){this.items.splice(0,c+1)}else{if(c>0){this.items.splice(0,c)}this.items[0]=this.items[0].subarray(o)}this.byteLength-=n}return a}else{if(i>0){var d=this.items[c].byteLength-i;if(d>0){a.set(this.items[c].subarray(i),s);s+=this.items[c].byteLength-i;i=0}else{i=-d}}else{a.set(this.items[c],s);s+=this.items[c].byteLength}o-=this.items[c].byteLength}}}},{key:"combine",value:function e(){if(this.byteLength==0)return null;var t=new Uint8Array(this.byteLength);var i=0;for(var r=0;r<this.items.length;r++){t.set(this.items[r],i);i+=this.items[r].byteLength}return t}},{key:"clear",value:function e(){this.items=[];this.byteLength=0}}]);return e}();i.default=a},{}],125:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function i(){n(this,i)}r(i,null,[{key:"SimChannelLen",value:function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(r==0){t=this.FixLen(t,12)}else if(r==2){if(!/.{20}_.{20}/g.test(t)){t=this.FixLen(t,20)+"_"+this.FixLen(i,20)}i=1}else{t=this.FixLen(t,20)}return{Sim:t,Channel:i}}},{key:"FixLen",value:function e(t,i){if(typeof t!=="string"){t=String(t)}if(t.length>i){return t.substr(0,i)}else{while(t.length<i){t="0"+t}return t}}},{key:"IsHttps",value:function e(){if(document){return document.location.protocol=="https:"}else{return true}}},{key:"GetWsp",value:function e(){if(i.IsHttps()){return"wss://"}else{return"ws://"}}},{key:"GetClusterPort",value:function e(t){if(t.usingCluster){if(i.IsHttps()&&t.clusterWssPort){return t.clusterWssPort}else{return t.clusterPort}}}},{key:"loadJs",value:function e(t,i){var r=document.createElement("script");r.type="text/javascript";if(typeof i!="undefined"){if(r.readyState){r.onreadystatechange=function(){if(r.readyState=="loaded"||r.readyState=="complete"){r.onreadystatechange=null;i()}}}else{r.onload=function(){i()}}}r.src=t;document.body.appendChild(r)}},{key:"loadCss",value:function e(t,i,r,n){var a=document.createElement("link");a.type="text/css";a.rel="stylesheet";if(i){a.id=i}if(typeof r!="undefined"){if(a.readyState){a.onreadystatechange=function(){if(a.readyState=="loaded"||a.readyState=="complete"){a.onreadystatechange=null;r()}}}else{a.onload=function(){r()}}}a.href=t;if(n)document.head.prepend(a);else document.head.appendChild(a)}},{key:"IsFullscreen",value:function e(){return this.IsFullscreen(null)}},{key:"IsFullscreen",value:function e(t){if(this.FullscreenEnabled()){if(document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen){var i=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(i&&(i.classList.contains("video-box-body")||i.classList.contains("video-container"))){this.Fullscreen=true;return this.Fullscreen}}return false}else if(t){this.Fullscreen=t.classList.contains("full");return this.Fullscreen}else if(this.Fullscreen){return true}return false}},{key:"FullscreenEnabled",value:function e(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled}},{key:"SupportCodec",value:async function e(){try{var t=await VideoDecoder.isConfigSupported({codec:"avc1.4d401f"}),i=t.supported;if(i){return true}}catch(e){}return false}}]);return i}();i.default=a},{}],126:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function e(t,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:4;n(this,e);this.min=i;this.max=i+r;this.bits_per_coded_sample=t};var s=function(){function i(){n(this,i);this.data=new Array;this.default_bits_per_coded_sample=4}r(i,[{key:"get_bits_per_coded_sample",value:function e(t){for(var i=0;i<this.data.length;i++){var r=this.data[i];if(t>=r.min&&t<=r.max){return r.bits_per_coded_sample}}return this.default_bits_per_coded_sample}},{key:"getPT",value:function e(t){switch(this.get_bits_per_coded_sample(t)){case 2:return 253;case 3:return 254;case 5:return 255}return 8}}],[{key:"getDefault",value:function e(){var t=new i;t.data.push(new a(2,20));t.data.push(new a(2,40));t.data.push(new a(3,30));t.data.push(new a(3,60));t.data.push(new a(3,90));t.data.push(new a(3,120));t.data.push(new a(3,180));t.data.push(new a(4,80));t.data.push(new a(4,160));t.data.push(new a(4,240));t.data.push(new a(5,50));t.data.push(new a(5,100));t.data.push(new a(5,150));t.data.push(new a(5,200));t.data.push(new a(5,300));return t}}]);return i}();i.default=s},{}],127:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var c=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function o(){n(this,o)}r(o,null,[{key:"SetLevel",value:function e(t){o.level=t}},{key:"SetTag",value:function e(t){if(typeof o.tags=="undefined")o.tags=new Map;o.tags.set(t,1)}},{key:"debug",value:function e(t){var i;if(typeof o.level!="undefined"&&o.level>0){return}for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++){n[a-1]=arguments[a]}(i=console).log.apply(i,["debug:"+(new Date).toLocaleTimeString()+" :"+t].concat(n))}},{key:"warn",value:function e(t){var i;if(typeof o.level!="undefined"&&o.level>1){return}for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++){n[a-1]=arguments[a]}(i=console).log.apply(i,["warn:"+(new Date).toLocaleTimeString()+" :"+t].concat(n))}},{key:"error",value:function e(t){var i;if(typeof o.level!="undefined"&&o.level>2){return}for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++){n[a-1]=arguments[a]}(i=console).log.apply(i,["error "+(new Date).toLocaleTimeString()+" :"+t].concat(n))}},{key:"custom",value:function e(t,i){var r;if(typeof o.tags=="undefined")return;if(!c(o.tags.has(t)))return;for(var n=arguments.length,a=Array(n>2?n-2:0),s=2;s<n;s++){a[s-2]=arguments[s]}(r=console).log.apply(r,["tag:"+t+" "+(new Date).toLocaleTimeString()+" :"+i].concat(a))}},{key:"downArrayBuffer",value:function e(t,i){var r=new Blob([t]);this.downBlob(r,i)}},{key:"downUint8Arrays",value:function e(t,i){var r=new Blob(t);this.downBlob(r,i)}},{key:"downBlob",value:function e(t,i){var r=document.createElement("a");r.download=i;r.style.display="none";r.href=URL.createObjectURL(t);document.body.appendChild(r);r.click();URL.revokeObjectURL(r.href);document.body.removeChild(r)}},{key:"diffTimeStr",value:function e(t,i){var r=i.getTime()-t.getTime();var n=Math.floor(r/(24*3600*1e3));var a=r%(24*3600*1e3);var s=Math.floor(a/(3600*1e3));var o=a%(3600*1e3);var c=Math.floor(o/(60*1e3));var d=o%(60*1e3);var l=Math.round(d/1e3);var u=l.toString();if(l<10){u="0"+u}u=c+":"+u;if(c<10){u="0"+u}if(s>0){u=s+":"+u}if(n>0){u=n+"d"+u}return u}}]);return o}();i.default=a},{}],128:[function(e,t,i){"use strict";t.exports=n;var m=null;try{m=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,i){this.low=e|0;this.high=t|0;this.unsigned=!!i}n.prototype.__isLong__;Object.defineProperty(n.prototype,"__isLong__",{value:true});function v(e){return(e&&e["__isLong__"])===true}n.isLong=v;var a={};var s={};function r(e,t){var i,r,n;if(t){e>>>=0;if(n=0<=e&&e<256){r=s[e];if(r)return r}i=g(e,(e|0)<0?-1:0,true);if(n)s[e]=i;return i}else{e|=0;if(n=-128<=e&&e<128){r=a[e];if(r)return r}i=g(e,e<0?-1:0,false);if(n)a[e]=i;return i}}n.fromInt=r;function y(e,t){if(isNaN(e))return t?p:w;if(t){if(e<0)return p;if(e>=f)return P}else{if(e<=-h)return R;if(e+1>=h)return T}if(e<0)return y(-e,t).neg();return g(e%d|0,e/d|0,t)}n.fromNumber=y;function g(e,t,i){return new n(e,t,i)}n.fromBits=g;var u=Math.pow;function l(e,t,i){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return w;if(typeof t==="number"){i=t,t=false}else{t=!!t}i=i||10;if(i<2||36<i)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");else if(r===0){return l(e.substring(1),t,i).neg()}var n=y(u(i,8));var a=w;for(var s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+o),i);if(o<8){var d=y(u(i,o));a=a.mul(d).add(y(c))}else{a=a.mul(n);a=a.add(y(c))}}a.unsigned=t;return a}n.fromString=l;function _(e,t){if(typeof e==="number")return y(e,t);if(typeof e==="string")return l(e,t);return g(e.low,e.high,typeof t==="boolean"?t:e.unsigned)}n.fromValue=_;var o=1<<16;var c=1<<24;var d=o*o;var f=d*d;var h=f/2;var b=r(c);var w=r(0);n.ZERO=w;var p=r(0,true);n.UZERO=p;var S=r(1);n.ONE=S;var k=r(1,true);n.UONE=k;var C=r(-1);n.NEG_ONE=C;var T=g(4294967295|0,2147483647|0,false);n.MAX_VALUE=T;var P=g(4294967295|0,4294967295|0,true);n.MAX_UNSIGNED_VALUE=P;var R=g(0,2147483648|0,false);n.MIN_VALUE=R;var E=n.prototype;E.toInt=function e(){return this.unsigned?this.low>>>0:this.low};E.toNumber=function e(){if(this.unsigned)return(this.high>>>0)*d+(this.low>>>0);return this.high*d+(this.low>>>0)};E.toString=function e(t){t=t||10;if(t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(R)){var i=y(t),r=this.div(i),n=r.mul(i).sub(this);return r.toString(t)+n.toInt().toString(t)}else return"-"+this.neg().toString(t)}var a=y(u(t,6),this.unsigned),s=this;var o="";while(true){var c=s.div(a),d=s.sub(c.mul(a)).toInt()>>>0,l=d.toString(t);s=c;if(s.isZero())return l+o;else{while(l.length<6){l="0"+l}o=""+l+o}}};E.getHighBits=function e(){return this.high};E.getHighBitsUnsigned=function e(){return this.high>>>0};E.getLowBits=function e(){return this.low};E.getLowBitsUnsigned=function e(){return this.low>>>0};E.getNumBitsAbs=function e(){if(this.isNegative())return this.eq(R)?64:this.neg().getNumBitsAbs();var t=this.high!=0?this.high:this.low;for(var i=31;i>0;i--){if((t&1<<i)!=0)break}return this.high!=0?i+33:i+1};E.isZero=function e(){return this.high===0&&this.low===0};E.eqz=E.isZero;E.isNegative=function e(){return!this.unsigned&&this.high<0};E.isPositive=function e(){return this.unsigned||this.high>=0};E.isOdd=function e(){return(this.low&1)===1};E.isEven=function e(){return(this.low&1)===0};E.equals=function e(t){if(!v(t))t=_(t);if(this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1)return false;return this.high===t.high&&this.low===t.low};E.eq=E.equals;E.notEquals=function e(t){return!this.eq(t)};E.neq=E.notEquals;E.ne=E.notEquals;E.lessThan=function e(t){return this.comp(t)<0};E.lt=E.lessThan;E.lessThanOrEqual=function e(t){return this.comp(t)<=0};E.lte=E.lessThanOrEqual;E.le=E.lessThanOrEqual;E.greaterThan=function e(t){return this.comp(t)>0};E.gt=E.greaterThan;E.greaterThanOrEqual=function e(t){return this.comp(t)>=0};E.gte=E.greaterThanOrEqual;E.ge=E.greaterThanOrEqual;E.compare=function e(t){if(!v(t))t=_(t);if(this.eq(t))return 0;var i=this.isNegative(),r=t.isNegative();if(i&&!r)return-1;if(!i&&r)return 1;if(!this.unsigned)return this.sub(t).isNegative()?-1:1;return t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1};E.comp=E.compare;E.negate=function e(){if(!this.unsigned&&this.eq(R))return R;return this.not().add(S)};E.neg=E.negate;E.add=function e(t){if(!v(t))t=_(t);var i=this.high>>>16;var r=this.high&65535;var n=this.low>>>16;var a=this.low&65535;var s=t.high>>>16;var o=t.high&65535;var c=t.low>>>16;var d=t.low&65535;var l=0,u=0,f=0,h=0;h+=a+d;f+=h>>>16;h&=65535;f+=n+c;u+=f>>>16;f&=65535;u+=r+o;l+=u>>>16;u&=65535;l+=i+s;l&=65535;return g(f<<16|h,l<<16|u,this.unsigned)};E.subtract=function e(t){if(!v(t))t=_(t);return this.add(t.neg())};E.sub=E.subtract;E.multiply=function e(t){if(this.isZero())return w;if(!v(t))t=_(t);if(m){var i=m["mul"](this.low,this.high,t.low,t.high);return g(i,m["get_high"](),this.unsigned)}if(t.isZero())return w;if(this.eq(R))return t.isOdd()?R:w;if(t.eq(R))return this.isOdd()?R:w;if(this.isNegative()){if(t.isNegative())return this.neg().mul(t.neg());else return this.neg().mul(t).neg()}else if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(b)&&t.lt(b))return y(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16;var n=this.high&65535;var a=this.low>>>16;var s=this.low&65535;var o=t.high>>>16;var c=t.high&65535;var d=t.low>>>16;var l=t.low&65535;var u=0,f=0,h=0,p=0;p+=s*l;h+=p>>>16;p&=65535;h+=a*l;f+=h>>>16;h&=65535;h+=s*d;f+=h>>>16;h&=65535;f+=n*l;u+=f>>>16;f&=65535;f+=a*d;u+=f>>>16;f&=65535;f+=s*c;u+=f>>>16;f&=65535;u+=r*l+n*d+a*c+s*o;u&=65535;return g(h<<16|p,u<<16|f,this.unsigned)};E.mul=E.multiply;E.divide=function e(t){if(!v(t))t=_(t);if(t.isZero())throw Error("division by zero");if(m){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1){return this}var i=(this.unsigned?m["div_u"]:m["div_s"])(this.low,this.high,t.low,t.high);return g(i,m["get_high"](),this.unsigned)}if(this.isZero())return this.unsigned?p:w;var r,n,a;if(!this.unsigned){if(this.eq(R)){if(t.eq(S)||t.eq(C))return R;else if(t.eq(R))return S;else{var s=this.shr(1);r=s.div(t).shl(1);if(r.eq(w)){return t.isNegative()?S:C}else{n=this.sub(t.mul(r));a=r.add(n.div(t));return a}}}else if(t.eq(R))return this.unsigned?p:w;if(this.isNegative()){if(t.isNegative())return this.neg().div(t.neg());return this.neg().div(t).neg()}else if(t.isNegative())return this.div(t.neg()).neg();a=w}else{if(!t.unsigned)t=t.toUnsigned();if(t.gt(this))return p;if(t.gt(this.shru(1)))return k;a=p}n=this;while(n.gte(t)){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));var o=Math.ceil(Math.log(r)/Math.LN2),c=o<=48?1:u(2,o-48),d=y(r),l=d.mul(t);while(l.isNegative()||l.gt(n)){r-=c;d=y(r,this.unsigned);l=d.mul(t)}if(d.isZero())d=S;a=a.add(d);n=n.sub(l)}return a};E.div=E.divide;E.modulo=function e(t){if(!v(t))t=_(t);if(m){var i=(this.unsigned?m["rem_u"]:m["rem_s"])(this.low,this.high,t.low,t.high);return g(i,m["get_high"](),this.unsigned)}return this.sub(this.div(t).mul(t))};E.mod=E.modulo;E.rem=E.modulo;E.not=function e(){return g(~this.low,~this.high,this.unsigned)};E.and=function e(t){if(!v(t))t=_(t);return g(this.low&t.low,this.high&t.high,this.unsigned)};E.or=function e(t){if(!v(t))t=_(t);return g(this.low|t.low,this.high|t.high,this.unsigned)};E.xor=function e(t){if(!v(t))t=_(t);return g(this.low^t.low,this.high^t.high,this.unsigned)};E.shiftLeft=function e(t){if(v(t))t=t.toInt();if((t&=63)===0)return this;else if(t<32)return g(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned);else return g(0,this.low<<t-32,this.unsigned)};E.shl=E.shiftLeft;E.shiftRight=function e(t){if(v(t))t=t.toInt();if((t&=63)===0)return this;else if(t<32)return g(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned);else return g(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};E.shr=E.shiftRight;E.shiftRightUnsigned=function e(t){if(v(t))t=t.toInt();if((t&=63)===0)return this;if(t<32)return g(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned);if(t===32)return g(this.high,0,this.unsigned);return g(this.high>>>t-32,0,this.unsigned)};E.shru=E.shiftRightUnsigned;E.shr_u=E.shiftRightUnsigned;E.rotateLeft=function e(t){var i;if(v(t))t=t.toInt();if((t&=63)===0)return this;if(t===32)return g(this.high,this.low,this.unsigned);if(t<32){i=32-t;return g(this.low<<t|this.high>>>i,this.high<<t|this.low>>>i,this.unsigned)}t-=32;i=32-t;return g(this.high<<t|this.low>>>i,this.low<<t|this.high>>>i,this.unsigned)};E.rotl=E.rotateLeft;E.rotateRight=function e(t){var i;if(v(t))t=t.toInt();if((t&=63)===0)return this;if(t===32)return g(this.high,this.low,this.unsigned);if(t<32){i=32-t;return g(this.high<<i|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned)}t-=32;i=32-t;return g(this.low<<i|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)};E.rotr=E.rotateRight;E.toSigned=function e(){if(!this.unsigned)return this;return g(this.low,this.high,false)};E.toUnsigned=function e(){if(this.unsigned)return this;return g(this.low,this.high,true)};E.toBytes=function e(t){return t?this.toBytesLE():this.toBytesBE()};E.toBytesLE=function e(){var t=this.high,i=this.low;return[i&255,i>>>8&255,i>>>16&255,i>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};E.toBytesBE=function e(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,i>>>24,i>>>16&255,i>>>8&255,i&255]};n.fromBytes=function e(t,i,r){return r?n.fromBytesLE(t,i):n.fromBytesBE(t,i)};n.fromBytesLE=function e(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)};n.fromBytesBE=function e(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)}},{}],129:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=function e(){r(this,e);this.items=[]};if(typeof n.prototype.push!=="function"){n.prototype.enqueue=function(){var e=arguments.length;if(e===0){return}for(var t=0;t<e;t++){this.items.push(arguments[t])}};n.prototype.dequeue=function(){var e=this.items.shift();return typeof e!=="undefined"?e:false};n.prototype.front=function(){return this.items[items.length-1]};n.prototype.isEmpty=function(){return this.items.length===0};n.prototype.size=function(){return this.items.length};n.prototype.clear=function(){this.items=[]};n.prototype.show=function(){return this.items};n.prototype.dequeueall=function(){var e=this.items;this.items=[];return e}}i.default=n},{}],130:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this.bytes=0;this.lgbytes=0;this.lgtime=0}r(e,[{key:"destroy",value:function e(){this.bytes=0;this.lgbytes=0;this.lgtime=0}},{key:"addbytes",value:function e(t){this.bytes+=t;if(this.lgtime==0){this.lgtime=(new Date).getTime()}}},{key:"getKBps",value:function e(){if(this.lgtime==0){return 0}var t=(new Date).getTime();var i=(this.bytes-this.lgbytes)/(t-this.lgtime)*.9765625;this.lgbytes=this.bytes;this.lgtime=t;return i}}]);return e}();i.default=a},{}]},{},[95])(95)});